{"version":3,"sources":["webpack:///app.min.js","webpack:///webpack/bootstrap d93fc0d6f2d278c250ea","webpack:///./~/es6-promise/dist/es6-promise.js","webpack:///./~/process/browser.js","webpack:///./~/whatwg-fetch/fetch.js","webpack:///./src/app/js/es6/app.js","webpack:///./src/app/js/es6/modules/Flingable.js","webpack:///./src/app/js/es6/modules/Resizable.js","webpack:///./src/app/js/es6/modules/Utility.js","webpack:///./src/app/js/es6/modules/Modal.js","webpack:///./src/app/js/es6/modules/keymaster.js","webpack:///./src/app/js/es6/modules/modalCanvasSize.js","webpack:///./src/app/js/es6/modules/modalOpenPattern.js","webpack:///./src/app/js/es6/modules/parseRLEFile.js","webpack:///./src/app/js/es6/modules/parseBMP.js","webpack:///./src/app/js/es6/modules/modalSavePattern.js","webpack:///./src/app/js/es6/modules/modalSharePattern.js","webpack:///./src/app/js/es6/modules/parseRLEPixelString.js","webpack:///./src/app/js/es6/modules/patToRleFileString.js","webpack:///./src/app/js/es6/modules/dataArrayToRLE.js","webpack:///./src/app/js/es6/modules/saveTextAsFile.js","webpack:///./~/hammerjs/hammer.js","webpack:///./src/app/js/es6/modules/tooltips-and-stacking.js","webpack:///./~/gator/gator.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","__WEBPACK_AMD_DEFINE_FACTORY__","__WEBPACK_AMD_DEFINE_RESULT__","process","global","_typeof","Symbol","iterator","obj","constructor","factory","undefined","objectOrFunction","x","isFunction","setScheduler","scheduleFn","customSchedulerFn","setAsap","asapFn","asap","useNextTick","nextTick","flush","useVertxTimer","vertxNext","useMutationObserver","iterations","observer","BrowserMutationObserver","node","document","createTextNode","observe","characterData","data","useMessageChannel","channel","MessageChannel","port1","onmessage","port2","postMessage","useSetTimeout","globalSetTimeout","setTimeout","i","len","callback","queue","arg","attemptVertx","vertx","runOnLoop","runOnContext","e","then","onFulfillment","onRejection","_arguments","arguments","parent","this","child","noop","PROMISE_ID","makePromise","_state","invokeCallback","_result","subscribe","resolve","object","Constructor","promise","_resolve","selfFulfillment","TypeError","cannotReturnOwn","getThen","error","GET_THEN_ERROR","tryThen","value","fulfillmentHandler","rejectionHandler","handleForeignThenable","thenable","sealed","fulfill","reason","_reject","_label","handleOwnThenable","FULFILLED","REJECTED","handleMaybeThenable","maybeThenable","then$$","publishRejection","_onerror","publish","PENDING","_subscribers","length","subscribers","settled","detail","ErrorObject","tryCatch","TRY_CATCH_ERROR","hasCallback","succeeded","failed","initializePromise","resolver","nextId","Enumerator","input","_instanceConstructor","isArray","_input","_remaining","Array","_enumerate","validationError","Error","all","entries","race","reject","_","needsResolver","needsNew","Promise","polyfill","local","self","Function","P","promiseToString","Object","prototype","toString","cast","_isArray","scheduleFlush","browserWindow","window","browserGlobal","MutationObserver","WebKitMutationObserver","isNode","isWorker","Uint8ClampedArray","importScripts","Math","random","substring","_eachEntry","entry","resolve$$","_then","_settledAt","_willSettleAt","state","enumerator","_setScheduler","_setAsap","_asap","catch","defaultSetTimout","defaultClearTimeout","runTimeout","fun","cachedSetTimeout","runClearTimeout","marker","cachedClearTimeout","clearTimeout","cleanUpNextTick","draining","currentQueue","concat","queueIndex","drainQueue","timeout","run","Item","array","args","push","apply","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","binding","name","cwd","chdir","dir","umask","normalizeName","String","test","toLowerCase","normalizeValue","iteratorFor","items","next","shift","done","support","iterable","Headers","headers","map","forEach","append","getOwnPropertyNames","consumed","body","bodyUsed","fileReaderReady","reader","onload","result","onerror","readBlobAsArrayBuffer","blob","FileReader","readAsArrayBuffer","readBlobAsText","readAsText","Body","_initBody","_bodyInit","_bodyText","Blob","isPrototypeOf","_bodyBlob","formData","FormData","_bodyFormData","searchParams","URLSearchParams","arrayBuffer","ArrayBuffer","get","set","type","rejected","text","decode","json","JSON","parse","normalizeMethod","method","upcased","toUpperCase","methods","indexOf","Request","options","url","credentials","mode","referrer","form","trim","split","bytes","replace","join","decodeURIComponent","xhr","head","pairs","getAllResponseHeaders","header","key","Response","bodyInit","status","ok","statusText","fetch","list","values","getAll","has","hasOwnProperty","thisArg","keys","clone","response","redirectStatuses","redirect","RangeError","location","init","responseURL","getResponseHeader","request","XMLHttpRequest","responseText","ontimeout","open","withCredentials","responseType","setRequestHeader","send","Flingable","Resizable","ut","Modal","modalCanvasSize","modalOpenPattern","modalSavePattern","modalSharePattern","parseRLEPixelString","patToRleFileString","dataArrayToRLE","saveTextAsFile","Hammer","w","doc","htmlEl","documentElement","bodyEl","scrollSs","querySelector","sheet","outerBgEl","innerViewEl","canvasEl","canvasCtx","getContext","splashEl","navCanvasEl","navCanvasCtx","navOutlineEl","toolboxEl","toolboxButtonEls","querySelectorAll","infoCursorXEl","infoCursorYEl","infoDimensionXEl","infoDimensionYEl","infoCanvasSizeButtonEl","playerPanelEl","playerToroidalWrapperEl","playerToroidalInputEl","playerSpeedEl","playerSpeedInputEl","playerCounterEl","playerClearButtonEl","playerResetButtonEl","playerPlayButtonEl","playerStepButtonEl","patternsPanelEl","patternsOuterWrapperEl","patternsOpenButtonEl","patternsSaveButtonEl","patternsShareButtonEl","patternsWrapperEl","patternsListItemEls","meterButtonMobileEl","menuButtonMobileEl","patternsButtonMobileEl","requestFullscreenButtonEl","exitFullscreenButtonEl","panelArray","create","isSafari","navigator","vendor","isBlink","isMac","platform","shortkey","isFirefox","userAgent","userIsDrawing","pointerIsHoveringResizableEdge","innerView","dragPageStart","dragScrollStart","isDragging","mouseIsDown","scroll","canvas","overflowsInnerView","domDim","scale","toolbox","tool","selectedButton","nav","outline","posX","posY","percentageX","percentageY","player","isPlaying","toroidal","generation","delay","patterns","scrollbarDim","nextFrameID","panelElement","initFlingable","flingCoast","flingContainer","flingHandleEl","patternPanel","extend","rzblAbortResize","isDrawing","isModalOpen","reportResizing","isResizing","panelIsResizing","initResizable","rzblTop","rzblHorizontalCssProp","Gator","target","className","preventDefault","getVisibleDimensions","visibleWidth","clientWidth","visibleHeight","clientHeight","onResize","evaluateOverflow","onScroll","scrollLeft","y","scrollTop","updateNavOutline","setScrollPosition","max","onPointerDown","isBig","pageX","pageY","addEventListener","onDragMove","onDragEnd","moveX","moveY","removeEventListener","setCanvasDim","width","height","imageSmoothingEnabled","fillStyle","clearMainAndNavCanvases","setNavigatorCanvasDimensions","textContent","imageData","getImageData","pixelBuffer","Int32Array","buffer","containerMaxWidth","containerMaxHeight","mainCanvasX","mainCanvasY","navWidth","navHeight","containerAspectRatio","canvasAspectRatio","round","style","clearDataArray","dataArray","Int8Array","cWidth","cHeight","clearRect","paintBothCanvasesPerfCounter","paintBothCanvasesDuration","paintBothCanvasesBitwise","paintBothCanvasesStart","performance","now","dataArr","pixels","putImageData","paintBothCanvasesEnd","console","log","draw","sc","scrollX","scrollY","arrayVal","targetOffsetLeft","targetOffsetTop","transOffsetLeft","transOffsetTop","pointerCount","targetTouches","pointerArray","touches","offsetLeft","offsetTop","floor","marginLeft","j","drawX","drawY","fillRect","override","isHoveringResizableEdge","which","parseInt","getComputedStyle","voidCurrentSelectedPatternLink","clearAnyHash","onPointerUp","handleResize","newWidth","newHeight","anchorX","anchorY","oldWidth","oldHeight","oldDataArray","newDataArray","oldCenterMap","left","center","right","top","middle","bottom","oldXOffset","oldYOffset","xLen","min","yLen","newCenterMap","newXOffset","newYOffset","redrawCanvasFromDataArray","repaintBoxShadow","classList","remove","add","handleIncrementalZoom","keybindingZoomDirection","currentScale","newScale","prevScroll","overflowed","zoomArray","direction","setAttribute","setScrollPositionBasedOnZoomEvent","canvasWidth","canvasHeight","theScale","newOverflow","newInnerViewWidth","newInnerViewHeight","removeNavOutlineDimensions","zoomPadding","pinchCenterX","pinchCenterY","pinchPanX","pinchPanY","prevScale","zoomCenterX","zoomCenterY","canvasTransX","canvasTransY","curCenteredFromLeft","curCenteredFromTop","canvasRawX","canvasRawY","newScrollX","newScrollY","handleFitZoom","innerViewVisWidth","innerViewVisHeight","innerViewVisibleProportion","canvasProportion","removeAttribute","hammerInnerV","Manager","touchAction","Pinch","initPinch","transform","initPinchCenter","newPinchCenter","setToolboxTool","newToolNameStr","getAttribute","mainCanvasVisibleX","mainCanvasVisibleY","padding","percentageVisibleX","percentageVisibleY","ratioBetweenCanvases","outlinePosX","outlinePosY","posy","updateCursorCoordinates","offsetX","offsetY","handleCoordinatesEnter","handleCoordinatesLeave","setSpeed","event","num","val","bitmapLookupArr","Uint8Array","bitmap","getTileFromFlatArray","countNonToroidal","ret","leftEdge","rightEdge","topEdge","bottomEdge","centerActive","neighborhoodCount","countToroidal","countLiveNeighbors","setToroidal","checked","renderNextGeneration","colorValue","requestAnimationFrame","pause","cancelAnimationFrame","onPlayerClearButton","onResetGenerationsCounter","onStepButton","play","onPlayStopButton","currentSelectedLink","parentNode","addPatternMargins","patPixArray","patWidth","patHeight","minCanvasX","minCanvasY","minMargin","outputWidth","outputHeight","newPixArray","curX","curY","isNonNegativeInteger","loadPatternJSONToCanvas","d","addMargin","patternStr","pattern","isToroidal","pixelArray","marginAddedObj","onPatternLinkClick","openCloseMobileFlyouts","patternListItem","href","fileName","pop","slice","history","replaceState","modalSetOpenState","bool","modalBeforeOpen","currentCanvasWidth","currentCanvasHeight","modalSubmit","resizeIconPositionX","resizeIconPositionY","fileExt","fileExtension","pat","parsedPattern","pathname","fileFormatEl","patternNameEl","patternAuthorEl","suppliedPatternName","usedPatternName","fileType","outputStr","orderedPatternForJSON","patternObj","author","stringify","modalInternalBinding","modalSharePatternFitsEl","urlDivEl","baseURL","patRLEObj","msg","linkURL","serializeToQueryString","innerHTML","focus","copyTextToClipBoard","setScope","filter","tagName","srcElement","repeat","toggle","click","hash","requestFullScreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullScreen","exitFullScreen","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","mobileRefreshEl","onPointerStartAnyPanelButton","onTouchEndAnyPanelButton","activeFlyout","flyoutTargets","meter","buttonEl","targetEl","menu","button","pointeredStr","activeTarget","pointeredTarget","contains","addFirefoxScrollStyleElements","widthInvert","createElement","widthLighter","heightInvert","heightLighter","cornerBox","heightInvertPatterns","heightLighterPatterns","heightSingleLine","cloneNode","insertBefore","appendChild","writeScrollbarDependentRules","rulesLength","cssRules","deleteRule","insertRule","deriveViewportDependentConstants","matchMedia","matches","offsetWidth","onWindowResize","splashTimeout","loadBlankCanvasBasedOnViewportDimensions","initialWidth","initialHeight","loadInitialCanvas","link","qsObj","deserializeQueryString","debounce","throttleRaf","hideSplash","removeChild","onPageLoad","recordComputedStyle","cutsMustard","readyState","elem","opts","element","background","coast","flingFriction","css","isFlingDragging","isFlingMoving","flingDragPositionX","flingDragPositionY","flingPositionX","flingPositionY","flingVelocityX","flingVelocityY","flingAccelX","flingAccelY","flingMouseDown","bind","flingMouseMove","flingMouseUp","elemToListenOn","transformProp","prefixProp","htmlElStyle","prefixArr","rzblHoveringEdge","measureContainers","flingPageStartX","flingPageStartY","flingItemBeginX","flingItemBeginY","flingAnimate","that","applyDragForce","containFling","renderFling","boundRect","getBoundingClientRect","str","translateX","translateY","flingForceX","flingForceY","abs","axis","drag","span","offsetDirection","__WEBPACK_AMD_DEFINE_ARRAY__","opt","rzblOnTopEdge","rzblOnRightEdge","rzblOnBottomEdge","rzblOnLeftEdge","rzblDragStartX","rzblDragStartY","rzblCalcEdges","rzblMouseDown","rzblMouseMove","rzblMouseUp","recordComputedStyleOnLoad","computedStyle","stripPixelUnits","rzblRight","rzblBottom","rzblLeft","rzblVerticalCssProp","rzblMinHeight","rzblMinWidth","rzblTolerance","boundTop","boundRight","boundBottom","boundLeft","clientX","clientY","tol","hoveredEdge","withinElementX","withinElementY","nearTopLine","nearRightLine","nearBottomLine","nearLeftLine","rzblIsHovering","stopPropagation","rzblApplyCursorClass","panelEl","rzblHoveredEdge","cursor","abort","rzblEdgeClicked","rzblMoveX","rzblMoveY","rzblAnimate","currentHoveredEdge","newHoveredEdge","rzblRender","decimalPlaces","Number","func","wait","context","timestamp","Date","later","last","ticking","getClosest","selector","firstChar","charAt","substr","hasAttribute","isDigit","n","Boolean","isFinite","parseFloat","prop","pair","selectContents","el","setSelectionRange","select","execCommand","modalWrapperElement","modalTitleEl","modalContentsEl","buttonElementToBind","modalOpenButtonElement","modalOpen","modalClose","modalOnOk","modalOnCancel","titleText","innerMarkup","modalOkButton","modalCancelButton","showError","errorText","errorEl","modalValidate","modalInternalUnbinding","modalAfterClose","index","item","compareArray","a1","a2","updateModifierKey","k","_mods","modifierMap","dispatch","handler","modifiersMatch","scope","keyCode","_downKeys","_MODIFIERS","assignKey","_handlers","getScope","mods","returnValue","cancelBubble","clearModifier","splice","resetModifiers","getKeys","getMods","code","shortcut","unbindKey","multipleKeys","isPressed","getPressedKeyCodes","_scope","deleteScope","handlers","mi","addEvent","attachEvent","noConflict","previousKey","16","18","17","91","⇧","⌥","alt","option","⌃","ctrl","control","⌘","command","_MAP","backspace","tab","clear","enter","return","esc","escape","space","up","down","del","delete","home","end","pageup","pagedown",",",".","/","`","-","=",";","'","[","]","\\","charCodeAt","toExport","unbind","onResizeDirectionButtonClick","resizeDirectionContainer","firstInput","getElementById","newWidthEl","newHeightEl","isNaN","stopImmediatePropagation","positions","parseRLEFile","parseBMP","fileInputEl","modalValidateFileInputChoice","modalValidateFileInputContents","isValid","validateBMP","file","bm","iHeader","bitsPerPixel","compressionMethod","readFile","fReader","ext","fileList","files","pos","chrctr","inComment","currentTerm","isSpace","isNewLine","stripTrailingSpaces","createEmptyPropIfNone","coordinates","dataV","DataView","fHeader","offsetToPixArray","getUint32","getUint16","stride","ceil","offset","indent","byteAddress","bitAddress","byteVal","bitVal","getUint8","runCount","runCountInteger","currentX","currentY","retStr","cropArray","arr","currWidth","currHeight","cropWidth","cropHeight","encodeArrayAsRLEString","currentChar","previousChar","previousCharCount","previousEndRowCount","posTopMost","posBottomMost","posLeftMost","posRightMost","patternWidth","patternHeight","croppedDataArray","destroyClickedElement","objURL","textStr","URL","revokeObjectURL","textFileAsBlob","downloadLink","download","createObjectURL","display","exportName","setTimeoutContext","fn","bindFn","invokeArrayArg","each","deprecate","message","deprecationMessage","stack","warn","inherit","base","properties","childP","baseP","_super","assign","boolOrFn","TYPE_FUNCTION","ifUndefined","val1","val2","addEventListeners","types","splitStr","removeEventListeners","hasParent","inStr","find","inArray","src","findByKey","toArray","uniqueArray","sort","results","a","b","prefixed","property","prefix","camelProp","VENDOR_PREFIXES","uniqueId","_uniqueId","getWindowForElement","ownerDocument","defaultView","parentWindow","Input","manager","inputTarget","domHandler","ev","enable","createInputInstance","Type","inputClass","SUPPORT_POINTER_EVENTS","PointerEventInput","SUPPORT_ONLY_TOUCH","TouchInput","SUPPORT_TOUCH","TouchMouseInput","MouseInput","inputHandler","eventType","pointersLen","pointers","changedPointersLen","changedPointers","isFirst","INPUT_START","isFinal","INPUT_END","INPUT_CANCEL","session","computeInputData","recognize","prevInput","pointersLength","simpleCloneInputData","firstMultiple","offsetCenter","getCenter","timeStamp","deltaTime","angle","getAngle","distance","getDistance","computeDeltaXY","getDirection","deltaX","deltaY","overallVelocity","getVelocity","overallVelocityX","overallVelocityY","getScale","rotation","getRotation","maxPointers","computeIntervalInputData","srcEvent","offsetDelta","prevDelta","velocity","velocityX","velocityY","lastInterval","COMPUTE_INTERVAL","v","DIRECTION_NONE","DIRECTION_LEFT","DIRECTION_RIGHT","DIRECTION_UP","DIRECTION_DOWN","p1","p2","props","PROPS_XY","sqrt","atan2","PI","start","PROPS_CLIENT_XY","evEl","MOUSE_ELEMENT_EVENTS","evWin","MOUSE_WINDOW_EVENTS","pressed","POINTER_ELEMENT_EVENTS","POINTER_WINDOW_EVENTS","store","pointerEvents","SingleTouchInput","evTarget","SINGLE_TOUCH_TARGET_EVENTS","SINGLE_TOUCH_WINDOW_EVENTS","started","normalizeSingleTouches","changed","changedTouches","TOUCH_TARGET_EVENTS","targetIds","getTouches","allTouches","INPUT_MOVE","identifier","changedTargetTouches","touch","mouse","primaryTouch","lastTouches","recordTouches","eventData","setLastTouch","lastTouch","lts","removeLastTouch","DEDUP_TIMEOUT","isSyntheticEvent","t","dx","dy","DEDUP_DISTANCE","TouchAction","cleanTouchActions","actions","TOUCH_ACTION_NONE","hasPanX","TOUCH_ACTION_PAN_X","hasPanY","TOUCH_ACTION_PAN_Y","TOUCH_ACTION_MANIPULATION","TOUCH_ACTION_AUTO","getTouchActionProps","NATIVE_TOUCH_ACTION","touchMap","cssSupports","CSS","supports","Recognizer","defaults","STATE_POSSIBLE","simultaneous","requireFail","stateStr","STATE_CANCELLED","STATE_ENDED","STATE_CHANGED","STATE_BEGAN","directionStr","getRecognizerByNameIfManager","otherRecognizer","recognizer","AttrRecognizer","PanRecognizer","pX","pY","PinchRecognizer","PressRecognizer","_timer","RotateRecognizer","SwipeRecognizer","TapRecognizer","pTime","pCenter","count","recognizers","preset","oldCssProps","toggleCssProps","recognizeWith","requireFailure","cssProps","triggerDomEvent","gestureEvent","createEvent","initEvent","gesture","dispatchEvent","TEST_ELEMENT","output","source","nextKey","dest","merge","MOBILE_REGEX","INPUT_TYPE_TOUCH","INPUT_TYPE_PEN","INPUT_TYPE_MOUSE","INPUT_TYPE_KINECT","DIRECTION_HORIZONTAL","DIRECTION_VERTICAL","DIRECTION_ALL","destroy","MOUSE_INPUT_MAP","mousedown","mousemove","mouseup","pointerType","POINTER_INPUT_MAP","pointerdown","pointermove","pointerup","pointercancel","pointerout","IE10_POINTER_TYPE_ENUM","2","3","4","5","MSPointerEvent","PointerEvent","removePointer","eventTypeNormalized","isTouch","storeIndex","pointerId","SINGLE_TOUCH_INPUT_MAP","touchstart","touchmove","touchend","touchcancel","TOUCH_INPUT_MAP","inputEvent","inputData","isMouse","sourceCapabilities","firesTouchEvents","PREFIXED_TOUCH_ACTION","TOUCH_ACTION_COMPUTE","TOUCH_ACTION_MAP","compute","update","getTouchAction","preventDefaults","prevented","hasNone","isTapPointer","isTapMovement","isTapTouchTime","preventSrc","STATE_RECOGNIZED","STATE_FAILED","dropRecognizeWith","dropRequireFailure","hasRequireFailures","canRecognizeWith","additionalEvent","tryEmit","canEmit","inputDataClone","reset","attrTest","optionPointers","isRecognized","threshold","directionTest","hasMoved","inOut","time","validPointers","validMovement","validTime","taps","interval","posThreshold","validTouchTime","failTimeout","validInterval","validMultiTap","tapCount","VERSION","domEvents","userSelect","touchSelect","touchCallout","contentZooming","userDrag","tapHighlightColor","STOP","FORCED_STOP","stop","force","stopped","curRecognizer","existing","events","Tap","Pan","Swipe","Rotate","Press","freeGlobal","inspectingTooltips","waitingPeriod","allowanceInterval","elementStack","addTooltip","abortTooltip","buttonElem","parentPanel","shufflePanelStack","getLayerNumber","applyZindexClasses","panelToGoOnTop","currentLayerNumber","_addEvent","gator","useCapture","_cancel","_getMatcher","_matcher","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","matchesSelector","_matchesSelector","boundElement","_level","_addHandler","_removeHandler","_handleEvent","match","_gatorInstances","matchesEvent","cancel","_bind","_getGlobalCallback","_id"],"mappings":"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","file":"app.min.js","sourcesContent":["/*!\n * Lifey. version 0.1.1\n * Copyright 2016 Benjamin Lord.\n * \n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n * \n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n * \n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(1);\n\t__webpack_require__(4);\n\tmodule.exports = __webpack_require__(5);\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;var require;/* WEBPACK VAR INJECTION */(function(process, global) {'use strict';\n\t\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\t\n\t/*!\n\t * @overview es6-promise - a tiny implementation of Promises/A+.\n\t * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)\n\t * @license   Licensed under MIT license\n\t *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE\n\t * @version   4.0.2\n\t */\n\t\n\t(function (global, factory) {\n\t  ( false ? 'undefined' : _typeof(exports)) === 'object' && typeof module !== 'undefined' ? module.exports = factory() :  true ? !(__WEBPACK_AMD_DEFINE_FACTORY__ = (factory), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)) : global.ES6Promise = factory();\n\t})(undefined, function () {\n\t  'use strict';\n\t\n\t  function objectOrFunction(x) {\n\t    return typeof x === 'function' || (typeof x === 'undefined' ? 'undefined' : _typeof(x)) === 'object' && x !== null;\n\t  }\n\t\n\t  function isFunction(x) {\n\t    return typeof x === 'function';\n\t  }\n\t\n\t  var _isArray = undefined;\n\t  if (!Array.isArray) {\n\t    _isArray = function _isArray(x) {\n\t      return Object.prototype.toString.call(x) === '[object Array]';\n\t    };\n\t  } else {\n\t    _isArray = Array.isArray;\n\t  }\n\t\n\t  var isArray = _isArray;\n\t\n\t  var len = 0;\n\t  var vertxNext = undefined;\n\t  var customSchedulerFn = undefined;\n\t\n\t  var asap = function asap(callback, arg) {\n\t    queue[len] = callback;\n\t    queue[len + 1] = arg;\n\t    len += 2;\n\t    if (len === 2) {\n\t      // If len is 2, that means that we need to schedule an async flush.\n\t      // If additional callbacks are queued before the queue is flushed, they\n\t      // will be processed by this flush that we are scheduling.\n\t      if (customSchedulerFn) {\n\t        customSchedulerFn(flush);\n\t      } else {\n\t        scheduleFlush();\n\t      }\n\t    }\n\t  };\n\t\n\t  function setScheduler(scheduleFn) {\n\t    customSchedulerFn = scheduleFn;\n\t  }\n\t\n\t  function setAsap(asapFn) {\n\t    asap = asapFn;\n\t  }\n\t\n\t  var browserWindow = typeof window !== 'undefined' ? window : undefined;\n\t  var browserGlobal = browserWindow || {};\n\t  var BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;\n\t  var isNode = typeof self === 'undefined' && typeof process !== 'undefined' && {}.toString.call(process) === '[object process]';\n\t\n\t  // test for web worker but not in IE10\n\t  var isWorker = typeof Uint8ClampedArray !== 'undefined' && typeof importScripts !== 'undefined' && typeof MessageChannel !== 'undefined';\n\t\n\t  // node\n\t  function useNextTick() {\n\t    // node version 0.10.x displays a deprecation warning when nextTick is used recursively\n\t    // see https://github.com/cujojs/when/issues/410 for details\n\t    return function () {\n\t      return process.nextTick(flush);\n\t    };\n\t  }\n\t\n\t  // vertx\n\t  function useVertxTimer() {\n\t    return function () {\n\t      vertxNext(flush);\n\t    };\n\t  }\n\t\n\t  function useMutationObserver() {\n\t    var iterations = 0;\n\t    var observer = new BrowserMutationObserver(flush);\n\t    var node = document.createTextNode('');\n\t    observer.observe(node, { characterData: true });\n\t\n\t    return function () {\n\t      node.data = iterations = ++iterations % 2;\n\t    };\n\t  }\n\t\n\t  // web worker\n\t  function useMessageChannel() {\n\t    var channel = new MessageChannel();\n\t    channel.port1.onmessage = flush;\n\t    return function () {\n\t      return channel.port2.postMessage(0);\n\t    };\n\t  }\n\t\n\t  function useSetTimeout() {\n\t    // Store setTimeout reference so es6-promise will be unaffected by\n\t    // other code modifying setTimeout (like sinon.useFakeTimers())\n\t    var globalSetTimeout = setTimeout;\n\t    return function () {\n\t      return globalSetTimeout(flush, 1);\n\t    };\n\t  }\n\t\n\t  var queue = new Array(1000);\n\t  function flush() {\n\t    for (var i = 0; i < len; i += 2) {\n\t      var callback = queue[i];\n\t      var arg = queue[i + 1];\n\t\n\t      callback(arg);\n\t\n\t      queue[i] = undefined;\n\t      queue[i + 1] = undefined;\n\t    }\n\t\n\t    len = 0;\n\t  }\n\t\n\t  function attemptVertx() {\n\t    try {\n\t      var r = require;\n\t      var vertx = __webpack_require__(3);\n\t      vertxNext = vertx.runOnLoop || vertx.runOnContext;\n\t      return useVertxTimer();\n\t    } catch (e) {\n\t      return useSetTimeout();\n\t    }\n\t  }\n\t\n\t  var scheduleFlush = undefined;\n\t  // Decide what async method to use to triggering processing of queued callbacks:\n\t  if (isNode) {\n\t    scheduleFlush = useNextTick();\n\t  } else if (BrowserMutationObserver) {\n\t    scheduleFlush = useMutationObserver();\n\t  } else if (isWorker) {\n\t    scheduleFlush = useMessageChannel();\n\t  } else if (browserWindow === undefined && \"function\" === 'function') {\n\t    scheduleFlush = attemptVertx();\n\t  } else {\n\t    scheduleFlush = useSetTimeout();\n\t  }\n\t\n\t  function then(onFulfillment, onRejection) {\n\t    var _arguments = arguments;\n\t\n\t    var parent = this;\n\t\n\t    var child = new this.constructor(noop);\n\t\n\t    if (child[PROMISE_ID] === undefined) {\n\t      makePromise(child);\n\t    }\n\t\n\t    var _state = parent._state;\n\t\n\t    if (_state) {\n\t      (function () {\n\t        var callback = _arguments[_state - 1];\n\t        asap(function () {\n\t          return invokeCallback(_state, child, callback, parent._result);\n\t        });\n\t      })();\n\t    } else {\n\t      subscribe(parent, child, onFulfillment, onRejection);\n\t    }\n\t\n\t    return child;\n\t  }\n\t\n\t  /**\n\t    `Promise.resolve` returns a promise that will become resolved with the\n\t    passed `value`. It is shorthand for the following:\n\t  \n\t    ```javascript\n\t    let promise = new Promise(function(resolve, reject){\n\t      resolve(1);\n\t    });\n\t  \n\t    promise.then(function(value){\n\t      // value === 1\n\t    });\n\t    ```\n\t  \n\t    Instead of writing the above, your code now simply becomes the following:\n\t  \n\t    ```javascript\n\t    let promise = Promise.resolve(1);\n\t  \n\t    promise.then(function(value){\n\t      // value === 1\n\t    });\n\t    ```\n\t  \n\t    @method resolve\n\t    @static\n\t    @param {Any} value value that the returned promise will be resolved with\n\t    Useful for tooling.\n\t    @return {Promise} a promise that will become fulfilled with the given\n\t    `value`\n\t  */\n\t  function resolve(object) {\n\t    /*jshint validthis:true */\n\t    var Constructor = this;\n\t\n\t    if (object && (typeof object === 'undefined' ? 'undefined' : _typeof(object)) === 'object' && object.constructor === Constructor) {\n\t      return object;\n\t    }\n\t\n\t    var promise = new Constructor(noop);\n\t    _resolve(promise, object);\n\t    return promise;\n\t  }\n\t\n\t  var PROMISE_ID = Math.random().toString(36).substring(16);\n\t\n\t  function noop() {}\n\t\n\t  var PENDING = void 0;\n\t  var FULFILLED = 1;\n\t  var REJECTED = 2;\n\t\n\t  var GET_THEN_ERROR = new ErrorObject();\n\t\n\t  function selfFulfillment() {\n\t    return new TypeError(\"You cannot resolve a promise with itself\");\n\t  }\n\t\n\t  function cannotReturnOwn() {\n\t    return new TypeError('A promises callback cannot return that same promise.');\n\t  }\n\t\n\t  function getThen(promise) {\n\t    try {\n\t      return promise.then;\n\t    } catch (error) {\n\t      GET_THEN_ERROR.error = error;\n\t      return GET_THEN_ERROR;\n\t    }\n\t  }\n\t\n\t  function tryThen(then, value, fulfillmentHandler, rejectionHandler) {\n\t    try {\n\t      then.call(value, fulfillmentHandler, rejectionHandler);\n\t    } catch (e) {\n\t      return e;\n\t    }\n\t  }\n\t\n\t  function handleForeignThenable(promise, thenable, then) {\n\t    asap(function (promise) {\n\t      var sealed = false;\n\t      var error = tryThen(then, thenable, function (value) {\n\t        if (sealed) {\n\t          return;\n\t        }\n\t        sealed = true;\n\t        if (thenable !== value) {\n\t          _resolve(promise, value);\n\t        } else {\n\t          fulfill(promise, value);\n\t        }\n\t      }, function (reason) {\n\t        if (sealed) {\n\t          return;\n\t        }\n\t        sealed = true;\n\t\n\t        _reject(promise, reason);\n\t      }, 'Settle: ' + (promise._label || ' unknown promise'));\n\t\n\t      if (!sealed && error) {\n\t        sealed = true;\n\t        _reject(promise, error);\n\t      }\n\t    }, promise);\n\t  }\n\t\n\t  function handleOwnThenable(promise, thenable) {\n\t    if (thenable._state === FULFILLED) {\n\t      fulfill(promise, thenable._result);\n\t    } else if (thenable._state === REJECTED) {\n\t      _reject(promise, thenable._result);\n\t    } else {\n\t      subscribe(thenable, undefined, function (value) {\n\t        return _resolve(promise, value);\n\t      }, function (reason) {\n\t        return _reject(promise, reason);\n\t      });\n\t    }\n\t  }\n\t\n\t  function handleMaybeThenable(promise, maybeThenable, then$$) {\n\t    if (maybeThenable.constructor === promise.constructor && then$$ === then && maybeThenable.constructor.resolve === resolve) {\n\t      handleOwnThenable(promise, maybeThenable);\n\t    } else {\n\t      if (then$$ === GET_THEN_ERROR) {\n\t        _reject(promise, GET_THEN_ERROR.error);\n\t      } else if (then$$ === undefined) {\n\t        fulfill(promise, maybeThenable);\n\t      } else if (isFunction(then$$)) {\n\t        handleForeignThenable(promise, maybeThenable, then$$);\n\t      } else {\n\t        fulfill(promise, maybeThenable);\n\t      }\n\t    }\n\t  }\n\t\n\t  function _resolve(promise, value) {\n\t    if (promise === value) {\n\t      _reject(promise, selfFulfillment());\n\t    } else if (objectOrFunction(value)) {\n\t      handleMaybeThenable(promise, value, getThen(value));\n\t    } else {\n\t      fulfill(promise, value);\n\t    }\n\t  }\n\t\n\t  function publishRejection(promise) {\n\t    if (promise._onerror) {\n\t      promise._onerror(promise._result);\n\t    }\n\t\n\t    publish(promise);\n\t  }\n\t\n\t  function fulfill(promise, value) {\n\t    if (promise._state !== PENDING) {\n\t      return;\n\t    }\n\t\n\t    promise._result = value;\n\t    promise._state = FULFILLED;\n\t\n\t    if (promise._subscribers.length !== 0) {\n\t      asap(publish, promise);\n\t    }\n\t  }\n\t\n\t  function _reject(promise, reason) {\n\t    if (promise._state !== PENDING) {\n\t      return;\n\t    }\n\t    promise._state = REJECTED;\n\t    promise._result = reason;\n\t\n\t    asap(publishRejection, promise);\n\t  }\n\t\n\t  function subscribe(parent, child, onFulfillment, onRejection) {\n\t    var _subscribers = parent._subscribers;\n\t    var length = _subscribers.length;\n\t\n\t    parent._onerror = null;\n\t\n\t    _subscribers[length] = child;\n\t    _subscribers[length + FULFILLED] = onFulfillment;\n\t    _subscribers[length + REJECTED] = onRejection;\n\t\n\t    if (length === 0 && parent._state) {\n\t      asap(publish, parent);\n\t    }\n\t  }\n\t\n\t  function publish(promise) {\n\t    var subscribers = promise._subscribers;\n\t    var settled = promise._state;\n\t\n\t    if (subscribers.length === 0) {\n\t      return;\n\t    }\n\t\n\t    var child = undefined,\n\t        callback = undefined,\n\t        detail = promise._result;\n\t\n\t    for (var i = 0; i < subscribers.length; i += 3) {\n\t      child = subscribers[i];\n\t      callback = subscribers[i + settled];\n\t\n\t      if (child) {\n\t        invokeCallback(settled, child, callback, detail);\n\t      } else {\n\t        callback(detail);\n\t      }\n\t    }\n\t\n\t    promise._subscribers.length = 0;\n\t  }\n\t\n\t  function ErrorObject() {\n\t    this.error = null;\n\t  }\n\t\n\t  var TRY_CATCH_ERROR = new ErrorObject();\n\t\n\t  function tryCatch(callback, detail) {\n\t    try {\n\t      return callback(detail);\n\t    } catch (e) {\n\t      TRY_CATCH_ERROR.error = e;\n\t      return TRY_CATCH_ERROR;\n\t    }\n\t  }\n\t\n\t  function invokeCallback(settled, promise, callback, detail) {\n\t    var hasCallback = isFunction(callback),\n\t        value = undefined,\n\t        error = undefined,\n\t        succeeded = undefined,\n\t        failed = undefined;\n\t\n\t    if (hasCallback) {\n\t      value = tryCatch(callback, detail);\n\t\n\t      if (value === TRY_CATCH_ERROR) {\n\t        failed = true;\n\t        error = value.error;\n\t        value = null;\n\t      } else {\n\t        succeeded = true;\n\t      }\n\t\n\t      if (promise === value) {\n\t        _reject(promise, cannotReturnOwn());\n\t        return;\n\t      }\n\t    } else {\n\t      value = detail;\n\t      succeeded = true;\n\t    }\n\t\n\t    if (promise._state !== PENDING) {\n\t      // noop\n\t    } else if (hasCallback && succeeded) {\n\t      _resolve(promise, value);\n\t    } else if (failed) {\n\t      _reject(promise, error);\n\t    } else if (settled === FULFILLED) {\n\t      fulfill(promise, value);\n\t    } else if (settled === REJECTED) {\n\t      _reject(promise, value);\n\t    }\n\t  }\n\t\n\t  function initializePromise(promise, resolver) {\n\t    try {\n\t      resolver(function resolvePromise(value) {\n\t        _resolve(promise, value);\n\t      }, function rejectPromise(reason) {\n\t        _reject(promise, reason);\n\t      });\n\t    } catch (e) {\n\t      _reject(promise, e);\n\t    }\n\t  }\n\t\n\t  var id = 0;\n\t  function nextId() {\n\t    return id++;\n\t  }\n\t\n\t  function makePromise(promise) {\n\t    promise[PROMISE_ID] = id++;\n\t    promise._state = undefined;\n\t    promise._result = undefined;\n\t    promise._subscribers = [];\n\t  }\n\t\n\t  function Enumerator(Constructor, input) {\n\t    this._instanceConstructor = Constructor;\n\t    this.promise = new Constructor(noop);\n\t\n\t    if (!this.promise[PROMISE_ID]) {\n\t      makePromise(this.promise);\n\t    }\n\t\n\t    if (isArray(input)) {\n\t      this._input = input;\n\t      this.length = input.length;\n\t      this._remaining = input.length;\n\t\n\t      this._result = new Array(this.length);\n\t\n\t      if (this.length === 0) {\n\t        fulfill(this.promise, this._result);\n\t      } else {\n\t        this.length = this.length || 0;\n\t        this._enumerate();\n\t        if (this._remaining === 0) {\n\t          fulfill(this.promise, this._result);\n\t        }\n\t      }\n\t    } else {\n\t      _reject(this.promise, validationError());\n\t    }\n\t  }\n\t\n\t  function validationError() {\n\t    return new Error('Array Methods must be provided an Array');\n\t  };\n\t\n\t  Enumerator.prototype._enumerate = function () {\n\t    var length = this.length;\n\t    var _input = this._input;\n\t\n\t    for (var i = 0; this._state === PENDING && i < length; i++) {\n\t      this._eachEntry(_input[i], i);\n\t    }\n\t  };\n\t\n\t  Enumerator.prototype._eachEntry = function (entry, i) {\n\t    var c = this._instanceConstructor;\n\t    var resolve$$ = c.resolve;\n\t\n\t    if (resolve$$ === resolve) {\n\t      var _then = getThen(entry);\n\t\n\t      if (_then === then && entry._state !== PENDING) {\n\t        this._settledAt(entry._state, i, entry._result);\n\t      } else if (typeof _then !== 'function') {\n\t        this._remaining--;\n\t        this._result[i] = entry;\n\t      } else if (c === Promise) {\n\t        var promise = new c(noop);\n\t        handleMaybeThenable(promise, entry, _then);\n\t        this._willSettleAt(promise, i);\n\t      } else {\n\t        this._willSettleAt(new c(function (resolve$$) {\n\t          return resolve$$(entry);\n\t        }), i);\n\t      }\n\t    } else {\n\t      this._willSettleAt(resolve$$(entry), i);\n\t    }\n\t  };\n\t\n\t  Enumerator.prototype._settledAt = function (state, i, value) {\n\t    var promise = this.promise;\n\t\n\t    if (promise._state === PENDING) {\n\t      this._remaining--;\n\t\n\t      if (state === REJECTED) {\n\t        _reject(promise, value);\n\t      } else {\n\t        this._result[i] = value;\n\t      }\n\t    }\n\t\n\t    if (this._remaining === 0) {\n\t      fulfill(promise, this._result);\n\t    }\n\t  };\n\t\n\t  Enumerator.prototype._willSettleAt = function (promise, i) {\n\t    var enumerator = this;\n\t\n\t    subscribe(promise, undefined, function (value) {\n\t      return enumerator._settledAt(FULFILLED, i, value);\n\t    }, function (reason) {\n\t      return enumerator._settledAt(REJECTED, i, reason);\n\t    });\n\t  };\n\t\n\t  /**\n\t    `Promise.all` accepts an array of promises, and returns a new promise which\n\t    is fulfilled with an array of fulfillment values for the passed promises, or\n\t    rejected with the reason of the first passed promise to be rejected. It casts all\n\t    elements of the passed iterable to promises as it runs this algorithm.\n\t  \n\t    Example:\n\t  \n\t    ```javascript\n\t    let promise1 = resolve(1);\n\t    let promise2 = resolve(2);\n\t    let promise3 = resolve(3);\n\t    let promises = [ promise1, promise2, promise3 ];\n\t  \n\t    Promise.all(promises).then(function(array){\n\t      // The array here would be [ 1, 2, 3 ];\n\t    });\n\t    ```\n\t  \n\t    If any of the `promises` given to `all` are rejected, the first promise\n\t    that is rejected will be given as an argument to the returned promises's\n\t    rejection handler. For example:\n\t  \n\t    Example:\n\t  \n\t    ```javascript\n\t    let promise1 = resolve(1);\n\t    let promise2 = reject(new Error(\"2\"));\n\t    let promise3 = reject(new Error(\"3\"));\n\t    let promises = [ promise1, promise2, promise3 ];\n\t  \n\t    Promise.all(promises).then(function(array){\n\t      // Code here never runs because there are rejected promises!\n\t    }, function(error) {\n\t      // error.message === \"2\"\n\t    });\n\t    ```\n\t  \n\t    @method all\n\t    @static\n\t    @param {Array} entries array of promises\n\t    @param {String} label optional string for labeling the promise.\n\t    Useful for tooling.\n\t    @return {Promise} promise that is fulfilled when all `promises` have been\n\t    fulfilled, or rejected if any of them become rejected.\n\t    @static\n\t  */\n\t  function all(entries) {\n\t    return new Enumerator(this, entries).promise;\n\t  }\n\t\n\t  /**\n\t    `Promise.race` returns a new promise which is settled in the same way as the\n\t    first passed promise to settle.\n\t  \n\t    Example:\n\t  \n\t    ```javascript\n\t    let promise1 = new Promise(function(resolve, reject){\n\t      setTimeout(function(){\n\t        resolve('promise 1');\n\t      }, 200);\n\t    });\n\t  \n\t    let promise2 = new Promise(function(resolve, reject){\n\t      setTimeout(function(){\n\t        resolve('promise 2');\n\t      }, 100);\n\t    });\n\t  \n\t    Promise.race([promise1, promise2]).then(function(result){\n\t      // result === 'promise 2' because it was resolved before promise1\n\t      // was resolved.\n\t    });\n\t    ```\n\t  \n\t    `Promise.race` is deterministic in that only the state of the first\n\t    settled promise matters. For example, even if other promises given to the\n\t    `promises` array argument are resolved, but the first settled promise has\n\t    become rejected before the other promises became fulfilled, the returned\n\t    promise will become rejected:\n\t  \n\t    ```javascript\n\t    let promise1 = new Promise(function(resolve, reject){\n\t      setTimeout(function(){\n\t        resolve('promise 1');\n\t      }, 200);\n\t    });\n\t  \n\t    let promise2 = new Promise(function(resolve, reject){\n\t      setTimeout(function(){\n\t        reject(new Error('promise 2'));\n\t      }, 100);\n\t    });\n\t  \n\t    Promise.race([promise1, promise2]).then(function(result){\n\t      // Code here never runs\n\t    }, function(reason){\n\t      // reason.message === 'promise 2' because promise 2 became rejected before\n\t      // promise 1 became fulfilled\n\t    });\n\t    ```\n\t  \n\t    An example real-world use case is implementing timeouts:\n\t  \n\t    ```javascript\n\t    Promise.race([ajax('foo.json'), timeout(5000)])\n\t    ```\n\t  \n\t    @method race\n\t    @static\n\t    @param {Array} promises array of promises to observe\n\t    Useful for tooling.\n\t    @return {Promise} a promise which settles in the same way as the first passed\n\t    promise to settle.\n\t  */\n\t  function race(entries) {\n\t    /*jshint validthis:true */\n\t    var Constructor = this;\n\t\n\t    if (!isArray(entries)) {\n\t      return new Constructor(function (_, reject) {\n\t        return reject(new TypeError('You must pass an array to race.'));\n\t      });\n\t    } else {\n\t      return new Constructor(function (resolve, reject) {\n\t        var length = entries.length;\n\t        for (var i = 0; i < length; i++) {\n\t          Constructor.resolve(entries[i]).then(resolve, reject);\n\t        }\n\t      });\n\t    }\n\t  }\n\t\n\t  /**\n\t    `Promise.reject` returns a promise rejected with the passed `reason`.\n\t    It is shorthand for the following:\n\t  \n\t    ```javascript\n\t    let promise = new Promise(function(resolve, reject){\n\t      reject(new Error('WHOOPS'));\n\t    });\n\t  \n\t    promise.then(function(value){\n\t      // Code here doesn't run because the promise is rejected!\n\t    }, function(reason){\n\t      // reason.message === 'WHOOPS'\n\t    });\n\t    ```\n\t  \n\t    Instead of writing the above, your code now simply becomes the following:\n\t  \n\t    ```javascript\n\t    let promise = Promise.reject(new Error('WHOOPS'));\n\t  \n\t    promise.then(function(value){\n\t      // Code here doesn't run because the promise is rejected!\n\t    }, function(reason){\n\t      // reason.message === 'WHOOPS'\n\t    });\n\t    ```\n\t  \n\t    @method reject\n\t    @static\n\t    @param {Any} reason value that the returned promise will be rejected with.\n\t    Useful for tooling.\n\t    @return {Promise} a promise rejected with the given `reason`.\n\t  */\n\t  function reject(reason) {\n\t    /*jshint validthis:true */\n\t    var Constructor = this;\n\t    var promise = new Constructor(noop);\n\t    _reject(promise, reason);\n\t    return promise;\n\t  }\n\t\n\t  function needsResolver() {\n\t    throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');\n\t  }\n\t\n\t  function needsNew() {\n\t    throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\");\n\t  }\n\t\n\t  /**\n\t    Promise objects represent the eventual result of an asynchronous operation. The\n\t    primary way of interacting with a promise is through its `then` method, which\n\t    registers callbacks to receive either a promise's eventual value or the reason\n\t    why the promise cannot be fulfilled.\n\t  \n\t    Terminology\n\t    -----------\n\t  \n\t    - `promise` is an object or function with a `then` method whose behavior conforms to this specification.\n\t    - `thenable` is an object or function that defines a `then` method.\n\t    - `value` is any legal JavaScript value (including undefined, a thenable, or a promise).\n\t    - `exception` is a value that is thrown using the throw statement.\n\t    - `reason` is a value that indicates why a promise was rejected.\n\t    - `settled` the final resting state of a promise, fulfilled or rejected.\n\t  \n\t    A promise can be in one of three states: pending, fulfilled, or rejected.\n\t  \n\t    Promises that are fulfilled have a fulfillment value and are in the fulfilled\n\t    state.  Promises that are rejected have a rejection reason and are in the\n\t    rejected state.  A fulfillment value is never a thenable.\n\t  \n\t    Promises can also be said to *resolve* a value.  If this value is also a\n\t    promise, then the original promise's settled state will match the value's\n\t    settled state.  So a promise that *resolves* a promise that rejects will\n\t    itself reject, and a promise that *resolves* a promise that fulfills will\n\t    itself fulfill.\n\t  \n\t  \n\t    Basic Usage:\n\t    ------------\n\t  \n\t    ```js\n\t    let promise = new Promise(function(resolve, reject) {\n\t      // on success\n\t      resolve(value);\n\t  \n\t      // on failure\n\t      reject(reason);\n\t    });\n\t  \n\t    promise.then(function(value) {\n\t      // on fulfillment\n\t    }, function(reason) {\n\t      // on rejection\n\t    });\n\t    ```\n\t  \n\t    Advanced Usage:\n\t    ---------------\n\t  \n\t    Promises shine when abstracting away asynchronous interactions such as\n\t    `XMLHttpRequest`s.\n\t  \n\t    ```js\n\t    function getJSON(url) {\n\t      return new Promise(function(resolve, reject){\n\t        let xhr = new XMLHttpRequest();\n\t  \n\t        xhr.open('GET', url);\n\t        xhr.onreadystatechange = handler;\n\t        xhr.responseType = 'json';\n\t        xhr.setRequestHeader('Accept', 'application/json');\n\t        xhr.send();\n\t  \n\t        function handler() {\n\t          if (this.readyState === this.DONE) {\n\t            if (this.status === 200) {\n\t              resolve(this.response);\n\t            } else {\n\t              reject(new Error('getJSON: `' + url + '` failed with status: [' + this.status + ']'));\n\t            }\n\t          }\n\t        };\n\t      });\n\t    }\n\t  \n\t    getJSON('/posts.json').then(function(json) {\n\t      // on fulfillment\n\t    }, function(reason) {\n\t      // on rejection\n\t    });\n\t    ```\n\t  \n\t    Unlike callbacks, promises are great composable primitives.\n\t  \n\t    ```js\n\t    Promise.all([\n\t      getJSON('/posts'),\n\t      getJSON('/comments')\n\t    ]).then(function(values){\n\t      values[0] // => postsJSON\n\t      values[1] // => commentsJSON\n\t  \n\t      return values;\n\t    });\n\t    ```\n\t  \n\t    @class Promise\n\t    @param {function} resolver\n\t    Useful for tooling.\n\t    @constructor\n\t  */\n\t  function Promise(resolver) {\n\t    this[PROMISE_ID] = nextId();\n\t    this._result = this._state = undefined;\n\t    this._subscribers = [];\n\t\n\t    if (noop !== resolver) {\n\t      typeof resolver !== 'function' && needsResolver();\n\t      this instanceof Promise ? initializePromise(this, resolver) : needsNew();\n\t    }\n\t  }\n\t\n\t  Promise.all = all;\n\t  Promise.race = race;\n\t  Promise.resolve = resolve;\n\t  Promise.reject = reject;\n\t  Promise._setScheduler = setScheduler;\n\t  Promise._setAsap = setAsap;\n\t  Promise._asap = asap;\n\t\n\t  Promise.prototype = {\n\t    constructor: Promise,\n\t\n\t    /**\n\t      The primary way of interacting with a promise is through its `then` method,\n\t      which registers callbacks to receive either a promise's eventual value or the\n\t      reason why the promise cannot be fulfilled.\n\t    \n\t      ```js\n\t      findUser().then(function(user){\n\t        // user is available\n\t      }, function(reason){\n\t        // user is unavailable, and you are given the reason why\n\t      });\n\t      ```\n\t    \n\t      Chaining\n\t      --------\n\t    \n\t      The return value of `then` is itself a promise.  This second, 'downstream'\n\t      promise is resolved with the return value of the first promise's fulfillment\n\t      or rejection handler, or rejected if the handler throws an exception.\n\t    \n\t      ```js\n\t      findUser().then(function (user) {\n\t        return user.name;\n\t      }, function (reason) {\n\t        return 'default name';\n\t      }).then(function (userName) {\n\t        // If `findUser` fulfilled, `userName` will be the user's name, otherwise it\n\t        // will be `'default name'`\n\t      });\n\t    \n\t      findUser().then(function (user) {\n\t        throw new Error('Found user, but still unhappy');\n\t      }, function (reason) {\n\t        throw new Error('`findUser` rejected and we're unhappy');\n\t      }).then(function (value) {\n\t        // never reached\n\t      }, function (reason) {\n\t        // if `findUser` fulfilled, `reason` will be 'Found user, but still unhappy'.\n\t        // If `findUser` rejected, `reason` will be '`findUser` rejected and we're unhappy'.\n\t      });\n\t      ```\n\t      If the downstream promise does not specify a rejection handler, rejection reasons will be propagated further downstream.\n\t    \n\t      ```js\n\t      findUser().then(function (user) {\n\t        throw new PedagogicalException('Upstream error');\n\t      }).then(function (value) {\n\t        // never reached\n\t      }).then(function (value) {\n\t        // never reached\n\t      }, function (reason) {\n\t        // The `PedgagocialException` is propagated all the way down to here\n\t      });\n\t      ```\n\t    \n\t      Assimilation\n\t      ------------\n\t    \n\t      Sometimes the value you want to propagate to a downstream promise can only be\n\t      retrieved asynchronously. This can be achieved by returning a promise in the\n\t      fulfillment or rejection handler. The downstream promise will then be pending\n\t      until the returned promise is settled. This is called *assimilation*.\n\t    \n\t      ```js\n\t      findUser().then(function (user) {\n\t        return findCommentsByAuthor(user);\n\t      }).then(function (comments) {\n\t        // The user's comments are now available\n\t      });\n\t      ```\n\t    \n\t      If the assimliated promise rejects, then the downstream promise will also reject.\n\t    \n\t      ```js\n\t      findUser().then(function (user) {\n\t        return findCommentsByAuthor(user);\n\t      }).then(function (comments) {\n\t        // If `findCommentsByAuthor` fulfills, we'll have the value here\n\t      }, function (reason) {\n\t        // If `findCommentsByAuthor` rejects, we'll have the reason here\n\t      });\n\t      ```\n\t    \n\t      Simple Example\n\t      --------------\n\t    \n\t      Synchronous Example\n\t    \n\t      ```javascript\n\t      let result;\n\t    \n\t      try {\n\t        result = findResult();\n\t        // success\n\t      } catch(reason) {\n\t        // failure\n\t      }\n\t      ```\n\t    \n\t      Errback Example\n\t    \n\t      ```js\n\t      findResult(function(result, err){\n\t        if (err) {\n\t          // failure\n\t        } else {\n\t          // success\n\t        }\n\t      });\n\t      ```\n\t    \n\t      Promise Example;\n\t    \n\t      ```javascript\n\t      findResult().then(function(result){\n\t        // success\n\t      }, function(reason){\n\t        // failure\n\t      });\n\t      ```\n\t    \n\t      Advanced Example\n\t      --------------\n\t    \n\t      Synchronous Example\n\t    \n\t      ```javascript\n\t      let author, books;\n\t    \n\t      try {\n\t        author = findAuthor();\n\t        books  = findBooksByAuthor(author);\n\t        // success\n\t      } catch(reason) {\n\t        // failure\n\t      }\n\t      ```\n\t    \n\t      Errback Example\n\t    \n\t      ```js\n\t    \n\t      function foundBooks(books) {\n\t    \n\t      }\n\t    \n\t      function failure(reason) {\n\t    \n\t      }\n\t    \n\t      findAuthor(function(author, err){\n\t        if (err) {\n\t          failure(err);\n\t          // failure\n\t        } else {\n\t          try {\n\t            findBoooksByAuthor(author, function(books, err) {\n\t              if (err) {\n\t                failure(err);\n\t              } else {\n\t                try {\n\t                  foundBooks(books);\n\t                } catch(reason) {\n\t                  failure(reason);\n\t                }\n\t              }\n\t            });\n\t          } catch(error) {\n\t            failure(err);\n\t          }\n\t          // success\n\t        }\n\t      });\n\t      ```\n\t    \n\t      Promise Example;\n\t    \n\t      ```javascript\n\t      findAuthor().\n\t        then(findBooksByAuthor).\n\t        then(function(books){\n\t          // found books\n\t      }).catch(function(reason){\n\t        // something went wrong\n\t      });\n\t      ```\n\t    \n\t      @method then\n\t      @param {Function} onFulfilled\n\t      @param {Function} onRejected\n\t      Useful for tooling.\n\t      @return {Promise}\n\t    */\n\t    then: then,\n\t\n\t    /**\n\t      `catch` is simply sugar for `then(undefined, onRejection)` which makes it the same\n\t      as the catch block of a try/catch statement.\n\t    \n\t      ```js\n\t      function findAuthor(){\n\t        throw new Error('couldn't find that author');\n\t      }\n\t    \n\t      // synchronous\n\t      try {\n\t        findAuthor();\n\t      } catch(reason) {\n\t        // something went wrong\n\t      }\n\t    \n\t      // async with promises\n\t      findAuthor().catch(function(reason){\n\t        // something went wrong\n\t      });\n\t      ```\n\t    \n\t      @method catch\n\t      @param {Function} onRejection\n\t      Useful for tooling.\n\t      @return {Promise}\n\t    */\n\t    'catch': function _catch(onRejection) {\n\t      return this.then(null, onRejection);\n\t    }\n\t  };\n\t\n\t  function polyfill() {\n\t    var local = undefined;\n\t\n\t    if (typeof global !== 'undefined') {\n\t      local = global;\n\t    } else if (typeof self !== 'undefined') {\n\t      local = self;\n\t    } else {\n\t      try {\n\t        local = Function('return this')();\n\t      } catch (e) {\n\t        throw new Error('polyfill failed because global object is unavailable in this environment');\n\t      }\n\t    }\n\t\n\t    var P = local.Promise;\n\t\n\t    if (P) {\n\t      var promiseToString = null;\n\t      try {\n\t        promiseToString = Object.prototype.toString.call(P.resolve());\n\t      } catch (e) {\n\t        // silently ignored\n\t      }\n\t\n\t      if (promiseToString === '[object Promise]' && !P.cast) {\n\t        return;\n\t      }\n\t    }\n\t\n\t    local.Promise = Promise;\n\t  }\n\t\n\t  // Strange compat..\n\t  Promise.polyfill = polyfill;\n\t  Promise.Promise = Promise;\n\t\n\t  return Promise;\n\t});\n\t//# sourceMappingURL=es6-promise.map\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), (function() { return this; }())))\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\t// shim for using process in browser\n\tvar process = module.exports = {};\n\t\n\t// cached from whatever global is present so that test runners that stub it\n\t// don't break things.  But we need to wrap it in a try catch in case it is\n\t// wrapped in strict mode code which doesn't define any globals.  It's inside a\n\t// function because try/catches deoptimize in certain engines.\n\t\n\tvar cachedSetTimeout;\n\tvar cachedClearTimeout;\n\t\n\tfunction defaultSetTimout() {\n\t    throw new Error('setTimeout has not been defined');\n\t}\n\tfunction defaultClearTimeout() {\n\t    throw new Error('clearTimeout has not been defined');\n\t}\n\t(function () {\n\t    try {\n\t        if (typeof setTimeout === 'function') {\n\t            cachedSetTimeout = setTimeout;\n\t        } else {\n\t            cachedSetTimeout = defaultSetTimout;\n\t        }\n\t    } catch (e) {\n\t        cachedSetTimeout = defaultSetTimout;\n\t    }\n\t    try {\n\t        if (typeof clearTimeout === 'function') {\n\t            cachedClearTimeout = clearTimeout;\n\t        } else {\n\t            cachedClearTimeout = defaultClearTimeout;\n\t        }\n\t    } catch (e) {\n\t        cachedClearTimeout = defaultClearTimeout;\n\t    }\n\t})();\n\tfunction runTimeout(fun) {\n\t    if (cachedSetTimeout === setTimeout) {\n\t        //normal enviroments in sane situations\n\t        return setTimeout(fun, 0);\n\t    }\n\t    // if setTimeout wasn't available but was latter defined\n\t    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n\t        cachedSetTimeout = setTimeout;\n\t        return setTimeout(fun, 0);\n\t    }\n\t    try {\n\t        // when when somebody has screwed with setTimeout but no I.E. maddness\n\t        return cachedSetTimeout(fun, 0);\n\t    } catch (e) {\n\t        try {\n\t            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n\t            return cachedSetTimeout.call(null, fun, 0);\n\t        } catch (e) {\n\t            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n\t            return cachedSetTimeout.call(this, fun, 0);\n\t        }\n\t    }\n\t}\n\tfunction runClearTimeout(marker) {\n\t    if (cachedClearTimeout === clearTimeout) {\n\t        //normal enviroments in sane situations\n\t        return clearTimeout(marker);\n\t    }\n\t    // if clearTimeout wasn't available but was latter defined\n\t    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n\t        cachedClearTimeout = clearTimeout;\n\t        return clearTimeout(marker);\n\t    }\n\t    try {\n\t        // when when somebody has screwed with setTimeout but no I.E. maddness\n\t        return cachedClearTimeout(marker);\n\t    } catch (e) {\n\t        try {\n\t            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n\t            return cachedClearTimeout.call(null, marker);\n\t        } catch (e) {\n\t            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n\t            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n\t            return cachedClearTimeout.call(this, marker);\n\t        }\n\t    }\n\t}\n\tvar queue = [];\n\tvar draining = false;\n\tvar currentQueue;\n\tvar queueIndex = -1;\n\t\n\tfunction cleanUpNextTick() {\n\t    if (!draining || !currentQueue) {\n\t        return;\n\t    }\n\t    draining = false;\n\t    if (currentQueue.length) {\n\t        queue = currentQueue.concat(queue);\n\t    } else {\n\t        queueIndex = -1;\n\t    }\n\t    if (queue.length) {\n\t        drainQueue();\n\t    }\n\t}\n\t\n\tfunction drainQueue() {\n\t    if (draining) {\n\t        return;\n\t    }\n\t    var timeout = runTimeout(cleanUpNextTick);\n\t    draining = true;\n\t\n\t    var len = queue.length;\n\t    while (len) {\n\t        currentQueue = queue;\n\t        queue = [];\n\t        while (++queueIndex < len) {\n\t            if (currentQueue) {\n\t                currentQueue[queueIndex].run();\n\t            }\n\t        }\n\t        queueIndex = -1;\n\t        len = queue.length;\n\t    }\n\t    currentQueue = null;\n\t    draining = false;\n\t    runClearTimeout(timeout);\n\t}\n\t\n\tprocess.nextTick = function (fun) {\n\t    var args = new Array(arguments.length - 1);\n\t    if (arguments.length > 1) {\n\t        for (var i = 1; i < arguments.length; i++) {\n\t            args[i - 1] = arguments[i];\n\t        }\n\t    }\n\t    queue.push(new Item(fun, args));\n\t    if (queue.length === 1 && !draining) {\n\t        runTimeout(drainQueue);\n\t    }\n\t};\n\t\n\t// v8 likes predictible objects\n\tfunction Item(fun, array) {\n\t    this.fun = fun;\n\t    this.array = array;\n\t}\n\tItem.prototype.run = function () {\n\t    this.fun.apply(null, this.array);\n\t};\n\tprocess.title = 'browser';\n\tprocess.browser = true;\n\tprocess.env = {};\n\tprocess.argv = [];\n\tprocess.version = ''; // empty string to avoid regexp issues\n\tprocess.versions = {};\n\t\n\tfunction noop() {}\n\t\n\tprocess.on = noop;\n\tprocess.addListener = noop;\n\tprocess.once = noop;\n\tprocess.off = noop;\n\tprocess.removeListener = noop;\n\tprocess.removeAllListeners = noop;\n\tprocess.emit = noop;\n\t\n\tprocess.binding = function (name) {\n\t    throw new Error('process.binding is not supported');\n\t};\n\t\n\tprocess.cwd = function () {\n\t    return '/';\n\t};\n\tprocess.chdir = function (dir) {\n\t    throw new Error('process.chdir is not supported');\n\t};\n\tprocess.umask = function () {\n\t    return 0;\n\t};\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\t/* (ignored) */\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\t(function (self) {\n\t  'use strict';\n\t\n\t  if (self.fetch) {\n\t    return;\n\t  }\n\t\n\t  var support = {\n\t    searchParams: 'URLSearchParams' in self,\n\t    iterable: 'Symbol' in self && 'iterator' in Symbol,\n\t    blob: 'FileReader' in self && 'Blob' in self && function () {\n\t      try {\n\t        new Blob();\n\t        return true;\n\t      } catch (e) {\n\t        return false;\n\t      }\n\t    }(),\n\t    formData: 'FormData' in self,\n\t    arrayBuffer: 'ArrayBuffer' in self\n\t  };\n\t\n\t  function normalizeName(name) {\n\t    if (typeof name !== 'string') {\n\t      name = String(name);\n\t    }\n\t    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n\t      throw new TypeError('Invalid character in header field name');\n\t    }\n\t    return name.toLowerCase();\n\t  }\n\t\n\t  function normalizeValue(value) {\n\t    if (typeof value !== 'string') {\n\t      value = String(value);\n\t    }\n\t    return value;\n\t  }\n\t\n\t  // Build a destructive iterator for the value list\n\t  function iteratorFor(items) {\n\t    var iterator = {\n\t      next: function next() {\n\t        var value = items.shift();\n\t        return { done: value === undefined, value: value };\n\t      }\n\t    };\n\t\n\t    if (support.iterable) {\n\t      iterator[Symbol.iterator] = function () {\n\t        return iterator;\n\t      };\n\t    }\n\t\n\t    return iterator;\n\t  }\n\t\n\t  function Headers(headers) {\n\t    this.map = {};\n\t\n\t    if (headers instanceof Headers) {\n\t      headers.forEach(function (value, name) {\n\t        this.append(name, value);\n\t      }, this);\n\t    } else if (headers) {\n\t      Object.getOwnPropertyNames(headers).forEach(function (name) {\n\t        this.append(name, headers[name]);\n\t      }, this);\n\t    }\n\t  }\n\t\n\t  Headers.prototype.append = function (name, value) {\n\t    name = normalizeName(name);\n\t    value = normalizeValue(value);\n\t    var list = this.map[name];\n\t    if (!list) {\n\t      list = [];\n\t      this.map[name] = list;\n\t    }\n\t    list.push(value);\n\t  };\n\t\n\t  Headers.prototype['delete'] = function (name) {\n\t    delete this.map[normalizeName(name)];\n\t  };\n\t\n\t  Headers.prototype.get = function (name) {\n\t    var values = this.map[normalizeName(name)];\n\t    return values ? values[0] : null;\n\t  };\n\t\n\t  Headers.prototype.getAll = function (name) {\n\t    return this.map[normalizeName(name)] || [];\n\t  };\n\t\n\t  Headers.prototype.has = function (name) {\n\t    return this.map.hasOwnProperty(normalizeName(name));\n\t  };\n\t\n\t  Headers.prototype.set = function (name, value) {\n\t    this.map[normalizeName(name)] = [normalizeValue(value)];\n\t  };\n\t\n\t  Headers.prototype.forEach = function (callback, thisArg) {\n\t    Object.getOwnPropertyNames(this.map).forEach(function (name) {\n\t      this.map[name].forEach(function (value) {\n\t        callback.call(thisArg, value, name, this);\n\t      }, this);\n\t    }, this);\n\t  };\n\t\n\t  Headers.prototype.keys = function () {\n\t    var items = [];\n\t    this.forEach(function (value, name) {\n\t      items.push(name);\n\t    });\n\t    return iteratorFor(items);\n\t  };\n\t\n\t  Headers.prototype.values = function () {\n\t    var items = [];\n\t    this.forEach(function (value) {\n\t      items.push(value);\n\t    });\n\t    return iteratorFor(items);\n\t  };\n\t\n\t  Headers.prototype.entries = function () {\n\t    var items = [];\n\t    this.forEach(function (value, name) {\n\t      items.push([name, value]);\n\t    });\n\t    return iteratorFor(items);\n\t  };\n\t\n\t  if (support.iterable) {\n\t    Headers.prototype[Symbol.iterator] = Headers.prototype.entries;\n\t  }\n\t\n\t  function consumed(body) {\n\t    if (body.bodyUsed) {\n\t      return Promise.reject(new TypeError('Already read'));\n\t    }\n\t    body.bodyUsed = true;\n\t  }\n\t\n\t  function fileReaderReady(reader) {\n\t    return new Promise(function (resolve, reject) {\n\t      reader.onload = function () {\n\t        resolve(reader.result);\n\t      };\n\t      reader.onerror = function () {\n\t        reject(reader.error);\n\t      };\n\t    });\n\t  }\n\t\n\t  function readBlobAsArrayBuffer(blob) {\n\t    var reader = new FileReader();\n\t    reader.readAsArrayBuffer(blob);\n\t    return fileReaderReady(reader);\n\t  }\n\t\n\t  function readBlobAsText(blob) {\n\t    var reader = new FileReader();\n\t    reader.readAsText(blob);\n\t    return fileReaderReady(reader);\n\t  }\n\t\n\t  function Body() {\n\t    this.bodyUsed = false;\n\t\n\t    this._initBody = function (body) {\n\t      this._bodyInit = body;\n\t      if (typeof body === 'string') {\n\t        this._bodyText = body;\n\t      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n\t        this._bodyBlob = body;\n\t      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n\t        this._bodyFormData = body;\n\t      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n\t        this._bodyText = body.toString();\n\t      } else if (!body) {\n\t        this._bodyText = '';\n\t      } else if (support.arrayBuffer && ArrayBuffer.prototype.isPrototypeOf(body)) {\n\t        // Only support ArrayBuffers for POST method.\n\t        // Receiving ArrayBuffers happens via Blobs, instead.\n\t      } else {\n\t        throw new Error('unsupported BodyInit type');\n\t      }\n\t\n\t      if (!this.headers.get('content-type')) {\n\t        if (typeof body === 'string') {\n\t          this.headers.set('content-type', 'text/plain;charset=UTF-8');\n\t        } else if (this._bodyBlob && this._bodyBlob.type) {\n\t          this.headers.set('content-type', this._bodyBlob.type);\n\t        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n\t          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');\n\t        }\n\t      }\n\t    };\n\t\n\t    if (support.blob) {\n\t      this.blob = function () {\n\t        var rejected = consumed(this);\n\t        if (rejected) {\n\t          return rejected;\n\t        }\n\t\n\t        if (this._bodyBlob) {\n\t          return Promise.resolve(this._bodyBlob);\n\t        } else if (this._bodyFormData) {\n\t          throw new Error('could not read FormData body as blob');\n\t        } else {\n\t          return Promise.resolve(new Blob([this._bodyText]));\n\t        }\n\t      };\n\t\n\t      this.arrayBuffer = function () {\n\t        return this.blob().then(readBlobAsArrayBuffer);\n\t      };\n\t\n\t      this.text = function () {\n\t        var rejected = consumed(this);\n\t        if (rejected) {\n\t          return rejected;\n\t        }\n\t\n\t        if (this._bodyBlob) {\n\t          return readBlobAsText(this._bodyBlob);\n\t        } else if (this._bodyFormData) {\n\t          throw new Error('could not read FormData body as text');\n\t        } else {\n\t          return Promise.resolve(this._bodyText);\n\t        }\n\t      };\n\t    } else {\n\t      this.text = function () {\n\t        var rejected = consumed(this);\n\t        return rejected ? rejected : Promise.resolve(this._bodyText);\n\t      };\n\t    }\n\t\n\t    if (support.formData) {\n\t      this.formData = function () {\n\t        return this.text().then(decode);\n\t      };\n\t    }\n\t\n\t    this.json = function () {\n\t      return this.text().then(JSON.parse);\n\t    };\n\t\n\t    return this;\n\t  }\n\t\n\t  // HTTP methods whose capitalization should be normalized\n\t  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT'];\n\t\n\t  function normalizeMethod(method) {\n\t    var upcased = method.toUpperCase();\n\t    return methods.indexOf(upcased) > -1 ? upcased : method;\n\t  }\n\t\n\t  function Request(input, options) {\n\t    options = options || {};\n\t    var body = options.body;\n\t    if (Request.prototype.isPrototypeOf(input)) {\n\t      if (input.bodyUsed) {\n\t        throw new TypeError('Already read');\n\t      }\n\t      this.url = input.url;\n\t      this.credentials = input.credentials;\n\t      if (!options.headers) {\n\t        this.headers = new Headers(input.headers);\n\t      }\n\t      this.method = input.method;\n\t      this.mode = input.mode;\n\t      if (!body) {\n\t        body = input._bodyInit;\n\t        input.bodyUsed = true;\n\t      }\n\t    } else {\n\t      this.url = input;\n\t    }\n\t\n\t    this.credentials = options.credentials || this.credentials || 'omit';\n\t    if (options.headers || !this.headers) {\n\t      this.headers = new Headers(options.headers);\n\t    }\n\t    this.method = normalizeMethod(options.method || this.method || 'GET');\n\t    this.mode = options.mode || this.mode || null;\n\t    this.referrer = null;\n\t\n\t    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n\t      throw new TypeError('Body not allowed for GET or HEAD requests');\n\t    }\n\t    this._initBody(body);\n\t  }\n\t\n\t  Request.prototype.clone = function () {\n\t    return new Request(this);\n\t  };\n\t\n\t  function decode(body) {\n\t    var form = new FormData();\n\t    body.trim().split('&').forEach(function (bytes) {\n\t      if (bytes) {\n\t        var split = bytes.split('=');\n\t        var name = split.shift().replace(/\\+/g, ' ');\n\t        var value = split.join('=').replace(/\\+/g, ' ');\n\t        form.append(decodeURIComponent(name), decodeURIComponent(value));\n\t      }\n\t    });\n\t    return form;\n\t  }\n\t\n\t  function headers(xhr) {\n\t    var head = new Headers();\n\t    var pairs = (xhr.getAllResponseHeaders() || '').trim().split('\\n');\n\t    pairs.forEach(function (header) {\n\t      var split = header.trim().split(':');\n\t      var key = split.shift().trim();\n\t      var value = split.join(':').trim();\n\t      head.append(key, value);\n\t    });\n\t    return head;\n\t  }\n\t\n\t  Body.call(Request.prototype);\n\t\n\t  function Response(bodyInit, options) {\n\t    if (!options) {\n\t      options = {};\n\t    }\n\t\n\t    this.type = 'default';\n\t    this.status = options.status;\n\t    this.ok = this.status >= 200 && this.status < 300;\n\t    this.statusText = options.statusText;\n\t    this.headers = options.headers instanceof Headers ? options.headers : new Headers(options.headers);\n\t    this.url = options.url || '';\n\t    this._initBody(bodyInit);\n\t  }\n\t\n\t  Body.call(Response.prototype);\n\t\n\t  Response.prototype.clone = function () {\n\t    return new Response(this._bodyInit, {\n\t      status: this.status,\n\t      statusText: this.statusText,\n\t      headers: new Headers(this.headers),\n\t      url: this.url\n\t    });\n\t  };\n\t\n\t  Response.error = function () {\n\t    var response = new Response(null, { status: 0, statusText: '' });\n\t    response.type = 'error';\n\t    return response;\n\t  };\n\t\n\t  var redirectStatuses = [301, 302, 303, 307, 308];\n\t\n\t  Response.redirect = function (url, status) {\n\t    if (redirectStatuses.indexOf(status) === -1) {\n\t      throw new RangeError('Invalid status code');\n\t    }\n\t\n\t    return new Response(null, { status: status, headers: { location: url } });\n\t  };\n\t\n\t  self.Headers = Headers;\n\t  self.Request = Request;\n\t  self.Response = Response;\n\t\n\t  self.fetch = function (input, init) {\n\t    return new Promise(function (resolve, reject) {\n\t      var request;\n\t      if (Request.prototype.isPrototypeOf(input) && !init) {\n\t        request = input;\n\t      } else {\n\t        request = new Request(input, init);\n\t      }\n\t\n\t      var xhr = new XMLHttpRequest();\n\t\n\t      function responseURL() {\n\t        if ('responseURL' in xhr) {\n\t          return xhr.responseURL;\n\t        }\n\t\n\t        // Avoid security warnings on getResponseHeader when not allowed by CORS\n\t        if (/^X-Request-URL:/m.test(xhr.getAllResponseHeaders())) {\n\t          return xhr.getResponseHeader('X-Request-URL');\n\t        }\n\t\n\t        return;\n\t      }\n\t\n\t      xhr.onload = function () {\n\t        var options = {\n\t          status: xhr.status,\n\t          statusText: xhr.statusText,\n\t          headers: headers(xhr),\n\t          url: responseURL()\n\t        };\n\t        var body = 'response' in xhr ? xhr.response : xhr.responseText;\n\t        resolve(new Response(body, options));\n\t      };\n\t\n\t      xhr.onerror = function () {\n\t        reject(new TypeError('Network request failed'));\n\t      };\n\t\n\t      xhr.ontimeout = function () {\n\t        reject(new TypeError('Network request failed'));\n\t      };\n\t\n\t      xhr.open(request.method, request.url, true);\n\t\n\t      if (request.credentials === 'include') {\n\t        xhr.withCredentials = true;\n\t      }\n\t\n\t      if ('responseType' in xhr && support.blob) {\n\t        xhr.responseType = 'blob';\n\t      }\n\t\n\t      request.headers.forEach(function (value, name) {\n\t        xhr.setRequestHeader(name, value);\n\t      });\n\t\n\t      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit);\n\t    });\n\t  };\n\t  self.fetch.polyfill = true;\n\t})(typeof self !== 'undefined' ? self : undefined);\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar Flingable = __webpack_require__(6);\n\tvar Resizable = __webpack_require__(7);\n\tvar ut = __webpack_require__(8);\n\tvar Modal = __webpack_require__(9);\n\tvar modalCanvasSize = __webpack_require__(11);\n\tvar modalOpenPattern = __webpack_require__(12);\n\tvar modalSavePattern = __webpack_require__(15);\n\tvar modalSharePattern = __webpack_require__(16);\n\tvar parseRLEPixelString = __webpack_require__(17);\n\tvar parseBMP = __webpack_require__(14);\n\tvar patToRleFileString = __webpack_require__(18);\n\tvar dataArrayToRLE = __webpack_require__(19);\n\tvar saveTextAsFile = __webpack_require__(20);\n\tvar Hammer = __webpack_require__(21);\n\t\n\t// Tooltips imports Gator for easy event delegation.\n\t__webpack_require__(22);\n\t\n\t// Note: Don't use the broken version of Keymaster on npm.\n\t// Lifey uses a modified version based on a fork of Keymaster which\n\t// supports direct binding to single modifier keys e.g. \"shift\":\n\t// https://github.com/madrobby/keymaster/pull/136\n\t// (The local version in modules also has other es6-related changes,\n\t// including not binding to window etc.)\n\tvar key = __webpack_require__(10);\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Elements ----\n\t//*******\n\t//*******************************************\n\t\n\tvar w = window;\n\tvar doc = document;\n\t\n\tvar htmlEl = doc.documentElement;\n\tvar bodyEl = doc.body;\n\t\n\tvar scrollSs = doc.querySelector(\"#scroll-stylesheet\").sheet;\n\t\n\tvar outerBgEl = doc.querySelector(\".outer-background\");\n\tvar innerViewEl = doc.querySelector(\".inner-background\");\n\tvar canvasEl = doc.querySelector(\".main-canvas\");\n\tvar canvasCtx = canvasEl.getContext(\"2d\");\n\t\n\tvar splashEl = doc.querySelector(\".splash\");\n\t\n\tvar navCanvasEl = doc.querySelector(\".navigator__canvas\");\n\tvar navCanvasCtx = navCanvasEl.getContext(\"2d\");\n\tvar navOutlineEl = doc.querySelector(\".navigator__canvas-outline\");\n\t\n\tvar toolboxEl = doc.querySelector(\"[data-toolbox]\");\n\tvar toolboxButtonEls = doc.querySelectorAll(\".toolbox__button\");\n\t\n\tvar infoCursorXEl = doc.querySelector(\"[data-info-cursor-position-x]\");\n\tvar infoCursorYEl = doc.querySelector(\"[data-info-cursor-position-y]\");\n\tvar infoDimensionXEl = doc.querySelector(\"[data-info-dimension-x]\");\n\tvar infoDimensionYEl = doc.querySelector(\"[data-info-dimension-y]\");\n\tvar infoCanvasSizeButtonEl = doc.querySelector(\"[data-info-button='resize']\");\n\t\n\tvar playerPanelEl = doc.querySelector(\".player\");\n\tvar playerToroidalWrapperEl = doc.querySelector(\".player__toroidal\");\n\tvar playerToroidalInputEl = doc.querySelector(\"[data-player-toroidal]\");\n\tvar playerSpeedEl = doc.querySelector(\"[data-player-speed]\");\n\tvar playerSpeedInputEl = doc.querySelector(\"[data-player-speed-input]\");\n\tvar playerCounterEl = doc.querySelector(\"[data-generations-counter]\");\n\tvar playerClearButtonEl = doc.querySelector(\"[data-player-button='clear']\");\n\tvar playerResetButtonEl = doc.querySelector(\"[data-player-button='reset']\");\n\tvar playerPlayButtonEl = doc.querySelector(\"[data-player-button='play']\");\n\tvar playerStepButtonEl = doc.querySelector(\"[data-player-button='step']\");\n\t\n\tvar patternsPanelEl = doc.querySelector(\".patterns\");\n\tvar patternsOuterWrapperEl = doc.querySelector(\".patterns__outer-wrapper\");\n\tvar patternsOpenButtonEl = doc.querySelector(\"[data-pattern-button=open]\");\n\tvar patternsSaveButtonEl = doc.querySelector(\"[data-pattern-button=save]\");\n\tvar patternsShareButtonEl = doc.querySelector(\"[data-pattern-button=share]\");\n\tvar patternsWrapperEl = doc.querySelector(\".patterns__outer-wrapper\");\n\tvar patternsListItemEls = doc.querySelectorAll(\".pat\");\n\t\n\t// Mobile-only UI\n\tvar meterButtonMobileEl = doc.querySelector(\".meter__mobile-button\");\n\tvar menuButtonMobileEl = doc.querySelector(\".menu__mobile-button\");\n\tvar patternsButtonMobileEl = doc.querySelector(\".patterns__mobile-button\");\n\tvar requestFullscreenButtonEl = doc.querySelector(\".mobile-menu__go-fullscreen\");\n\tvar exitFullscreenButtonEl = doc.querySelector(\".mobile-menu__exit-fullscreen\");\n\t\n\t// All panels\n\tvar panelArray = [doc.querySelector(\"[data-toolbox]\"), doc.querySelector(\"[data-navigator]\"), doc.querySelector(\"[data-info]\"), doc.querySelector(\"[data-player]\"), doc.querySelector(\"[data-patterns]\")];\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Browser Specifics/Feature detects ----\n\t//*******\n\t//*******************************************\n\t\n\t// Note: window.browser is already defined in the <head> for detects and avoiding FOUC.\n\t\n\t// Safari currently \"supports\" the 'webkit-crisp-edges' value on CSS\n\t// image-rendering, but doesn't actually render it for <canvas> elements.\n\t// Because it's a false positive, it's hard to test for.\n\t// Use crummy vendor detection for now until Apple fixes it.\n\tw.browser = w.browser || Object.create(null);\n\tw.browser.isSafari = navigator.vendor && navigator.vendor.indexOf(\"Apple\") > -1;\n\t\n\t// Modern Opera also uses this value.\n\tw.browser.isBlink = navigator.vendor && navigator.vendor === \"Google Inc.\";\n\t\n\tw.browser.isMac = navigator.platform && navigator.platform.toUpperCase().indexOf(\"MAC\") >= 0;\n\t\n\tw.browser.shortkey = browser.isMac ? \"⌘\" : \"ctrl\";\n\t\n\tw.browser.isFirefox = navigator.userAgent.toLowerCase().indexOf(\"firefox\") !== -1;\n\t\n\t// TO DO: INSERT Polyfill for lack of current Firefox support.\n\t// See https://bugzilla.mozilla.org/show_bug.cgi?id=960316\n\t// The document root should never scroll/overscroll.\n\t// (For now FF seems to work without this.)\n\t// if ( !( \"touchAction\" in document.documentElement.style ) ) {\n\t// }\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- State ----\n\t//*******\n\t//*******************************************\n\t\n\tvar state = Object.create(null);\n\tstate.userIsDrawing = false;\n\tstate.pointerIsHoveringResizableEdge = false;\n\t\n\tstate.innerView = Object.create(null);\n\tstate.innerView.dragPageStart = Object.create(null);\n\tstate.innerView.dragScrollStart = Object.create(null);\n\tstate.innerView.isDragging = false;\n\tstate.innerView.mouseIsDown = false;\n\t\n\t// Scroll values are initially undefined because initial view always fit in window.\n\tstate.innerView.scroll = Object.create(null);\n\t\n\tstate.canvas = Object.create(null);\n\tstate.canvas.overflowsInnerView = false;\n\tstate.canvas.domDim = Object.create(null);\n\tstate.canvas.scale = 6; // Initially match the CSS transform scale() in CSS.\n\t\n\tstate.toolbox = Object.create(null);\n\tstate.toolbox.tool = \"brush\";\n\tstate.toolbox.selectedButton = doc.querySelector(\".toolbox__button\"); // Brush is first\n\t\n\tstate.nav = Object.create(null);\n\tstate.nav.canvas = Object.create(null);\n\tstate.nav.outline = Object.create(null);\n\tstate.nav.outline.posX = 0;\n\tstate.nav.outline.posY = 0;\n\tstate.nav.outline.percentageX = 1; // 100% initial.\n\tstate.nav.outline.percentageY = 1;\n\t\n\tstate.player = Object.create(null);\n\tstate.player.isPlaying = false;\n\tstate.player.toroidal = false; // Initially unchecked.\n\tstate.player.generation = 0;\n\tstate.player.delay = 500; // Initially the input type=range slider is in the middle.\n\t\n\tstate.patterns = Object.create(null);\n\t\n\tstate.scrollbarDim = 0; // Assume zero until load.\n\t\n\tvar nextFrameID = void 0; // Timeouts set in the player.\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Flingable and Resizable Panels ----\n\t//*******\n\t//*******************************************\n\t\n\t// Make each panel Flingable except for the last panel (patterns).\n\tfor (var i = 0; i < 4; i += 1) {\n\t\tvar panelElement = panelArray[i];\n\t\tObject.create(Flingable).initFlingable(panelElement, {\n\t\t\tflingCoast: false,\n\t\t\tflingContainer: bodyEl,\n\t\t\tflingHandleEl: panelElement.querySelector(\"[data-flingable-handle]\")\n\t\t});\n\t}\n\t\n\t// Pattern panel is uniquely both Flingable and Resizable.\n\tvar patternPanel = Object.create(ut.extend(Object.create(Flingable), Resizable));\n\t\n\tpatternPanel.rzblAbortResize = function () {\n\t\treturn state.canvas.isDrawing || state.isModalOpen; // Prevents resize handle behaviors.\n\t};\n\t\n\tpatternPanel.reportResizing = function (isResizing) {\n\t\tstate.panelIsResizing = isResizing; // Set state when an edge is being resized.\n\t};\n\t\n\tpatternPanel.initFlingable(panelArray[4], {\n\t\tflingCoast: false,\n\t\tflingContainer: bodyEl,\n\t\tflingHandleEl: panelArray[4].querySelector(\"[data-flingable-handle]\")\n\t}).initResizable(panelArray[4], {\n\t\trzblTop: false,\n\t\trzblHorizontalCssProp: \"right\"\n\t});\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Prevent Default on Panel drag\n\t//*******\n\t//*******************************************\n\t\n\t// Suppress the default I-beam cursor when user is mistakenly trying to drag\n\t// a panel by something other than the \"panel__dragspot\" at the top.\n\t// The only time we want to allow default native mousedown behavior is when the\n\t// speed slider is dragged.\n\tGator(bodyEl).on([\"mousedown\"], \".panel\", function (e) {\n\t\tif (e.target.className !== \"player__speed-input\") {\n\t\t\te.preventDefault();\n\t\t}\n\t});\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- innerView ----\n\t//*******\n\t//*******************************************\n\t\n\tvar innerView = {\n\t\tgetVisibleDimensions: function getVisibleDimensions() {\n\t\n\t\t\t// The outer background dimensions, minus any scrollbars. offsetDim includes scrollbars.\n\t\t\t// state.innerView.visibleWidth = outerBgEl.clientWidth - state.scrollbarDim;\n\t\t\t// state.innerView.visibleHeight = outerBgEl.clientHeight - state.scrollbarDim;\n\t\t\tstate.innerView.visibleWidth = outerBgEl.clientWidth;\n\t\t\tstate.innerView.visibleHeight = outerBgEl.clientHeight;\n\t\t},\n\t\n\t\tonResize: function onResize() {\n\t\t\tinnerView.getVisibleDimensions();\n\t\t\tcanvas.evaluateOverflow(); // Will set dimensions if goes into overflow.\n\t\t},\n\t\n\t\tonScroll: function onScroll() {\n\t\t\tif (state.innerView.isDragging) {\n\t\t\t\treturn; // Bail out, drag memoizes scroll position on its own,\n\t\t\t\t// and the debounce breaks it.\n\t\t\t}\n\t\n\t\t\tstate.innerView.scroll.x = state.innerView.dragScrollStart.x = this.scrollLeft;\n\t\t\tstate.innerView.scroll.y = state.innerView.dragScrollStart.y = this.scrollTop;\n\t\n\t\t\tupdateNavOutline(false);\n\t\t},\n\t\n\t\tsetScrollPosition: function setScrollPosition(x, y) {\n\t\t\tif (!state.canvas.overflowsInnerView) {\n\t\t\t\treturn;\n\t\t\t}\n\t\n\t\t\t// TO-DO: limit the height to max?\n\t\t\tx = Math.max(0, x);\n\t\t\ty = Math.max(0, y);\n\t\n\t\t\touterBgEl.scrollLeft = state.innerView.scroll.x = x;\n\t\t\touterBgEl.scrollTop = state.innerView.scroll.y = y;\n\t\t},\n\t\n\t\tonPointerDown: function onPointerDown(e) {\n\t\n\t\t\tif (!state.canvas.overflowsInnerView || browser.isBig && !key.shift && state.toolbox.tool !== \"hand\" || !browser.isBig && state.toolbox.tool !== \"zoom-in\") {\n\t\t\t\treturn; // Get out, don't handle drag by scrolling.\n\t\t\t}\n\t\n\t\t\tstate.innerView.dragPageStart.x = e.pageX;\n\t\t\tstate.innerView.dragPageStart.y = e.pageY;\n\t\n\t\t\t// Record the initial scroll position at the start of the drag.\n\t\t\t// This is the only place where this property get written.\n\t\t\tstate.innerView.dragScrollStart.x = state.innerView.scroll.x;\n\t\t\tstate.innerView.dragScrollStart.y = state.innerView.scroll.y;\n\t\t\tstate.innerView.isDragging = true;\n\t\n\t\t\tbodyEl.addEventListener(\"mousemove\", innerView.onDragMove);\n\t\t\tbodyEl.addEventListener(\"mouseleave\", innerView.onDragEnd);\n\t\t\tbodyEl.addEventListener(\"mouseup\", innerView.onDragEnd);\n\t\t},\n\t\n\t\tonDragMove: function onDragMove(e) {\n\t\t\tvar pageX = e.pageX;\n\t\t\tvar pageY = e.pageY;\n\t\n\t\t\tvar moveX = pageX - state.innerView.dragPageStart.x;\n\t\t\tvar moveY = pageY - state.innerView.dragPageStart.y;\n\t\n\t\t\t// Set on DOM. These values get clamped by scroll endpoints.\n\t\t\touterBgEl.scrollLeft = state.innerView.dragScrollStart.x - moveX;\n\t\t\touterBgEl.scrollTop = state.innerView.dragScrollStart.y - moveY;\n\t\n\t\t\t// Read clamped value back into memory for the navigator to use.\n\t\t\t// Fix this to be cleaner later.\n\t\t\tstate.innerView.scroll.x = outerBgEl.scrollLeft;\n\t\t\tstate.innerView.scroll.y = outerBgEl.scrollTop;\n\t\n\t\t\tif (browser.isBig) {\n\t\t\t\tw.setTimeout(function () {\n\t\t\t\t\tupdateNavOutline(false);\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t},\n\t\n\t\tonDragEnd: function onDragEnd(e) {\n\t\t\tstate.innerView.isDragging = false;\n\t\n\t\t\tbodyEl.removeEventListener(\"mousemove\", innerView.onDragMove);\n\t\t\tbodyEl.removeEventListener(\"mouseleave\", innerView.onDragEnd);\n\t\t\tbodyEl.removeEventListener(\"mouseup\", innerView.onDragEnd);\n\t\n\t\t\t// Read values back from Dom into memory, to normalize for min/max values\n\t\t\tstate.innerView.scroll.x = outerBgEl.scrollLeft;\n\t\t\tstate.innerView.scroll.y = outerBgEl.scrollTop;\n\t\t}\n\t};\n\t\n\t// ---- innerView Bindings are added on page load, below.\n\t// Firefox on Android can fire mysterious early resize events which cause trouble.\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Canvas ----\n\t//*******\n\t//*******************************************\n\t\n\tvar canvas = Object.create(null);\n\t\n\tcanvas.setCanvasDim = function (x, y) {\n\t\tstate.canvas.domDim.x = canvasEl.width = x;\n\t\tstate.canvas.domDim.y = canvasEl.height = y;\n\t\n\t\t// Turning off canvas image smoothing shouldn't really matter,\n\t\t// but there may be a very slight performance gain:\n\t\t// https://jsperf.com/imagesmoothingenabled\n\t\t// image smoothing must be reset after resize.\n\t\tcanvasCtx.imageSmoothingEnabled = false;\n\t\n\t\t// Whenever a new canvas dimension is specified. Temporarily reset to white\n\t\t// on eraser mousedown on canvas.\n\t\tcanvasCtx.fillStyle = \"rgba(0,0,0,1)\";\n\t\tnavCanvasCtx.fillStyle = \"rgba(0,0,0,1)\";\n\t\n\t\tcanvas.clearMainAndNavCanvases();\n\t\tcanvas.setNavigatorCanvasDimensions();\n\t\n\t\t// Set the user-displayed dimensions in the Info panel.\n\t\tinfoDimensionXEl.textContent = x;\n\t\tinfoDimensionYEl.textContent = y;\n\t\n\t\t// Allows optimized fast 2d drawing in the render loop. See:\n\t\t// https://hacks.mozilla.org/2011/12/faster-canvas-pixel-manipulation-with-typed-arrays/\n\t\tstate.canvas.imageData = canvasCtx.getImageData(0, 0, x, y);\n\t\tstate.canvas.pixelBuffer = new Int32Array(state.canvas.imageData.data.buffer);\n\t};\n\t\n\tcanvas.setNavigatorCanvasDimensions = function () {\n\t\tvar containerMaxWidth = 158;\n\t\tvar containerMaxHeight = 164;\n\t\tvar mainCanvasX = state.canvas.domDim.x;\n\t\tvar mainCanvasY = state.canvas.domDim.y;\n\t\tvar navWidth = void 0,\n\t\t    navHeight = void 0;\n\t\tvar containerAspectRatio = containerMaxWidth / containerMaxWidth;\n\t\tvar canvasAspectRatio = mainCanvasX / mainCanvasY;\n\t\n\t\t// Always maximize nav canvas within the nav container regardless of main canvas dimensions.\n\t\n\t\t// The wide case.\n\t\tif (canvasAspectRatio >= containerAspectRatio) {\n\t\t\tnavWidth = containerMaxWidth;\n\t\t\tnavHeight = Math.round(containerMaxWidth / canvasAspectRatio);\n\t\n\t\t\t// The tall case.\n\t\t} else {\n\t\t\tnavWidth = Math.round(containerMaxHeight * canvasAspectRatio);\n\t\t\tnavHeight = containerMaxHeight;\n\t\t}\n\t\n\t\t// Inline styles\n\t\tnavCanvasEl.style.width = navWidth + \"px\";\n\t\tnavCanvasEl.style.height = navHeight + \"px\";\n\t\n\t\t// Stored state.\n\t\tstate.nav.canvas.width = navWidth;\n\t\tstate.nav.canvas.height = navHeight;\n\t\n\t\t// Navigator Canvas Dom Dimensions match the main canvas.\n\t\t// This is more efficient for the player loop.\n\t\tnavCanvasEl.width = mainCanvasX;\n\t\tnavCanvasEl.height = mainCanvasY;\n\t\n\t\t// Must be reset after resize.\n\t\t// Keeps the navigator canvas from being blurry when the main canvas is tiny.\n\t\t// Otherwise keep smoothing on because it generally looks better.\n\t\tif (mainCanvasX <= containerMaxWidth && mainCanvasY <= containerMaxHeight) {\n\t\t\tnavCanvasCtx.imageSmoothingEnabled = false;\n\t\t}\n\t};\n\t\n\tcanvas.clearDataArray = function () {\n\t\tstate.canvas.dataArray = new Int8Array(state.canvas.domDim.x * state.canvas.domDim.y);\n\t};\n\t\n\tcanvas.clearMainAndNavCanvases = function () {\n\t\tvar cWidth = state.canvas.domDim.x;\n\t\tvar cHeight = state.canvas.domDim.y;\n\t\tcanvasCtx.clearRect(0, 0, cWidth, cHeight);\n\t\tnavCanvasCtx.clearRect(0, 0, cWidth, cHeight);\n\t};\n\t\n\t// Commented out but preserve for performance checking.\n\tvar paintBothCanvasesPerfCounter = 0;\n\tvar paintBothCanvasesDuration = 0;\n\t\n\tcanvas.paintBothCanvasesBitwise = function () {\n\t\n\t\t// Performance checking Main paint start.\n\t\tvar paintBothCanvasesStart = performance.now();\n\t\n\t\tvar dataArr = state.canvas.dataArray;\n\t\tvar len = dataArr.length;\n\t\tvar canvasWidth = state.canvas.domDim.x;\n\t\n\t\t// Thanks to:\n\t\t// https://hacks.mozilla.org/2011/12/faster-canvas-pixel-manipulation-with-typed-arrays/\n\t\t// Note however that 32-bit direct manipulation is actually fastest. See:\n\t\t// http://jsperf.com/canvas-pixel-manipulation/8\n\t\n\t\tvar pixels = state.canvas.pixelBuffer;\n\t\n\t\tfor (var _i = 0; _i < len; _i += 1) {\n\t\n\t\t\t// Convert 1 (live) to 0. Convert 0 (dead) to 255.\n\t\t\tvar value = 255 - dataArr[_i] * 255;\n\t\n\t\t\tpixels[_i] = 255 << 24 | /* alpha always opaque*/\n\t\t\tvalue << 16 | /* blue */\n\t\t\tvalue << 8 | /* green */\n\t\t\tvalue; /* red */\n\t\t}\n\t\n\t\tcanvasCtx.putImageData(state.canvas.imageData, 0, 0);\n\t\tnavCanvasCtx.putImageData(state.canvas.imageData, 0, 0);\n\t\n\t\t// Performance checking Main paint end.\n\t\tvar paintBothCanvasesEnd = performance.now();\n\t\tpaintBothCanvasesDuration += paintBothCanvasesEnd - paintBothCanvasesStart;\n\t\tif (paintBothCanvasesPerfCounter === 59) {\n\t\t\tconsole.log(\"Avg canvas.paintBothCanvasesBitwise: \" + paintBothCanvasesDuration / 60 + \" ms.\");\n\t\t\tpaintBothCanvasesPerfCounter = 0;\n\t\t\tpaintBothCanvasesDuration = 0;\n\t\t}\n\t\tpaintBothCanvasesPerfCounter += 1;\n\t};\n\t\n\tcanvas.draw = function (e) {\n\t\tvar cWidth = state.canvas.domDim.x;\n\t\tvar cHeight = state.canvas.domDim.y;\n\t\tvar sc = state.canvas.scale;\n\t\tvar scrollX = state.innerView.scroll.x;\n\t\tvar scrollY = state.innerView.scroll.y;\n\t\tvar arrayVal = 1; // Assume paint.\n\t\tvar pageX = void 0,\n\t\t    pageY = void 0,\n\t\t    targetOffsetLeft = void 0,\n\t\t    targetOffsetTop = void 0,\n\t\t    transOffsetLeft = void 0,\n\t\t    transOffsetTop = void 0,\n\t\t    x = void 0,\n\t\t    y = void 0;\n\t\n\t\tif (e.type === \"touchmove\") {\n\t\t\te.preventDefault();\n\t\t} // Prevent simulated mouse events.\n\t\tif (key.shift) {\n\t\t\treturn;\n\t\t} // Don't draw anything if shift is held.\n\t\n\t\t// Note: clearRect() sometimes leaves ghosting in Blink. Yes, using integers. ARGH!\n\t\t// Erase on the main canvas by painting with opaque white instead.\n\t\t// This is super ugly but it's the only way to get clean whites.\n\t\n\t\t// Changing the destination mode only works for true 2D erasing. Saving this for\n\t\t// future reference though:\n\t\t// canvasCtx.globalCompositeOperation = \"source-over\";\n\t\t// canvasCtx.globalCompositeOperation = \"destination-out\";\n\t\n\t\t// Note that these fill styles will need to be reset to black on mouseup/touchend,\n\t\t// otherwise the player won't work.\n\t\tif (state.toolbox.tool === \"eraser\") {\n\t\t\tarrayVal = 0;\n\t\t\tcanvasCtx.fillStyle = \"rgba(255,255,255,1)\";\n\t\t\tnavCanvasCtx.fillStyle = \"rgba(255,255,255,1)\";\n\t\t}\n\t\n\t\t// Handle multitouch drawing/erasing.\n\t\tvar pointerCount = e.targetTouches && e.targetTouches.length || 1;\n\t\tvar pointerArray = [];\n\t\n\t\t// Synthesize offsetX / Y for all drawing, including mouse.\n\t\n\t\tfor (var _i2 = 0; _i2 < pointerCount; _i2 += 1) {\n\t\n\t\t\t// Emulate/synthesize offsetX and offsetY event properties for touch events.\n\t\t\tif (e.type === \"touchstart\" || e.type === \"touchmove\") {\n\t\t\t\tpageX = e.touches[_i2].pageX;\n\t\t\t\tpageY = e.touches[_i2].pageY;\n\t\t\t\ttargetOffsetLeft = e.touches[_i2].target.offsetLeft;\n\t\t\t\ttargetOffsetTop = e.touches[_i2].target.offsetTop;\n\t\t\t} else {\n\t\t\t\tpageX = e.pageX;\n\t\t\t\tpageY = e.pageY;\n\t\t\t\ttargetOffsetLeft = e.target.offsetLeft;\n\t\t\t\ttargetOffsetTop = e.target.offsetTop;\n\t\t\t}\n\t\n\t\t\ttransOffsetLeft = targetOffsetLeft - (cWidth * sc - cWidth) / 2;\n\t\t\ttransOffsetTop = targetOffsetTop - (cHeight * sc - cHeight) / 2;\n\t\n\t\t\tx = (pageX - transOffsetLeft) / sc;\n\t\t\ty = (pageY - transOffsetTop) / sc;\n\t\n\t\t\t// Need to check before compensating for scroll.\n\t\t\t// Scroll values are undefined when canvas fits in innerView.\n\t\t\tif (scrollX) {\n\t\t\t\tx += scrollX / sc;\n\t\t\t}\n\t\t\tif (scrollY) {\n\t\t\t\ty += scrollY / sc;\n\t\t\t}\n\t\n\t\t\t// Lastly adjust for the \"auto\" left margin value created on\n\t\t\t// tall overflowing canvases.\n\t\t\tpointerArray[_i2] = {\n\t\t\t\tx: Math.floor(x - state.innerView.marginLeft / sc),\n\t\t\t\ty: Math.floor(y)\n\t\t\t};\n\t\t}\n\t\n\t\tfor (var j = 0; j < pointerCount; j += 1) {\n\t\t\tvar drawX = pointerArray[j].x;\n\t\t\tvar drawY = pointerArray[j].y;\n\t\n\t\t\t// Note: fillRect() is fastest on modern browsers\n\t\t\t// http://jsperf.com/setting-canvas-pixel\n\t\t\tcanvasCtx.fillRect(drawX, drawY, 1, 1);\n\t\t\tnavCanvasCtx.fillRect(drawX, drawY, 1, 1);\n\t\t\tstate.canvas.dataArray[drawY * state.canvas.domDim.x + drawX] = arrayVal;\n\t\t}\n\t};\n\t\n\tcanvas.onPointerDown = function (e) {\n\t\n\t\t// Early return for non-drawing modes.\n\t\tif (state.toolbox.tool !== \"brush\" && state.toolbox.tool !== \"eraser\" || // E.g. hand, zoom\n\t\tstate.toolbox.override || // Hand keyboard shortcut state.\n\t\tstate.panelIsResizing || // On canvas but resizing a panel.\n\t\tstate.isHoveringResizableEdge || // On canvas but near a drag-resizable edge. TO DO?\n\t\tstate.isModalOpen || e.which === 3) {\n\t\t\t// Right mouse click shouldn't paint.\n\t\n\t\t\treturn;\n\t\t}\n\t\n\t\t// Keep below early return.\n\t\t// Don't prevent default regular native inertial touch-dragging.\n\t\tif (e.type === \"touchstart\") {\n\t\t\te.preventDefault();\n\t\t}\n\t\n\t\t// Read and stored for draw positioning when canvas is narrow but overflows vertically,\n\t\t// and width is less than the inner view width minus all horizontal padding.\n\t\tstate.innerView.marginLeft = parseInt(w.getComputedStyle(innerViewEl).marginLeft, 10);\n\t\n\t\t// Drawing on top of a pattern in the library deselects that pattern.\n\t\tvoidCurrentSelectedPatternLink();\n\t\tclearAnyHash();\n\t\n\t\tcanvas.draw(e);\n\t\tstate.canvas.isDrawing = true;\n\t\n\t\tif (e.type === \"touchstart\") {\n\t\t\tcanvasEl.addEventListener(\"touchmove\", canvas.draw);\n\t\t\tw.addEventListener(\"touchend\", canvas.onPointerUp);\n\t\t} else {\n\t\t\t// Assume mouse.\n\t\t\tcanvasEl.addEventListener(\"mousemove\", canvas.draw);\n\t\t\tw.addEventListener(\"mouseup\", canvas.onPointerUp);\n\t\t}\n\t};\n\t\n\tcanvas.onPointerUp = function (e) {\n\t\tstate.canvas.isDrawing = false;\n\t\n\t\t// Canvas fill style must be reset to black on end of eraser (white draw)\n\t\t// so that player drawing will work.\n\t\tif (state.toolbox.tool === \"eraser\") {\n\t\t\tcanvasCtx.fillStyle = \"rgba(0,0,0,1)\";\n\t\t\tnavCanvasCtx.fillStyle = \"rgba(0,0,0,1)\";\n\t\t}\n\t\n\t\tif (e.type === \"touchend\") {\n\t\t\te.preventDefault();\n\t\t\tcanvasEl.removeEventListener(\"touchmove\", canvas.draw);\n\t\t\tw.removeEventListener(\"touchend\", canvas.onPointerUp);\n\t\t} else {\n\t\t\t// Assume mouse.\n\t\t\tcanvasEl.removeEventListener(\"mousemove\", canvas.draw);\n\t\t\tw.removeEventListener(\"mouseup\", canvas.onPointerUp);\n\t\t}\n\t};\n\t\n\tcanvas.handleResize = function (newWidth, newHeight, anchorX, anchorY) {\n\t\tvar oldWidth = state.canvas.domDim.x;\n\t\tvar oldHeight = state.canvas.domDim.y;\n\t\n\t\tvar oldDataArray = state.canvas.dataArray;\n\t\tvar newDataArray = new Int8Array(newWidth * newHeight);\n\t\n\t\t// The amount to crop out from the origin (left, top) sides of the original.\n\t\t// If the new dims are bigger, there will be no crop, and offset will be 0.\n\t\t// If the new dims are smaller, offset will be a positive integer.\n\t\t// These are only used to determine where the loop starts.\n\t\tvar oldCenterMap = Object.create(null, {\n\t\t\tleft: { value: 0 },\n\t\t\tcenter: { value: Math.round(Math.max(oldWidth - newWidth, 0) / 2) },\n\t\t\tright: { value: Math.max(oldWidth - newWidth, 0) },\n\t\t\ttop: { value: 0 },\n\t\t\tmiddle: { value: Math.round(Math.max(oldHeight - newHeight, 0) / 2) },\n\t\t\tbottom: { value: Math.max(oldHeight - newHeight, 0) }\n\t\t});\n\t\n\t\tvar oldXOffset = oldCenterMap[anchorX];\n\t\tvar oldYOffset = oldCenterMap[anchorY];\n\t\n\t\t// The endpoint of the loop will be the smaller of the current and new dims.\n\t\tvar xLen = oldXOffset + Math.min(oldWidth, newWidth);\n\t\tvar yLen = oldYOffset + Math.min(oldHeight, newHeight);\n\t\n\t\t// These offsets handle the cases when the new canvas is bigger.\n\t\t// Handling these separately keeps the loop clean.\n\t\tvar newCenterMap = Object.create(null, {\n\t\t\tleft: { value: 0 },\n\t\t\tcenter: { value: Math.round(Math.max(newWidth - oldWidth, 0) / 2) },\n\t\t\tright: { value: Math.max(newWidth - oldWidth, 0) },\n\t\t\ttop: { value: 0 },\n\t\t\tmiddle: { value: Math.round(Math.max(newHeight - oldHeight, 0) / 2) },\n\t\t\tbottom: { value: Math.max(newHeight - oldHeight, 0) }\n\t\t});\n\t\n\t\tvar newXOffset = newCenterMap[anchorX];\n\t\tvar newYOffset = newCenterMap[anchorY];\n\t\n\t\t// Loop through all (or part) of the old dataArray,\n\t\t// applying it with an offset to the newDataArray.\n\t\tfor (var _i3 = oldYOffset; _i3 < yLen; _i3 += 1) {\n\t\t\tfor (var j = oldXOffset; j < xLen; j += 1) {\n\t\t\t\tnewDataArray[(_i3 - oldYOffset + newYOffset) * newWidth + (j - oldXOffset + newXOffset)] = oldDataArray[_i3 * oldWidth + j];\n\t\t\t}\n\t\t}\n\t\n\t\tstate.canvas.dataArray = newDataArray;\n\t\n\t\t// Don't reset generations counter on canvas resize.\n\t\tredrawCanvasFromDataArray(newDataArray, newWidth, newHeight);\n\t};\n\t\n\t//\n\t// ---- Canvas Drawing Binding ----\n\t//\n\t\n\tcanvasEl.addEventListener(\"touchstart\", canvas.onPointerDown);\n\tcanvasEl.addEventListener(\"mousedown\", canvas.onPointerDown);\n\t\n\t//\n\t// ---- Zoom Stuff ----\n\t//\n\t\n\tcanvas.repaintBoxShadow = function () {\n\t\n\t\t// Blink misrenders the canvas edge as blurry after any zoom.\n\t\t// Blink also sometimes mistakenly shows scroll bars on the outer bg.\n\t\t// This is a Blink bug, the internal dim is less than the outer bg.\n\t\t// Removing the box-shadow class, forcing render, then\n\t\t// adding it back again fixes it. Yuck!\n\t\tcanvasEl.classList.remove(\"main-canvas--box-shadow\");\n\t\tw.getComputedStyle(canvasEl); // Force render. Yuck.\n\t\tw.setTimeout(function () {\n\t\t\tcanvasEl.classList.add(\"main-canvas--box-shadow\");\n\t\t}, 90); // Waiting less than 90ms doesn't seem to work. WTF.\n\t};\n\t\n\tcanvas.handleIncrementalZoom = function (e, keybindingZoomDirection) {\n\t\n\t\t// Zoom on touch is handled via pinch. We want to duck synthetic click events.\n\t\t// For mobile/touch, get out, and don't prevent default.\n\t\tif (state.toolbox.tool !== \"zoom-in\" && state.toolbox.tool !== \"zoom-out\" && !keybindingZoomDirection || state.toolbox.override || !browser.isBig) {\n\t\t\treturn;\n\t\t}\n\t\n\t\tvar currentScale = state.canvas.scale;\n\t\tvar newScale = currentScale; // Default to same. In case of some mistake below.\n\t\n\t\t// Snapshot of previous pre-zoom state for passing to scroll calculator.\n\t\tvar prevScroll = {\n\t\t\toverflowed: state.canvas.overflowsInnerView,\n\t\t\tx: state.innerView.scroll.x,\n\t\t\ty: state.innerView.scroll.y,\n\t\t\tscale: currentScale\n\t\t};\n\t\n\t\tvar zoomArray = [0.333, // 0 (index number)\n\t\t0.5, // 1\n\t\t0.667, // 2\n\t\t1, // 3 (= 100% scale)\n\t\t2, // 4\n\t\t3, // 5\n\t\t4, // 6\n\t\t5, // 7\n\t\t6, // 8\n\t\t7, // 9\n\t\t8, // 10\n\t\t12, // 11\n\t\t16, // 12\n\t\t32, // 13\n\t\t64 // 14\n\t\t];\n\t\n\t\tvar direction = state.toolbox.tool; // E.g. \"zoom-in\" or \"zoom-out\"\n\t\n\t\t// Keyboard shortcut overrides toolbox\n\t\tif (keybindingZoomDirection) {\n\t\t\tdirection = keybindingZoomDirection; // Again, \"zoom-in\" or \"zoom-out\"\n\t\t}\n\t\n\t\tif (direction === \"zoom-in\") {\n\t\t\tfor (var _i4 = 0; _i4 < 15; _i4 += 1) {\n\t\t\t\tif (zoomArray[_i4] > currentScale) {\n\t\t\t\t\tnewScale = zoomArray[_i4];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfor (var _i5 = 14; _i5 > -1; _i5 -= 1) {\n\t\t\t\tif (zoomArray[_i5] < currentScale) {\n\t\t\t\t\tnewScale = zoomArray[_i5];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\n\t\t// If no change, perhaps we're at one of the ends of the zoom scale, get out.\n\t\tif (newScale === currentScale) {\n\t\t\treturn;\n\t\t}\n\t\n\t\t// Set scale since it has changed.\n\t\tcanvasEl.setAttribute(\"style\", \"transform: scale(\" + newScale + \")\");\n\t\tstate.canvas.scale = newScale;\n\t\tif (browser.isBlink) {\n\t\t\tcanvas.repaintBoxShadow();\n\t\t}\n\t\n\t\t// Toggles classes and styles on innerView, and will remove scroll if canvas is contained.\n\t\tcanvas.evaluateOverflow(newScale);\n\t\n\t\tif (state.canvas.overflowsInnerView) {\n\t\t\tcanvas.setScrollPositionBasedOnZoomEvent(e, prevScroll, keybindingZoomDirection);\n\t\t}\n\t};\n\t\n\tcanvas.evaluateOverflow = function (newScale) {\n\t\tvar canvasWidth = state.canvas.domDim.x;\n\t\tvar canvasHeight = state.canvas.domDim.y;\n\t\tvar theScale = state.canvas.scale;\n\t\tvar newOverflow = false;\n\t\tvar newInnerViewWidth = void 0,\n\t\t    newInnerViewHeight = void 0;\n\t\tvar removeNavOutlineDimensions = false;\n\t\n\t\t// For example, newScale is undefined when called on resize.\n\t\t// Also note newScale equals 0 when zoomed all the way out.\n\t\tif (newScale !== undefined) {\n\t\t\ttheScale = newScale;\n\t\t}\n\t\n\t\t// No overflow on update.\n\t\tif (canvasWidth * theScale < state.innerView.visibleWidth && canvasHeight * theScale < state.innerView.visibleHeight) {\n\t\n\t\t\tif (state.canvas.overflowsInnerView) {\n\t\n\t\t\t\t// Unsure on this. TO DO: review state etc.\n\t\t\t\tstate.innerView.width = innerView.visibleWidth;\n\t\t\t\tstate.innerView.height = innerView.visibleHeight;\n\t\t\t\tstate.innerView.scroll.x = undefined;\n\t\t\t\tstate.innerView.scroll.y = undefined;\n\t\n\t\t\t\tinnerViewEl.classList.remove(\"inner-background--canvas-overflows\");\n\t\n\t\t\t\t// Effectively reverts height and width back to 100% values in stylesheet.\n\t\t\t\tinnerViewEl.style.width = \"\";\n\t\t\t\tinnerViewEl.style.height = \"\";\n\t\t\t\tremoveNavOutlineDimensions = true;\n\t\t\t}\n\t\n\t\t\t// Else one or more of the dims overflows the innerView,\n\t\t\t// so switch into overflow state if we aren't already,\n\t\t\t// and set dims using explicit numeric CSS values.\n\t\t} else {\n\t\t\tnewOverflow = true;\n\t\n\t\t\t// Base innerView dims on canvas.\n\t\t\t// Note however that height is constrained to min-height: 100% in stylesheet,\n\t\t\t// in the stylesheet, otherwise vertical centering would break.\n\t\t\tnewInnerViewWidth = canvasWidth * theScale + state.canvas.zoomPadding * 2;\n\t\t\tnewInnerViewHeight = canvasHeight * theScale + state.canvas.zoomPadding * 2;\n\t\n\t\t\t// But don't let them ever be less than 100% or it breaks centering\n\t\t\tstate.innerView.width = newInnerViewWidth;\n\t\t\tstate.innerView.height = newInnerViewHeight;\n\t\t\tinnerViewEl.style.width = newInnerViewWidth + \"px\";\n\t\t\tinnerViewEl.style.height = newInnerViewHeight + \"px\";\n\t\n\t\t\t// Note that in this case scroll positions will still need to be set.\n\t\n\t\t\tif (!state.canvas.overflowsInnerView) {\n\t\t\t\tinnerViewEl.classList.add(\"inner-background--canvas-overflows\");\n\t\t\t}\n\t\t}\n\t\n\t\tstate.canvas.overflowsInnerView = newOverflow;\n\t\tupdateNavOutline(removeNavOutlineDimensions);\n\t};\n\t\n\t// Set scroll position on any overflow.\n\t// Always called within a conditional. Assume state.canvas.overflowsInnerView true.\n\tcanvas.setScrollPositionBasedOnZoomEvent = function (e, prevScroll, keybindingZoomDirection, pinchCenterX, pinchCenterY, pinchPanX, pinchPanY) {\n\t\tvar cWidth = state.canvas.domDim.x;\n\t\tvar cHeight = state.canvas.domDim.y;\n\t\tvar zoomPadding = state.canvas.zoomPadding;\n\t\tvar prevScale = prevScroll.scale;\n\t\tvar newScale = state.canvas.scale;\n\t\tpinchPanX = pinchPanX || 0;\n\t\tpinchPanY = pinchPanY || 0;\n\t\n\t\t// Event pageX/Y will exist for for mouse clicks.\n\t\t// (Keyboard-shortcut-initiated zooms have a synthetic pageX/Y.)\n\t\t// e will be null for pinch zooms.\n\t\tvar zoomCenterX = e && e.pageX || pinchCenterX;\n\t\tvar zoomCenterY = e && e.pageY || pinchCenterY;\n\t\n\t\tvar canvasTransX = void 0,\n\t\t    canvasTransY = void 0,\n\t\t    curCenteredFromLeft = void 0,\n\t\t    curCenteredFromTop = void 0,\n\t\t    canvasRawX = void 0,\n\t\t    canvasRawY = void 0,\n\t\t    newScrollX = void 0,\n\t\t    newScrollY = void 0;\n\t\n\t\tif (prevScroll.overflowed) {\n\t\t\tcanvasTransX = zoomCenterX + prevScroll.x - zoomPadding;\n\t\t\tcanvasTransY = zoomCenterY + prevScroll.y - zoomPadding;\n\t\n\t\t\t// Previously no scroll bars\n\t\t} else {\n\t\t\tcurCenteredFromLeft = (state.innerView.visibleWidth - cWidth * prevScale) / 2;\n\t\t\tcurCenteredFromTop = (state.innerView.visibleHeight - cHeight * prevScale) / 2;\n\t\n\t\t\tcanvasTransX = zoomCenterX - curCenteredFromLeft;\n\t\t\tcanvasTransY = zoomCenterY - curCenteredFromTop;\n\t\t}\n\t\n\t\tcanvasRawX = canvasTransX / prevScale;\n\t\tcanvasRawY = canvasTransY / prevScale;\n\t\n\t\t// If the user is scroll centered, and zoom-clicks in the center of the canvas,\n\t\t// the new scroll should scale up in proportion to the\n\t\t// (new innerView / old Inner view)\n\t\n\t\tnewScrollX = zoomPadding + canvasRawX * newScale - zoomCenterX;\n\t\tnewScrollY = zoomPadding + canvasRawY * newScale - zoomCenterY;\n\t\n\t\t// Adjust for possible pinch panning. (Moving the pinch center during the pinch.)\n\t\tnewScrollX -= pinchPanX;\n\t\tnewScrollY -= pinchPanY;\n\t\n\t\tinnerView.setScrollPosition(newScrollX, newScrollY);\n\t};\n\t\n\tcanvas.handleFitZoom = function () {\n\t\tvar canvasWidth = state.canvas.domDim.x;\n\t\tvar canvasHeight = state.canvas.domDim.y;\n\t\tvar innerViewVisWidth = state.innerView.visibleWidth;\n\t\tvar innerViewVisHeight = state.innerView.visibleHeight;\n\t\tvar newScale = void 0;\n\t\tvar innerViewVisibleProportion = innerViewVisWidth / innerViewVisHeight;\n\t\tvar canvasProportion = canvasWidth / canvasHeight;\n\t\n\t\tif (innerViewVisibleProportion >= canvasProportion) {\n\t\n\t\t\t// The wide Inner View case, fit height\n\t\t\tnewScale = innerViewVisHeight / canvasHeight;\n\t\t} else {\n\t\t\tnewScale = innerViewVisWidth / canvasWidth;\n\t\t}\n\t\n\t\t// Remove any overflow styles\n\t\tif (state.canvas.overflowsInnerView) {\n\t\t\tinnerViewEl.classList.remove(\"inner-background--canvas-overflows\");\n\t\n\t\t\t// Remove explicit width and height\n\t\t\tinnerViewEl.removeAttribute(\"style\");\n\t\t}\n\t\n\t\t// Fit should always center the canvas, removing any CSS translate()\n\t\tcanvasEl.setAttribute(\"style\", \"transform: scale(\" + newScale + \")\");\n\t\n\t\tstate.canvas.overflowsInnerView = false;\n\t\n\t\t// Remove scroll\n\t\tstate.innerView.scroll.x = undefined;\n\t\tstate.innerView.scroll.y = undefined;\n\t\n\t\t// Reset navigation outline\n\t\tnavOutlineEl.removeAttribute(\"style\");\n\t\tstate.nav.outline.posX = 0;\n\t\tstate.nav.outline.posY = 0;\n\t\tstate.nav.outline.percentageX = 1;\n\t\tstate.nav.outline.percentageY = 1;\n\t\n\t\tstate.canvas.scale = newScale;\n\t\tif (browser.isBlink) {\n\t\t\tcanvas.repaintBoxShadow();\n\t\t}\n\t};\n\t\n\t// Don't bother binding a listener for touchstart because pinch handles\n\t// all zoom in the mobile/tablet interface.\n\tinnerViewEl.addEventListener(\"click\", canvas.handleIncrementalZoom);\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Pinch/Zoom on Touch ----\n\t//*******\n\t//*******************************************\n\t\n\t// Create a manager for the inner view.\n\tvar hammerInnerV = new Hammer.Manager(innerViewEl, {\n\t\ttouchAction: \"pan-x pan-y\" // Allow default native panning behaviors for single touches.\n\t});\n\t\n\t// Create a recognizer, and add that recognizer to the manager.\n\thammerInnerV.add(new Hammer.Pinch());\n\t\n\t// Holds snapshot of pre-pinch state.\n\tvar initPinch = Object.create(null);\n\t\n\thammerInnerV.on(\"pinchstart\", function (e) {\n\t\te.preventDefault(); // Always on pinchstart.\n\t\tif (state.toolbox.tool !== \"zoom-in\") {\n\t\t\treturn;\n\t\t}\n\t\n\t\tinitPinch.overflowed = state.canvas.overflowsInnerView;\n\t\tinitPinch.x = state.innerView.scroll.x;\n\t\tinitPinch.y = state.innerView.scroll.y;\n\t\tinitPinch.scale = state.canvas.scale;\n\t\tinitPinch.center = e.center;\n\t\n\t\t// No CSS scale transition timing.\n\t\tcanvasEl.classList.remove(\"main-canvas--transition-scale\");\n\t});\n\t\n\thammerInnerV.on(\"pinch\", function (e) {\n\t\te.preventDefault(); // Always on pinch.\n\t\n\t\tif (state.toolbox.tool !== \"zoom-in\") {\n\t\t\treturn;\n\t\t}\n\t\n\t\tvar newScale = initPinch.scale * e.scale;\n\t\tcanvasEl.style.transform = \"scale(\" + newScale + \")\";\n\t\tstate.canvas.scale = newScale;\n\t\n\t\tvar initPinchCenter = initPinch.center;\n\t\tvar newPinchCenter = e.center;\n\t\n\t\t// Reevaluate overflow continuously during the pinch.\n\t\tcanvas.evaluateOverflow(newScale);\n\t\n\t\t// When in overflow mode, scroll should adjust so that the center of the pinch on the canvas\n\t\t// tracks to the same screen position. Also pinch centers can \"pan\" during pinch.\n\t\tvar pinchPanX = newPinchCenter.x - initPinchCenter.x;\n\t\tvar pinchPanY = newPinchCenter.y - initPinchCenter.y;\n\t\n\t\tcanvas.setScrollPositionBasedOnZoomEvent(null, initPinch, null, initPinchCenter.x, initPinchCenter.y, pinchPanX, pinchPanY);\n\t});\n\t\n\thammerInnerV.on(\"pinchend\", function (e) {\n\t\te.preventDefault(); // Always on pinchend.\n\t\n\t\tif (state.toolbox.tool !== \"zoom-in\") {\n\t\t\treturn;\n\t\t}\n\t\n\t\tif (browser.isBlink) {\n\t\t\tcanvas.repaintBoxShadow();\n\t\t}\n\t});\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Toolbox ----\n\t//*******\n\t//*******************************************\n\t\n\t// Arguments are button event, string is \"brush\" or \"eraser or \"hand\" etc.\n\tvar setToolboxTool = function setToolboxTool(e, newToolNameStr) {\n\t\tnewToolNameStr = newToolNameStr || this.getAttribute(\"data-tool-button\");\n\t\n\t\tif (newToolNameStr === state.toolbox.tool) {\n\t\t\treturn;\n\t\t} // Get out\n\t\tfor (var _i6 = 0; _i6 < 5; _i6 += 1) {\n\t\t\ttoolboxButtonEls[_i6].classList.remove(\"panel__button--selected\");\n\t\t}\n\t\tvar selectedButton = doc.querySelector(\"[data-tool-button=\" + newToolNameStr);\n\t\tselectedButton.classList.add(\"panel__button--selected\");\n\t\n\t\t// Handle CSS cursors.\n\t\tinnerViewEl.classList.remove(\"brush-tool\", \"eraser-tool\", \"hand-tool\", \"zoom-in-tool\", \"zoom-out-tool\");\n\t\tinnerViewEl.classList.add(newToolNameStr + \"-tool\");\n\t\n\t\tstate.toolbox.tool = newToolNameStr;\n\t};\n\t\n\tGator(toolboxEl).on([\"touchstart\", \"mousedown\"], \".toolbox__button\", setToolboxTool);\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Navigator ----\n\t//*******\n\t//*******************************************\n\t\n\t// Called by innerView.onUserScroll and canvas.evaluateOverflow\n\tvar updateNavOutline = function updateNavOutline(removeNavOutlineDimensions) {\n\t\tif (!browser.isBig) {\n\t\t\treturn;\n\t\t}\n\t\n\t\t// Called from evaluateOverflow if there's been a change from\n\t\t// overflow to no overflow.\n\t\tif (removeNavOutlineDimensions) {\n\t\t\tnavOutlineEl.removeAttribute(\"style\");\n\t\t\treturn;\n\t\t}\n\t\n\t\t// This early return must stay in place here. Don't refactor.\n\t\tif (!state.canvas.overflowsInnerView) {\n\t\t\treturn;\n\t\t}\n\t\n\t\t// Default if roughly centered, doesn't yet account for scroll position.\n\t\tvar mainCanvasVisibleX = state.innerView.visibleWidth;\n\t\tvar mainCanvasVisibleY = state.innerView.visibleHeight;\n\t\tvar padding = state.canvas.zoomPadding;\n\t\tvar scale = state.canvas.scale;\n\t\tvar percentageVisibleX = void 0,\n\t\t    percentageVisibleY = void 0,\n\t\t    ratioBetweenCanvases = void 0,\n\t\t    outlinePosX = void 0,\n\t\t    outlinePosY = void 0;\n\t\n\t\t// If scrolled to left edge\n\t\tif (state.innerView.scroll.x < padding) {\n\t\t\tmainCanvasVisibleX -= padding - state.innerView.scroll.x;\n\t\n\t\t\t// If scrolled to right edge\n\t\t} else if (state.innerView.scroll.x > state.innerView.width - state.innerView.visibleWidth - padding) {\n\t\t\tmainCanvasVisibleX -= state.innerView.scroll.x - (state.innerView.width - state.innerView.visibleWidth - padding);\n\t\t}\n\t\n\t\t// If scrolled to top edge\n\t\tif (state.innerView.scroll.y < padding) {\n\t\t\tmainCanvasVisibleY -= padding - state.innerView.scroll.y;\n\t\n\t\t\t// If scrolled to bottom edge\n\t\t} else if (state.innerView.scroll.y > state.innerView.height - state.innerView.visibleHeight - padding) {\n\t\t\tmainCanvasVisibleY -= state.innerView.scroll.y - (state.innerView.height - state.innerView.visibleHeight - padding);\n\t\t}\n\t\n\t\tpercentageVisibleX = mainCanvasVisibleX / (state.canvas.domDim.x * scale);\n\t\tpercentageVisibleY = mainCanvasVisibleY / (state.canvas.domDim.y * scale);\n\t\n\t\t// If width or height have changed then set them on the element\n\t\tif (percentageVisibleX !== state.nav.outline.percentageX) {\n\t\t\tstate.nav.outline.percentageX = percentageVisibleX;\n\t\t\tnavOutlineEl.style.width = percentageVisibleX * 100 + \"%\";\n\t\t}\n\t\tif (percentageVisibleY !== state.nav.outline.percentageY) {\n\t\t\tstate.nav.outline.percentageY = percentageVisibleY;\n\t\t\tnavOutlineEl.style.height = percentageVisibleY * 100 + \"%\";\n\t\t}\n\t\n\t\t// Use the larger of the two dimensions to calculate the ratio,\n\t\t// in order to minimize ugly rounding errors.\n\t\tif (state.nav.canvas.width > state.nav.canvas.height) {\n\t\t\tratioBetweenCanvases = state.nav.canvas.width / (state.canvas.domDim.x * scale);\n\t\t} else {\n\t\t\tratioBetweenCanvases = state.nav.canvas.height / (state.canvas.domDim.y * scale);\n\t\t}\n\t\n\t\toutlinePosX = (state.innerView.scroll.x - padding) * ratioBetweenCanvases;\n\t\toutlinePosY = (state.innerView.scroll.y - padding) * ratioBetweenCanvases;\n\t\n\t\t// Clamp outline to 0,0 (don't allow negative).\n\t\toutlinePosX = Math.max(0, outlinePosX);\n\t\toutlinePosY = Math.max(0, outlinePosY);\n\t\n\t\tstate.nav.outline.posX = outlinePosX;\n\t\tstate.nav.outline.posy = outlinePosY;\n\t\tnavOutlineEl.style.transform = \"translate(\" + outlinePosX + \"px,\" + outlinePosY + \"px)\";\n\t};\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Info ----\n\t//*******\n\t//*******************************************\n\t\n\tvar updateCursorCoordinates = function updateCursorCoordinates(e) {\n\t\n\t\t// IE reports non-integer values for offset. Round down.\n\t\t// Consider removing floor() if never supporting IE.\n\t\tinfoCursorXEl.textContent = Math.floor(e.offsetX);\n\t\tinfoCursorYEl.textContent = Math.floor(e.offsetY);\n\t};\n\t\n\tvar handleCoordinatesEnter = function handleCoordinatesEnter(e) {\n\t\tupdateCursorCoordinates(e);\n\t\tcanvasEl.addEventListener(\"mousemove\", updateCursorCoordinates);\n\t\tcanvasEl.addEventListener(\"mouseleave\", handleCoordinatesLeave);\n\t};\n\t\n\tvar handleCoordinatesLeave = function handleCoordinatesLeave(e) {\n\t\tinfoCursorXEl.textContent = \"\";\n\t\tinfoCursorYEl.textContent = \"\";\n\t\tcanvasEl.removeEventListener(\"mousemove\", updateCursorCoordinates);\n\t\tcanvasEl.removeEventListener(\"mouseleave\", handleCoordinatesLeave);\n\t};\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Player ----\n\t//*******\n\t//*******************************************\n\t\n\tvar player = Object.create(null);\n\t\n\tplayer.setSpeed = function (event, num) {\n\t\n\t\t// Arguments will include an Event in case it's being emitted from the input\n\t\t// slider, but can also be set directly below based on read-in values.\n\t\tvar val = event && event.target ? event.target.value : num;\n\t\tval = Math.max(0, Math.min(6, val)); // Must be between 0 and 6 inclusive.\n\t\tstate.player.delay = [1600, 750, 200, 100, 50, 25, \"none\"][val]; // Durations in ms.\n\t\n\t\tif (!event) {\n\t\t\tplayerSpeedInputEl.value = val;\n\t\t}\n\t\n\t\t// The data-* attribute creates a CSS hook for the position styling of the SVG thumb.\n\t\tplayerSpeedInputEl.setAttribute(\"data-player-speed-input\", val);\n\t};\n\t\n\t// Allow the next few often-called fns to live in the outermost scope, to reduce object lookups.\n\t\n\t// A 3x3 bitmap has 2^9 = 512 possible states.\n\t// 000000001 = 1\n\t// 000000010 = 2\n\t// 000000011 = 3\n\t// 000000100 = 4\n\t// 000000101 = 5\n\t// 000000110 = 6\n\t// 000000111 = 7\n\t// 000001000 = 8\n\t// 000001001 = 9\n\t// 000001010 = 10\n\t// 000001011 = 11\n\t// 000001100 = 12\n\t// 000001101 = 13\n\t// 000001110 = 14\n\t// 000001111 = 15\n\t// 111000000 = 448 etc.\n\t\n\t// Pre-build and store a lookup array mapping all the possibilities.\n\t// Stores the number of active cells in the nine cell neighborhood,\n\t// including the center cell.\n\tvar bitmapLookupArr = new Uint8Array(512);\n\tfor (var _i7 = 0; _i7 < 512; _i7 += 1) {\n\t\tbitmapLookupArr[_i7] = _i7.toString(2).split(\"1\").length - 1;\n\t}\n\t\n\tvar bitmap = 0;\n\t\n\tvar getTileFromFlatArray = function getTileFromFlatArray(x, y, cWidth, dataArray) {\n\t\treturn dataArray[y * cWidth + x];\n\t};\n\t\n\t// Listlife reference at: http://dotat.at/prog/life/life.html\n\t// Local cell neighborhood as binary map:\n\t//  _______________________________________________________\n\t//  |                  |                 |                 |\n\t//  |  001000000 = 64  |  000001000 = 8  |  000000001 = 1  |\n\t//  |__________________|_________________|_________________|\n\t//  |                  |                 |                 |\n\t//  |  010000000 = 128 |  000010000 = 16 |  000000010 = 2  |\n\t//  |__________________|_________________|_________________|\n\t//  |                  |                 |                 |\n\t//  |  100000000 = 256 |  000100000 = 32 |  000000100 = 4  |\n\t//  |__________________|_________________|_________________|\n\t\n\tvar countNonToroidal = function countNonToroidal(x, y, cWidth, cHeight, dataArray) {\n\t\n\t\tvar ret = 0;\n\t\tvar leftEdge = x === 0;\n\t\tvar rightEdge = x === cWidth - 1;\n\t\tvar topEdge = y === 0;\n\t\tvar bottomEdge = y === cHeight - 1;\n\t\tvar centerActive = false;\n\t\tvar neighborhoodCount = void 0;\n\t\n\t\tif (leftEdge) {\n\t\t\tbitmap = 0;\n\t\t} else {\n\t\n\t\t\t// Move binary representation three cells to left, adding zeroes from the right.\n\t\t\t// Using the shift allows 3 array lookups for non-edge cells, instead of 9.\n\t\t\tbitmap = bitmap << 3;\n\t\t\tbitmap = bitmap & 511; // 511 = \"111111111\". Set all but the 9 right most digits equal to 0.\n\t\t\tcenterActive = (bitmap & 16) === 16;\n\t\t}\n\t\n\t\t// Always add cells in column to the right, for all cases.\n\t\n\t\t// Top right cell.\n\t\tif (!rightEdge && !topEdge && getTileFromFlatArray(x + 1, y - 1, cWidth, dataArray)) {\n\t\t\tbitmap = bitmap | 1;\n\t\t}\n\t\n\t\t// Right cell.\n\t\tif (!rightEdge && getTileFromFlatArray(x + 1, y, cWidth, dataArray)) {\n\t\t\tbitmap = bitmap | 2;\n\t\t}\n\t\n\t\t// Bottom right cell.\n\t\tif (!rightEdge && !bottomEdge && getTileFromFlatArray(x + 1, y + 1, cWidth, dataArray)) {\n\t\t\tbitmap = bitmap | 4;\n\t\t}\n\t\n\t\tif (leftEdge) {\n\t\n\t\t\t// Top cell.\n\t\t\tif (!topEdge && getTileFromFlatArray(x, y - 1, cWidth, dataArray)) {\n\t\t\t\tbitmap = bitmap | 8;\n\t\t\t}\n\t\n\t\t\t// Center cell.\n\t\t\tif (getTileFromFlatArray(x, y, cWidth, dataArray)) {\n\t\t\t\tbitmap = bitmap | 16;\n\t\t\t\tcenterActive = true;\n\t\t\t}\n\t\n\t\t\t// Bottom cell.\n\t\t\tif (!bottomEdge && getTileFromFlatArray(x, y + 1, cWidth, dataArray)) {\n\t\t\t\tbitmap = bitmap | 32;\n\t\t\t}\n\t\t}\n\t\n\t\tneighborhoodCount = bitmapLookupArr[bitmap];\n\t\tif (neighborhoodCount === 3 || centerActive && neighborhoodCount === 4) {\n\t\t\tret = 1;\n\t\t}\n\t\treturn ret;\n\t};\n\t\n\t// Substantially similar logic, but putting in a separate function avoids an extra \"if\"\n\t// statement (or wrapper function) in the typical render loop.\n\tvar countToroidal = function countToroidal(x, y, cWidth, cHeight, dataArray) {\n\t\n\t\tvar ret = 0;\n\t\tvar leftEdge = x === 0;\n\t\tvar rightEdge = x === cWidth - 1;\n\t\tvar topEdge = y === 0;\n\t\tvar bottomEdge = y === cHeight - 1;\n\t\tvar centerActive = false;\n\t\tvar neighborhoodCount = void 0;\n\t\n\t\tif (leftEdge) {\n\t\t\tbitmap = 0;\n\t\t} else {\n\t\n\t\t\t// Move binary representation three cells to left, adding zeroes from the right.\n\t\t\t// Using the shift allows 3 array lookups for non-edge cells, instead of 9.\n\t\t\tbitmap = bitmap << 3;\n\t\t\tbitmap = bitmap & 511; // 511 = \"111111111\". Set all but the 9 right most digits equal to 0.\n\t\t\tcenterActive = (bitmap & 16) === 16;\n\t\t}\n\t\n\t\t// Account for wrapping behavior.\n\t\tvar left = x - 1;\n\t\tvar right = x + 1;\n\t\tvar top = y - 1;\n\t\tvar bottom = y + 1;\n\t\n\t\tif (leftEdge) {\n\t\t\tleft = cWidth - 1; // Wrap left edge over to the right.\n\t\t} else if (rightEdge) {\n\t\t\tright = 0; // Wrap right edge over to the left.\n\t\t}\n\t\tif (topEdge) {\n\t\t\ttop = cHeight - 1; // Wrap above top over to the bottom.\n\t\t} else if (bottomEdge) {\n\t\t\tbottom = 0; // Wrap below bottom over to the top.\n\t\t}\n\t\n\t\t// Always add cells in column to the right, for all cases, even on the edges.\n\t\n\t\t// Top right cell.\n\t\tif (getTileFromFlatArray(right, top, cWidth, dataArray)) {\n\t\t\tbitmap = bitmap | 1;\n\t\t}\n\t\n\t\t// Right cell.\n\t\tif (getTileFromFlatArray(right, y, cWidth, dataArray)) {\n\t\t\tbitmap = bitmap | 2;\n\t\t}\n\t\n\t\t// Bottom right cell.\n\t\tif (getTileFromFlatArray(right, bottom, cWidth, dataArray)) {\n\t\t\tbitmap = bitmap | 4;\n\t\t}\n\t\n\t\t// Add center and left columns.\n\t\tif (leftEdge) {\n\t\n\t\t\t// Top cell.\n\t\t\tif (getTileFromFlatArray(x, top, cWidth, dataArray)) {\n\t\t\t\tbitmap = bitmap | 8;\n\t\t\t}\n\t\n\t\t\t// Center cell.\n\t\t\tif (getTileFromFlatArray(x, y, cWidth, dataArray)) {\n\t\t\t\tbitmap = bitmap | 16;\n\t\t\t\tcenterActive = true;\n\t\t\t}\n\t\n\t\t\t// Bottom cell.\n\t\t\tif (getTileFromFlatArray(x, bottom, cWidth, dataArray)) {\n\t\t\t\tbitmap = bitmap | 32;\n\t\t\t}\n\t\n\t\t\t// Top left cell.\n\t\t\tif (getTileFromFlatArray(left, top, cWidth, dataArray)) {\n\t\t\t\tbitmap = bitmap | 64;\n\t\t\t}\n\t\n\t\t\t// Left cell.\n\t\t\tif (getTileFromFlatArray(left, y, cWidth, dataArray)) {\n\t\t\t\tbitmap = bitmap | 128;\n\t\t\t}\n\t\n\t\t\t// Bottom left cell.\n\t\t\tif (getTileFromFlatArray(left, bottom, cWidth, dataArray)) {\n\t\t\t\tbitmap = bitmap | 256;\n\t\t\t}\n\t\t}\n\t\n\t\tneighborhoodCount = bitmapLookupArr[bitmap];\n\t\tif (neighborhoodCount === 3 || centerActive && neighborhoodCount === 4) {\n\t\t\tret = 1;\n\t\t}\n\t\treturn ret;\n\t};\n\t\n\tvar countLiveNeighbors = countNonToroidal; // Initial setting.\n\t\n\tplayer.setToroidal = function (e) {\n\t\tif (e.target.checked) {\n\t\t\tstate.player.toroidal = true;\n\t\t\tcountLiveNeighbors = countToroidal;\n\t\t} else {\n\t\t\tstate.player.toroidal = false;\n\t\t\tcountLiveNeighbors = countNonToroidal;\n\t\t}\n\t};\n\t\n\t// Perf Testing.\n\t// let renderNextGenPerfCounter = 0;\n\t// let renderNextGenDuration = 0;\n\t\n\tplayer.renderNextGeneration = function () {\n\t\n\t\t// Performance checking Main paint start.\n\t\t// let renderNextGenStart = performance.now();\n\t\n\t\tvar currentValue = void 0,\n\t\t    neighborCount = void 0;\n\t\tvar cWidth = state.canvas.domDim.x;\n\t\tvar cHeight = state.canvas.domDim.y;\n\t\tvar dataArray = state.canvas.dataArray;\n\t\tvar newDataArray = new Int8Array(cWidth * cHeight); // All initially zero.\n\t\tvar pixels = state.canvas.pixelBuffer;\n\t\n\t\t// Performance checking math start.\n\t\t// let arrayMathStart = performance.now();\n\t\n\t\tfor (var _i8 = 0; _i8 < cHeight; _i8 += 1) {\n\t\t\t// Outer loop is rows.\n\t\t\tfor (var j = 0; j < cWidth; j += 1) {\n\t\t\t\t// Inner loop is columns.\n\t\n\t\t\t\t// A 1 (live) or 0 (dead)\n\t\t\t\tvar value = countLiveNeighbors(j, _i8, cWidth, cHeight, dataArray);\n\t\t\t\tnewDataArray[_i8 * cWidth + j] = value;\n\t\n\t\t\t\t// Repeat the logic from canvas.paintBothCanvasesBitwise here to\n\t\t\t\t// avoid an separate loop through all pixels.\n\t\t\t\t// Convert 1 (live) to 0. Convert 0 (dead) to 255.\n\t\t\t\tvar colorValue = 255 - value * 255;\n\t\n\t\t\t\tpixels[_i8 * cWidth + j] = 255 << 24 | /* alpha always opaque*/\n\t\t\t\tcolorValue << 16 | /* blue */\n\t\t\t\tcolorValue << 8 | /* green */\n\t\t\t\tcolorValue; /* red */\n\t\t\t}\n\t\t}\n\t\n\t\tcanvasCtx.putImageData(state.canvas.imageData, 0, 0);\n\t\tnavCanvasCtx.putImageData(state.canvas.imageData, 0, 0);\n\t\n\t\t// Performance checking Main paint end.\n\t\t// let renderNextGenEnd = performance.now();\n\t\t// renderNextGenDuration += renderNextGenEnd - renderNextGenStart;\n\t\t// if ( renderNextGenPerfCounter  === 59 ) {\n\t\t// \tconsole.log( \"Avg renderNextGen: \" + ( renderNextGenDuration / 60 ) + \" ms.\" );\n\t\t// \trenderNextGenPerfCounter = 0;\n\t\t// \trenderNextGenDuration = 0;\n\t\t// }\n\t\t// renderNextGenPerfCounter += 1;\n\t\n\t\tstate.canvas.dataArray = newDataArray; // Swap.\n\t\n\t\t// Increment the generation counter\n\t\tplayerCounterEl.textContent = state.player.generation = state.player.generation += 1;\n\t\n\t\t// If playing, then loop.\n\t\tif (state.player.isPlaying) {\n\t\t\tif (state.player.delay === \"none\") {\n\t\t\t\tnextFrameID = requestAnimationFrame(player.renderNextGeneration);\n\t\t\t} else {\n\t\t\t\tnextFrameID = w.setTimeout(function () {\n\t\t\t\t\trequestAnimationFrame(player.renderNextGeneration);\n\t\t\t\t}, state.player.delay);\n\t\t\t}\n\t\t}\n\t};\n\t\n\tplayer.pause = function () {\n\t\n\t\t// Cancel any scheduled stepAll call so that resets while playing don't step forward\n\t\t// to generation 1.\n\t\tif (state.player.isPlaying) {\n\t\t\tif (state.player.delay === \"none\") {\n\t\t\t\tcancelAnimationFrame(nextFrameID);\n\t\t\t} else {\n\t\t\t\tw.clearTimeout(nextFrameID);\n\t\t\t}\n\t\t}\n\t\tstate.player.isPlaying = false;\n\t\tplayerPlayButtonEl.classList.remove(\"player__play-button--is-playing\");\n\t};\n\t\n\tplayer.onPlayerClearButton = function (e) {\n\t\tplayer.onResetGenerationsCounter(e);\n\t\tvoidCurrentSelectedPatternLink();\n\t\tcanvas.clearDataArray();\n\t\tcanvas.clearMainAndNavCanvases();\n\t};\n\t\n\tplayer.onResetGenerationsCounter = function (e) {\n\t\tif (e && e.type === \"touchstart\") {\n\t\t\te.preventDefault();\n\t\t}\n\t\tplayer.pause();\n\t\tplayerCounterEl.textContent = \"0\";\n\t\tstate.player.generation = 0;\n\t};\n\t\n\tplayer.onStepButton = function (e) {\n\t\tif (e && e.type === \"touchstart\") {\n\t\t\te.preventDefault();\n\t\t}\n\t\tif (state.player.isPlaying) {\n\t\t\tplayer.pause();\n\t\t}\n\t\tvoidCurrentSelectedPatternLink();\n\t\tclearAnyHash();\n\t\tplayer.renderNextGeneration();\n\t};\n\t\n\tplayer.play = function () {\n\t\tstate.player.isPlaying = true;\n\t\tplayerPlayButtonEl.classList.add(\"player__play-button--is-playing\");\n\t\tvoidCurrentSelectedPatternLink();\n\t\tclearAnyHash();\n\t\tplayer.renderNextGeneration();\n\t};\n\t\n\tplayer.onPlayStopButton = function (e) {\n\t\tif (e && e.type === \"touchstart\") {\n\t\t\te.preventDefault();\n\t\t}\n\t\tif (state.player.isPlaying) {\n\t\t\tplayer.pause();\n\t\t} else {\n\t\t\tplayer.play();\n\t\t}\n\t};\n\t\n\tplayerToroidalInputEl.addEventListener(\"change\", player.setToroidal);\n\t\n\tplayerSpeedInputEl.addEventListener(\"input\", player.setSpeed);\n\t\n\tplayerClearButtonEl.addEventListener(\"touchstart\", player.onPlayerClearButton);\n\tplayerClearButtonEl.addEventListener(\"mousedown\", player.onPlayerClearButton);\n\t\n\tplayerResetButtonEl.addEventListener(\"touchstart\", player.onResetGenerationsCounter);\n\tplayerResetButtonEl.addEventListener(\"mousedown\", player.onResetGenerationsCounter);\n\t\n\tplayerPlayButtonEl.addEventListener(\"touchstart\", player.onPlayStopButton);\n\tplayerPlayButtonEl.addEventListener(\"mousedown\", player.onPlayStopButton);\n\t\n\tplayerStepButtonEl.addEventListener(\"touchstart\", player.onStepButton);\n\tplayerStepButtonEl.addEventListener(\"mousedown\", player.onStepButton);\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Patterns ----\n\t//*******\n\t//*******************************************\n\t\n\tvar voidCurrentSelectedPatternLink = function voidCurrentSelectedPatternLink() {\n\t\tvar currentSelectedLink = state.patterns.currentSelectedLink;\n\t\tif (currentSelectedLink) {\n\t\t\tcurrentSelectedLink.parentNode.classList.remove(\"pat--selected\", \"pat--loading\");\n\t\t\tstate.patterns.currentSelectedLink = null;\n\t\t}\n\t};\n\t\n\t// Patterns need room to breathe.\n\t// Canvas of an imported pattern that doesn't have a minCanvasX or minCanvasY properties\n\t// should be at least three times the core pattern dimensions on that side, with a\n\t// minimum value based on viewport media query.\n\t// (This helps keep small patterns fast on mobile.)\n\t// If the pattern includes minimum dimensions and/or offset values for positioning,\n\t// use those.\n\tvar addPatternMargins = function addPatternMargins(patPixArray, patWidth, patHeight, minCanvasX, minCanvasY, offsetX, offsetY) {\n\t\n\t\tvar minMargin = w.browser.isBig ? 200 : 80;\n\t\tvar outputWidth = minCanvasX || Math.max(patWidth * 3, minMargin);\n\t\tvar outputHeight = minCanvasY || Math.max(patHeight * 3, minMargin);\n\t\tvar newPixArray = new Int8Array(outputWidth * outputHeight); // All zeros initially\n\t\tvar len = patWidth * patHeight;\n\t\tvar curX = void 0,\n\t\t    curY = void 0;\n\t\n\t\t// Use any pixel offset if supplied, otherwise calculate\n\t\t// Validate offset values.\n\t\tif (!ut.isNonNegativeInteger(offsetX)) {\n\t\t\toffsetX = Math.floor((outputWidth - patWidth) / 2); // Default to centered\n\t\t}\n\t\tif (!ut.isNonNegativeInteger(offsetY)) {\n\t\t\toffsetY = Math.floor((outputHeight - patHeight) / 2);\n\t\t}\n\t\n\t\tfor (var _i9 = 0; _i9 < len; _i9 += 1) {\n\t\t\tcurX = _i9 % patWidth;\n\t\t\tcurY = Math.floor(_i9 / patWidth);\n\t\t\tnewPixArray[(curY + offsetY) * outputWidth + curX + offsetX] = patPixArray[_i9];\n\t\t}\n\t\n\t\treturn {\n\t\t\tdataArray: newPixArray,\n\t\t\twidth: outputWidth,\n\t\t\theight: outputHeight\n\t\t};\n\t};\n\t\n\tvar redrawCanvasFromDataArray = function redrawCanvasFromDataArray(dataArray, width, height) {\n\t\n\t\t// Don't reset generations counter here, because might be canvas resizing.\n\t\t// Don't transition-zoom.\n\t\tcanvasEl.classList.remove(\"main-canvas--transition-scale\");\n\t\tcanvas.setCanvasDim(width, height);\n\t\tstate.canvas.dataArray = dataArray;\n\t\tcanvas.paintBothCanvasesBitwise();\n\t\n\t\tw.requestAnimationFrame(function () {\n\t\t\tcanvas.handleFitZoom();\n\t\t\tcanvasEl.classList.add(\"main-canvas--transition-scale\");\n\t\t});\n\t};\n\t\n\t/**\n\t* @param {object} d - The JSON\n\t* @param {Boolean} addMargin - Whether or not additional margins should be considered.\n\t*/\n\tvar loadPatternJSONToCanvas = function loadPatternJSONToCanvas(d, addMargin) {\n\t\tvar patternStr = d.pattern;\n\t\tvar width = d.width;\n\t\tvar height = d.height;\n\t\tvar minCanvasX = d.minCanvasX;\n\t\tvar minCanvasY = d.minCanvasY;\n\t\tvar offsetX = d.offsetX;\n\t\tvar offsetY = d.offsetY;\n\t\tvar isToroidal = !!d.toroidal;\n\t\n\t\tif (!patternStr) {\n\t\t\tconsole.log(\"Pattern file parse error\");\n\t\t}\n\t\n\t\tvar pixelArray = parseRLEPixelString(patternStr, width, height);\n\t\tvar marginAddedObj = void 0;\n\t\n\t\t// Add margins for included JSON patterns.\n\t\tif (addMargin) {\n\t\t\tmarginAddedObj = addPatternMargins(pixelArray, width, height, minCanvasX, minCanvasY, offsetX, offsetY);\n\t\t\tpixelArray = marginAddedObj.dataArray;\n\t\t\twidth = marginAddedObj.width;\n\t\t\theight = marginAddedObj.height;\n\t\t}\n\t\n\t\tredrawCanvasFromDataArray(pixelArray, width, height);\n\t\tplayer.onResetGenerationsCounter();\n\t\n\t\tplayerToroidalInputEl.checked = isToroidal; // Set on DOM element. Doesn't fire a change event.\n\t\tstate.player.toroidal = isToroidal;\n\t\tcountLiveNeighbors = isToroidal ? countToroidal : countNonToroidal;\n\t};\n\t\n\tvar onPatternLinkClick = function onPatternLinkClick(e) {\n\t\te.preventDefault(); // Always for both touch and mouse.\n\t\n\t\t// Hide any mobile UI.\n\t\t// patternsPanelEl.classList.remove( \"patterns--mobile-show\" );\n\t\t// patternsButtonMobileEl.classList.remove( \"panel__button--selected\" );\n\t\n\t\topenCloseMobileFlyouts(); // Don't need to pass e. Calling w/o arguments closes everything.\n\t\n\t\tvar patternListItem = this.parentNode;\n\t\n\t\tplayer.pause(); // Stop any current animation.\n\t\tcanvas.clearMainAndNavCanvases();\n\t\n\t\tvoidCurrentSelectedPatternLink();\n\t\n\t\t// Remove loading class from all other pattern list items.\n\t\tfor (var _i10 = 0; _i10 < patternsListItemEls.length; _i10 += 1) {\n\t\t\tpatternsListItemEls[_i10].classList.remove(\"pat--loading\");\n\t\t}\n\t\tpatternListItem.classList.add(\"pat--selected\", \"pat--loading\");\n\t\n\t\t// Store for comparison when XHR returns, and also for removing classes.\n\t\tstate.patterns.currentSelectedLink = this;\n\t\n\t\tfetch(this.href).then(function (response) {\n\t\n\t\t\t// Unlike jQuery.AJAX(), 404 errors do not reject in fetch.\n\t\t\t// Must check for these manually.\n\t\t\tif (!response.ok) {\n\t\t\t\tvar error = new Error(response.statusText);\n\t\t\t\terror.response = response;\n\t\t\t\tthrow error;\n\t\t\t} else {\n\t\t\t\treturn response;\n\t\t\t}\n\t\t}).then(function (response) {\n\t\n\t\t\t// Patterns may return from the network out of the order clicked on.\n\t\t\tif (response.url !== state.patterns.currentSelectedLink.href) {\n\t\t\t\treturn Promise.reject(\"Pattern loaded was not the most recently clicked\");\n\t\t\t}\n\t\n\t\t\t// Get relative path from absolute and drop the extension.\n\t\t\t// Sanity check as there are probably some typos in markup.\n\t\t\tvar fileName = response.url.split(\"/\").pop();\n\t\t\tif (fileName.slice(-5) === \".json\") {\n\t\t\t\tfileName = fileName.slice(0, -5);\n\t\t\t\tw.history.replaceState(undefined, undefined, \"#\" + fileName);\n\t\t\t\treturn response.json();\n\t\t\t} else {\n\t\t\t\treturn Promise.reject(\"Response didn't have a '.json' extension\");\n\t\t\t}\n\t\t}).then(function (json) {\n\t\n\t\t\tloadPatternJSONToCanvas(json, true);\n\t\t}).catch(function (error) {\n\t\n\t\t\t// Catch and log any error that has happened along the way.\n\t\t\tconsole.log(\"error:\", error);\n\t\t}).then(function () {\n\t\n\t\t\t// Always remove the \"loading\" class when the promise is settled\n\t\t\t// and no longer pending, in all cases.\n\t\t\tpatternListItem.classList.remove(\"pat--loading\");\n\t\t});\n\t};\n\t\n\t// Attach delegated event handler for patterns.\n\t// Don't listen for touchstart because the link list needs to be scrollable.\n\tGator(patternsWrapperEl).on(\"click\", \".pat__link\", onPatternLinkClick);\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- All Modals ----\n\t//*******\n\t//*******************************************\n\t\n\tModal.modalSetOpenState = function (bool) {\n\t\tstate.isModalOpen = bool;\n\t};\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Canvas Size Modal ----\n\t//*******\n\t//*******************************************\n\t\n\tmodalCanvasSize.modalBeforeOpen = function () {\n\t\tthis.currentCanvasWidth = state.canvas.domDim.x;\n\t\tthis.currentCanvasHeight = state.canvas.domDim.y;\n\t};\n\tmodalCanvasSize.modalSubmit = function () {\n\t\tcanvas.handleResize(this.newWidth, this.newHeight, this.resizeIconPositionX, this.resizeIconPositionY);\n\t};\n\tmodalCanvasSize.init(infoCanvasSizeButtonEl);\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Pattern Open Modal ----\n\t//*******\n\t//*******************************************\n\t\n\tmodalOpenPattern.modalSubmit = function () {\n\t\tvar fileExt = this.fileExtension;\n\t\tvar pat = this.parsedPattern;\n\t\n\t\t// The selected file should already be parsed by the time the user clicks \"OK\" in modal.\n\t\t// (We don't currently check for this asynchronicity.)\n\t\t// Don't ever add any margins to patterns loaded externally.\n\t\n\t\t// Text files have RLE string for pattern property.\n\t\tif (fileExt === \"JSON\" || fileExt === \"RLE\") {\n\t\t\tloadPatternJSONToCanvas(pat, false);\n\t\t} else if (fileExt === \"BMP\") {\n\t\n\t\t\t// BMP files have data array for pixels property.\n\t\t\tredrawCanvasFromDataArray(pat.pixels, pat.width, pat.height);\n\t\t}\n\t\n\t\tvoidCurrentSelectedPatternLink();\n\t\tclearAnyHash();\n\t\tplayer.onResetGenerationsCounter();\n\t\tw.history.replaceState(undefined, undefined, w.location.pathname);\n\t};\n\t\n\tmodalOpenPattern.init(patternsOpenButtonEl);\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Pattern Save Modal ----\n\t//*******\n\t//*******************************************\n\t\n\tmodalSavePattern.modalSubmit = function () {\n\t\tvar fileFormatEl = doc.querySelector(\"[data-modal-save-file-format]\");\n\t\tvar patternNameEl = doc.querySelector(\"[data-modal-save-pattern-name]\");\n\t\tvar patternAuthorEl = doc.querySelector(\"[data-modal-save-pattern-author]\");\n\t\tvar suppliedPatternName = patternNameEl.value;\n\t\tvar usedPatternName = suppliedPatternName || \"my-lifey-pattern\";\n\t\tvar fileType = fileFormatEl.value;\n\t\tvar outputStr = void 0;\n\t\n\t\tvar orderedPatternForJSON = Object.create(null);\n\t\tvar patternObj = dataArrayToRLE(state.canvas.dataArray, state.canvas.domDim.x, state.canvas.domDim.y);\n\t\n\t\t// Add the properties to the new object in the order they should be printed.\n\t\tif (suppliedPatternName) {\n\t\t\torderedPatternForJSON.name = suppliedPatternName;\n\t\t}\n\t\tif (patternAuthorEl.value) {\n\t\t\torderedPatternForJSON.author = patternAuthorEl.value;\n\t\t}\n\t\torderedPatternForJSON.width = patternObj.width;\n\t\torderedPatternForJSON.height = patternObj.height;\n\t\torderedPatternForJSON.minCanvasX = patternObj.minCanvasX;\n\t\torderedPatternForJSON.minCanvasY = patternObj.minCanvasY;\n\t\torderedPatternForJSON.offsetX = patternObj.offsetX;\n\t\torderedPatternForJSON.offsetY = patternObj.offsetY;\n\t\torderedPatternForJSON.pattern = patternObj.pattern;\n\t\n\t\tif (fileType === \"json\") {\n\t\t\toutputStr = JSON.stringify(orderedPatternForJSON, null, \"\\t\");\n\t\t} else if (fileType === \"rle\") {\n\t\t\toutputStr = patToRleFileString(orderedPatternForJSON);\n\t\t}\n\t\n\t\tsaveTextAsFile(outputStr, usedPatternName + \".\" + fileType);\n\t};\n\t\n\tmodalSavePattern.init(patternsSaveButtonEl);\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Pattern Share Modal ----\n\t//*******\n\t//*******************************************\n\t\n\t// Runs after innerMarkup has been added. Not really a binding in this case, but can use.\n\tmodalSharePattern.modalInternalBinding = function () {\n\t\tvar modalSharePatternFitsEl = doc.querySelector(\".pattern-fits-in-url\");\n\t\tvar urlDivEl = doc.querySelector(\"[data-modal-shareable-url]\");\n\t\tvar cWidth = state.canvas.domDim.x;\n\t\tvar cHeight = state.canvas.domDim.y;\n\t\tvar baseURL = w.location.href;\n\t\tvar patRLEObj = dataArrayToRLE(state.canvas.dataArray, cWidth, cHeight);\n\t\tvar msg = void 0,\n\t\t    linkURL = void 0;\n\t\n\t\t// If sharing a pattern from the library, don't use query string data.\n\t\tif (state.patterns.currentSelectedLink) {\n\t\t\tlinkURL = baseURL;\n\t\t} else {\n\t\t\tlinkURL = baseURL + \"#\" + ut.serializeToQueryString(patRLEObj);\n\t\t}\n\t\n\t\tif (!linkURL || linkURL.length > 4000) {\n\t\t\tmsg = \"Sorry, but your pattern is too large to be shared in a URL.\" + \" Please consider saving to a JSON or RLE text file instead.\" + \" You can also right-click directly on the canvas to save it as a PNG.\";\n\t\t\turlDivEl.classList.add(\"hide-url\");\n\t\t} else {\n\t\t\tmsg = \"The following URL is a permanent, shareable link to the current pattern.\" + \" It has been copied to your system clipboard.\";\n\t\t\turlDivEl.innerHTML = linkURL;\n\t\t\turlDivEl.focus();\n\t\t\tut.copyTextToClipBoard(linkURL);\n\t\t}\n\t\n\t\tmodalSharePatternFitsEl.innerHTML = msg;\n\t};\n\t\n\tmodalSharePattern.init(patternsShareButtonEl);\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Keyboard Shortcuts ----\n\t//*******\n\t//*******************************************\n\t\n\t// Keymaster defines shortcuts within a particular \"scope\" that corresponds to an area of a\n\t// single page app. Lifey currently has two areas: \"main\" and \"modal\". Nearly all general\n\t// keyboard shortcuts are disabled in the modal view.\n\tkey.setScope(\"main\"); // Keymaster default scope is \"all\".\n\t\n\t// By default, Keymaster doesn't process shortcuts when INPUT, SELECT, or\n\t// TEXTAREA elements are focused. Loosen this restriction to allow shortcuts\n\t// to work when INPUT elements are focused.\n\tkey.filter = function (event) {\n\t\tvar tagName = (event.target || event.srcElement).tagName;\n\t\treturn !(tagName == \"SELECT\" || tagName == \"TEXTAREA\");\n\t};\n\t\n\t// Kill all repeated key events.\n\tbodyEl.addEventListener(\"keydown\", function (e) {\n\t\tif (e.repeat) {\n\t\t\treturn false;\n\t\t}\n\t});\n\t\n\t// ---- Toolbox Shortcuts ----\n\t\n\t// Shift key switches toolbox to the hand tool until the key is released.\n\tkey(\"shift\", \"main\", function () {\n\t\tbodyEl.classList.add(\"shift-depressed\");\n\t\tstate.toolbox.override = \"hand\";\n\t});\n\t\n\t// Keyup must be done manually without Keymaster.\n\tbodyEl.addEventListener(\"keyup\", function (e) {\n\t\tif (e.which === 16) {\n\t\t\tbodyEl.classList.remove(\"shift-depressed\");\n\t\t\tstate.toolbox.override = null;\n\t\t}\n\t});\n\t\n\tkey(\"b\", \"main\", function () {\n\t\tsetToolboxTool(\"brush\");\n\t});\n\t\n\tkey(\"e\", \"main\", function () {\n\t\tsetToolboxTool(\"eraser\");\n\t});\n\t\n\tkey(\"h\", \"main\", function () {\n\t\tsetToolboxTool(\"hand\");\n\t});\n\t\n\tkey(\"z\", \"main\", function () {\n\t\tsetToolboxTool(\"zoom-in\");\n\t});\n\t\n\t// ---- Zoom Shortcuts ----\n\t\n\t// Plus key.\n\tkey(browser.shortkey + \"+=\", \"main\", function (e) {\n\t\te.preventDefault();\n\t\n\t\t// Treat keyboard-shortcut-initiated zooms as occurring at center of the visible innerView.\n\t\t// Synthesize an event property on them for simplicity.\n\t\te.pageX = state.innerView.visibleWidth / 2;\n\t\te.pageY = state.innerView.visibleHeight / 2;\n\t\tcanvas.handleIncrementalZoom(e, \"zoom-in\");\n\t});\n\t\n\t// Minus key.\n\tkey(browser.shortkey + \"+-\", \"main\", function (e) {\n\t\te.preventDefault();\n\t\te.pageX = state.innerView.visibleWidth / 2;\n\t\te.pageY = state.innerView.visibleHeight / 2;\n\t\tcanvas.handleIncrementalZoom(e, \"zoom-out\");\n\t});\n\t\n\t// Zero key.\n\tkey(browser.shortkey + \"+0\", \"main\", function (e) {\n\t\te.preventDefault();\n\t\tcanvas.handleFitZoom();\n\t});\n\t\n\t// ---- Player Shortcut ----\n\t\n\t// As in video software, space bar plays/pauses.\n\tkey(\"space\", \"main\", function () {\n\t\tplayer.onPlayStopButton();\n\t});\n\t\n\t// ---- Hide Panels Shortcut ----\n\t\n\t// Tab key.\n\tkey(\"tab\", \"main\", function () {\n\t\tbodyEl.classList.toggle(\"hide-panels\");\n\t\treturn false;\n\t});\n\t\n\t// ---- Modal Shortcuts ----\n\t\n\t// Treat hitting \"enter\" as clicking \"ok\".\n\tkey(\"enter\", \"modal\", function (e) {\n\t\tdoc.querySelector(\"[data-modal-ok]\").click();\n\t});\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Hash Management ----\n\t//*******\n\t//*******************************************\n\t\n\tvar clearAnyHash = function clearAnyHash() {\n\t\tif (w.location.hash) {\n\t\t\tw.history.replaceState(undefined, undefined, w.location.pathname);\n\t\t}\n\t};\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Fullscreen API\n\t//*******\n\t//*******************************************\n\t\n\trequestFullscreenButtonEl.addEventListener(\"click\", function (e) {\n\t\tvar requestFullScreen = htmlEl.requestFullscreen || htmlEl.mozRequestFullScreen || htmlEl.webkitRequestFullScreen;\n\t\n\t\trequestFullScreen.call(htmlEl);\n\t});\n\t\n\texitFullscreenButtonEl.addEventListener(\"click\", function (e) {\n\t\tvar exitFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen;\n\t\n\t\texitFullScreen.call(doc);\n\t});\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Refresh from Standalone\n\t//*******\n\t//*******************************************\n\t\n\tvar mobileRefreshEl = doc.querySelector(\".mobile-menu__refresh\");\n\t\n\tmobileRefreshEl.addEventListener(\"click\", function (e) {\n\t\te.preventDefault();\n\t\tw.location = \"https://bellandwhistle.net/lifey\";\n\t});\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Mobile-only UI\n\t//*******\n\t//*******************************************\n\t\n\tvar onPointerStartAnyPanelButton = function onPointerStartAnyPanelButton(e) {\n\t\tif (e.type === \"touchstart\") {\n\t\t\te.preventDefault();\n\t\n\t\t\t// :active styling is screwed up on FF for Android.\n\t\t\t// Manually add and remove classes instead. :/\n\t\t\tthis.classList.add(\"panel__button--touch-pressed\");\n\t\t}\n\t\topenCloseMobileFlyouts(e, this);\n\t};\n\t\n\tvar onTouchEndAnyPanelButton = function onTouchEndAnyPanelButton(e) {\n\t\te.preventDefault();\n\t\tthis.classList.remove(\"panel__button--touch-pressed\");\n\t};\n\t\n\tvar openCloseMobileFlyouts = function () {\n\t\tvar activeFlyout = void 0;\n\t\tvar flyoutTargets = {\n\t\t\t\"meter\": {\n\t\t\t\t\"buttonEl\": meterButtonMobileEl,\n\t\t\t\t\"targetEl\": playerPanelEl,\n\t\t\t\t\"className\": \"player--mobile-show-speed\"\n\t\t\t},\n\t\t\t\"menu\": {\n\t\t\t\t\"buttonEl\": menuButtonMobileEl,\n\t\t\t\t\"targetEl\": playerPanelEl,\n\t\t\t\t\"className\": \"player--mobile-show-toroidal\"\n\t\t\t},\n\t\t\t\"patterns\": {\n\t\t\t\t\"buttonEl\": patternsButtonMobileEl,\n\t\t\t\t\"targetEl\": patternsPanelEl,\n\t\t\t\t\"className\": \"patterns--mobile-show\"\n\t\t\t}\n\t\t};\n\t\n\t\treturn function (e, button) {\n\t\n\t\t\t// Could be \"meter\", \"menu\", \"patterns\" or undefined.\n\t\t\tvar pointeredStr = void 0;\n\t\n\t\t\tif (button) {\n\t\t\t\tpointeredStr = button.getAttribute(\"data-mobile-button\");\n\t\t\t}\n\t\n\t\t\t// Unified closing logic:\n\t\t\t// If the clicked button is currently active, close it and return.\n\t\t\t// If another flyout is active, close it.\n\t\t\tif (activeFlyout) {\n\t\t\t\tvar activeTarget = flyoutTargets[activeFlyout];\n\t\t\t\tactiveTarget.buttonEl.classList.remove(\"panel__button--selected\");\n\t\t\t\tactiveTarget.targetEl.classList.remove(activeTarget.className);\n\t\n\t\t\t\t// If clicked button was currently active, get out.\n\t\t\t\tif (pointeredStr && pointeredStr === activeFlyout) {\n\t\t\t\t\tactiveFlyout = undefined;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tactiveFlyout = undefined; /* May be overridden below. */\n\t\t\t}\n\t\n\t\t\t// Opening logic:\n\t\t\tif (button) {\n\t\t\t\tvar pointeredTarget = flyoutTargets[pointeredStr];\n\t\t\t\tif (!pointeredTarget) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tpointeredTarget.buttonEl.classList.add(\"panel__button--selected\");\n\t\t\t\tpointeredTarget.targetEl.classList.add(pointeredTarget.className);\n\t\t\t\tactiveFlyout = pointeredStr;\n\t\t\t}\n\t\t};\n\t}();\n\t\n\t// This works on all panel buttons everywhere. So canvas size, save as, share buttons all\n\t// close any current flyout.\n\tGator(bodyEl).on([\"touchstart\", \"click\"], \".panel__button\", onPointerStartAnyPanelButton);\n\t\n\t// Hamburger menu item click should close the hamburger menu.\n\t// Use click instead of touchstart here to reduce glitching on the menu item handlers,\n\t// which fire on touchstart.\n\tGator(playerToroidalWrapperEl).on(\"click\", \".mobile-menu__item\", openCloseMobileFlyouts);\n\t\n\tGator(bodyEl).on(\"touchend\", \".panel__button\", onTouchEndAnyPanelButton);\n\t\n\t// On touch, tapping tortoise/hare should increment/decrement the input range slider.\n\tGator(playerSpeedEl).on(\"touchstart\", \"svg\", function (e) {\n\t\tvar val = this.classList.contains(\"player__tortoise\") ? -1 : 1;\n\t\tplayer.setSpeed(null, parseInt(playerSpeedInputEl.value, 10) + val);\n\t});\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Scrollbar Styles for Firefox\n\t//*******\n\t//*******************************************\n\t\n\t// Firefox currently doesn't support CSS on scrollbars.\n\t// Use overlaid dummy elements and CSS mix-blend-mode to style.\n\t// This is gross but it's better than either of the alternatives.\n\t\n\tvar addFirefoxScrollStyleElements = function addFirefoxScrollStyleElements() {\n\t\n\t\tvar widthInvert = doc.createElement(\"div\");\n\t\tvar widthLighter = doc.createElement(\"div\");\n\t\tvar heightInvert = doc.createElement(\"div\");\n\t\tvar heightLighter = doc.createElement(\"div\");\n\t\tvar cornerBox = doc.createElement(\"div\");\n\t\n\t\tvar heightInvertPatterns = void 0,\n\t\t    heightLighterPatterns = void 0,\n\t\t    heightSingleLine = void 0;\n\t\n\t\twidthInvert.classList.add(\"ff-scroll\", \"ff-scroll--horizontal\", \"ff-scroll--invert\");\n\t\twidthLighter.classList.add(\"ff-scroll\", \"ff-scroll--horizontal\", \"ff-scroll--lighter\");\n\t\theightInvert.classList.add(\"ff-scroll\", \"ff-scroll--vertical\", \"ff-scroll--invert\");\n\t\theightLighter.classList.add(\"ff-scroll\", \"ff-scroll--vertical\", \"ff-scroll--lighter\");\n\t\n\t\tcornerBox.classList.add(\"ff-scroll\", \"ff-scroll-corner\");\n\t\n\t\t// Clone a full-height set for the patterns panel.\n\t\theightInvertPatterns = heightInvert.cloneNode();\n\t\theightInvertPatterns.classList.add(\"ff-scroll--full-height\");\n\t\theightLighterPatterns = heightLighter.cloneNode();\n\t\theightLighterPatterns.classList.add(\"ff-scroll--full-height\");\n\t\n\t\t// Divs on the main background need to save room for a corner.\n\t\twidthInvert.classList.add(\"ff-scroll--horizontal-with-corner\");\n\t\twidthLighter.classList.add(\"ff-scroll--horizontal-with-corner\");\n\t\theightInvert.classList.add(\"ff-scroll--vertical-with-corner\");\n\t\theightLighter.classList.add(\"ff-scroll--vertical-with-corner\");\n\t\n\t\theightSingleLine = doc.createElement(\"div\");\n\t\theightSingleLine.classList.add(\"ff-scroll\", \"ff-scroll--vertical\", \"ff-scroll--full-height\", \"ff-scroll--single-line\");\n\t\n\t\t// Main panels need to sit in front of the FF color-flipping divs\n\t\t// otherwise there are weird compositing glitches.\n\t\tbodyEl.insertBefore(widthInvert, toolboxEl);\n\t\tbodyEl.insertBefore(widthLighter, toolboxEl);\n\t\tbodyEl.insertBefore(heightInvert, toolboxEl);\n\t\tbodyEl.insertBefore(heightLighter, toolboxEl);\n\t\tbodyEl.insertBefore(cornerBox, toolboxEl);\n\t\n\t\tpatternsOuterWrapperEl.appendChild(heightInvertPatterns);\n\t\tpatternsOuterWrapperEl.appendChild(heightLighterPatterns);\n\t\n\t\t// Black 1px line prevents an occasional weird white line from rendering.\n\t\tpatternsOuterWrapperEl.appendChild(heightSingleLine);\n\t};\n\t\n\tif (w.browser.isFirefox) {\n\t\taddFirefoxScrollStyleElements();\n\t}\n\t\n\t// No way to disable browser-level zoom in Firefox. Rebuild styles on both load and resize.\n\t// Add rules to existing stylesheet to indent desktop toolbars on the right by the scrollbar width.\n\tvar writeScrollbarDependentRules = function writeScrollbarDependentRules() {\n\t\n\t\tvar rulesLength = scrollSs.cssRules.length;\n\t\tfor (var _i11 = 0; _i11 < rulesLength; _i11 += 1) {\n\t\t\tscrollSs.deleteRule(0);\n\t\t}\n\t\n\t\t// Always on page load for all browsers.\n\t\tscrollSs.insertRule(\".panel--right { right: \" + state.scrollbarDim + \"px;}\", 0);\n\t\n\t\tif (w.browser.isFirefox) {\n\t\t\tscrollSs.insertRule(\".ff-scroll--horizontal {\" + \"height: \" + state.scrollbarDim + \"px;\", 1);\n\t\n\t\t\tscrollSs.insertRule(\".ff-scroll--vertical  {\" + \"width: \" + state.scrollbarDim + \"px;\", 2);\n\t\n\t\t\tscrollSs.insertRule(\".ff-scroll--horizontal-with-corner {\" + \"width: calc(100% - \" + state.scrollbarDim + \"px);}\", 3);\n\t\n\t\t\tscrollSs.insertRule(\".ff-scroll--vertical-with-corner {\" + \"height: calc(100% - \" + state.scrollbarDim + \"px);}\", 4);\n\t\n\t\t\tscrollSs.insertRule(\".ff-scroll-corner { width: \" + state.scrollbarDim + \"px;\" + \"height: \" + state.scrollbarDim + \"px);}\", 5);\n\t\t}\n\t};\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Master Window Resize Handler\n\t//*******\n\t//*******************************************\n\t\n\t// Refer to different padding values in base.SCSS starting at line 46.\n\tvar deriveViewportDependentConstants = function deriveViewportDependentConstants() {\n\t\n\t\t// Track mobile vs desktop state, for layout math.\n\t\t// Current this is only needed to deal with changing scrollbars and padding.\n\t\tw.browser.isBig = false;\n\t\tstate.canvas.zoomPadding = 100;\n\t\n\t\t// These breakpoints must match the breakpoints on line 17 of \"_vars.scss\"\n\t\tif (w.matchMedia(\"(min-width: 790px) and (min-height: 600px)\").matches) {\n\t\t\tstate.canvas.zoomPadding = 200;\n\t\t\tw.browser.isBig = true;\n\t\n\t\t\t// Don't track mouse cursor position if we're not actually showing it.\n\t\t\tcanvasEl.addEventListener(\"mouseenter\", handleCoordinatesEnter);\n\t\t}\n\t\n\t\t// Scrollbar CSS pixel thickness varies between browsers and sometimes zoom levels.\n\t\tstate.scrollbarDim = outerBgEl.offsetWidth - outerBgEl.clientWidth;\n\t};\n\t\n\tvar onWindowResize = function onWindowResize() {\n\t\tderiveViewportDependentConstants();\n\t\tif (w.browser.isFirefox) {\n\t\t\twriteScrollbarDependentRules();\n\t\t}\n\t\tinnerView.onResize();\n\t};\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- On Window Load ----\n\t//*******\n\t//*******************************************\n\t\n\t// Some CSS values can't be read and stored reliably until the load event.\n\t// Wait, otherwise scaling doesn't work reliably on the initial canvas.\n\t(function () {\n\t\n\t\tvar splashTimeout = void 0;\n\t\n\t\tvar loadBlankCanvasBasedOnViewportDimensions = function loadBlankCanvasBasedOnViewportDimensions() {\n\t\n\t\t\tvar initialWidth = void 0,\n\t\t\t    initialHeight = void 0;\n\t\n\t\t\t// 80% of the available viewport on desktop. More tightly fitted on mobile.\n\t\t\tif (w.browser.isBig) {\n\t\t\t\tinitialWidth = Math.floor(state.innerView.visibleWidth * 0.8 / state.canvas.scale);\n\t\t\t\tinitialHeight = Math.floor(state.innerView.visibleHeight * 0.8 / state.canvas.scale);\n\t\t\t} else {\n\t\t\t\tinitialWidth = Math.floor((state.innerView.visibleWidth - 30) / state.canvas.scale);\n\t\t\t\tinitialHeight = Math.floor((state.innerView.visibleHeight - 30) / state.canvas.scale);\n\t\t\t}\n\t\t\tcanvas.setCanvasDim(initialWidth, initialHeight);\n\t\t\tcanvas.clearDataArray(); // Data Array based on canvas dim state so must come after.\n\t\t};\n\t\n\t\tvar loadInitialCanvas = function loadInitialCanvas() {\n\t\t\tvar hash = w.location.hash.slice(1); // Remove \"#\"\n\t\t\tvar link = doc.querySelector(\"[href='pat/\" + hash + \".json']\");\n\t\t\tvar qsObj = ut.deserializeQueryString(hash);\n\t\n\t\t\t// Show the red navigator outline;\n\t\t\tnavOutlineEl.classList.remove(\"navigator__canvas-outline--hidden\");\n\t\n\t\t\t// First try parsing as a query string.\n\t\t\tif (qsObj && qsObj.pattern && qsObj.width && qsObj.height) {\n\t\n\t\t\t\t// Query string might be malformed or mistyped etc. Fall through to blank canvas.\n\t\t\t\ttry {\n\t\t\t\t\tloadPatternJSONToCanvas(qsObj, true); // Do add margins in queryString.\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log(\"Error parsing query string: \", e);\n\t\t\t\t\tloadBlankCanvasBasedOnViewportDimensions();\n\t\t\t\t}\n\t\n\t\t\t\t// Else if hash is a named pattern for which a pattern link exists, \"click\" that link.\n\t\t\t} else if (link) {\n\t\t\t\tlink.click();\n\t\t\t} else {\n\t\t\t\tloadBlankCanvasBasedOnViewportDimensions();\n\t\t\t}\n\t\n\t\t\t// Add innerView listeners once canvas exists.\n\t\t\t/// Firefox on Android fires mysterious early resize events.\n\t\t\tw.addEventListener(\"resize\", ut.debounce(onWindowResize, 80));\n\t\t\touterBgEl.addEventListener(\"scroll\", ut.throttleRaf(innerView.onScroll));\n\t\n\t\t\t// Drag-scroll work natively on touch, in order to get silky inertial scrolling.\n\t\t\t// Thus no need to bind a touchstart handler.\n\t\t\tinnerViewEl.addEventListener(\"mousedown\", innerView.onPointerDown);\n\t\t};\n\t\n\t\tvar hideSplash = function hideSplash(e) {\n\t\t\tif (e) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t\tclearTimeout(splashTimeout);\n\t\t\tsplashEl.removeEventListener(\"touchstart\", hideSplash);\n\t\t\tsplashEl.removeEventListener(\"click\", hideSplash);\n\t\t\tsplashEl.parentNode.removeChild(splashEl);\n\t\t\tloadInitialCanvas();\n\t\t};\n\t\n\t\tvar onPageLoad = function onPageLoad() {\n\t\n\t\t\t// Init: Read the rateInput value off of the slider.\n\t\t\t// Preserves slider state across cached page reload.\n\t\t\tplayer.setSpeed(undefined, playerSpeedInputEl.value);\n\t\n\t\t\t// Get scrollbar size and zoom padding dims and set in state.\n\t\t\t// This must come before the innerView calcs.\n\t\t\tderiveViewportDependentConstants();\n\t\t\twriteScrollbarDependentRules();\n\t\n\t\t\t// Sets the state.innerView.visibleWidth based on viewport and scrollbar thickness.\n\t\t\tinnerView.getVisibleDimensions();\n\t\n\t\t\t// Width and visibleWidth states will initially be equal.\n\t\t\tstate.innerView.width = state.innerView.visibleWidth;\n\t\t\tstate.innerView.height = state.innerView.visibleHeight;\n\t\n\t\t\t// Needed for resize handle hover areas to be placed correctly.\n\t\t\tpatternPanel.recordComputedStyle();\n\t\n\t\t\tif (browser.cutsMustard) {\n\t\t\t\tif (w.location.hash) {\n\t\t\t\t\thideSplash(); // Go directly when a hash is being shared.\n\t\t\t\t} else {\n\t\t\t\t\tsplashTimeout = w.setTimeout(hideSplash, 2500);\n\t\n\t\t\t\t\t// For the impatient, allow clicking past the initial splash screen.\n\t\t\t\t\tsplashEl.addEventListener(\"touchstart\", hideSplash);\n\t\t\t\t\tsplashEl.addEventListener(\"click\", hideSplash);\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\tw.removeEventListener(\"load\", onPageLoad);\n\t\t};\n\t\n\t\tif (doc.readyState === \"complete\") {\n\t\t\tonPageLoad();\n\t\t} else {\n\t\t\tw.addEventListener(\"load\", onPageLoad);\n\t\t}\n\t})();\n\t\n\t//*******************************************\n\t//*******\n\t//******* ---- Expose on the window for Testing ----\n\t//*******\n\t//*******************************************\n\t\n\t// Uglify should automatically rip the block below out for 'grunt prod' builds.\n\t// http://philipwalton.com/articles/how-to-unit-test-private-functions-in-javascript/\n\t// https://github.com/petehunt/webpack-howto\n\t// Note that this line will throw a \"condition always true\" warning\n\t// in webpack dev builds.\n\tif (false) {\n\t\tw.Flingable = function () {\n\t\t\treturn Flingable;\n\t\t};\n\t\tw.Resizable = function () {\n\t\t\treturn Resizable;\n\t\t};\n\t\tw.ut = function () {\n\t\t\treturn ut;\n\t\t};\n\t\tw.Modal = function () {\n\t\t\treturn Modal;\n\t\t};\n\t\tw.modalCanvasSize = function () {\n\t\t\treturn modalCanvasSize;\n\t\t};\n\t\tw.modalOpenPattern = function () {\n\t\t\treturn modalOpenPattern;\n\t\t};\n\t\tw.modalSavePattern = function () {\n\t\t\treturn modalSavePattern;\n\t\t};\n\t\tw.modalSharePattern = function () {\n\t\t\treturn modalSharePattern;\n\t\t};\n\t\tw.parseRLEPixelString = function () {\n\t\t\treturn parseRLEPixelString;\n\t\t};\n\t\tw.parseBMP = function () {\n\t\t\treturn parseBMP;\n\t\t};\n\t\tw.patToRleFileString = function () {\n\t\t\treturn patToRleFileString;\n\t\t};\n\t\tw.dataArrayToRLE = function () {\n\t\t\treturn dataArrayToRLE;\n\t\t};\n\t\tw.saveTextAsFile = function () {\n\t\t\treturn saveTextAsFile;\n\t\t};\n\t\n\t\tw.state = function () {\n\t\t\treturn state;\n\t\t};\n\t\tw.innerView = function () {\n\t\t\treturn innerView;\n\t\t};\n\t\tw.canvas = function () {\n\t\t\treturn canvas;\n\t\t};\n\t}\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t// Flingable\n\t!(__WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t\treturn {\n\t\n\t\t\tinitFlingable: function initFlingable(elem, opts) {\n\t\t\t\tthis.element = elem;\n\t\t\t\tthis.background = document.querySelector(\".outer-background\");\n\t\t\t\tthis.flingCoast = false; // Default\n\t\t\t\tif (opts) {\n\t\t\t\t\tthis.flingCoast = !!opts.coast;\n\t\t\t\t\tif (opts.flingFriction) {\n\t\t\t\t\t\tthis.flingFriction = opts.flingFriction;\n\t\t\t\t\t}\n\t\t\t\t\tif (opts.flingHandleEl) {\n\t\t\t\t\t\tthis.flingHandleEl = opts.flingHandleEl;\n\t\t\t\t\t}\n\t\t\t\t\tif (opts.flingContainer) {\n\t\t\t\t\t\tthis.flingContainer = Object.create(null);\n\t\t\t\t\t\tthis.flingContainer.element = opts.flingContainer;\n\t\t\t\t\t\tthis.flingContainer.css = Object.create(null);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\n\t\t\t\t// Initial properties specific to the instance.\n\t\t\t\tif (!this.css) {\n\t\t\t\t\tthis.css = Object.create(null);\n\t\t\t\t}\n\t\t\t\tthis.isFlingDragging = false;\n\t\t\t\tthis.isFlingMoving = false;\n\t\t\t\tthis.flingDragPositionX = 0;\n\t\t\t\tthis.flingDragPositionY = 0;\n\t\n\t\t\t\tthis.flingPositionX = 0;\n\t\t\t\tthis.flingPositionY = 0;\n\t\t\t\tthis.flingVelocityX = 0;\n\t\t\t\tthis.flingVelocityY = 0;\n\t\t\t\tthis.flingAccelX = 0;\n\t\t\t\tthis.flingAccelY = 0;\n\t\n\t\t\t\t// Create bound local reference for all the prototype handler methods  :/\n\t\t\t\tthis.flingMouseDown = this.flingMouseDown.bind(this);\n\t\t\t\tthis.flingMouseMove = this.flingMouseMove.bind(this);\n\t\t\t\tthis.flingMouseUp = this.flingMouseUp.bind(this);\n\t\n\t\t\t\tvar elemToListenOn = this.element;\n\t\t\t\tif (this.flingHandleEl) {\n\t\t\t\t\telemToListenOn = this.flingHandleEl;\n\t\t\t\t}\n\t\n\t\t\t\telemToListenOn.addEventListener(\"mousedown\", this.flingMouseDown);\n\t\n\t\t\t\treturn this; // Make chainable.\n\t\t\t},\n\t\n\t\t\t// On the prototype, figure out if unprefixed 2D Transforms are supported.\n\t\t\t// If not, check for prefix support.\n\t\t\ttransformProp: function (w) {\n\t\t\t\tvar htmlElStyle = w.getComputedStyle(document.documentElement);\n\t\t\t\tvar prefixArr = [\"webkit\", \"ms\"];\n\t\t\t\tvar prefixProp;\n\t\t\t\tif (\"transform\" in htmlElStyle) {\n\t\t\t\t\treturn \"transform\";\n\t\t\t\t}\n\t\t\t\tfor (var i = 0; i < 2; i += 1) {\n\t\t\t\t\tprefixProp = prefixArr[i] + \"Transform\";\n\t\t\t\t\tif (prefixProp in htmlElStyle) {\n\t\t\t\t\t\treturn \"-\" + prefixArr[i] + \"-transform\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}(window),\n\t\n\t\t\tflingMouseDown: function flingMouseDown(event) {\n\t\t\t\tevent.preventDefault();\n\t\n\t\t\t\t// Don't fling if this is a resize.\n\t\t\t\tif (this.rzblHoveringEdge) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\n\t\t\t\tthis.element.classList.add(\"panel--is-flinging\");\n\t\t\t\tthis.background.classList.add(\"panel--is-flinging\");\n\t\n\t\t\t\t// Container may have changed dimensions since init, e.g. viewport resize.\n\t\t\t\tthis.measureContainers();\n\t\n\t\t\t\t// Get drag start positions.\n\t\t\t\tthis.flingPageStartX = event.pageX;\n\t\t\t\tthis.flingPageStartY = event.pageY;\n\t\n\t\t\t\t// The flingDragPosition may reflect the last mouseup position,\n\t\t\t\t// not the final resting place, and thus needs to be updated.\n\t\t\t\tthis.flingItemBeginX = this.flingDragPositionX = this.flingPositionX;\n\t\t\t\tthis.flingItemBeginY = this.flingDragPositionY = this.flingPositionY;\n\t\n\t\t\t\tthis.isFlingDragging = this.isFlingMoving = true;\n\t\n\t\t\t\t// Start a rAF animation loop\n\t\t\t\tthis.flingAnimate();\n\t\n\t\t\t\t// Catch all mouse activity, even outside the browser viewport.\n\t\t\t\twindow.addEventListener(\"mousemove\", this.flingMouseMove);\n\t\t\t\twindow.addEventListener(\"mouseup\", this.flingMouseUp);\n\t\t\t},\n\t\n\t\t\tflingMouseMove: function flingMouseMove(event) {\n\t\n\t\t\t\t// Mousemove updates the flingDragPosition, which is one event ahead of the\n\t\t\t\t// flingPosition. The difference between the two is what generates the\n\t\t\t\t// velocity calculations around line 263. The velocity, adjusted for drag,\n\t\t\t\t// is then applied to the flingPosition, which is what is rendered out.\n\t\t\t\tvar moveX = event.pageX - this.flingPageStartX;\n\t\t\t\tvar moveY = event.pageY - this.flingPageStartY;\n\t\n\t\t\t\tthis.flingDragPositionX = this.flingItemBeginX + moveX;\n\t\t\t\tthis.flingDragPositionY = this.flingItemBeginY + moveY;\n\t\t\t},\n\t\n\t\t\tflingMouseUp: function flingMouseUp() {\n\t\t\t\tthis.isFlingDragging = false;\n\t\n\t\t\t\tif (!this.flingCoast) {\n\t\t\t\t\tthis.isFlingMoving = false; // Stop the animation.\n\t\t\t\t\tthis.flingVelocityX = this.flingVelocityY = 0;\n\t\t\t\t}\n\t\n\t\t\t\tthis.element.classList.remove(\"panel--is-flinging\");\n\t\t\t\tthis.background.classList.remove(\"panel--is-flinging\");\n\t\n\t\t\t\twindow.removeEventListener(\"mousemove\", this.flingMouseMove);\n\t\t\t\twindow.removeEventListener(\"mouseup\", this.flingMouseUp);\n\t\t\t},\n\t\n\t\t\tflingAnimate: function flingAnimate() {\n\t\n\t\t\t\tvar that = this;\n\t\t\t\tif (!this.isFlingMoving || !this.isFlingDragging && !this.flingCoast) {\n\t\n\t\t\t\t\t// Animation is over, update the final boundingRect.\n\t\t\t\t\tthis.css.boundRect = this.element.getBoundingClientRect();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.applyDragForce();\n\t\n\t\t\t\t// Containment option.\n\t\t\t\tif (this.flingContainer) {\n\t\t\t\t\tthis.flingPositionX = this.containFling(\"x\", this.flingPositionX);\n\t\t\t\t\tthis.flingPositionY = this.containFling(\"y\", this.flingPositionY);\n\t\t\t\t}\n\t\n\t\t\t\tthis.renderFling();\n\t\n\t\t\t\trequestAnimationFrame(function () {\n\t\t\t\t\tthat.flingAnimate();\n\t\t\t\t});\n\t\t\t},\n\t\n\t\t\trenderFling: function renderFling() {\n\t\n\t\t\t\t// Round the final translation numbers to three decimal places when it stops.\n\t\t\t\tthis.flingPositionX = Math.round(this.flingPositionX * 1000) / 1000;\n\t\t\t\tthis.flingPositionY = Math.round(this.flingPositionY * 1000) / 1000;\n\t\n\t\t\t\tvar str = \"translate(\" + this.flingPositionX + \"px, \" + this.flingPositionY + \"px)\";\n\t\t\t\tif (this.scale) {\n\t\t\t\t\tstr += \" scale(\" + this.scale + \")\";\n\t\t\t\t}\n\t\t\t\tthis.element.style[this.transformProp] = str;\n\t\n\t\t\t\t// Store the properties\n\t\t\t\tthis.css.translateX = this.flingPositionX;\n\t\t\t\tthis.css.translateY = this.flingPositionY;\n\t\t\t},\n\t\n\t\t\tflingFriction: 0.93,\n\t\n\t\t\tapplyDragForce: function applyDragForce() {\n\t\t\t\tif (this.isFlingDragging) {\n\t\n\t\t\t\t\t// Change the position to drag position by applying force to acceleration\n\t\t\t\t\tvar flingVelocityX = this.flingDragPositionX - this.flingPositionX;\n\t\t\t\t\tvar flingForceX = flingVelocityX - this.flingVelocityX;\n\t\n\t\t\t\t\tvar flingVelocityY = this.flingDragPositionY - this.flingPositionY;\n\t\t\t\t\tvar flingForceY = flingVelocityY - this.flingVelocityY;\n\t\n\t\t\t\t\tthis.flingAccelX += flingForceX;\n\t\t\t\t\tthis.flingAccelY += flingForceY;\n\t\t\t\t}\n\t\n\t\t\t\tthis.flingVelocityX += this.flingAccelX;\n\t\t\t\tthis.flingVelocityX *= this.flingFriction;\n\t\t\t\tthis.flingPositionX += this.flingVelocityX;\n\t\n\t\t\t\tthis.flingVelocityY += this.flingAccelY;\n\t\t\t\tthis.flingVelocityY *= this.flingFriction;\n\t\t\t\tthis.flingPositionY += this.flingVelocityY;\n\t\n\t\t\t\t// If the last update was miniscule, set isMoving to break the rAF loop.\n\t\t\t\tif (Math.abs(this.flingVelocityX) < 0.001 && Math.abs(this.flingVelocityY) < 0.001 && !this.isFlingDragging) {\n\t\t\t\t\tthis.isFlingMoving = false;\n\t\t\t\t}\n\t\n\t\t\t\tthis.flingAccelX = 0;\n\t\t\t\tthis.flingAccelY = 0;\n\t\t\t},\n\t\n\t\t\tmeasureContainers: function measureContainers() {\n\t\t\t\tthis.css.boundRect = this.element.getBoundingClientRect();\n\t\n\t\t\t\t// Note: getBoundingClientRect is with transforms applied.\n\t\t\t\t// offset positions are without transforms applied.\n\t\t\t\tthis.css.offsetTop = this.element.offsetTop;\n\t\t\t\tthis.css.offsetLeft = this.element.offsetLeft;\n\t\n\t\t\t\tif (this.flingContainer && this.flingContainer.element) {\n\t\t\t\t\tthis.flingContainer.css.boundRect = this.flingContainer.element.getBoundingClientRect();\n\t\t\t\t}\n\t\t\t},\n\t\n\t\t\t// Axis is 'x' or 'y' string, drag is numeric value\n\t\t\tcontainFling: function containFling(axis, drag) {\n\t\t\t\tvar span = axis === \"x\" ? \"width\" : \"height\";\n\t\t\t\tvar offsetDirection = axis === \"x\" ? \"Left\" : \"Top\";\n\t\n\t\t\t\tvar min = -1 * this.css[\"offset\" + offsetDirection];\n\t\t\t\tvar max = this.flingContainer.css.boundRect[span] - this.css.boundRect[span] + min;\n\t\n\t\t\t\treturn Math.min(max, Math.max(min, drag));\n\t\t\t}\n\t\t};\n\t}.call(exports, __webpack_require__, exports, module), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(8)], __WEBPACK_AMD_DEFINE_RESULT__ = function (ut) {\n\t\n\t\treturn {\n\t\n\t\t\tinitResizable: function initResizable(elem, opts) {\n\t\t\t\tvar that = this;\n\t\t\t\tthis.element = elem;\n\t\n\t\t\t\t// Copy options onto the local object\n\t\t\t\tif (opts) {\n\t\t\t\t\tfor (var opt in opts) {\n\t\n\t\t\t\t\t\tif (opts.hasOwnProperty(opt)) {\n\t\t\t\t\t\t\tthis[opt] = opts[opt];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\n\t\t\t\t// Check first, might be inheriting.\n\t\t\t\tif (!this.css) {\n\t\t\t\t\tthis.css = Object.create(null);\n\t\t\t\t}\n\t\n\t\t\t\t// Initial properties specific to the object.\n\t\t\t\tthis.isResizing = false;\n\t\t\t\tthis.rzblOnTopEdge = false;\n\t\t\t\tthis.rzblOnRightEdge = false;\n\t\t\t\tthis.rzblOnBottomEdge = false;\n\t\t\t\tthis.rzblOnLeftEdge = false;\n\t\t\t\tthis.rzblDragStartX = 0;\n\t\t\t\tthis.rzblDragStartY = 0;\n\t\n\t\t\t\tthis.rzblCalcEdges = this.rzblCalcEdges.bind(this);\n\t\n\t\t\t\tthis.recordComputedStyle = this.recordComputedStyle.bind(this);\n\t\t\t\tthis.rzblMouseDown = this.rzblMouseDown.bind(this);\n\t\t\t\tthis.rzblMouseMove = this.rzblMouseMove.bind(this);\n\t\t\t\tthis.rzblMouseUp = this.rzblMouseUp.bind(this);\n\t\n\t\t\t\t// Must wait for load/layout to internally record the resolved values of CSS\n\t\t\t\t// properties. This must happen after the scrollbar width is calculated.\n\t\t\t\tvar recordComputedStyleOnLoad = function recordComputedStyleOnLoad() {\n\t\t\t\t\tthat.recordComputedStyle();\n\t\t\t\t\twindow.removeEventListener(\"load\", recordComputedStyleOnLoad, true);\n\t\t\t\t};\n\t\n\t\t\t\tif (document.readyState === \"complete\") {\n\t\t\t\t\trecordComputedStyleOnLoad();\n\t\t\t\t} else {\n\t\t\t\t\twindow.addEventListener(\"load\", recordComputedStyleOnLoad, true);\n\t\t\t\t}\n\t\n\t\t\t\twindow.addEventListener(\"resize\", ut.debounce(this.recordComputedStyle, 80), true);\n\t\t\t\twindow.addEventListener(\"mousemove\", this.rzblMouseMove, true);\n\t\t\t\twindow.addEventListener(\"mousedown\", this.rzblMouseDown, true);\n\t\n\t\t\t\treturn this; // Chainability\n\t\t\t},\n\t\n\t\t\trecordComputedStyle: function recordComputedStyle() {\n\t\t\t\tvar computedStyle = window.getComputedStyle(this.element);\n\t\t\t\tthis.css.boundRect = this.element.getBoundingClientRect();\n\t\t\t\tthis.css.top = ut.stripPixelUnits(computedStyle.top);\n\t\t\t\tthis.css.right = ut.stripPixelUnits(computedStyle.right);\n\t\t\t\tthis.css.bottom = ut.stripPixelUnits(computedStyle.bottom);\n\t\t\t\tthis.css.left = ut.stripPixelUnits(computedStyle.left);\n\t\t\t},\n\t\n\t\t\t// Default settings live on the prototype.\n\t\t\trzblTop: true,\n\t\t\trzblRight: true,\n\t\t\trzblBottom: true,\n\t\t\trzblLeft: true,\n\t\t\trzblHorizontalCssProp: \"left\",\n\t\t\trzblVerticalCssProp: \"top\",\n\t\t\trzblMinHeight: 100,\n\t\t\trzblMinWidth: 100,\n\t\t\trzblTolerance: 4,\n\t\n\t\t\t// Meaure cursor's proximity to the edges of the box.\n\t\t\t// Returns one of the following: \"top\" \"right\" \"left\" \"bottom\" or false\n\t\t\trzblCalcEdges: function rzblCalcEdges(e) {\n\t\t\t\tif (!this.css.boundRect) {\n\t\t\t\t\treturn; // Layout hasn't happened yet, get out.\n\t\t\t\t}\n\t\t\t\tvar boundTop = this.css.boundRect.top;\n\t\t\t\tvar boundRight = this.css.boundRect.right;\n\t\t\t\tvar boundBottom = this.css.boundRect.bottom;\n\t\t\t\tvar boundLeft = this.css.boundRect.left;\n\t\t\t\tvar clientX = e.clientX;\n\t\t\t\tvar clientY = e.clientY;\n\t\t\t\tvar tol = this.rzblTolerance;\n\t\t\t\tvar hoveredEdge = false;\n\t\n\t\t\t\tvar withinElementX = boundLeft <= clientX && clientX <= boundRight;\n\t\t\t\tvar withinElementY = boundTop <= clientY && clientY <= boundBottom;\n\t\n\t\t\t\tvar nearTopLine = Math.abs(clientY - boundTop) <= tol;\n\t\t\t\tvar nearRightLine = Math.abs(clientX - boundRight) <= tol;\n\t\t\t\tvar nearBottomLine = Math.abs(clientY - boundBottom) <= tol;\n\t\t\t\tvar nearLeftLine = Math.abs(clientX - boundLeft) <= tol;\n\t\n\t\t\t\tif (nearTopLine && withinElementX && this.rzblTop) {\n\t\t\t\t\thoveredEdge = \"top\";\n\t\t\t\t} else if (nearRightLine && withinElementY && this.rzblRight) {\n\t\t\t\t\thoveredEdge = \"right\";\n\t\t\t\t} else if (nearBottomLine && withinElementX && this.rzblBottom) {\n\t\t\t\t\thoveredEdge = \"bottom\";\n\t\t\t\t} else if (nearLeftLine && withinElementY && this.rzblLeft) {\n\t\t\t\t\thoveredEdge = \"left\";\n\t\t\t\t}\n\t\n\t\t\t\t// Will be false when mouse leaves edge zone.\n\t\t\t\t// Assign at the top so canvas drawing can check.\n\t\t\t\t// Don't yet assign to the local object.\n\t\t\t\t// this.rzblHoveredEdge = isHoveringEdge;\n\t\t\t\tif (typeof this.rzblIsHovering === \"function\") {\n\t\t\t\t\tthis.rzblIsHovering(hoveredEdge);\n\t\t\t\t}\n\t\t\t\tif (hoveredEdge) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}\n\t\t\t\treturn hoveredEdge;\n\t\t\t},\n\t\n\t\t\trzblApplyCursorClass: function rzblApplyCursorClass() {\n\t\t\t\tvar bodyEl = document.body;\n\t\t\t\tvar outerBgEl = document.querySelector(\".outer-background\");\n\t\t\t\tvar panelEl = this.element;\n\t\n\t\t\t\tif (this.rzblHoveredEdge === \"top\" || this.rzblHoveredEdge === \"bottom\") {\n\t\t\t\t\tif (this.cursor !== \"ns\") {\n\t\t\t\t\t\tthis.cursor = \"ns\";\n\t\t\t\t\t\tbodyEl.classList.add(\"ns-resize-cursor\");\n\t\t\t\t\t\touterBgEl.classList.add(\"ns-resize-cursor\");\n\t\t\t\t\t\tpanelEl.classList.add(\"ns-resize-cursor\");\n\t\t\t\t\t}\n\t\t\t\t} else if (this.rzblHoveredEdge === \"right\" || this.rzblHoveredEdge === \"left\") {\n\t\t\t\t\tif (this.cursor !== \"ew\") {\n\t\t\t\t\t\tthis.cursor = \"ew\";\n\t\t\t\t\t\tbodyEl.classList.add(\"ew-resize-cursor\");\n\t\t\t\t\t\touterBgEl.classList.add(\"ew-resize-cursor\");\n\t\t\t\t\t\tpanelEl.classList.add(\"ew-resize-cursor\");\n\t\t\t\t\t}\n\t\t\t\t} else if (!this.isResizing) {\n\t\t\t\t\tif (this.cursor) {\n\t\t\t\t\t\tthis.cursor = \"\";\n\t\t\t\t\t\tbodyEl.classList.remove(\"ns-resize-cursor\", \"ew-resize-cursor\");\n\t\t\t\t\t\touterBgEl.classList.remove(\"ns-resize-cursor\", \"ew-resize-cursor\");\n\t\t\t\t\t\tpanelEl.classList.remove(\"ns-resize-cursor\", \"ew-resize-cursor\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\n\t\t\trzblMouseDown: function rzblMouseDown(e) {\n\t\t\t\tvar abort = false;\n\t\t\t\tif (this.rzblAbortResize) {\n\t\t\t\t\tabort = this.rzblAbortResize();\n\t\t\t\t}\n\t\n\t\t\t\tif (!this.rzblHoveredEdge || abort) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\n\t\t\t\te.stopPropagation();\n\t\n\t\t\t\tthis.rzblEdgeClicked = this.rzblHoveredEdge; // E.g. \"left\"\n\t\n\t\t\t\t// Allows the resize animation to loop, also checked by canvas paint/erase.\n\t\t\t\t// A single property for all panels?\n\t\t\t\tthis.isResizing = true;\n\t\t\t\tif (this.reportResizing) {\n\t\t\t\t\tthis.reportResizing(true);\n\t\t\t\t}\n\t\n\t\t\t\tthis.recordComputedStyle();\n\t\n\t\t\t\tthis.rzblDragStartX = e.clientX;\n\t\t\t\tthis.rzblDragStartY = e.clientY;\n\t\t\t\tthis.rzblMoveX = 0;\n\t\t\t\tthis.rzblMoveY = 0;\n\t\n\t\t\t\t// These values can be either right or left, top or bottom CSS.\n\t\t\t\tthis.flingItemBeginX = this.css[this.rzblHorizontalCssProp];\n\t\t\t\tthis.flingItemBeginY = this.css[this.rzblVerticalCssProp];\n\t\n\t\t\t\t// Start a rAF animation loop\n\t\t\t\tthis.rzblAnimate();\n\t\n\t\t\t\twindow.addEventListener(\"mouseup\", this.rzblMouseUp, true);\n\t\t\t},\n\t\n\t\t\trzblMouseMove: function rzblMouseMove(e) {\n\t\t\t\tvar currentHoveredEdge = this.rzblHoveredEdge;\n\t\t\t\tvar newHoveredEdge = this.rzblCalcEdges(e);\n\t\n\t\t\t\tif (this.isResizing) {\n\t\n\t\t\t\t\t// Set the \"move\" properties, which will get\n\t\t\t\t\t// picked up in the animation loop.\n\t\t\t\t\tif (this.rzblEdgeClicked === \"top\" || this.rzblEdgeClicked === \"bottom\") {\n\t\t\t\t\t\tthis.rzblMoveY = e.pageY - this.rzblDragStartY;\n\t\t\t\t\t} else if (this.rzblEdgeClicked === \"right\" || this.rzblEdgeClicked === \"left\") {\n\t\t\t\t\t\tthis.rzblMoveX = e.pageX - this.rzblDragStartX;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\n\t\t\t\t\t// Modify the cursors on hover/hoverend, but only if we're not already\n\t\t\t\t\t// resizing.\n\t\t\t\t\tthis.rzblHoveredEdge = newHoveredEdge;\n\t\n\t\t\t\t\t// If already painting near the panel edge, don't apply the resize cursor class.\n\t\t\t\t\tif (this.rzblAbortResize && this.rzblAbortResize()) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// Don't touch the DOM if there hasn't been a change.\n\t\t\t\t\tif (newHoveredEdge !== currentHoveredEdge) {\n\t\t\t\t\t\tthis.rzblApplyCursorClass();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\n\t\t\trzblMouseUp: function rzblMouseUp(e) {\n\t\n\t\t\t\t// Breaks the resize animation loop, also checked by canvas paint/erase\n\t\t\t\tthis.isResizing = false;\n\t\t\t\tif (this.reportResizing) {\n\t\t\t\t\tthis.reportResizing(false);\n\t\t\t\t}\n\t\n\t\t\t\t// Flushing these seems to reduce glitching\n\t\t\t\tthis.rzblEdgeClicked = undefined;\n\t\n\t\t\t\t// Mouseups can always propagate.\n\t\t\t\twindow.removeEventListener(\"mouseup\", this.rzblMouseUp, true);\n\t\t\t},\n\t\n\t\t\trzblAnimate: function rzblAnimate() {\n\t\t\t\tvar that = this;\n\t\t\t\tif (!this.isResizing) {\n\t\n\t\t\t\t\t// Animation is over. Update the box after resize complete\n\t\t\t\t\tthis.css.boundRect = this.element.getBoundingClientRect();\n\t\t\t\t\treturn; // Get out when mouseup breaks the animation loop.\n\t\t\t\t}\n\t\t\t\tthis.rzblRender();\n\t\t\t\trequestAnimationFrame(function () {\n\t\t\t\t\tthat.rzblAnimate();\n\t\t\t\t});\n\t\t\t},\n\t\n\t\t\t// ========= RENDER =========================\n\t\t\t//\n\t\t\t//  Drag       |  CSS       |  Render\n\t\t\t//  From       |  pos prop  |  Outcome\n\t\t\t// ------------------------------------------\n\t\t\t//  left       |  left      | + left\n\t\t\t//             |            | - width\n\t\t\t// ------------------------------------------\n\t\t\t//  left       |  right     | - width\n\t\t\t//             |            |\n\t\t\t// ------------------------------------------\n\t\t\t//  right      |  right     | - right\n\t\t\t//             |            | + width\n\t\t\t// ------------------------------------------\n\t\t\t//  right      |  left      | + width\n\t\t\t//             |            |\n\t\t\t// ------------------------------------------\n\t\t\t//  top        |  top       | + top\n\t\t\t//             |            | - height\n\t\t\t// ------------------------------------------\n\t\t\t//  top        |  bottom    | - height\n\t\t\t//             |            |\n\t\t\t// ------------------------------------------\n\t\t\t//  bottom     |  bottom    | - bottom\n\t\t\t//             |            | + height\n\t\t\t// ------------------------------------------\n\t\t\t//  bottom     |  top       | + height\n\t\t\t//             |            |\n\t\t\t// ------------------------------------------\n\t\n\t\t\trzblRender: function rzblRender() {\n\t\t\t\tif (this.rzblEdgeClicked === \"left\") {\n\t\t\t\t\tif (this.rzblHorizontalCssProp === \"left\") {\n\t\t\t\t\t\tthis.css.left = this.flingItemBeginX + this.rzblMoveX;\n\t\t\t\t\t\tthis.element.style.left = this.css.left + \"px\";\n\t\t\t\t\t}\n\t\t\t\t\tthis.element.style.width = this.css.boundRect.width - this.rzblMoveX + \"px\";\n\t\t\t\t} else if (this.rzblEdgeClicked === \"right\") {\n\t\t\t\t\tif (this.rzblHorizontalCssProp === \"right\") {\n\t\t\t\t\t\tthis.css.right = this.flingItemBeginX - this.rzblMoveX;\n\t\t\t\t\t\tthis.element.style.right = this.css.right + \"px\";\n\t\t\t\t\t}\n\t\t\t\t\tthis.element.style.width = this.css.boundRect.width + this.rzblMoveX + \"px\";\n\t\t\t\t} else if (this.rzblEdgeClicked === \"top\") {\n\t\t\t\t\tif (this.rzblVerticalCssProp === \"top\") {\n\t\t\t\t\t\tthis.css.top = this.flingItemBeginY + this.rzblMoveY;\n\t\t\t\t\t\tthis.element.style.top = this.css.top + \"px\";\n\t\t\t\t\t}\n\t\t\t\t\tthis.element.style.height = this.css.boundRect.height - this.rzblMoveY + \"px\";\n\t\t\t\t} else if (this.rzblEdgeClicked === \"bottom\") {\n\t\t\t\t\tif (this.rzblVerticalCssProp === \"bottom\") {\n\t\t\t\t\t\tthis.css.bottom = this.css.bottom - this.rzblMoveY;\n\t\t\t\t\t\tthis.element.style.bottom = this.css.bottom + \"px\";\n\t\t\t\t\t}\n\t\t\t\t\tthis.element.style.height = this.css.boundRect.height + this.rzblMoveY + \"px\";\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t\t// Currently needed just for Intern to allow block-scoping. Possibly delete in build?\n\t\t\"use strict\";\n\t\n\t\treturn {\n\t\n\t\t\t// http://www.jacklmoore.com/notes/rounding-in-javascript/\n\t\t\tround: function round(value, decimalPlaces) {\n\t\t\t\treturn Number(Math.round(value + \"e\" + decimalPlaces) + \"e-\" + decimalPlaces);\n\t\t\t},\n\t\n\t\t\t// Http://modernjavascript.blogspot.com/2013/08/building-better-debounce.html\n\t\t\tdebounce: function debounce(func, wait) {\n\t\n\t\t\t\t// We need to save these in the closure\n\t\t\t\tvar timeout = void 0,\n\t\t\t\t    args = void 0,\n\t\t\t\t    context = void 0,\n\t\t\t\t    timestamp = void 0;\n\t\n\t\t\t\treturn function () {\n\t\n\t\t\t\t\t// Save details of latest call\n\t\t\t\t\tcontext = this;\n\t\t\t\t\targs = [].slice.call(arguments, 0);\n\t\t\t\t\ttimestamp = new Date();\n\t\n\t\t\t\t\t// This is where the magic happens\n\t\t\t\t\tvar later = function later() {\n\t\n\t\t\t\t\t\t// How long ago was the last call\n\t\t\t\t\t\tvar last = new Date() - timestamp;\n\t\n\t\t\t\t\t\t// If the latest call was less that the wait period ago\n\t\t\t\t\t\t// then we reset the timeout to wait for the difference\n\t\t\t\t\t\tif (last < wait) {\n\t\t\t\t\t\t\ttimeout = setTimeout(later, wait - last);\n\t\n\t\t\t\t\t\t\t// Or if not we can null out the timer and run the latest\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttimeout = null;\n\t\t\t\t\t\t\tfunc.apply(context, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\n\t\t\t\t\t// We only need to set the timer now if one isn't already running\n\t\t\t\t\tif (!timeout) {\n\t\t\t\t\t\ttimeout = setTimeout(later, wait);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t},\n\t\n\t\t\tthrottleRaf: function throttleRaf(func) {\n\t\t\t\tvar args = void 0,\n\t\t\t\t    context = void 0,\n\t\t\t\t    ticking = void 0;\n\t\n\t\t\t\treturn function () {\n\t\n\t\t\t\t\t// Save details of latest call, e.g. event properties.\n\t\t\t\t\tcontext = this;\n\t\t\t\t\targs = [].slice.call(arguments, 0);\n\t\n\t\t\t\t\tvar later = function later() {\n\t\t\t\t\t\tfunc.apply(context, args);\n\t\t\t\t\t\tticking = false;\n\t\t\t\t\t};\n\t\n\t\t\t\t\tif (!ticking) {\n\t\t\t\t\t\trequestAnimationFrame(later);\n\t\t\t\t\t\tticking = true;\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t},\n\t\n\t\t\t// Get closest DOM element up the tree that contains a class, ID, or data attribute\n\t\t\t// @param  {Node} elem The base element\n\t\t\t// @param  {String} selector The class, id, data attribute, or tag to look for\n\t\t\t// @return {Node} Null if no match\n\t\t\t// http://gomakethings.com/climbing-up-and-down-the-dom-tree-with-vanilla-javascript/\n\t\t\tgetClosest: function getClosest(elem, selector) {\n\t\t\t\tvar firstChar = selector.charAt(0);\n\t\n\t\t\t\t// Get closest match\n\t\t\t\tfor (; elem && elem !== document; elem = elem.parentNode) {\n\t\n\t\t\t\t\t// If selector is a class\n\t\t\t\t\tif (firstChar === \".\") {\n\t\t\t\t\t\tif (elem.classList.contains(selector.substr(1))) {\n\t\t\t\t\t\t\treturn elem;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// If selector is an ID\n\t\t\t\t\tif (firstChar === \"#\") {\n\t\t\t\t\t\tif (elem.id === selector.substr(1)) {\n\t\t\t\t\t\t\treturn elem;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// If selector is a data attribute\n\t\t\t\t\tif (firstChar === \"[\") {\n\t\t\t\t\t\tif (elem.hasAttribute(selector.substr(1, selector.length - 2))) {\n\t\t\t\t\t\t\treturn elem;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// If selector is a tag\n\t\t\t\t\tif (elem.tagName.toLowerCase() === selector) {\n\t\t\t\t\t\treturn elem;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\n\t\t\textend: function extend() {\n\t\t\t\tfor (var i = 1; i < arguments.length; i += 1) {\n\t\t\t\t\tfor (var key in arguments[i]) {\n\t\t\t\t\t\tif (arguments[i].hasOwnProperty(key)) {\n\t\t\t\t\t\t\targuments[0][key] = arguments[i][key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn arguments[0];\n\t\t\t},\n\t\n\t\t\tisDigit: function isDigit(n) {\n\t\t\t\treturn Boolean([true, true, true, true, true, true, true, true, true, true][n]);\n\t\t\t},\n\t\n\t\t\tisNonNegativeInteger: function isNonNegativeInteger(val) {\n\t\t\t\treturn Number.isFinite(val) && val % 1 === 0 && val >= 0;\n\t\t\t},\n\t\n\t\t\tstripPixelUnits: function stripPixelUnits(str) {\n\t\t\t\tvar ret = str.replace(/px$/i, \"\");\n\t\n\t\t\t\t// Avoid converting \"auto\" to NaN, but still coerce \"6px\" to the number 6.\n\t\t\t\tif (this.isDigit(str[0])) {\n\t\t\t\t\tret = parseFloat(ret);\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t\t},\n\t\n\t\t\t// @param  {object}\n\t\t\t// @return {string}\n\t\t\tserializeToQueryString: function serializeToQueryString(obj) {\n\t\t\t\tvar ret = \"\";\n\t\t\t\tfor (var prop in obj) {\n\t\t\t\t\tret += prop + \"=\" + obj[prop] + \"&\";\n\t\t\t\t}\n\t\t\t\tif (ret) {\n\t\t\t\t\tret = ret.slice(0, -1); // Remove final trailing ampersand.\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t\t},\n\t\n\t\t\tdeserializeQueryString: function deserializeQueryString(str) {\n\t\t\t\tvar ret = Object.create(null);\n\t\t\t\tif (str.indexOf(\"?\") > -1) {\n\t\t\t\t\tstr = str.split(\"?\")[1];\n\t\t\t\t}\n\t\t\t\tvar pairs = str.split(\"&\");\n\t\t\t\tpairs.forEach(function (pair) {\n\t\t\t\t\tpair = pair.split(\"=\");\n\t\t\t\t\tret[pair[0]] = decodeURIComponent(pair[1] || \"\");\n\t\t\t\t});\n\t\t\t\treturn ret;\n\t\t\t},\n\t\n\t\t\tselectContents: function selectContents(el) {\n\t\n\t\t\t\t// FF doesn\"t support select() method.\n\t\t\t\t// Webkit throws InvalidStateError on setSelectionRange on an input type=number.\n\t\t\t\t// https://code.google.com/p/chromium/issues/detail?id=346270\n\t\t\t\ttry {\n\t\t\t\t\tel.focus();\n\t\t\t\t\tel.setSelectionRange(0, 9999);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tel.select();\n\t\t\t\t}\n\t\t\t\treturn el;\n\t\t\t},\n\t\n\t\t\tcopyTextToClipBoard: function copyTextToClipBoard(text) {\n\t\t\t\tvar input = document.createElement(\"textarea\");\n\t\t\t\tdocument.body.appendChild(input);\n\t\t\t\tinput.value = text;\n\t\t\t\tthis.selectContents(input);\n\t\t\t\tdocument.execCommand(\"Copy\");\n\t\t\t\tdocument.body.removeChild(input);\n\t\t\t\treturn text;\n\t\t\t}\n\t\t};\n\t}.call(exports, __webpack_require__, exports, module), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 9 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t//Modal\n\t!(__WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t\t// Opening modal changes keymaster \"scope\"\n\t\tvar key = __webpack_require__(10);\n\t\n\t\t// To be customized per unique modal object:\n\t\t// this.innerMarkup   html to insert\n\t\t// this.modalInternalBinding   listeners other than ok/cancel\n\t\t// this.modalInternalUnbinding  remove listeners other than ok/cancel\n\t\t// this.modalValidate  optional check on click of OK. returns a Boolean.\n\t\t// this.modalSubmit   function to run 'ok' click if valid.\n\t\n\t\treturn {\n\t\n\t\t\tmodalWrapperElement: document.querySelector(\".modal-wrapper\"),\n\t\n\t\t\tmodalTitleEl: document.querySelector(\".modal__title\"),\n\t\n\t\t\tmodalContentsEl: document.querySelector(\".modal__contents\"),\n\t\n\t\t\tinit: function init(buttonElementToBind) {\n\t\t\t\tthis.modalOpenButtonElement = buttonElementToBind;\n\t\n\t\t\t\t// Create bound local reference for all the prototype handler methods  :/\n\t\t\t\tthis.modalOpen = this.modalOpen.bind(this);\n\t\t\t\tthis.modalClose = this.modalClose.bind(this);\n\t\t\t\tthis.modalOnOk = this.modalOnOk.bind(this);\n\t\t\t\tthis.modalOnCancel = this.modalOnCancel.bind(this);\n\t\n\t\t\t\t// Assume for now it's always a button that triggers opening the modal.\n\t\t\t\tthis.modalOpenButtonElement.addEventListener(\"touchstart\", this.modalOpen);\n\t\t\t\tthis.modalOpenButtonElement.addEventListener(\"click\", this.modalOpen);\n\t\t\t},\n\t\n\t\t\tmodalOpen: function modalOpen(e) {\n\t\n\t\t\t\tif (e.type === \"touchstart\") {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t} /* Suppress ghost click. */\n\t\n\t\t\t\t// The custom pre-open fn unique to a particular modal.\n\t\t\t\tif (typeof this.modalBeforeOpen === \"function\") {\n\t\t\t\t\tthis.modalBeforeOpen();\n\t\t\t\t}\n\t\n\t\t\t\t// Generic to all Modals but set inside the closure.\n\t\t\t\tif (typeof this.modalSetOpenState === \"function\") {\n\t\t\t\t\tthis.modalSetOpenState(true);\n\t\t\t\t}\n\t\n\t\t\t\t// Turn off all Keymaster shortcuts applicable in the main view, so that, for example,\n\t\t\t\t// tabbing works between form fields in a modal.\n\t\t\t\t// In the \"modal\" scope, \"enter\" clicks the OK button.\n\t\t\t\tkey.setScope(\"modal\");\n\t\n\t\t\t\t// Show the modal.\n\t\t\t\tthis.modalWrapperElement.classList.remove(\"modal-wrapper--hide\");\n\t\n\t\t\t\t// Insert the DOM elements\n\t\t\t\tthis.modalTitleEl.innerHTML = this.titleText;\n\t\t\t\tthis.modalContentsEl.innerHTML = this.innerMarkup();\n\t\n\t\t\t\tthis.modalOkButton = document.querySelector(\"[data-modal-ok]\");\n\t\t\t\tthis.modalCancelButton = document.querySelector(\"[data-modal-cancel]\");\n\t\n\t\t\t\tthis.modalOkButton.addEventListener(\"touchstart\", this.modalOnOk);\n\t\t\t\tthis.modalOkButton.addEventListener(\"click\", this.modalOnOk);\n\t\n\t\t\t\t// Not all modals have a cancel button.\n\t\t\t\tif (this.modalCancelButton) {\n\t\t\t\t\tthis.modalCancelButton.addEventListener(\"touchstart\", this.modalOnCancel);\n\t\t\t\t\tthis.modalCancelButton.addEventListener(\"click\", this.modalOnCancel);\n\t\t\t\t}\n\t\n\t\t\t\t// The custom post-open fn unique to a particular modal.\n\t\t\t\tif (this.modalInternalBinding) {\n\t\t\t\t\tthis.modalInternalBinding();\n\t\t\t\t}\n\t\t\t},\n\t\n\t\t\tshowError: function showError(errorText) {\n\t\t\t\tthis.errorEl.innerHTML = errorText;\n\t\t\t},\n\t\n\t\t\tmodalOnOk: function modalOnOk(e) {\n\t\n\t\t\t\tif (e.type === \"touchstart\") {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t} /* Suppress ghost click. */\n\t\n\t\t\t\t// Revalidate on click of OK.\n\t\t\t\t// Assume valid because not all modals use validation.\n\t\t\t\tif (typeof this.modalValidate === \"function\") {\n\t\t\t\t\tif (!this.modalValidate()) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\n\t\t\t\t// Some \"info\" modals (like share) don't do anything on submit.\n\t\t\t\tif (typeof this.modalSubmit === \"function\") {\n\t\t\t\t\tthis.modalSubmit();\n\t\t\t\t}\n\t\t\t\tthis.modalClose();\n\t\t\t},\n\t\n\t\t\tmodalOnCancel: function modalOnCancel(e) {\n\t\t\t\tif (e.type === \"touchstart\") {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t} /* Suppress ghost click. */\n\t\t\t\tthis.modalClose();\n\t\t\t},\n\t\n\t\t\tmodalClose: function modalClose() {\n\t\t\t\tif (this.modalInternalUnbinding) {\n\t\t\t\t\tthis.modalInternalBinding();\n\t\t\t\t}\n\t\n\t\t\t\t// Unbind confirmation buttons\n\t\t\t\tthis.modalOkButton.removeEventListener(\"touchstart\", this.modalOnOk);\n\t\t\t\tthis.modalOkButton.removeEventListener(\"click\", this.modalOnOk);\n\t\n\t\t\t\tif (this.modalCancelButton) {\n\t\t\t\t\tthis.modalCancelButton.removeEventListener(\"touchstart\", this.modalOnCancel);\n\t\t\t\t\tthis.modalCancelButton.removeEventListener(\"click\", this.modalOnCancel);\n\t\t\t\t}\n\t\t\t\tthis.modalWrapperElement.classList.add(\"modal-wrapper--hide\");\n\t\n\t\t\t\tkey.setScope(\"main\");\n\t\n\t\t\t\t// Generic to all Modals but set inside the closure.\n\t\t\t\tif (typeof this.modalSetOpenState === \"function\") {\n\t\t\t\t\tthis.modalSetOpenState(false);\n\t\t\t\t}\n\t\n\t\t\t\t// The custom post-open fn unique to a particular modal.\n\t\t\t\tif (typeof this.modalAfterClose === \"function\") {\n\t\t\t\t\tthis.modalAfterClose();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}.call(exports, __webpack_require__, exports, module), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 10 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\t/* Keymaster.js\n\t   (c) 2011-2013 Thomas Fuchs\n\t   keymaster.js may be freely distributed under the MIT license. */\n\t\n\t;(function (global) {\n\t  var k,\n\t      _handlers = {},\n\t      _mods = { 16: false, 18: false, 17: false, 91: false },\n\t      _scope = \"all\",\n\t\n\t\n\t  // Modifier keys\n\t  _MODIFIERS = {\n\t    \"⇧\": 16, shift: 16,\n\t    \"⌥\": 18, alt: 18, option: 18,\n\t    \"⌃\": 17, ctrl: 17, control: 17,\n\t    \"⌘\": 91, command: 91\n\t  },\n\t\n\t\n\t  // Special keys\n\t  _MAP = {\n\t    backspace: 8, tab: 9, clear: 12,\n\t    enter: 13, \"return\": 13,\n\t    esc: 27, escape: 27, space: 32,\n\t    left: 37, up: 38,\n\t    right: 39, down: 40,\n\t    del: 46, \"delete\": 46,\n\t    home: 36, end: 35,\n\t    pageup: 33, pagedown: 34,\n\t    \",\": 188, \".\": 190, \"/\": 191,\n\t    \"`\": 192, \"-\": 189, \"=\": 187,\n\t    \";\": 186, \"\\'\": 222,\n\t    \"[\": 219, \"]\": 221, \"\\\\\": 220\n\t  },\n\t      code = function code(x) {\n\t    return _MAP[x] || x.toUpperCase().charCodeAt(0);\n\t  },\n\t      _downKeys = [];\n\t\n\t  for (k = 1; k < 20; k++) {\n\t    _MAP[\"f\" + k] = 111 + k;\n\t  }\n\t\n\t  // IE doesn't support Array#indexOf, so have a simple replacement\n\t  function index(array, item) {\n\t    var i = array.length;\n\t    while (i--) {\n\t      if (array[i] === item) {\n\t        return i;\n\t      }\n\t    }return -1;\n\t  }\n\t\n\t  // For comparing mods before unassignment\n\t  function compareArray(a1, a2) {\n\t    if (a1.length != a2.length) {\n\t      return false;\n\t    }\n\t    for (var i = 0; i < a1.length; i++) {\n\t      if (a1[i] !== a2[i]) {\n\t        return false;\n\t      }\n\t    }\n\t    return true;\n\t  }\n\t\n\t  var modifierMap = {\n\t    16: \"shiftKey\",\n\t    18: \"altKey\",\n\t    17: \"ctrlKey\",\n\t    91: \"metaKey\"\n\t  };\n\t\n\t  function updateModifierKey(event) {\n\t    for (k in _mods) {\n\t      _mods[k] = event[modifierMap[k]];\n\t    }\n\t  }\n\t\n\t  // Handle keydown event\n\t  function dispatch(event) {\n\t    var key, handler, k, i, modifiersMatch, scope;\n\t    key = event.keyCode;\n\t\n\t    if (index(_downKeys, key) == -1) {\n\t      _downKeys.push(key);\n\t    }\n\t\n\t    // If a modifier key, set the key.<modifierkeyname> property to true and return\n\t    if (key == 93 || key == 224) {\n\t      key = 91;\n\t    } /* right command on webkit, command on Gecko */\n\t    if (key in _mods) {\n\t      _mods[key] = true;\n\t\n\t      // 'assignKey' from inside this closure is exported to window.key\n\t      for (k in _MODIFIERS) {\n\t        if (_MODIFIERS[k] == key) {\n\t          assignKey[k] = true;\n\t        }\n\t      }if (!(key in _handlers)) {\n\t        /* allow single modifier shortcuts to execute */\n\t        return; /* for combinations, return and wait for the second keypress */\n\t      }\n\t    }\n\t    updateModifierKey(event);\n\t\n\t    // See if we need to ignore the keypress (filter() can can be overridden)\n\t    // by default ignore key presses if a select, textarea, or input is focused\n\t    if (!assignKey.filter.call(this, event)) {\n\t      return;\n\t    }\n\t\n\t    // Abort if no potentially matching shortcuts found\n\t    if (!(key in _handlers)) {\n\t      return;\n\t    }\n\t\n\t    scope = getScope();\n\t\n\t    // For each potential shortcut\n\t    for (i = 0; i < _handlers[key].length; i++) {\n\t      handler = _handlers[key][i];\n\t\n\t      // See if it's in the current scope\n\t      if (handler.scope == scope || handler.scope == \"all\") {\n\t\n\t        // Check if modifiers match if any\n\t        modifiersMatch = handler.mods.length > 0;\n\t        for (k in _mods) {\n\t          if (!_mods[k] && index(handler.mods, +k) > -1 || _mods[k] && index(handler.mods, +k) == -1) {\n\t            modifiersMatch = false;\n\t          }\n\t        }\n\t\n\t        // Call the handler and stop the event if neccessary\n\t        if (handler.mods.length === 0 && !_mods[16] && !_mods[18] && !_mods[17] && !_mods[91] || modifiersMatch) {\n\t          if (handler.method(event, handler) === false) {\n\t            if (event.preventDefault) {\n\t              event.preventDefault();\n\t            } else {\n\t              event.returnValue = false;\n\t            }\n\t            if (event.stopPropagation) {\n\t              event.stopPropagation();\n\t            }\n\t            if (event.cancelBubble) {\n\t              event.cancelBubble = true;\n\t            }\n\t          }\n\t        }\n\t      }\n\t    }\n\t  }\n\t\n\t  // Unset modifier keys on keyup\n\t  function clearModifier(event) {\n\t    var key = event.keyCode,\n\t        k,\n\t        i = index(_downKeys, key);\n\t\n\t    // Remove key from _downKeys\n\t    if (i >= 0) {\n\t      _downKeys.splice(i, 1);\n\t    }\n\t\n\t    if (key == 93 || key == 224) {\n\t      key = 91;\n\t    }\n\t    if (key in _mods) {\n\t      _mods[key] = false;\n\t      for (k in _MODIFIERS) {\n\t        if (_MODIFIERS[k] == key) {\n\t          assignKey[k] = false;\n\t        }\n\t      }\n\t    }\n\t  }\n\t\n\t  function resetModifiers() {\n\t    for (k in _mods) {\n\t      _mods[k] = false;\n\t    }for (k in _MODIFIERS) {\n\t      assignKey[k] = false;\n\t    }\n\t  }\n\t\n\t  // Parse and assign shortcut\n\t  function assignKey(key, scope, method) {\n\t    var keys, mods;\n\t    keys = getKeys(key);\n\t    if (method === undefined) {\n\t      method = scope;\n\t      scope = \"all\";\n\t    }\n\t\n\t    // For each shortcut\n\t    for (var i = 0; i < keys.length; i++) {\n\t\n\t      // Set modifier keys if any\n\t      mods = [];\n\t      key = keys[i].split(\"+\");\n\t\n\t      // Account for the case where shortcut is a single modifier\n\t      if (key in _MODIFIERS) {\n\t        key = _MODIFIERS[key];\n\t        mods = [key];\n\t      }\n\t\n\t      // All other cases\n\t      else {\n\t          if (key.length > 1) {\n\t            mods = getMods(key);\n\t            key = [key[key.length - 1]];\n\t          }\n\t\n\t          // Convert to keycode and...\n\t          key = key[0];\n\t          key = code(key);\n\t        }\n\t\n\t      // ...Store handler\n\t      if (!(key in _handlers)) {\n\t        _handlers[key] = [];\n\t      }\n\t      _handlers[key].push({\n\t        shortcut: keys[i],\n\t        scope: scope,\n\t        method: method,\n\t        key: keys[i],\n\t        mods: mods\n\t      });\n\t    }\n\t  }\n\t\n\t  // Unbind all handlers for given key in current scope\n\t  function unbindKey(key, scope) {\n\t    var multipleKeys,\n\t        keys,\n\t        mods = [],\n\t        i,\n\t        j,\n\t        obj;\n\t\n\t    multipleKeys = getKeys(key);\n\t\n\t    for (j = 0; j < multipleKeys.length; j++) {\n\t      keys = multipleKeys[j].split(\"+\");\n\t\n\t      // Account for the case where shortcut is a single modifier\n\t      if (key in _MODIFIERS) {\n\t        key = _MODIFIERS[key];\n\t        mods = [key];\n\t      }\n\t\n\t      // All other cases\n\t      else {\n\t          if (keys.length > 1) {\n\t            mods = getMods(keys);\n\t          }\n\t\n\t          key = keys[keys.length - 1];\n\t          key = code(key);\n\t        }\n\t\n\t      if (scope === undefined) {\n\t        scope = getScope();\n\t      }\n\t      if (!_handlers[key]) {\n\t        return;\n\t      }\n\t      for (i = 0; i < _handlers[key].length; i++) {\n\t        obj = _handlers[key][i];\n\t\n\t        // Only clear handlers if correct scope and mods match\n\t        if (obj.scope === scope && compareArray(obj.mods, mods)) {\n\t          _handlers[key][i] = {};\n\t        }\n\t      }\n\t    }\n\t  }\n\t\n\t  // Returns true if the key with code 'keyCode' is currently down\n\t  // Converts strings into key codes.\n\t  function isPressed(keyCode) {\n\t    if (typeof keyCode == \"string\") {\n\t      keyCode = code(keyCode);\n\t    }\n\t    return index(_downKeys, keyCode) != -1;\n\t  }\n\t\n\t  function getPressedKeyCodes() {\n\t    return _downKeys.slice(0);\n\t  }\n\t\n\t  function filter(event) {\n\t    var tagName = (event.target || event.srcElement).tagName;\n\t\n\t    // Ignore keypressed in any elements that support keyboard data input\n\t    return !(tagName == \"INPUT\" || tagName == \"SELECT\" || tagName == \"TEXTAREA\");\n\t  }\n\t\n\t  // Initialize key.<modifier> to false\n\t  for (k in _MODIFIERS) {\n\t    assignKey[k] = false;\n\t  } // Set current scope (default 'all')\n\t  function setScope(scope) {\n\t    _scope = scope || \"all\";\n\t  }\n\t  function getScope() {\n\t    return _scope || \"all\";\n\t  }\n\t\n\t  // Delete all handlers for a given scope\n\t  function deleteScope(scope) {\n\t    var key, handlers, i;\n\t\n\t    for (key in _handlers) {\n\t      handlers = _handlers[key];\n\t      for (i = 0; i < handlers.length;) {\n\t        if (handlers[i].scope === scope) {\n\t          handlers.splice(i, 1);\n\t        } else {\n\t          i++;\n\t        }\n\t      }\n\t    }\n\t  }\n\t\n\t  // Abstract key logic for assign and unassign\n\t  function getKeys(key) {\n\t    var keys;\n\t    key = key.replace(/\\s/g, \"\");\n\t    keys = key.split(\",\");\n\t    if (keys[keys.length - 1] === \"\") {\n\t      keys[keys.length - 2] += \",\";\n\t    }\n\t    return keys;\n\t  }\n\t\n\t  // Abstract mods logic for assign and unassign\n\t  function getMods(key) {\n\t    var mods = key.slice(0, key.length - 1);\n\t    for (var mi = 0; mi < mods.length; mi++) {\n\t      mods[mi] = _MODIFIERS[mods[mi]];\n\t    }return mods;\n\t  }\n\t\n\t  // Cross-browser events\n\t  function addEvent(object, event, method) {\n\t    if (object.addEventListener) {\n\t      object.addEventListener(event, method, false);\n\t    } else if (object.attachEvent) {\n\t      object.attachEvent(\"on\" + event, function () {\n\t        method(window.event);\n\t      });\n\t    }\n\t  }\n\t\n\t  // Set the handlers globally on document\n\t  // Passing _scope to a callback to ensure it remains the same by execution. Fixes #48\n\t  addEvent(document, \"keydown\", function (event) {\n\t    dispatch(event);\n\t  });\n\t  addEvent(document, \"keyup\", clearModifier);\n\t\n\t  // Reset modifiers to false whenever the window is (re)focused.\n\t  addEvent(window, \"focus\", resetModifiers);\n\t\n\t  // Store previously defined key\n\t  var previousKey;\n\t\n\t  // Restore previously defined key and return reference to our key object\n\t  function noConflict() {\n\t    var k = global.key;\n\t    global.key = previousKey;\n\t    return k;\n\t  }\n\t\n\t  var toExport = assignKey;\n\t  toExport.setScope = setScope;\n\t  toExport.getScope = getScope;\n\t  toExport.deleteScope = deleteScope;\n\t  toExport.filter = filter;\n\t  toExport.isPressed = isPressed;\n\t  toExport.getPressedKeyCodes = getPressedKeyCodes;\n\t  toExport.noConflict = noConflict;\n\t  toExport.unbind = unbindKey;\n\t\n\t  // If window is available set window.key and window.key.set/get/deleteScope,\n\t  // and the default filter.\n\t  if (global) {\n\t    if (global.key) {\n\t\n\t      // Store for possible recovery\n\t      previousKey = global.key;\n\t    }\n\t    global.key = toExport;\n\t  }\n\t\n\t  // If requiring as module\n\t  //\tif( typeof module !== \"undefined\" ) {\n\t  //\t\t module.exports = toExport;\n\t  //\t}\n\t\n\t  // Remove from conditional to suppress Uglify warnings.\n\t  module.exports = toExport;\n\t})(undefined);\n\n/***/ },\n/* 11 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(9)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Modal) {\n\t\n\t\t// To be added & customized for each unique modal objects:\n\t\t// this.titleText   html to insert in body of modal\n\t\t// this.innerMarkup   html to insert in body of modal\n\t\t// this.modalInternalBinding   listeners other than ok/cancel\n\t\t// this.modalInternalUnbinding  remove listeners other than ok/cancel\n\t\t// this.modalValidate  optional check on click of OK. returns a Boolean.\n\t\t// this.modalSubmit   function to run \"ok\" click if valid.\n\t\n\t\tvar modalCanvasSize = Object.create(Modal);\n\t\n\t\tmodalCanvasSize.titleText = \"Canvas Size\";\n\t\n\t\tmodalCanvasSize.innerMarkup = function () {\n\t\t\treturn \"<div class=\\\"modal__configure\\\">\\n\\t\\t\\t<div class=\\\"modal__section\\\">\\n\\t\\t\\t\\t<div class=\\\"modal__section-title\\\">Current Size</div>\\n\\t\\t\\t\\t<div class=\\\"modal__prop modal__prop--text-only\\\">\\n\\t\\t\\t\\t\\t<span class=\\\"modal__prop-name modal__prop-name--text-only\\\">Width:</span>\\n\\t\\t\\t\\t</div\\n\\t\\t\\t\\t><div class=\\\"modal__value modal__value--text-only\\\">\\n\\t\\t\\t\\t\\t<span class=\\\"modal__value-name modal__value-name--text-only\\\"\\n\\t\\t\\t\\t\\t\\tdata-modal-canvas-size-current-width >\\n\\t\\t\\t\\t\\t\\t\" + this.currentCanvasWidth + \"</span>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t<div class=\\\"modal__prop modal__prop--text-only\\\">\\n\\t\\t\\t\\t\\t<span class=\\\"modal__prop-name modal__prop-name--text-only\\\">Height:</span>\\n\\t\\t\\t\\t</div\\n\\t\\t\\t\\t><div class=\\\"modal__value modal__value--text-only\\\">\\n\\t\\t\\t\\t\\t<span class=\\\"modal__value-name modal__value-name--text-only\\\"\\n\\t\\t\\t\\t\\t\\tdata-modal-canvas-size-current-height\\n\\t\\t\\t\\t\\t\\t\\t>\" + this.currentCanvasHeight + \"</span>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"modal__section\\\">\\n\\t\\t\\t\\t<div class=\\\"modal__section-title\\\">New Size</div>\\n\\t\\t\\t\\t<div class=\\\"modal__prop\\\">\\n\\t\\t\\t\\t\\t<span class=\\\"modal__prop-name\\\">Width:</span>\\n\\t\\t\\t\\t</div\\n\\t\\t\\t\\t><div class=\\\"modal__value\\\">\\n\\t\\t\\t\\t\\t<input id=\\\"canvas-size-width\\\" class=\\\"modal__numeric-input\\\" type=number min=\\\"0\\\"\\n\\t\\t\\t\\t\\t\\tstep=\\\"1\\\" required value=\" + this.currentCanvasWidth + \"\\n\\t\\t\\t\\t\\t\\tdata-modal-canvas-size-new-width>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t<div class=\\\"modal__prop\\\">\\n\\t\\t\\t\\t\\t<span class=modal__prop-name>Height:</span>\\n\\t\\t\\t\\t</div\\n\\t\\t\\t\\t><div class=\\\"modal__value\\\">\\n\\t\\t\\t\\t\\t<input class=\\\"modal__numeric-input\\\" type=\\\"number\\\" min=\\\"0\\\" step=\\\"1\\\" required\\n\\t\\t\\t\\t\\t\\tvalue=\" + this.currentCanvasHeight + \"  data-modal-canvas-size-new-height>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t<div class=\\\"modal__prop\\\">\\n\\t\\t\\t\\t\\t<span class=modal__prop-name>Anchor:</span>\\n\\t\\t\\t\\t</div\\n\\t\\t\\t\\t><div class=\\\"modal__value modal__canvas-direction-button-container\\\"\\n\\t\\t\\t\\t\\tdata-canvas-direction-container>\\n\\t\\t\\t\\t\\t<svg class=\\\"modal__canvas-resize-arrows\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n\\t\\t\\t\\t\\t\\tviewBox=\\\"0 0 68 68\\\" >\\n\\t\\t\\t\\t\\t\\t<polygon fill=\\\"#231F20\\\"\\n\\t\\t\\t\\t\\t\\t\\tpoints=\\\"4,4 4,13.15 7.87,9.3 15.66,16.95 17.14,15.54 9.41,\\n\\t\\t\\t\\t\\t\\t\\t\\t7.71 13.05,4\\\"/>\\n\\t\\t\\t\\t\\t\\t<polygon fill=\\\"#231F20\\\"\\n\\t\\t\\t\\t\\t\\t\\tpoints=\\\"40,8 34,2 28,8 33,8 33,19 35,19 35,8\\\"/>\\n\\t\\t\\t\\t\\t\\t<polygon fill=\\\"#231F20\\\"\\n\\t\\t\\t\\t\\t\\t\\tpoints=\\\"64,4 55,4 58.85,7.85 51.2,15.62 52.61,17.1 60.37,9.37 64,13\\\"/>\\n\\t\\t\\t\\t\\t\\t<polygon fill=\\\"#231F20\\\"\\n\\t\\t\\t\\t\\t\\t\\tpoints=\\\"8,27.5 2,33.5 8,39.5 8,35 19,35 19,33 8,33\\\"/>\\n\\t\\t\\t\\t\\t\\t<circle id=\\\"circle_4_\\\" fill=\\\"#231F20\\\" cx=\\\"34\\\" cy=\\\"34\\\" r=\\\"3\\\"/>\\n\\t\\t\\t\\t\\t\\t<polygon fill=\\\"#231F20\\\"\\n\\t\\t\\t\\t\\t\\t\\tpoints=\\\"60,39.5 66,33.5 60,27.5 60,33 49,33 49,35 60,35\\\"/>\\n\\t\\t\\t\\t\\t\\t<polygon fill=\\\"#231F20\\\"\\n\\t\\t\\t\\t\\t\\t\\tpoints=\\\"4,64 13.2,64 9.35,60.2 17,52.45 15.59,50.99 7.73,58.72 4,55.1\\\"/>\\n\\t\\t\\t\\t\\t\\t<polygon fill=\\\"#231F20\\\"\\n\\t\\t\\t\\t\\t\\t\\tpoints=\\\"28,60 34,66 40,60 35,60 35,49 33,49 33,60\\\"/>\\n\\t\\t\\t\\t\\t\\t<polygon fill=\\\"#231F20\\\"\\n\\t\\t\\t\\t\\t\\t\\tpoints=\\\"64,64 64,54.95 60.22,58.8 52.49,51.15 51.03,52.56 58.77,\\n\\t\\t\\t\\t\\t\\t\\t60.34 55.15,64\\\"/>\\n\\t\\t\\t\\t\\t</svg>\\n\\t\\t\\t\\t\\t<button type=button class=\\\"modal__canvas-direction-button\\\" tabindex=-1\\n\\t\\t\\t\\t\\t\\tdata-canvas-resize-direction=\\\"left   top\\\"    ></button\\n\\t\\t\\t\\t\\t><button type=button class=\\\"modal__canvas-direction-button\\\" tabindex=-1\\n\\t\\t\\t\\t\\t\\tdata-canvas-resize-direction=\\\"center top\\\"    ></button\\n\\t\\t\\t\\t\\t><button type=button class=\\\"modal__canvas-direction-button\\\" tabindex=-1\\n\\t\\t\\t\\t\\t\\tdata-canvas-resize-direction=\\\"right  top\\\"    ></button\\n\\t\\t\\t\\t\\t><button type=button class=\\\"modal__canvas-direction-button\\\" tabindex=-1\\n\\t\\t\\t\\t\\t\\tdata-canvas-resize-direction=\\\"left   middle\\\" ></button\\n\\t\\t\\t\\t\\t><button type=button class=\\\"modal__canvas-direction-button\\\" tabindex=-1\\n\\t\\t\\t\\t\\t\\tdata-canvas-resize-direction=\\\"center middle\\\" ></button\\n\\t\\t\\t\\t\\t><button type=button class=\\\"modal__canvas-direction-button\\\" tabindex=-1\\n\\t\\t\\t\\t\\t\\tdata-canvas-resize-direction=\\\"right  middle\\\" ></button\\n\\t\\t\\t\\t\\t><button type=button class=\\\"modal__canvas-direction-button\\\" tabindex=-1\\n\\t\\t\\t\\t\\t\\tdata-canvas-resize-direction=\\\"left   bottom\\\" ></button\\n\\t\\t\\t\\t\\t><button type=button class=\\\"modal__canvas-direction-button\\\" tabindex=-1\\n\\t\\t\\t\\t\\t\\tdata-canvas-resize-direction=\\\"center bottom\\\" ></button\\n\\t\\t\\t\\t\\t><button type=button class=\\\"modal__canvas-direction-button\\\" tabindex=-1\\n\\t\\t\\t\\t\\t\\tdata-canvas-resize-direction=\\\"right  bottom\\\" ></button\\n\\t\\t\\t\\t></div\\n\\t\\t\\t></div\\n\\t\\t></div\\n\\t\\t><div class=modal__confirm>\\n\\t\\t\\t<button type=button class=\\\"modal__button modal-ok\\\" data-modal-ok>OK</button>\\n\\t\\t\\t<button type=button class=\\\"modal__button modal-cancel\\\" data-modal-cancel>Cancel</button>\\n\\t\\t</div>\\n\\t\\t<div class=\\\"modal__error-text\\\"></div>\";\n\t\t};\n\t\n\t\tmodalCanvasSize.modalInternalBinding = function () {\n\t\t\tvar doc = document; // Shortening only :/\n\t\t\tthis.resizeIconPositionX = \"center\";\n\t\t\tthis.resizeIconPositionY = \"middle\";\n\t\n\t\t\tthis.onResizeDirectionButtonClick = this.onResizeDirectionButtonClick.bind(this);\n\t\n\t\t\tthis.resizeDirectionContainer = doc.querySelector(\"[data-canvas-direction-container]\");\n\t\t\tthis.resizeDirectionContainer.addEventListener(\"click\", this.onResizeDirectionButtonClick);\n\t\n\t\t\t// Focus the first input box and select (highlight) its contents.\n\t\t\t// FF doesn\"t support select() method.\n\t\t\t// Webkit throws InvalidStateError on setSelectionRange on an input type=number element.\n\t\t\t// https://code.google.com/p/chromium/issues/detail?id=346270\n\t\t\tvar firstInput = doc.getElementById(\"canvas-size-width\");\n\t\t\ttry {\n\t\t\t\tfirstInput.focus();\n\t\t\t\tfirstInput.setSelectionRange(0, 9999);\n\t\t\t} catch (e) {\n\t\t\t\tfirstInput.select();\n\t\t\t}\n\t\t};\n\t\n\t\tmodalCanvasSize.modalInternalUnbinding = function () {\n\t\t\tvar that = this;\n\t\t\tthis.resizeDirectionContainer.removeEventListener(\"click\", that.onResizeDirectionButtonClick);\n\t\t};\n\t\n\t\t// Returns true if user input is valid.\n\t\tmodalCanvasSize.modalValidate = function () {\n\t\t\tvar newWidthEl = document.querySelector(\"[data-modal-canvas-size-new-width]\");\n\t\t\tvar newHeightEl = document.querySelector(\"[data-modal-canvas-size-new-height]\");\n\t\t\tvar newWidth = parseInt(newWidthEl.value);\n\t\t\tvar newHeight = parseInt(newHeightEl.value);\n\t\t\tvar errorText = void 0;\n\t\n\t\t\tthis.errorEl = document.querySelector(\".modal__error-text\");\n\t\n\t\t\tif (typeof newWidth !== \"number\" || typeof newHeight !== \"number\" || Number.isNaN(newWidth) || Number.isNaN(newHeight)) {\n\t\t\t\terrorText = \"Oops! Please enter a numeric input value.\";\n\t\t\t} else if (newWidth < 3 || newHeight < 3) {\n\t\t\t\terrorText = \"Oops! Canvases must be at least three pixels or larger on each dimension.\";\n\t\t\t} else if (newWidth >= 5000 || newHeight >= 5000) {\n\t\t\t\terrorText = \"Whoa Nellie! Please keep it under 5000 pixels on each dimension.\";\n\t\t\t}\n\t\t\tif (errorText) {\n\t\t\t\tthis.showError(errorText);\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tthis.newWidth = newWidth;\n\t\t\t\tthis.newHeight = newHeight;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t};\n\t\n\t\tmodalCanvasSize.onResizeDirectionButtonClick = function (e) {\n\t\t\te.preventDefault();\n\t\t\te.stopImmediatePropagation();\n\t\n\t\t\t// Target should be one of the child buttons, split on spaces.\n\t\t\tvar positions = e.target.getAttribute(\"data-canvas-resize-direction\");\n\t\t\tpositions = positions.split(/\\s+/);\n\t\n\t\t\t// Set the new icon positions.\n\t\t\t// Markup is strictly horizontal value first, then vertical value.\n\t\t\tthis.resizeIconPositionX = positions[0];\n\t\t\tthis.resizeIconPositionY = positions[1];\n\t\n\t\t\t// Remove all old positioning classes. This could surely be improved?\n\t\t\tthis.resizeDirectionContainer.classList.remove(\"resize-icon-top\", \"resize-icon-middle\", \"resize-icon-bottom\", \"resize-icon-left\", \"resize-icon-center\", \"resize-icon-right\");\n\t\n\t\t\t// And add the new appropriate classes.\n\t\t\tthis.resizeDirectionContainer.classList.add(\"resize-icon-\" + this.resizeIconPositionX);\n\t\t\tthis.resizeDirectionContainer.classList.add(\"resize-icon-\" + this.resizeIconPositionY);\n\t\t};\n\t\n\t\treturn modalCanvasSize;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 12 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(9), __webpack_require__(13), __webpack_require__(14)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Modal, parseRLEFile, parseBMP) {\n\t\n\t\t// To be added & customized for each unique modal object:\n\t\t// this.titleText   html to insert in body of modal\n\t\t// this.innerMarkup   html to insert in body of modal\n\t\t// this.modalInternalBinding   listeners other than ok/cancel\n\t\t// this.modalInternalUnbinding  remove listeners other than ok/cancel\n\t\t// this.modalValidate  optional check on click of OK. returns a Boolean.\n\t\t// this.modalSubmit   function to run 'ok' click if valid.\n\t\n\t\tvar modalOpenPattern = Object.create(Modal);\n\t\n\t\tmodalOpenPattern.titleText = \"Open Pattern\";\n\t\n\t\tmodalOpenPattern.innerMarkup = function () {\n\t\t\treturn \"<div class='modal__open modal__configure'>\" + \"<div class='modal__open__instructions'>Choose a JSON, RLE, or 1-bit\" + \" Windows BMP file pattern from your file system.\" + \"</div>\" + \"</div\" + \"><div class=modal__confirm>\" + \"<button type=button class='modal__button modal-ok'\" + \" data-modal-ok>OK</button>\" + \"<button type=button class='modal__button modal-cancel' \" + \"data-modal-cancel>Cancel</button>\" + \"</div>\" + \"<div class='modal__open__error-text modal__error-text'></div>\" + \"<div class=modal__input-file-wrapper>\" + \"<input class=modal__file-input type=file>\" + \"</div>\";\n\t\t};\n\t\n\t\tmodalOpenPattern.modalInternalBinding = function () {\n\t\t\tvar fileInputEl = document.querySelector(\".modal__file-input\");\n\t\t\tvar errorEl = document.querySelector(\".modal__error-text\");\n\t\n\t\t\tthis.modalValidateFileInputChoice = this.modalValidateFileInputChoice.bind(this);\n\t\t\tthis.modalValidateFileInputContents = this.modalValidateFileInputContents.bind(this);\n\t\n\t\t\tthis.fileInputEl = fileInputEl;\n\t\t\tthis.errorEl = errorEl;\n\t\n\t\t\t// Don't wait until \"OK\" click to validate the input.\n\t\t\tthis.fileInputEl.addEventListener(\"change\", this.modalValidateFileInputChoice);\n\t\t};\n\t\n\t\tmodalOpenPattern.modalInternalUnbinding = function () {\n\t\t\tthis.fileInputEl.removeEventListener(\"change\", this.modalValidateFileInputChoice);\n\t\t};\n\t\n\t\tmodalOpenPattern.parsedPattern = null;\n\t\tmodalOpenPattern.isValid = false; // Nothing initially selected.\n\t\n\t\tmodalOpenPattern.validateBMP = function (file) {\n\t\t\tvar bm = parseBMP(file);\n\t\t\tvar errorText = \"\";\n\t\n\t\t\tif (bm.iHeader.bitsPerPixel > 1) {\n\t\t\t\terrorText = \"The BMP file can't be read because it has a bit depth of \" + \"greater than one.\";\n\t\t\t} else if (bm.iHeader.compressionMethod > 0) {\n\t\t\t\terrorText = \"Lifey currently only supports uncompressed BMP files.\";\n\t\t\t}\n\t\t\tif (errorText) {\n\t\t\t\tthis.parsedPattern = null;\n\t\t\t} else {\n\t\t\t\tthis.parsedPattern = bm;\n\t\t\t}\n\t\t\treturn errorText;\n\t\t};\n\t\n\t\tmodalOpenPattern.readFile = function (file) {\n\t\t\tvar fReader = new FileReader();\n\t\t\tvar that = this;\n\t\t\tvar ext = this.fileExtension;\n\t\n\t\t\tfReader.onload = function (e) {\n\t\t\t\tthat.modalValidateFileInputContents(e.target.result);\n\t\t\t};\n\t\n\t\t\t// Read the file differently based on the extension.\n\t\t\t// This kicks off the onload event above.\n\t\t\tif (ext === \"JSON\" || ext === \"RLE\") {\n\t\t\t\tfReader.readAsText(file);\n\t\t\t} else if (ext === \"BMP\") {\n\t\n\t\t\t\t// BMP is binary, read as an Array Buffer.\n\t\t\t\tfReader.readAsArrayBuffer(file);\n\t\t\t}\n\t\t};\n\t\n\t\t// Validity can be set by the file(s) being selected, or the file being (mis)read\n\t\t// or parsed. This gets checked on click of \"ok\" button.\n\t\tmodalOpenPattern.modalValidate = function () {\n\t\t\treturn this.isValid;\n\t\t};\n\t\n\t\tmodalOpenPattern.modalValidateFileInputContents = function (file) {\n\t\t\tvar ext = this.fileExtension;\n\t\t\tvar errorText = \"\";\n\t\n\t\t\tif (ext === \"JSON\") {\n\t\t\t\ttry {\n\t\t\t\t\tthis.parsedPattern = JSON.parse(file);\n\t\t\t\t} catch (e) {\n\t\t\t\t\terrorText = \"The file text is not valid JSON.\" + \" Please check the file for a possible syntax error.\";\n\t\t\t\t}\n\t\t\t} else if (ext === \"RLE\") {\n\t\t\t\tthis.parsedPattern = parseRLEFile(file);\n\t\t\t} else if (ext === \"BMP\") {\n\t\t\t\terrorText = this.validateBMP(file);\n\t\t\t}\n\t\n\t\t\tthis.showError(errorText);\n\t\t\tthis.isValid = !errorText;\n\t\t};\n\t\n\t\tmodalOpenPattern.modalValidateFileInputChoice = function () {\n\t\t\tvar fileList = this.fileInputEl.files;\n\t\t\tvar file = fileList[0];\n\t\t\tvar errorText = \"\"; // Always added, must be a string.\n\t\t\tvar fileName = file.name;\n\t\t\tvar fileExtension = fileName.split(\".\").pop().toUpperCase();\n\t\t\tthis.fileExtension = fileExtension;\n\t\n\t\t\tif (!file || fileList.length === 0) {\n\t\t\t\terrorText = \"No file selected.\";\n\t\t\t} else if (fileList.length > 1) {\n\t\t\t\terrorText = \"Multiple files selected. Please choose a single file.\";\n\t\t\t} else if (fileExtension !== \"JSON\" && fileExtension !== \"BMP\" && fileExtension !== \"RLE\") {\n\t\t\t\terrorText = \"The file name should end with a dot, followed by either “json”,\" + \" “rle”, or “bmp”.\";\n\t\t\t}\n\t\n\t\t\tif (errorText) {\n\t\t\t\tthis.parsedPattern = null;\n\t\t\t} else {\n\t\t\t\tthis.readFile(file); // Kicks off a second round of validation.\n\t\t\t}\n\t\n\t\t\t// Always \"show\" the error even if it's an empty string, so that a file input\n\t\t\t// correction erases any previous error messages.\n\t\t\tthis.showError(errorText);\n\t\t\tthis.isValid = !errorText;\n\t\t};\n\t\n\t\treturn modalOpenPattern;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 13 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t/**\n\t * Parse RLE to JSON\n\t *\n\t * Parses \"run-length-encoded\" (.rle) files used for storing\n\t * cellular automata patterns. Written as AMD module.\n\t *\n\t * By Alex Bell |  MIT License\n\t *\n\t * @returns {\n\t *     name: String,\n\t *     comments: String,\n\t *     author: String,\n\t *     coordinates: [Integer, Integer],\n\t *     rule: String,\n\t *     width: Integer,\n\t *     height: Integer,\n\t *     pattern: str\n\t *  }\n\t *\n\t * Based on the very basic syntax/grammar outline here\n\t * http://www.mirekw.com/ca/ca_files_formats.html\n\t *\n\t *   b = a dead cell\n\t *   o = a live cell\n\t *   $ = end of a line of the pattern\n\t *\n\t *   #N Beehive at beehive\n\t *   #C A simple 12-cell still life composed of two beehive.\n\t *   #C www.conwaylife.com/wiki/index.php?title=Beehive_at_beehive\n\t *   #O ook \"The Librarian\"@unseen.edu Fri Apr 30 19:38:52 1999\n\t *   #R -22 -57 (this is the offset from the top left.)\n\t *   x = 6, y = 6, rule = 23/3\n\t *   4bob$3bobo$3bobo$b2obob$o2bo2b$b2o!\n\t */\n\t!(__WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t\treturn function (str) {\n\t\t\tvar ret = Object.create(null);\n\t\n\t\t\tif (!str) {\n\t\t\t\treturn;\n\t\t\t} // Stay out of trouble.\n\t\n\t\t\tvar pos = 0;\n\t\t\tvar chrctr = void 0;\n\t\t\tvar inComment = false;\n\t\t\tvar currentTerm = void 0; // Can be \"width\", \"height\", or \"rule\"\n\t\n\t\t\tret.name = \"\"; // These are the really the only two properties certain to be included.\n\t\t\tret.pattern = \"\";\n\t\n\t\t\tvar isSpace = function isSpace(c) {\n\t\t\t\treturn c === \" \" || // Space\n\t\t\t\tc === \"\\t\"; // Horizontal tab\n\t\t\t};\n\t\n\t\t\tvar isNewLine = function isNewLine(c) {\n\t\t\t\treturn c === \"\\n\" || // New line\n\t\t\t\tc === \"\\f\" || // Form feed\n\t\t\t\tc === \"\\r\"; // Carriage return\n\t\t\t};\n\t\n\t\t\t// http://jsperf.com/isdigittest/5\n\t\t\tvar isDigit = function isDigit(n) {\n\t\t\t\treturn Boolean([true, true, true, true, true, true, true, true, true, true][n]);\n\t\t\t};\n\t\n\t\t\tvar stripTrailingSpaces = function stripTrailingSpaces(str) {\n\t\t\t\twhile (isSpace(str[str.length - 1])) {\n\t\t\t\t\tstr = str.substring(0, str.length - 2);\n\t\t\t\t}\n\t\t\t\treturn str;\n\t\t\t};\n\t\n\t\t\tvar createEmptyPropIfNone = function createEmptyPropIfNone(str) {\n\t\t\t\tif (!ret[str]) {\n\t\t\t\t\tret[str] = \"\";\n\t\t\t\t}\n\t\t\t};\n\t\n\t\t\twhile (true) {\n\t\t\t\tchrctr = str[pos];\n\t\n\t\t\t\t// If string has no length, or we've hit the exclamation point EOF marker,\n\t\t\t\t// or end of string reached.\n\t\t\t\tif (!chrctr || chrctr === \"!\") {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\n\t\t\t\t// Determine if entering a comment\n\t\t\t\tif (chrctr === \"#\") {\n\t\t\t\t\tif (str[pos + 1] === \"N\" || str[pos + 1] === \"n\") {\n\t\t\t\t\t\tinComment = \"name\";\n\t\t\t\t\t} else if (str[pos + 1] === \"C\" || str[pos + 1] === \"c\") {\n\t\t\t\t\t\tinComment = \"comments\";\n\t\t\t\t\t\tcreateEmptyPropIfNone(\"comments\");\n\t\t\t\t\t} else if (str[pos + 1] === \"O\" || str[pos + 1] === \"o\") {\n\t\t\t\t\t\tinComment = \"author\";\n\t\t\t\t\t\tcreateEmptyPropIfNone(\"author\");\n\t\t\t\t\t} else if (str[pos + 1] === \"R\") {\n\t\t\t\t\t\tinComment = \"coordinates\";\n\t\t\t\t\t\tcreateEmptyPropIfNone(\"coordinates\");\n\t\t\t\t\t}\n\t\t\t\t\tpos = pos + 2;\n\t\t\t\t\tcontinue;\n\t\n\t\t\t\t\t// Inside a comment\n\t\t\t\t} else if (inComment) {\n\t\n\t\t\t\t\t// Bail out of comment on newline.\n\t\t\t\t\tif (isNewLine(chrctr)) {\n\t\n\t\t\t\t\t\t// Remove trailing spaces from a comment line.\n\t\t\t\t\t\tret[inComment] = stripTrailingSpaces(ret[inComment]);\n\t\n\t\t\t\t\t\tif (inComment === \"coordinates\") {\n\t\t\t\t\t\t\tret.coordinates = ret.coordinates.split(\" \");\n\t\t\t\t\t\t\tret.coordinates[0] = parseInt(ret.coordinates[0], 10); // The x\n\t\t\t\t\t\t\tret.coordinates[1] = parseInt(ret.coordinates[1], 10); // The y\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinComment = false;\n\t\n\t\t\t\t\t\t// Ignore leading spaces and tabcharacters inside a comment if\n\t\t\t\t\t\t// the corresponding property is currently an empty string.\n\t\t\t\t\t} else if (isSpace(chrctr) && ret[inComment] === \"\") {\n\t\n\t\t\t\t\t\t// Do nothing inside here. Do Not remove.\n\t\n\t\t\t\t\t\t// The coordinates string should be only digits, hyphens, spaces.\n\t\t\t\t\t\t// Skip over anything else like letters or punctuation.\n\t\t\t\t\t} else if (inComment === \"coordinates\" && !isSpace(chrctr) && !isDigit(chrctr) && chrctr !== \"-\") {\n\t\t\t\t\t\tpos += 1;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\n\t\t\t\t\t\t// The general case: add the character to the comment.\n\t\t\t\t\t\tret[inComment] += chrctr;\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// Not in a comment from here on down.\n\t\t\t\t\t// Determine if entering a property\n\t\t\t\t} else if (chrctr === \"x\") {\n\t\t\t\t\tcurrentTerm = \"width\";\n\t\t\t\t\tcreateEmptyPropIfNone(\"width\");\n\t\t\t\t} else if (chrctr === \"y\") {\n\t\t\t\t\tcurrentTerm = \"height\";\n\t\t\t\t\tcreateEmptyPropIfNone(\"height\");\n\t\t\t\t} else if (str.substring(pos, pos + 4) === \"rule\") {\n\t\t\t\t\tcurrentTerm = \"rule\";\n\t\t\t\t\tcreateEmptyPropIfNone(\"rule\");\n\t\n\t\t\t\t\t// Reset currentTerm to empty on commas or newlines\n\t\t\t\t} else if (chrctr === \",\" || isNewLine(chrctr)) {\n\t\t\t\t\tcurrentTerm = \"\";\n\t\n\t\t\t\t\t// Convert to number\n\t\t\t\t\tif (ret.width && ret.height) {\n\t\t\t\t\t\tret.width = parseInt(ret.width);\n\t\t\t\t\t\tret.height = parseInt(ret.height);\n\t\t\t\t\t}\n\t\t\t\t} else if (currentTerm) {\n\t\n\t\t\t\t\t// Width, height, and rule all accept any digit.\n\t\t\t\t\tif (isDigit(chrctr)) {\n\t\t\t\t\t\tret[currentTerm] += chrctr;\n\t\n\t\t\t\t\t\t// \"rule\" additionally accepts a slash\n\t\t\t\t\t} else if (currentTerm === \"rule\" && chrctr === \"/\") {\n\t\t\t\t\t\tret[currentTerm] += \"/\";\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// Not in a comment, and not in currentTerm,\n\t\t\t\t\t// which means we've reached the actual pattern.\n\t\t\t\t} else if (isDigit(chrctr) || chrctr === \"b\" || chrctr === \"o\" || chrctr === \"$\") {\n\t\t\t\t\tret.pattern += chrctr;\n\t\t\t\t}\n\t\n\t\t\t\tpos += 1;\n\t\t\t} // End of big while loop.\n\t\t};\n\t}.call(exports, __webpack_require__, exports, module), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 14 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t\t/**\n\t  * @param {Buffer} buffer (from FileReader)\n\t  * @returns {Object} with image properties\n\t  */\n\t\treturn function (buffer) {\n\t\t\tvar dataV = new DataView(buffer);\n\t\t\tvar bm = Object.create(null);\n\t\n\t\t\t// Omit for brevity:\n\t\t\t// let decoder = new TextDecoder( \"utf-8\" );\n\t\n\t\t\tbm.fHeader = Object.create(null);\n\t\n\t\t\t// Much of this could be omitted for brevity, but it's useful for\n\t\t\t// reference and debugging.\n\t\n\t\t\t// Typically \"BM\" for Windows 3, 95, NT +\n\t\t\t// Ancient unsupported entries include: \"BA\", \"CI\", \"CP\", \"IC\", \"PT\".\n\t\t\t// bm.fHeader.type = decoder.decode( new DataView( buffer, 0, 2 ) );\n\t\n\t\t\t// The file size in bytes\n\t\t\t// bm.fHeader.byteSize =         dataV.getUint32( 2, true );\n\t\n\t\t\t// Reserved, depends on the application\n\t\t\t// bm.fHeader.reserved1 =        dataV.getUint16( 6, true );\n\t\n\t\t\t// Reserved, depends on the application\n\t\t\t// bm.fHeader.reserved2 =        dataV.getUint16( 8, true );\n\t\n\t\t\t// Offset of the byte where the pixel array starts\n\t\t\tbm.fHeader.offsetToPixArray = dataV.getUint32(10, true);\n\t\n\t\t\tbm.iHeader = Object.create(null);\n\t\n\t\t\t// The size of this header, varies with format version #\n\t\t\t// e.g. V2 = 12; V3 = 40; V4 = 108; V5 = 124\n\t\t\t// bm.iHeader.headerSize =        dataV.getUint32( 14, true );\n\t\n\t\t\t// The bitmap width in pixels (integer).\n\t\t\tbm.width = dataV.getUint32(18, true);\n\t\n\t\t\t// The bitmap height in pixels (integer).\n\t\t\tbm.height = dataV.getUint32(22, true);\n\t\n\t\t\t// Number of color planes used (set to 1).\n\t\t\t// bm.iHeader.colorPlanes =       dataV.getUint16( 26, true );\n\t\n\t\t\t// Number of bits per pixel. Typically: 1, 4, 8, 16, 24 or 32.\n\t\t\tbm.iHeader.bitsPerPixel = dataV.getUint16(28, true);\n\t\n\t\t\t// The compression method being used. 0 means uncompressed,\n\t\t\t// which is currently the only value supported in the validator.\n\t\t\tbm.iHeader.compressionMethod = dataV.getUint32(30, true);\n\t\n\t\t\t// Image size of raw bitmap data (not file size).\n\t\t\t// bm.iHeader.imageSize =         dataV.getUint32( 34, true );\n\t\n\t\t\t// Irrelevant in this context.\n\t\t\t// bm.iHeader.pixPerMeterX =      dataV.getUint32( 38, true );\n\t\t\t// bm.iHeader.pixPerMeterY =      dataV.getUint32( 42, true );\n\t\n\t\t\t// Number of colors in the palette. Should be \"0\" for 1 bit.\n\t\t\t// bm.iHeader.usedColors =        dataV.getUint32( 46, true );\n\t\n\t\t\t// Number of important colors used\n\t\t\t// bm.iHeader.importantColors =   dataV.getUint32( 50, true );\n\t\n\t\t\t// Stride is the number of bytes in a row. Stride must be a multiple of 4.\n\t\t\tbm.stride = Math.ceil(bm.iHeader.bitsPerPixel * bm.width / 32) * 4;\n\t\n\t\t\t// Total number of pixels in the image\n\t\t\tbm.pixels = new Uint8Array(bm.width * bm.height); // Initially all zeros\n\t\n\t\t\tvar offset = bm.fHeader.offsetToPixArray;\n\t\t\tvar indent = void 0,\n\t\t\t    byteAddress = void 0,\n\t\t\t    bitAddress = void 0,\n\t\t\t    byteVal = void 0,\n\t\t\t    bitVal = void 0;\n\t\n\t\t\t// Outer loop iterates image rows\n\t\t\tfor (var y = 0; y < bm.height; y += 1) {\n\t\t\t\tindent = bm.stride * y;\n\t\n\t\t\t\t// Inner loop iterates image columns\n\t\t\t\tfor (var x = 0; x < bm.width; x += 1) {\n\t\t\t\t\tbyteAddress = Math.floor(x / 8);\n\t\t\t\t\tbitAddress = x % 8;\n\t\t\t\t\tbyteVal = dataV.getUint8(offset + indent + byteAddress, true);\n\t\t\t\t\tbyteVal = byteVal.toString(2); // Convert to base 2\n\t\n\t\t\t\t\t// Trick to pad left with zeros to 8 digits\n\t\t\t\t\tbyteVal = (\"00000000\" + byteVal).substring(byteVal.length);\n\t\t\t\t\tbitVal = byteVal[bitAddress];\n\t\n\t\t\t\t\t// BMP pixels start at the bottom left, so reverse the row order\n\t\t\t\t\tbm.pixels[(bm.height - 1 - y) * bm.width + x] = bitVal;\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\treturn bm;\n\t\t};\n\t}.call(exports, __webpack_require__, exports, module), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 15 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(9)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Modal) {\n\t\n\t\t// To be added & customized for each unique modal objects:\n\t\t// this.titleText   html to insert in body of modal\n\t\t// this.innerMarkup   html to insert in body of modal\n\t\t// this.modalInternalBinding   listeners other than ok/cancel\n\t\t// this.modalInternalUnbinding  remove listeners other than ok/cancel\n\t\t// this.modalValidate  optional check on click of OK. returns a Boolean.\n\t\t// this.modalSubmit   function to run 'ok' click if valid.\n\t\n\t\tvar modalSavePattern = Object.create(Modal);\n\t\n\t\tmodalSavePattern.titleText = \"Save As\";\n\t\n\t\tmodalSavePattern.innerMarkup = function () {\n\t\t\treturn \"<div class='modal__configure modal__configure--save-as'>\" + \"<div class='modal__save-pattern-option'>Format:</div>\" + \"<div class='modal__save-pattern-option-input-wrapper'>\" + \"<select class=modal__save-pattern-option-input name=fileformat\" + \" data-modal-save-file-format>\" + \"<option value='json' selected>JavaScript Object Notation (.json)</option>\" + \"<option value='rle'>Run Length Encoded (.rle)</option>\" + \"</select>\" + \"</div>\" + \"<div class=modal__save-pattern-option>Pattern Name:</div>\" + \"<div class=modal__save-pattern-option-input-wrapper>\" + \"<input type=text class=modal__save-pattern-option-input\" + \" data-modal-save-pattern-name>\" + \"</div>\" + \"<div class=modal__save-pattern-option>Author:</div>\" + \"<div class=modal__save-pattern-option-input-wrapper>\" + \"<input type=text class=modal__save-pattern-option-input\" + \" data-modal-save-pattern-author>\" + \"</div>\" + \"<div class=modal__error-text></div>\" + \"</div>\" + \"<div class='modal__confirm modal__confirm--bottom-corner'>\" + \"<button type=button class='modal__button modal-cancel modal-cancel--save-as'\" + \"data-modal-cancel>Cancel</button>\" + \"<button type=button class='modal__button modal-ok modal-ok--save-as'\" + \"data-modal-ok >Save</button>\" + \"</div>\";\n\t\t};\n\t\n\t\treturn modalSavePattern;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 16 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(9)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Modal) {\n\t\n\t\t// To be added & customized for each unique modal object:\n\t\t// this.titleText   html to insert in body of modal.\n\t\t// this.innerMarkup   html to insert in body of modal.\n\t\t// this.modalInternalBinding   (optional) listeners other than ok/cancel.\n\t\t// this.modalInternalUnbinding  (optional) remove listeners other than ok/cancel.\n\t\t// this.modalValidate  (optional) check on click of OK. returns a Boolean.\n\t\t// this.modalSubmit   function to run \"ok\" click if valid.\n\t\n\t\tvar modalSharePattern = Object.create(Modal);\n\t\n\t\tmodalSharePattern.titleText = \"Share Pattern\";\n\t\n\t\tmodalSharePattern.innerMarkup = function () {\n\t\t\treturn \"\" + \"<div class='modal__configure modal__share__configure'>\" + \"<div class='modal__section-title--share'>\" + \"<span class=pattern-fits-in-url></span>\" + \"</div>\" + \"</div>\" + \"<div class=modal__confirm>\" + \"<button type=button class='modal__button modal-ok' data-modal-ok>OK</button>\" + \"</div>\" + \"<div class=modal__shareable-url data-modal-shareable-url></div\";\n\t\t};\n\t\n\t\treturn modalSharePattern;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 17 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t/**  ---- Parse RLE pixel string ----\n\t *\n\t *\t Based on the syntax outline at:\n\t *\t http://www.mirekw.com/ca/ca_files_formats.html\n\t *\n\t *   b = a dead cell\n\t *   o = a live cell\n\t *   $ = end of a line of the pattern\n\t *\n\t *   4bob$3bobo$3bobo$b2obob$o2bo2b$b2o!\n\t *\n\t *\tReturns a uInt8 Array of pixel data with 0 = dead, 1 = live\n\t *\n\t * @param {String} str\n\t * @param {Number} width\n\t * @param {Number} height\n\t * @returns {uInt8 Array}\n\t */\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(8)], __WEBPACK_AMD_DEFINE_RESULT__ = function (ut) {\n\t\n\t\t// Currently needed just for Intern to allow block-scoping.\n\t\t// Consider removing in build.\n\t\t\"use strict\";\n\t\n\t\treturn function (str, width, height) {\n\t\t\twidth = width || 0;\n\t\t\theight = height || 0;\n\t\t\tvar chrctr = void 0;\n\t\t\tvar pos = 0;\n\t\t\tvar runCount = \"\"; // Concatenated character by character\n\t\t\tvar runCountInteger = void 0;\n\t\t\tvar currentX = 0;\n\t\t\tvar currentY = 0;\n\t\t\tvar dataArray = new Int8Array(width * height); // All zeros initially\n\t\n\t\t\tif (!str || !width || !height) {\n\t\t\t\treturn; // Stay out of loop.\n\t\t\t}\n\t\n\t\t\t// Loop through each character in the string.\n\t\t\twhile (true) {\n\t\t\t\tchrctr = str[pos];\n\t\n\t\t\t\t// If end of string reached, or exclamation point EOF marker.\n\t\t\t\tif (!chrctr || chrctr === \"!\") {\n\t\t\t\t\treturn dataArray; // Main return path\n\t\t\t\t} else if (ut.isDigit(chrctr)) {\n\t\t\t\t\trunCount += chrctr;\n\t\t\t\t} else if (chrctr === \"b\" || chrctr === \"o\") {\n\t\t\t\t\trunCountInteger = parseInt(runCount) || 1;\n\t\n\t\t\t\t\t// Don't bother setting empty cells on the typed array,\n\t\t\t\t\t// because it's pre-populated with all zeroes.\n\t\t\t\t\tif (chrctr === \"o\") {\n\t\t\t\t\t\tfor (var i = 0; i < runCountInteger; i += 1) {\n\t\t\t\t\t\t\tdataArray[currentY * width + currentX + i] = 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// Advance currentX (whether it's a \"b\" or an \"o\")\n\t\t\t\t\tcurrentX += runCountInteger;\n\t\t\t\t\trunCount = \"\"; // Reset\n\t\t\t\t} else if (chrctr === \"$\") {\n\t\n\t\t\t\t\t// End of this row, and possibly the next rows, etc.\n\t\t\t\t\t// Basically treat runCount $s as \"newlines\" in the grid.\n\t\t\t\t\trunCountInteger = parseInt(runCount) || 1;\n\t\n\t\t\t\t\tcurrentX = 0;\n\t\t\t\t\tcurrentY += runCountInteger;\n\t\t\t\t\trunCount = \"\";\n\t\t\t\t}\n\t\n\t\t\t\tpos += 1;\n\t\t\t}\n\t\t};\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 18 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t/**  ---- Convert Pattern Object to RLE file string ----\n\t *\n\t *\t Based on the syntax outline at:\n\t *\t http://www.mirekw.com/ca/ca_files_formats.html\n\t *\n\t *   #N Beehive at beehive\n\t *   #C A simple 12-cell still life composed of two beehive.\n\t *   #C www.conwaylife.com/wiki/index.php?title=Beehive_at_beehive\n\t *   #O ook \"The Librarian\"@unseen.edu Fri Apr 30 19:38:52 1999\n\t *   #R -22 -57\n\t *   x = 6, y = 6, rule = 23/3\n\t *   4bob$3bobo$3bobo$b2obob$o2bo2b$b2o!\n\t *\n\t *   TO DO: Integrate #R value with offsetX and offsetY? It's unclear to me\n\t *   right now what negative #R values here are relative to.\n\t *\n\t */\n\t!(__WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t  return function (pat) {\n\t    var retStr = \"\";\n\t\n\t    if (pat.name) {\n\t      retStr += \"#N \" + pat.name + \"\\n\";\n\t    }\n\t    if (pat.author) {\n\t      retStr += \"#O \" + pat.author + \"\\n\";\n\t    }\n\t    retStr += \"x = \" + pat.width + \", y=\" + pat.height + \", rule = B3/S23\\n\";\n\t    retStr += pat.pattern + \"!\\n\";\n\t\n\t    return retStr;\n\t  };\n\t}.call(exports, __webpack_require__, exports, module), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 19 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t/**\n\t * Fn dataArrayToRLE\n\t * @returns {object}  returns object with properties\n\t *\t pattern {string},\n\t *\t width {integer},\n\t *\t height {integer},\n\t *   minCanvasX {integer},\n\t *   minCanvasY {integer},\n\t *   offsetX {integer},\n\t *   offsetY {integer}\n\t */\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t\t// Currently needed just for Intern to allow block-scoping.\n\t\t\"use strict\";\n\t\n\t\treturn function (dataArray, canvasWidth, canvasHeight) {\n\t\t\tvar len = dataArray.length;\n\t\t\tif (len !== canvasWidth * canvasHeight) {\n\t\t\t\tconsole.log(\"dataArray doesn't match supplied canvas dimensions.\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\n\t\t\tvar posTopMost = 0; // Start at beginning.\n\t\t\tfor (; posTopMost < len; posTopMost += 1) {\n\t\t\t\tif (dataArray[posTopMost] === 1) {\n\t\t\t\t\tbreak; // Exit at first active cell.\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\tvar posBottomMost = len - 1; // Start at end.\n\t\t\tfor (; posBottomMost > 0; posBottomMost -= 1) {\n\t\t\t\tif (dataArray[posBottomMost] === 1) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\t// Array position of leftmost active. Start all the way right and move left.\n\t\t\tvar posLeftMost = canvasWidth - 1;\n\t\t\tfor (var i = 0; i < len; i += 1) {\n\t\t\t\tif (dataArray[i] === 1 && i % canvasWidth < posLeftMost % canvasWidth) {\n\t\t\t\t\tposLeftMost = i; // Must go through the full loop.\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\t// Array position of rightmost active. Start all the way left and move right.\n\t\t\tvar posRightMost = 0;\n\t\t\tfor (var _i = 0; _i < len; _i += 1) {\n\t\t\t\tif (dataArray[_i] === 1 && _i % canvasWidth > posRightMost % canvasWidth) {\n\t\t\t\t\tposRightMost = _i; // Must go through the full loop.\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\tvar patternWidth = posRightMost % canvasWidth - posLeftMost % canvasWidth + 1;\n\t\t\tvar patternHeight = Math.floor(posBottomMost / canvasWidth) - Math.floor(posTopMost / canvasWidth) + 1;\n\t\t\tvar offsetX = posLeftMost % canvasWidth;\n\t\t\tvar offsetY = Math.floor(posTopMost / canvasWidth);\n\t\n\t\t\tvar croppedDataArray = cropArray(dataArray, canvasWidth, canvasHeight, patternWidth, patternHeight, offsetX, offsetY);\n\t\n\t\t\tvar ret = Object.create(null);\n\t\t\tret.pattern = encodeArrayAsRLEString(croppedDataArray, patternWidth);\n\t\t\tret.width = patternWidth;\n\t\t\tret.height = patternHeight;\n\t\n\t\t\tif (patternWidth < canvasWidth) {\n\t\t\t\tret.offsetX = offsetX;\n\t\t\t\tret.minCanvasX = canvasWidth;\n\t\t\t}\n\t\t\tif (patternHeight < canvasHeight) {\n\t\t\t\tret.offsetY = offsetY;\n\t\t\t\tret.minCanvasY = canvasHeight;\n\t\t\t}\n\t\n\t\t\t// Handle the \"completely empty canvas\" case.\n\t\t\t// Never return a negative width and height.\n\t\t\tif (posTopMost === len) {\n\t\t\t\tret.width = ret.height = ret.offsetX = ret.offsetY = 0;\n\t\t\t}\n\t\n\t\t\treturn ret;\n\t\t};\n\t\n\t\t/**\n\t  *\tReturns a cropped data Array.\n\t  *\n\t  *  offsetX and offsetY values are from top left.\n\t  */\n\t\tfunction cropArray(arr, currWidth, currHeight, cropWidth, cropHeight, offsetX, offsetY) {\n\t\t\tvar newDataArray = new Int8Array(cropWidth * cropHeight);\n\t\n\t\t\t// Loop through all of the newDataArray,\n\t\t\t// getting values from the old DataArray.\n\t\t\tfor (var i = 0; i < cropHeight; i += 1) {\n\t\t\t\tfor (var j = 0; j < cropWidth; j += 1) {\n\t\t\t\t\tnewDataArray[i * cropWidth + j] = arr[(i + offsetY) * currWidth + j + offsetX];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn newDataArray;\n\t\t}\n\t\n\t\tfunction encodeArrayAsRLEString(dataArr, canvasWidth) {\n\t\t\tvar retStr = \"\";\n\t\t\tvar currentChar = void 0,\n\t\t\t    previousChar = void 0;\n\t\t\tvar previousCharCount = 0;\n\t\t\tvar previousEndRowCount = 0;\n\t\n\t\t\tvar len = dataArr.length;\n\t\n\t\t\tfor (var i = 0; i < len; i += 1) {\n\t\t\t\tcurrentChar = dataArr[i] ? \"o\" : \"b\";\n\t\n\t\t\t\t// For tailing characters at the end of a row:\n\t\t\t\t// bb do nothing.\n\t\t\t\t// bo write number of repeats, then \"b\", then \"o\".\n\t\t\t\t// ob write number of repeats, then \"o\".\n\t\t\t\t// oo write number of repeats + 1, then \"o\".\n\t\n\t\t\t\t// If on the last cell of a row.\n\t\t\t\tif (i > 0 && (i + 1) % canvasWidth === 0) {\n\t\t\t\t\tif (currentChar === \"o\") {\n\t\n\t\t\t\t\t\t// First, if there are any accumulated end-of-lines, print them\n\t\t\t\t\t\t// and reset the blank row counter.\n\t\t\t\t\t\tif (previousEndRowCount) {\n\t\t\t\t\t\t\tif (previousEndRowCount > 1) {\n\t\t\t\t\t\t\t\tretStr += previousEndRowCount;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tretStr += \"$\";\n\t\t\t\t\t\t\tpreviousEndRowCount = 0;\n\t\t\t\t\t\t}\n\t\n\t\t\t\t\t\tif (previousChar === \"o\") {\n\t\n\t\t\t\t\t\t\t// INCREMENT\n\t\t\t\t\t\t\tpreviousCharCount += 1;\n\t\t\t\t\t\t\tretStr += previousCharCount;\n\t\t\t\t\t\t} else if (previousChar === \"b\") {\n\t\t\t\t\t\t\tif (previousCharCount > 1) {\n\t\t\t\t\t\t\t\tretStr += previousCharCount;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tretStr += \"b\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tretStr = retStr + \"o\";\n\t\t\t\t\t} else if (currentChar === \"b\") {\n\t\t\t\t\t\tif (previousChar === \"o\") {\n\t\t\t\t\t\t\tif (previousCharCount > 1) {\n\t\t\t\t\t\t\t\tretStr += previousCharCount;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tretStr += previousChar;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// Increment the row count, unless we're at the very end of the entire array.\n\t\t\t\t\t// TO DO: Consider adding the exclamation mark EOF? Possibly unnecessary in JSON.\n\t\t\t\t\tif (i !== len - 1) {\n\t\t\t\t\t\tpreviousEndRowCount += 1;\n\t\t\t\t\t\tpreviousChar = undefined;\n\t\t\t\t\t\tpreviousCharCount = 0;\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// INCREMENT, THE GENERAL CASE.\n\t\t\t\t} else if (currentChar === previousChar) {\n\t\t\t\t\tpreviousCharCount += 1;\n\t\t\t\t\tcontinue;\n\t\n\t\t\t\t\t// WRITE\n\t\t\t\t} else {\n\t\n\t\t\t\t\t// We're either:\n\t\t\t\t\t// \t- at the beginning of a new row with any value.\n\t\t\t\t\t//  - in the middle of a row that has live cells on it, and at\n\t\t\t\t\t//    a new character or a different character.\n\t\n\t\t\t\t\t// Write to the output string and reset the counter.\n\t\n\t\t\t\t\t// If reached an active cell and there is are any accumulated\n\t\t\t\t\t// end-of-lines, print them first and reset the blank row counter.\n\t\t\t\t\tif (currentChar === \"o\" && previousEndRowCount) {\n\t\t\t\t\t\tif (previousEndRowCount > 1) {\n\t\t\t\t\t\t\tretStr += previousEndRowCount;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tretStr += \"$\";\n\t\t\t\t\t\tpreviousEndRowCount = 0;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (previousCharCount > 1) {\n\t\t\t\t\t\tretStr += previousCharCount;\n\t\t\t\t\t}\n\t\t\t\t\tif (previousChar) {\n\t\t\t\t\t\tretStr += previousChar;\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// Reset for next iteration of loop.\n\t\t\t\t\tpreviousChar = currentChar;\n\t\t\t\t\tpreviousCharCount = 1;\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\treturn retStr;\n\t\t}\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 20 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t// Adapted and improved from\n\t// http://thiscouldbebetter.neocities.org/texteditor.html\n\t\n\t// If this presents problems in the future consider migrating up to:\n\t// https://github.com/eligrey/FileSaver.js\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(8)], __WEBPACK_AMD_DEFINE_RESULT__ = function (ut) {\n\t\tvar objURL = void 0;\n\t\n\t\tfunction destroyClickedElement(event) {\n\t\t\tevent.target.removeEventListener(\"click\", destroyClickedElement);\n\t\t\tdocument.body.removeChild(event.target);\n\t\t}\n\t\n\t\treturn function (textStr, fileName) {\n\t\n\t\t\t// Any old reference ought to be released.\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL\n\t\t\tif (objURL) {\n\t\t\t\twindow.URL.revokeObjectURL(objURL);\n\t\t\t}\n\t\t\tvar textFileAsBlob = new Blob([textStr], { type: \"text/plain\" });\n\t\t\tvar downloadLink = document.createElement(\"a\");\n\t\t\tdownloadLink.download = fileName;\n\t\t\tobjURL = window.URL.createObjectURL(textFileAsBlob);\n\t\t\tdownloadLink.href = objURL;\n\t\n\t\t\t// Chrome allows the link to be clicked without actually adding it to the DOM.\n\t\t\t// Firefox requires the link to be added to the DOM before it can be clicked.\n\t\t\tif (!(navigator && navigator.vendor && navigator.vendor === \"Google Inc.\")) {\n\t\t\t\tdownloadLink.addEventListener(\"click\", destroyClickedElement);\n\t\t\t\tdownloadLink.style.display = \"none\";\n\t\t\t\tdocument.body.appendChild(downloadLink);\n\t\t\t}\n\t\n\t\t\tdownloadLink.click();\n\t\t};\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 21 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_RESULT__;'use strict';\n\t\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\t\n\t/*! Hammer.JS - v2.0.7 - 2016-04-22\n\t * http://hammerjs.github.io/\n\t *\n\t * Copyright (c) 2016 Jorik Tangelder;\n\t * Licensed under the MIT license */\n\t(function (window, document, exportName, undefined) {\n\t    'use strict';\n\t\n\t    var VENDOR_PREFIXES = ['', 'webkit', 'Moz', 'MS', 'ms', 'o'];\n\t    var TEST_ELEMENT = document.createElement('div');\n\t\n\t    var TYPE_FUNCTION = 'function';\n\t\n\t    var round = Math.round;\n\t    var abs = Math.abs;\n\t    var now = Date.now;\n\t\n\t    /**\n\t     * set a timeout with a given scope\n\t     * @param {Function} fn\n\t     * @param {Number} timeout\n\t     * @param {Object} context\n\t     * @returns {number}\n\t     */\n\t    function setTimeoutContext(fn, timeout, context) {\n\t        return setTimeout(bindFn(fn, context), timeout);\n\t    }\n\t\n\t    /**\n\t     * if the argument is an array, we want to execute the fn on each entry\n\t     * if it aint an array we don't want to do a thing.\n\t     * this is used by all the methods that accept a single and array argument.\n\t     * @param {*|Array} arg\n\t     * @param {String} fn\n\t     * @param {Object} [context]\n\t     * @returns {Boolean}\n\t     */\n\t    function invokeArrayArg(arg, fn, context) {\n\t        if (Array.isArray(arg)) {\n\t            each(arg, context[fn], context);\n\t            return true;\n\t        }\n\t        return false;\n\t    }\n\t\n\t    /**\n\t     * walk objects and arrays\n\t     * @param {Object} obj\n\t     * @param {Function} iterator\n\t     * @param {Object} context\n\t     */\n\t    function each(obj, iterator, context) {\n\t        var i;\n\t\n\t        if (!obj) {\n\t            return;\n\t        }\n\t\n\t        if (obj.forEach) {\n\t            obj.forEach(iterator, context);\n\t        } else if (obj.length !== undefined) {\n\t            i = 0;\n\t            while (i < obj.length) {\n\t                iterator.call(context, obj[i], i, obj);\n\t                i++;\n\t            }\n\t        } else {\n\t            for (i in obj) {\n\t                obj.hasOwnProperty(i) && iterator.call(context, obj[i], i, obj);\n\t            }\n\t        }\n\t    }\n\t\n\t    /**\n\t     * wrap a method with a deprecation warning and stack trace\n\t     * @param {Function} method\n\t     * @param {String} name\n\t     * @param {String} message\n\t     * @returns {Function} A new function wrapping the supplied method.\n\t     */\n\t    function deprecate(method, name, message) {\n\t        var deprecationMessage = 'DEPRECATED METHOD: ' + name + '\\n' + message + ' AT \\n';\n\t        return function () {\n\t            var e = new Error('get-stack-trace');\n\t            var stack = e && e.stack ? e.stack.replace(/^[^\\(]+?[\\n$]/gm, '').replace(/^\\s+at\\s+/gm, '').replace(/^Object.<anonymous>\\s*\\(/gm, '{anonymous}()@') : 'Unknown Stack Trace';\n\t\n\t            var log = window.console && (window.console.warn || window.console.log);\n\t            if (log) {\n\t                log.call(window.console, deprecationMessage, stack);\n\t            }\n\t            return method.apply(this, arguments);\n\t        };\n\t    }\n\t\n\t    /**\n\t     * extend object.\n\t     * means that properties in dest will be overwritten by the ones in src.\n\t     * @param {Object} target\n\t     * @param {...Object} objects_to_assign\n\t     * @returns {Object} target\n\t     */\n\t    var assign;\n\t    if (typeof Object.assign !== 'function') {\n\t        assign = function assign(target) {\n\t            if (target === undefined || target === null) {\n\t                throw new TypeError('Cannot convert undefined or null to object');\n\t            }\n\t\n\t            var output = Object(target);\n\t            for (var index = 1; index < arguments.length; index++) {\n\t                var source = arguments[index];\n\t                if (source !== undefined && source !== null) {\n\t                    for (var nextKey in source) {\n\t                        if (source.hasOwnProperty(nextKey)) {\n\t                            output[nextKey] = source[nextKey];\n\t                        }\n\t                    }\n\t                }\n\t            }\n\t            return output;\n\t        };\n\t    } else {\n\t        assign = Object.assign;\n\t    }\n\t\n\t    /**\n\t     * extend object.\n\t     * means that properties in dest will be overwritten by the ones in src.\n\t     * @param {Object} dest\n\t     * @param {Object} src\n\t     * @param {Boolean} [merge=false]\n\t     * @returns {Object} dest\n\t     */\n\t    var extend = deprecate(function extend(dest, src, merge) {\n\t        var keys = Object.keys(src);\n\t        var i = 0;\n\t        while (i < keys.length) {\n\t            if (!merge || merge && dest[keys[i]] === undefined) {\n\t                dest[keys[i]] = src[keys[i]];\n\t            }\n\t            i++;\n\t        }\n\t        return dest;\n\t    }, 'extend', 'Use `assign`.');\n\t\n\t    /**\n\t     * merge the values from src in the dest.\n\t     * means that properties that exist in dest will not be overwritten by src\n\t     * @param {Object} dest\n\t     * @param {Object} src\n\t     * @returns {Object} dest\n\t     */\n\t    var merge = deprecate(function merge(dest, src) {\n\t        return extend(dest, src, true);\n\t    }, 'merge', 'Use `assign`.');\n\t\n\t    /**\n\t     * simple class inheritance\n\t     * @param {Function} child\n\t     * @param {Function} base\n\t     * @param {Object} [properties]\n\t     */\n\t    function inherit(child, base, properties) {\n\t        var baseP = base.prototype,\n\t            childP;\n\t\n\t        childP = child.prototype = Object.create(baseP);\n\t        childP.constructor = child;\n\t        childP._super = baseP;\n\t\n\t        if (properties) {\n\t            assign(childP, properties);\n\t        }\n\t    }\n\t\n\t    /**\n\t     * simple function bind\n\t     * @param {Function} fn\n\t     * @param {Object} context\n\t     * @returns {Function}\n\t     */\n\t    function bindFn(fn, context) {\n\t        return function boundFn() {\n\t            return fn.apply(context, arguments);\n\t        };\n\t    }\n\t\n\t    /**\n\t     * let a boolean value also be a function that must return a boolean\n\t     * this first item in args will be used as the context\n\t     * @param {Boolean|Function} val\n\t     * @param {Array} [args]\n\t     * @returns {Boolean}\n\t     */\n\t    function boolOrFn(val, args) {\n\t        if ((typeof val === 'undefined' ? 'undefined' : _typeof(val)) == TYPE_FUNCTION) {\n\t            return val.apply(args ? args[0] || undefined : undefined, args);\n\t        }\n\t        return val;\n\t    }\n\t\n\t    /**\n\t     * use the val2 when val1 is undefined\n\t     * @param {*} val1\n\t     * @param {*} val2\n\t     * @returns {*}\n\t     */\n\t    function ifUndefined(val1, val2) {\n\t        return val1 === undefined ? val2 : val1;\n\t    }\n\t\n\t    /**\n\t     * addEventListener with multiple events at once\n\t     * @param {EventTarget} target\n\t     * @param {String} types\n\t     * @param {Function} handler\n\t     */\n\t    function addEventListeners(target, types, handler) {\n\t        each(splitStr(types), function (type) {\n\t            target.addEventListener(type, handler, false);\n\t        });\n\t    }\n\t\n\t    /**\n\t     * removeEventListener with multiple events at once\n\t     * @param {EventTarget} target\n\t     * @param {String} types\n\t     * @param {Function} handler\n\t     */\n\t    function removeEventListeners(target, types, handler) {\n\t        each(splitStr(types), function (type) {\n\t            target.removeEventListener(type, handler, false);\n\t        });\n\t    }\n\t\n\t    /**\n\t     * find if a node is in the given parent\n\t     * @method hasParent\n\t     * @param {HTMLElement} node\n\t     * @param {HTMLElement} parent\n\t     * @return {Boolean} found\n\t     */\n\t    function hasParent(node, parent) {\n\t        while (node) {\n\t            if (node == parent) {\n\t                return true;\n\t            }\n\t            node = node.parentNode;\n\t        }\n\t        return false;\n\t    }\n\t\n\t    /**\n\t     * small indexOf wrapper\n\t     * @param {String} str\n\t     * @param {String} find\n\t     * @returns {Boolean} found\n\t     */\n\t    function inStr(str, find) {\n\t        return str.indexOf(find) > -1;\n\t    }\n\t\n\t    /**\n\t     * split string on whitespace\n\t     * @param {String} str\n\t     * @returns {Array} words\n\t     */\n\t    function splitStr(str) {\n\t        return str.trim().split(/\\s+/g);\n\t    }\n\t\n\t    /**\n\t     * find if a array contains the object using indexOf or a simple polyFill\n\t     * @param {Array} src\n\t     * @param {String} find\n\t     * @param {String} [findByKey]\n\t     * @return {Boolean|Number} false when not found, or the index\n\t     */\n\t    function inArray(src, find, findByKey) {\n\t        if (src.indexOf && !findByKey) {\n\t            return src.indexOf(find);\n\t        } else {\n\t            var i = 0;\n\t            while (i < src.length) {\n\t                if (findByKey && src[i][findByKey] == find || !findByKey && src[i] === find) {\n\t                    return i;\n\t                }\n\t                i++;\n\t            }\n\t            return -1;\n\t        }\n\t    }\n\t\n\t    /**\n\t     * convert array-like objects to real arrays\n\t     * @param {Object} obj\n\t     * @returns {Array}\n\t     */\n\t    function toArray(obj) {\n\t        return Array.prototype.slice.call(obj, 0);\n\t    }\n\t\n\t    /**\n\t     * unique array with objects based on a key (like 'id') or just by the array's value\n\t     * @param {Array} src [{id:1},{id:2},{id:1}]\n\t     * @param {String} [key]\n\t     * @param {Boolean} [sort=False]\n\t     * @returns {Array} [{id:1},{id:2}]\n\t     */\n\t    function uniqueArray(src, key, sort) {\n\t        var results = [];\n\t        var values = [];\n\t        var i = 0;\n\t\n\t        while (i < src.length) {\n\t            var val = key ? src[i][key] : src[i];\n\t            if (inArray(values, val) < 0) {\n\t                results.push(src[i]);\n\t            }\n\t            values[i] = val;\n\t            i++;\n\t        }\n\t\n\t        if (sort) {\n\t            if (!key) {\n\t                results = results.sort();\n\t            } else {\n\t                results = results.sort(function sortUniqueArray(a, b) {\n\t                    return a[key] > b[key];\n\t                });\n\t            }\n\t        }\n\t\n\t        return results;\n\t    }\n\t\n\t    /**\n\t     * get the prefixed property\n\t     * @param {Object} obj\n\t     * @param {String} property\n\t     * @returns {String|Undefined} prefixed\n\t     */\n\t    function prefixed(obj, property) {\n\t        var prefix, prop;\n\t        var camelProp = property[0].toUpperCase() + property.slice(1);\n\t\n\t        var i = 0;\n\t        while (i < VENDOR_PREFIXES.length) {\n\t            prefix = VENDOR_PREFIXES[i];\n\t            prop = prefix ? prefix + camelProp : property;\n\t\n\t            if (prop in obj) {\n\t                return prop;\n\t            }\n\t            i++;\n\t        }\n\t        return undefined;\n\t    }\n\t\n\t    /**\n\t     * get a unique id\n\t     * @returns {number} uniqueId\n\t     */\n\t    var _uniqueId = 1;\n\t    function uniqueId() {\n\t        return _uniqueId++;\n\t    }\n\t\n\t    /**\n\t     * get the window object of an element\n\t     * @param {HTMLElement} element\n\t     * @returns {DocumentView|Window}\n\t     */\n\t    function getWindowForElement(element) {\n\t        var doc = element.ownerDocument || element;\n\t        return doc.defaultView || doc.parentWindow || window;\n\t    }\n\t\n\t    var MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;\n\t\n\t    var SUPPORT_TOUCH = 'ontouchstart' in window;\n\t    var SUPPORT_POINTER_EVENTS = prefixed(window, 'PointerEvent') !== undefined;\n\t    var SUPPORT_ONLY_TOUCH = SUPPORT_TOUCH && MOBILE_REGEX.test(navigator.userAgent);\n\t\n\t    var INPUT_TYPE_TOUCH = 'touch';\n\t    var INPUT_TYPE_PEN = 'pen';\n\t    var INPUT_TYPE_MOUSE = 'mouse';\n\t    var INPUT_TYPE_KINECT = 'kinect';\n\t\n\t    var COMPUTE_INTERVAL = 25;\n\t\n\t    var INPUT_START = 1;\n\t    var INPUT_MOVE = 2;\n\t    var INPUT_END = 4;\n\t    var INPUT_CANCEL = 8;\n\t\n\t    var DIRECTION_NONE = 1;\n\t    var DIRECTION_LEFT = 2;\n\t    var DIRECTION_RIGHT = 4;\n\t    var DIRECTION_UP = 8;\n\t    var DIRECTION_DOWN = 16;\n\t\n\t    var DIRECTION_HORIZONTAL = DIRECTION_LEFT | DIRECTION_RIGHT;\n\t    var DIRECTION_VERTICAL = DIRECTION_UP | DIRECTION_DOWN;\n\t    var DIRECTION_ALL = DIRECTION_HORIZONTAL | DIRECTION_VERTICAL;\n\t\n\t    var PROPS_XY = ['x', 'y'];\n\t    var PROPS_CLIENT_XY = ['clientX', 'clientY'];\n\t\n\t    /**\n\t     * create new input type manager\n\t     * @param {Manager} manager\n\t     * @param {Function} callback\n\t     * @returns {Input}\n\t     * @constructor\n\t     */\n\t    function Input(manager, callback) {\n\t        var self = this;\n\t        this.manager = manager;\n\t        this.callback = callback;\n\t        this.element = manager.element;\n\t        this.target = manager.options.inputTarget;\n\t\n\t        // smaller wrapper around the handler, for the scope and the enabled state of the manager,\n\t        // so when disabled the input events are completely bypassed.\n\t        this.domHandler = function (ev) {\n\t            if (boolOrFn(manager.options.enable, [manager])) {\n\t                self.handler(ev);\n\t            }\n\t        };\n\t\n\t        this.init();\n\t    }\n\t\n\t    Input.prototype = {\n\t        /**\n\t         * should handle the inputEvent data and trigger the callback\n\t         * @virtual\n\t         */\n\t        handler: function handler() {},\n\t\n\t        /**\n\t         * bind the events\n\t         */\n\t        init: function init() {\n\t            this.evEl && addEventListeners(this.element, this.evEl, this.domHandler);\n\t            this.evTarget && addEventListeners(this.target, this.evTarget, this.domHandler);\n\t            this.evWin && addEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\n\t        },\n\t\n\t        /**\n\t         * unbind the events\n\t         */\n\t        destroy: function destroy() {\n\t            this.evEl && removeEventListeners(this.element, this.evEl, this.domHandler);\n\t            this.evTarget && removeEventListeners(this.target, this.evTarget, this.domHandler);\n\t            this.evWin && removeEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\n\t        }\n\t    };\n\t\n\t    /**\n\t     * create new input type manager\n\t     * called by the Manager constructor\n\t     * @param {Hammer} manager\n\t     * @returns {Input}\n\t     */\n\t    function createInputInstance(manager) {\n\t        var Type;\n\t        var inputClass = manager.options.inputClass;\n\t\n\t        if (inputClass) {\n\t            Type = inputClass;\n\t        } else if (SUPPORT_POINTER_EVENTS) {\n\t            Type = PointerEventInput;\n\t        } else if (SUPPORT_ONLY_TOUCH) {\n\t            Type = TouchInput;\n\t        } else if (!SUPPORT_TOUCH) {\n\t            Type = MouseInput;\n\t        } else {\n\t            Type = TouchMouseInput;\n\t        }\n\t        return new Type(manager, inputHandler);\n\t    }\n\t\n\t    /**\n\t     * handle input events\n\t     * @param {Manager} manager\n\t     * @param {String} eventType\n\t     * @param {Object} input\n\t     */\n\t    function inputHandler(manager, eventType, input) {\n\t        var pointersLen = input.pointers.length;\n\t        var changedPointersLen = input.changedPointers.length;\n\t        var isFirst = eventType & INPUT_START && pointersLen - changedPointersLen === 0;\n\t        var isFinal = eventType & (INPUT_END | INPUT_CANCEL) && pointersLen - changedPointersLen === 0;\n\t\n\t        input.isFirst = !!isFirst;\n\t        input.isFinal = !!isFinal;\n\t\n\t        if (isFirst) {\n\t            manager.session = {};\n\t        }\n\t\n\t        // source event is the normalized value of the domEvents\n\t        // like 'touchstart, mouseup, pointerdown'\n\t        input.eventType = eventType;\n\t\n\t        // compute scale, rotation etc\n\t        computeInputData(manager, input);\n\t\n\t        // emit secret event\n\t        manager.emit('hammer.input', input);\n\t\n\t        manager.recognize(input);\n\t        manager.session.prevInput = input;\n\t    }\n\t\n\t    /**\n\t     * extend the data with some usable properties like scale, rotate, velocity etc\n\t     * @param {Object} manager\n\t     * @param {Object} input\n\t     */\n\t    function computeInputData(manager, input) {\n\t        var session = manager.session;\n\t        var pointers = input.pointers;\n\t        var pointersLength = pointers.length;\n\t\n\t        // store the first input to calculate the distance and direction\n\t        if (!session.firstInput) {\n\t            session.firstInput = simpleCloneInputData(input);\n\t        }\n\t\n\t        // to compute scale and rotation we need to store the multiple touches\n\t        if (pointersLength > 1 && !session.firstMultiple) {\n\t            session.firstMultiple = simpleCloneInputData(input);\n\t        } else if (pointersLength === 1) {\n\t            session.firstMultiple = false;\n\t        }\n\t\n\t        var firstInput = session.firstInput;\n\t        var firstMultiple = session.firstMultiple;\n\t        var offsetCenter = firstMultiple ? firstMultiple.center : firstInput.center;\n\t\n\t        var center = input.center = getCenter(pointers);\n\t        input.timeStamp = now();\n\t        input.deltaTime = input.timeStamp - firstInput.timeStamp;\n\t\n\t        input.angle = getAngle(offsetCenter, center);\n\t        input.distance = getDistance(offsetCenter, center);\n\t\n\t        computeDeltaXY(session, input);\n\t        input.offsetDirection = getDirection(input.deltaX, input.deltaY);\n\t\n\t        var overallVelocity = getVelocity(input.deltaTime, input.deltaX, input.deltaY);\n\t        input.overallVelocityX = overallVelocity.x;\n\t        input.overallVelocityY = overallVelocity.y;\n\t        input.overallVelocity = abs(overallVelocity.x) > abs(overallVelocity.y) ? overallVelocity.x : overallVelocity.y;\n\t\n\t        input.scale = firstMultiple ? getScale(firstMultiple.pointers, pointers) : 1;\n\t        input.rotation = firstMultiple ? getRotation(firstMultiple.pointers, pointers) : 0;\n\t\n\t        input.maxPointers = !session.prevInput ? input.pointers.length : input.pointers.length > session.prevInput.maxPointers ? input.pointers.length : session.prevInput.maxPointers;\n\t\n\t        computeIntervalInputData(session, input);\n\t\n\t        // find the correct target\n\t        var target = manager.element;\n\t        if (hasParent(input.srcEvent.target, target)) {\n\t            target = input.srcEvent.target;\n\t        }\n\t        input.target = target;\n\t    }\n\t\n\t    function computeDeltaXY(session, input) {\n\t        var center = input.center;\n\t        var offset = session.offsetDelta || {};\n\t        var prevDelta = session.prevDelta || {};\n\t        var prevInput = session.prevInput || {};\n\t\n\t        if (input.eventType === INPUT_START || prevInput.eventType === INPUT_END) {\n\t            prevDelta = session.prevDelta = {\n\t                x: prevInput.deltaX || 0,\n\t                y: prevInput.deltaY || 0\n\t            };\n\t\n\t            offset = session.offsetDelta = {\n\t                x: center.x,\n\t                y: center.y\n\t            };\n\t        }\n\t\n\t        input.deltaX = prevDelta.x + (center.x - offset.x);\n\t        input.deltaY = prevDelta.y + (center.y - offset.y);\n\t    }\n\t\n\t    /**\n\t     * velocity is calculated every x ms\n\t     * @param {Object} session\n\t     * @param {Object} input\n\t     */\n\t    function computeIntervalInputData(session, input) {\n\t        var last = session.lastInterval || input,\n\t            deltaTime = input.timeStamp - last.timeStamp,\n\t            velocity,\n\t            velocityX,\n\t            velocityY,\n\t            direction;\n\t\n\t        if (input.eventType != INPUT_CANCEL && (deltaTime > COMPUTE_INTERVAL || last.velocity === undefined)) {\n\t            var deltaX = input.deltaX - last.deltaX;\n\t            var deltaY = input.deltaY - last.deltaY;\n\t\n\t            var v = getVelocity(deltaTime, deltaX, deltaY);\n\t            velocityX = v.x;\n\t            velocityY = v.y;\n\t            velocity = abs(v.x) > abs(v.y) ? v.x : v.y;\n\t            direction = getDirection(deltaX, deltaY);\n\t\n\t            session.lastInterval = input;\n\t        } else {\n\t            // use latest velocity info if it doesn't overtake a minimum period\n\t            velocity = last.velocity;\n\t            velocityX = last.velocityX;\n\t            velocityY = last.velocityY;\n\t            direction = last.direction;\n\t        }\n\t\n\t        input.velocity = velocity;\n\t        input.velocityX = velocityX;\n\t        input.velocityY = velocityY;\n\t        input.direction = direction;\n\t    }\n\t\n\t    /**\n\t     * create a simple clone from the input used for storage of firstInput and firstMultiple\n\t     * @param {Object} input\n\t     * @returns {Object} clonedInputData\n\t     */\n\t    function simpleCloneInputData(input) {\n\t        // make a simple copy of the pointers because we will get a reference if we don't\n\t        // we only need clientXY for the calculations\n\t        var pointers = [];\n\t        var i = 0;\n\t        while (i < input.pointers.length) {\n\t            pointers[i] = {\n\t                clientX: round(input.pointers[i].clientX),\n\t                clientY: round(input.pointers[i].clientY)\n\t            };\n\t            i++;\n\t        }\n\t\n\t        return {\n\t            timeStamp: now(),\n\t            pointers: pointers,\n\t            center: getCenter(pointers),\n\t            deltaX: input.deltaX,\n\t            deltaY: input.deltaY\n\t        };\n\t    }\n\t\n\t    /**\n\t     * get the center of all the pointers\n\t     * @param {Array} pointers\n\t     * @return {Object} center contains `x` and `y` properties\n\t     */\n\t    function getCenter(pointers) {\n\t        var pointersLength = pointers.length;\n\t\n\t        // no need to loop when only one touch\n\t        if (pointersLength === 1) {\n\t            return {\n\t                x: round(pointers[0].clientX),\n\t                y: round(pointers[0].clientY)\n\t            };\n\t        }\n\t\n\t        var x = 0,\n\t            y = 0,\n\t            i = 0;\n\t        while (i < pointersLength) {\n\t            x += pointers[i].clientX;\n\t            y += pointers[i].clientY;\n\t            i++;\n\t        }\n\t\n\t        return {\n\t            x: round(x / pointersLength),\n\t            y: round(y / pointersLength)\n\t        };\n\t    }\n\t\n\t    /**\n\t     * calculate the velocity between two points. unit is in px per ms.\n\t     * @param {Number} deltaTime\n\t     * @param {Number} x\n\t     * @param {Number} y\n\t     * @return {Object} velocity `x` and `y`\n\t     */\n\t    function getVelocity(deltaTime, x, y) {\n\t        return {\n\t            x: x / deltaTime || 0,\n\t            y: y / deltaTime || 0\n\t        };\n\t    }\n\t\n\t    /**\n\t     * get the direction between two points\n\t     * @param {Number} x\n\t     * @param {Number} y\n\t     * @return {Number} direction\n\t     */\n\t    function getDirection(x, y) {\n\t        if (x === y) {\n\t            return DIRECTION_NONE;\n\t        }\n\t\n\t        if (abs(x) >= abs(y)) {\n\t            return x < 0 ? DIRECTION_LEFT : DIRECTION_RIGHT;\n\t        }\n\t        return y < 0 ? DIRECTION_UP : DIRECTION_DOWN;\n\t    }\n\t\n\t    /**\n\t     * calculate the absolute distance between two points\n\t     * @param {Object} p1 {x, y}\n\t     * @param {Object} p2 {x, y}\n\t     * @param {Array} [props] containing x and y keys\n\t     * @return {Number} distance\n\t     */\n\t    function getDistance(p1, p2, props) {\n\t        if (!props) {\n\t            props = PROPS_XY;\n\t        }\n\t        var x = p2[props[0]] - p1[props[0]],\n\t            y = p2[props[1]] - p1[props[1]];\n\t\n\t        return Math.sqrt(x * x + y * y);\n\t    }\n\t\n\t    /**\n\t     * calculate the angle between two coordinates\n\t     * @param {Object} p1\n\t     * @param {Object} p2\n\t     * @param {Array} [props] containing x and y keys\n\t     * @return {Number} angle\n\t     */\n\t    function getAngle(p1, p2, props) {\n\t        if (!props) {\n\t            props = PROPS_XY;\n\t        }\n\t        var x = p2[props[0]] - p1[props[0]],\n\t            y = p2[props[1]] - p1[props[1]];\n\t        return Math.atan2(y, x) * 180 / Math.PI;\n\t    }\n\t\n\t    /**\n\t     * calculate the rotation degrees between two pointersets\n\t     * @param {Array} start array of pointers\n\t     * @param {Array} end array of pointers\n\t     * @return {Number} rotation\n\t     */\n\t    function getRotation(start, end) {\n\t        return getAngle(end[1], end[0], PROPS_CLIENT_XY) + getAngle(start[1], start[0], PROPS_CLIENT_XY);\n\t    }\n\t\n\t    /**\n\t     * calculate the scale factor between two pointersets\n\t     * no scale is 1, and goes down to 0 when pinched together, and bigger when pinched out\n\t     * @param {Array} start array of pointers\n\t     * @param {Array} end array of pointers\n\t     * @return {Number} scale\n\t     */\n\t    function getScale(start, end) {\n\t        return getDistance(end[0], end[1], PROPS_CLIENT_XY) / getDistance(start[0], start[1], PROPS_CLIENT_XY);\n\t    }\n\t\n\t    var MOUSE_INPUT_MAP = {\n\t        mousedown: INPUT_START,\n\t        mousemove: INPUT_MOVE,\n\t        mouseup: INPUT_END\n\t    };\n\t\n\t    var MOUSE_ELEMENT_EVENTS = 'mousedown';\n\t    var MOUSE_WINDOW_EVENTS = 'mousemove mouseup';\n\t\n\t    /**\n\t     * Mouse events input\n\t     * @constructor\n\t     * @extends Input\n\t     */\n\t    function MouseInput() {\n\t        this.evEl = MOUSE_ELEMENT_EVENTS;\n\t        this.evWin = MOUSE_WINDOW_EVENTS;\n\t\n\t        this.pressed = false; // mousedown state\n\t\n\t        Input.apply(this, arguments);\n\t    }\n\t\n\t    inherit(MouseInput, Input, {\n\t        /**\n\t         * handle mouse events\n\t         * @param {Object} ev\n\t         */\n\t        handler: function MEhandler(ev) {\n\t            var eventType = MOUSE_INPUT_MAP[ev.type];\n\t\n\t            // on start we want to have the left mouse button down\n\t            if (eventType & INPUT_START && ev.button === 0) {\n\t                this.pressed = true;\n\t            }\n\t\n\t            if (eventType & INPUT_MOVE && ev.which !== 1) {\n\t                eventType = INPUT_END;\n\t            }\n\t\n\t            // mouse must be down\n\t            if (!this.pressed) {\n\t                return;\n\t            }\n\t\n\t            if (eventType & INPUT_END) {\n\t                this.pressed = false;\n\t            }\n\t\n\t            this.callback(this.manager, eventType, {\n\t                pointers: [ev],\n\t                changedPointers: [ev],\n\t                pointerType: INPUT_TYPE_MOUSE,\n\t                srcEvent: ev\n\t            });\n\t        }\n\t    });\n\t\n\t    var POINTER_INPUT_MAP = {\n\t        pointerdown: INPUT_START,\n\t        pointermove: INPUT_MOVE,\n\t        pointerup: INPUT_END,\n\t        pointercancel: INPUT_CANCEL,\n\t        pointerout: INPUT_CANCEL\n\t    };\n\t\n\t    // in IE10 the pointer types is defined as an enum\n\t    var IE10_POINTER_TYPE_ENUM = {\n\t        2: INPUT_TYPE_TOUCH,\n\t        3: INPUT_TYPE_PEN,\n\t        4: INPUT_TYPE_MOUSE,\n\t        5: INPUT_TYPE_KINECT // see https://twitter.com/jacobrossi/status/480596438489890816\n\t    };\n\t\n\t    var POINTER_ELEMENT_EVENTS = 'pointerdown';\n\t    var POINTER_WINDOW_EVENTS = 'pointermove pointerup pointercancel';\n\t\n\t    // IE10 has prefixed support, and case-sensitive\n\t    if (window.MSPointerEvent && !window.PointerEvent) {\n\t        POINTER_ELEMENT_EVENTS = 'MSPointerDown';\n\t        POINTER_WINDOW_EVENTS = 'MSPointerMove MSPointerUp MSPointerCancel';\n\t    }\n\t\n\t    /**\n\t     * Pointer events input\n\t     * @constructor\n\t     * @extends Input\n\t     */\n\t    function PointerEventInput() {\n\t        this.evEl = POINTER_ELEMENT_EVENTS;\n\t        this.evWin = POINTER_WINDOW_EVENTS;\n\t\n\t        Input.apply(this, arguments);\n\t\n\t        this.store = this.manager.session.pointerEvents = [];\n\t    }\n\t\n\t    inherit(PointerEventInput, Input, {\n\t        /**\n\t         * handle mouse events\n\t         * @param {Object} ev\n\t         */\n\t        handler: function PEhandler(ev) {\n\t            var store = this.store;\n\t            var removePointer = false;\n\t\n\t            var eventTypeNormalized = ev.type.toLowerCase().replace('ms', '');\n\t            var eventType = POINTER_INPUT_MAP[eventTypeNormalized];\n\t            var pointerType = IE10_POINTER_TYPE_ENUM[ev.pointerType] || ev.pointerType;\n\t\n\t            var isTouch = pointerType == INPUT_TYPE_TOUCH;\n\t\n\t            // get index of the event in the store\n\t            var storeIndex = inArray(store, ev.pointerId, 'pointerId');\n\t\n\t            // start and mouse must be down\n\t            if (eventType & INPUT_START && (ev.button === 0 || isTouch)) {\n\t                if (storeIndex < 0) {\n\t                    store.push(ev);\n\t                    storeIndex = store.length - 1;\n\t                }\n\t            } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\n\t                removePointer = true;\n\t            }\n\t\n\t            // it not found, so the pointer hasn't been down (so it's probably a hover)\n\t            if (storeIndex < 0) {\n\t                return;\n\t            }\n\t\n\t            // update the event in the store\n\t            store[storeIndex] = ev;\n\t\n\t            this.callback(this.manager, eventType, {\n\t                pointers: store,\n\t                changedPointers: [ev],\n\t                pointerType: pointerType,\n\t                srcEvent: ev\n\t            });\n\t\n\t            if (removePointer) {\n\t                // remove from the store\n\t                store.splice(storeIndex, 1);\n\t            }\n\t        }\n\t    });\n\t\n\t    var SINGLE_TOUCH_INPUT_MAP = {\n\t        touchstart: INPUT_START,\n\t        touchmove: INPUT_MOVE,\n\t        touchend: INPUT_END,\n\t        touchcancel: INPUT_CANCEL\n\t    };\n\t\n\t    var SINGLE_TOUCH_TARGET_EVENTS = 'touchstart';\n\t    var SINGLE_TOUCH_WINDOW_EVENTS = 'touchstart touchmove touchend touchcancel';\n\t\n\t    /**\n\t     * Touch events input\n\t     * @constructor\n\t     * @extends Input\n\t     */\n\t    function SingleTouchInput() {\n\t        this.evTarget = SINGLE_TOUCH_TARGET_EVENTS;\n\t        this.evWin = SINGLE_TOUCH_WINDOW_EVENTS;\n\t        this.started = false;\n\t\n\t        Input.apply(this, arguments);\n\t    }\n\t\n\t    inherit(SingleTouchInput, Input, {\n\t        handler: function TEhandler(ev) {\n\t            var type = SINGLE_TOUCH_INPUT_MAP[ev.type];\n\t\n\t            // should we handle the touch events?\n\t            if (type === INPUT_START) {\n\t                this.started = true;\n\t            }\n\t\n\t            if (!this.started) {\n\t                return;\n\t            }\n\t\n\t            var touches = normalizeSingleTouches.call(this, ev, type);\n\t\n\t            // when done, reset the started state\n\t            if (type & (INPUT_END | INPUT_CANCEL) && touches[0].length - touches[1].length === 0) {\n\t                this.started = false;\n\t            }\n\t\n\t            this.callback(this.manager, type, {\n\t                pointers: touches[0],\n\t                changedPointers: touches[1],\n\t                pointerType: INPUT_TYPE_TOUCH,\n\t                srcEvent: ev\n\t            });\n\t        }\n\t    });\n\t\n\t    /**\n\t     * @this {TouchInput}\n\t     * @param {Object} ev\n\t     * @param {Number} type flag\n\t     * @returns {undefined|Array} [all, changed]\n\t     */\n\t    function normalizeSingleTouches(ev, type) {\n\t        var all = toArray(ev.touches);\n\t        var changed = toArray(ev.changedTouches);\n\t\n\t        if (type & (INPUT_END | INPUT_CANCEL)) {\n\t            all = uniqueArray(all.concat(changed), 'identifier', true);\n\t        }\n\t\n\t        return [all, changed];\n\t    }\n\t\n\t    var TOUCH_INPUT_MAP = {\n\t        touchstart: INPUT_START,\n\t        touchmove: INPUT_MOVE,\n\t        touchend: INPUT_END,\n\t        touchcancel: INPUT_CANCEL\n\t    };\n\t\n\t    var TOUCH_TARGET_EVENTS = 'touchstart touchmove touchend touchcancel';\n\t\n\t    /**\n\t     * Multi-user touch events input\n\t     * @constructor\n\t     * @extends Input\n\t     */\n\t    function TouchInput() {\n\t        this.evTarget = TOUCH_TARGET_EVENTS;\n\t        this.targetIds = {};\n\t\n\t        Input.apply(this, arguments);\n\t    }\n\t\n\t    inherit(TouchInput, Input, {\n\t        handler: function MTEhandler(ev) {\n\t            var type = TOUCH_INPUT_MAP[ev.type];\n\t            var touches = getTouches.call(this, ev, type);\n\t            if (!touches) {\n\t                return;\n\t            }\n\t\n\t            this.callback(this.manager, type, {\n\t                pointers: touches[0],\n\t                changedPointers: touches[1],\n\t                pointerType: INPUT_TYPE_TOUCH,\n\t                srcEvent: ev\n\t            });\n\t        }\n\t    });\n\t\n\t    /**\n\t     * @this {TouchInput}\n\t     * @param {Object} ev\n\t     * @param {Number} type flag\n\t     * @returns {undefined|Array} [all, changed]\n\t     */\n\t    function getTouches(ev, type) {\n\t        var allTouches = toArray(ev.touches);\n\t        var targetIds = this.targetIds;\n\t\n\t        // when there is only one touch, the process can be simplified\n\t        if (type & (INPUT_START | INPUT_MOVE) && allTouches.length === 1) {\n\t            targetIds[allTouches[0].identifier] = true;\n\t            return [allTouches, allTouches];\n\t        }\n\t\n\t        var i,\n\t            targetTouches,\n\t            changedTouches = toArray(ev.changedTouches),\n\t            changedTargetTouches = [],\n\t            target = this.target;\n\t\n\t        // get target touches from touches\n\t        targetTouches = allTouches.filter(function (touch) {\n\t            return hasParent(touch.target, target);\n\t        });\n\t\n\t        // collect touches\n\t        if (type === INPUT_START) {\n\t            i = 0;\n\t            while (i < targetTouches.length) {\n\t                targetIds[targetTouches[i].identifier] = true;\n\t                i++;\n\t            }\n\t        }\n\t\n\t        // filter changed touches to only contain touches that exist in the collected target ids\n\t        i = 0;\n\t        while (i < changedTouches.length) {\n\t            if (targetIds[changedTouches[i].identifier]) {\n\t                changedTargetTouches.push(changedTouches[i]);\n\t            }\n\t\n\t            // cleanup removed touches\n\t            if (type & (INPUT_END | INPUT_CANCEL)) {\n\t                delete targetIds[changedTouches[i].identifier];\n\t            }\n\t            i++;\n\t        }\n\t\n\t        if (!changedTargetTouches.length) {\n\t            return;\n\t        }\n\t\n\t        return [\n\t        // merge targetTouches with changedTargetTouches so it contains ALL touches, including 'end' and 'cancel'\n\t        uniqueArray(targetTouches.concat(changedTargetTouches), 'identifier', true), changedTargetTouches];\n\t    }\n\t\n\t    /**\n\t     * Combined touch and mouse input\n\t     *\n\t     * Touch has a higher priority then mouse, and while touching no mouse events are allowed.\n\t     * This because touch devices also emit mouse events while doing a touch.\n\t     *\n\t     * @constructor\n\t     * @extends Input\n\t     */\n\t\n\t    var DEDUP_TIMEOUT = 2500;\n\t    var DEDUP_DISTANCE = 25;\n\t\n\t    function TouchMouseInput() {\n\t        Input.apply(this, arguments);\n\t\n\t        var handler = bindFn(this.handler, this);\n\t        this.touch = new TouchInput(this.manager, handler);\n\t        this.mouse = new MouseInput(this.manager, handler);\n\t\n\t        this.primaryTouch = null;\n\t        this.lastTouches = [];\n\t    }\n\t\n\t    inherit(TouchMouseInput, Input, {\n\t        /**\n\t         * handle mouse and touch events\n\t         * @param {Hammer} manager\n\t         * @param {String} inputEvent\n\t         * @param {Object} inputData\n\t         */\n\t        handler: function TMEhandler(manager, inputEvent, inputData) {\n\t            var isTouch = inputData.pointerType == INPUT_TYPE_TOUCH,\n\t                isMouse = inputData.pointerType == INPUT_TYPE_MOUSE;\n\t\n\t            if (isMouse && inputData.sourceCapabilities && inputData.sourceCapabilities.firesTouchEvents) {\n\t                return;\n\t            }\n\t\n\t            // when we're in a touch event, record touches to  de-dupe synthetic mouse event\n\t            if (isTouch) {\n\t                recordTouches.call(this, inputEvent, inputData);\n\t            } else if (isMouse && isSyntheticEvent.call(this, inputData)) {\n\t                return;\n\t            }\n\t\n\t            this.callback(manager, inputEvent, inputData);\n\t        },\n\t\n\t        /**\n\t         * remove the event listeners\n\t         */\n\t        destroy: function destroy() {\n\t            this.touch.destroy();\n\t            this.mouse.destroy();\n\t        }\n\t    });\n\t\n\t    function recordTouches(eventType, eventData) {\n\t        if (eventType & INPUT_START) {\n\t            this.primaryTouch = eventData.changedPointers[0].identifier;\n\t            setLastTouch.call(this, eventData);\n\t        } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\n\t            setLastTouch.call(this, eventData);\n\t        }\n\t    }\n\t\n\t    function setLastTouch(eventData) {\n\t        var touch = eventData.changedPointers[0];\n\t\n\t        if (touch.identifier === this.primaryTouch) {\n\t            var lastTouch = { x: touch.clientX, y: touch.clientY };\n\t            this.lastTouches.push(lastTouch);\n\t            var lts = this.lastTouches;\n\t            var removeLastTouch = function removeLastTouch() {\n\t                var i = lts.indexOf(lastTouch);\n\t                if (i > -1) {\n\t                    lts.splice(i, 1);\n\t                }\n\t            };\n\t            setTimeout(removeLastTouch, DEDUP_TIMEOUT);\n\t        }\n\t    }\n\t\n\t    function isSyntheticEvent(eventData) {\n\t        var x = eventData.srcEvent.clientX,\n\t            y = eventData.srcEvent.clientY;\n\t        for (var i = 0; i < this.lastTouches.length; i++) {\n\t            var t = this.lastTouches[i];\n\t            var dx = Math.abs(x - t.x),\n\t                dy = Math.abs(y - t.y);\n\t            if (dx <= DEDUP_DISTANCE && dy <= DEDUP_DISTANCE) {\n\t                return true;\n\t            }\n\t        }\n\t        return false;\n\t    }\n\t\n\t    var PREFIXED_TOUCH_ACTION = prefixed(TEST_ELEMENT.style, 'touchAction');\n\t    var NATIVE_TOUCH_ACTION = PREFIXED_TOUCH_ACTION !== undefined;\n\t\n\t    // magical touchAction value\n\t    var TOUCH_ACTION_COMPUTE = 'compute';\n\t    var TOUCH_ACTION_AUTO = 'auto';\n\t    var TOUCH_ACTION_MANIPULATION = 'manipulation'; // not implemented\n\t    var TOUCH_ACTION_NONE = 'none';\n\t    var TOUCH_ACTION_PAN_X = 'pan-x';\n\t    var TOUCH_ACTION_PAN_Y = 'pan-y';\n\t    var TOUCH_ACTION_MAP = getTouchActionProps();\n\t\n\t    /**\n\t     * Touch Action\n\t     * sets the touchAction property or uses the js alternative\n\t     * @param {Manager} manager\n\t     * @param {String} value\n\t     * @constructor\n\t     */\n\t    function TouchAction(manager, value) {\n\t        this.manager = manager;\n\t        this.set(value);\n\t    }\n\t\n\t    TouchAction.prototype = {\n\t        /**\n\t         * set the touchAction value on the element or enable the polyfill\n\t         * @param {String} value\n\t         */\n\t        set: function set(value) {\n\t            // find out the touch-action by the event handlers\n\t            if (value == TOUCH_ACTION_COMPUTE) {\n\t                value = this.compute();\n\t            }\n\t\n\t            if (NATIVE_TOUCH_ACTION && this.manager.element.style && TOUCH_ACTION_MAP[value]) {\n\t                this.manager.element.style[PREFIXED_TOUCH_ACTION] = value;\n\t            }\n\t            this.actions = value.toLowerCase().trim();\n\t        },\n\t\n\t        /**\n\t         * just re-set the touchAction value\n\t         */\n\t        update: function update() {\n\t            this.set(this.manager.options.touchAction);\n\t        },\n\t\n\t        /**\n\t         * compute the value for the touchAction property based on the recognizer's settings\n\t         * @returns {String} value\n\t         */\n\t        compute: function compute() {\n\t            var actions = [];\n\t            each(this.manager.recognizers, function (recognizer) {\n\t                if (boolOrFn(recognizer.options.enable, [recognizer])) {\n\t                    actions = actions.concat(recognizer.getTouchAction());\n\t                }\n\t            });\n\t            return cleanTouchActions(actions.join(' '));\n\t        },\n\t\n\t        /**\n\t         * this method is called on each input cycle and provides the preventing of the browser behavior\n\t         * @param {Object} input\n\t         */\n\t        preventDefaults: function preventDefaults(input) {\n\t            var srcEvent = input.srcEvent;\n\t            var direction = input.offsetDirection;\n\t\n\t            // if the touch action did prevented once this session\n\t            if (this.manager.session.prevented) {\n\t                srcEvent.preventDefault();\n\t                return;\n\t            }\n\t\n\t            var actions = this.actions;\n\t            var hasNone = inStr(actions, TOUCH_ACTION_NONE) && !TOUCH_ACTION_MAP[TOUCH_ACTION_NONE];\n\t            var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y];\n\t            var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];\n\t\n\t            if (hasNone) {\n\t                //do not prevent defaults if this is a tap gesture\n\t\n\t                var isTapPointer = input.pointers.length === 1;\n\t                var isTapMovement = input.distance < 2;\n\t                var isTapTouchTime = input.deltaTime < 250;\n\t\n\t                if (isTapPointer && isTapMovement && isTapTouchTime) {\n\t                    return;\n\t                }\n\t            }\n\t\n\t            if (hasPanX && hasPanY) {\n\t                // `pan-x pan-y` means browser handles all scrolling/panning, do not prevent\n\t                return;\n\t            }\n\t\n\t            if (hasNone || hasPanY && direction & DIRECTION_HORIZONTAL || hasPanX && direction & DIRECTION_VERTICAL) {\n\t                return this.preventSrc(srcEvent);\n\t            }\n\t        },\n\t\n\t        /**\n\t         * call preventDefault to prevent the browser's default behavior (scrolling in most cases)\n\t         * @param {Object} srcEvent\n\t         */\n\t        preventSrc: function preventSrc(srcEvent) {\n\t            this.manager.session.prevented = true;\n\t            srcEvent.preventDefault();\n\t        }\n\t    };\n\t\n\t    /**\n\t     * when the touchActions are collected they are not a valid value, so we need to clean things up. *\n\t     * @param {String} actions\n\t     * @returns {*}\n\t     */\n\t    function cleanTouchActions(actions) {\n\t        // none\n\t        if (inStr(actions, TOUCH_ACTION_NONE)) {\n\t            return TOUCH_ACTION_NONE;\n\t        }\n\t\n\t        var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X);\n\t        var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y);\n\t\n\t        // if both pan-x and pan-y are set (different recognizers\n\t        // for different directions, e.g. horizontal pan but vertical swipe?)\n\t        // we need none (as otherwise with pan-x pan-y combined none of these\n\t        // recognizers will work, since the browser would handle all panning\n\t        if (hasPanX && hasPanY) {\n\t            return TOUCH_ACTION_NONE;\n\t        }\n\t\n\t        // pan-x OR pan-y\n\t        if (hasPanX || hasPanY) {\n\t            return hasPanX ? TOUCH_ACTION_PAN_X : TOUCH_ACTION_PAN_Y;\n\t        }\n\t\n\t        // manipulation\n\t        if (inStr(actions, TOUCH_ACTION_MANIPULATION)) {\n\t            return TOUCH_ACTION_MANIPULATION;\n\t        }\n\t\n\t        return TOUCH_ACTION_AUTO;\n\t    }\n\t\n\t    function getTouchActionProps() {\n\t        if (!NATIVE_TOUCH_ACTION) {\n\t            return false;\n\t        }\n\t        var touchMap = {};\n\t        var cssSupports = window.CSS && window.CSS.supports;\n\t        ['auto', 'manipulation', 'pan-y', 'pan-x', 'pan-x pan-y', 'none'].forEach(function (val) {\n\t\n\t            // If css.supports is not supported but there is native touch-action assume it supports\n\t            // all values. This is the case for IE 10 and 11.\n\t            touchMap[val] = cssSupports ? window.CSS.supports('touch-action', val) : true;\n\t        });\n\t        return touchMap;\n\t    }\n\t\n\t    /**\n\t     * Recognizer flow explained; *\n\t     * All recognizers have the initial state of POSSIBLE when a input session starts.\n\t     * The definition of a input session is from the first input until the last input, with all it's movement in it. *\n\t     * Example session for mouse-input: mousedown -> mousemove -> mouseup\n\t     *\n\t     * On each recognizing cycle (see Manager.recognize) the .recognize() method is executed\n\t     * which determines with state it should be.\n\t     *\n\t     * If the recognizer has the state FAILED, CANCELLED or RECOGNIZED (equals ENDED), it is reset to\n\t     * POSSIBLE to give it another change on the next cycle.\n\t     *\n\t     *               Possible\n\t     *                  |\n\t     *            +-----+---------------+\n\t     *            |                     |\n\t     *      +-----+-----+               |\n\t     *      |           |               |\n\t     *   Failed      Cancelled          |\n\t     *                          +-------+------+\n\t     *                          |              |\n\t     *                      Recognized       Began\n\t     *                                         |\n\t     *                                      Changed\n\t     *                                         |\n\t     *                                  Ended/Recognized\n\t     */\n\t    var STATE_POSSIBLE = 1;\n\t    var STATE_BEGAN = 2;\n\t    var STATE_CHANGED = 4;\n\t    var STATE_ENDED = 8;\n\t    var STATE_RECOGNIZED = STATE_ENDED;\n\t    var STATE_CANCELLED = 16;\n\t    var STATE_FAILED = 32;\n\t\n\t    /**\n\t     * Recognizer\n\t     * Every recognizer needs to extend from this class.\n\t     * @constructor\n\t     * @param {Object} options\n\t     */\n\t    function Recognizer(options) {\n\t        this.options = assign({}, this.defaults, options || {});\n\t\n\t        this.id = uniqueId();\n\t\n\t        this.manager = null;\n\t\n\t        // default is enable true\n\t        this.options.enable = ifUndefined(this.options.enable, true);\n\t\n\t        this.state = STATE_POSSIBLE;\n\t\n\t        this.simultaneous = {};\n\t        this.requireFail = [];\n\t    }\n\t\n\t    Recognizer.prototype = {\n\t        /**\n\t         * @virtual\n\t         * @type {Object}\n\t         */\n\t        defaults: {},\n\t\n\t        /**\n\t         * set options\n\t         * @param {Object} options\n\t         * @return {Recognizer}\n\t         */\n\t        set: function set(options) {\n\t            assign(this.options, options);\n\t\n\t            // also update the touchAction, in case something changed about the directions/enabled state\n\t            this.manager && this.manager.touchAction.update();\n\t            return this;\n\t        },\n\t\n\t        /**\n\t         * recognize simultaneous with an other recognizer.\n\t         * @param {Recognizer} otherRecognizer\n\t         * @returns {Recognizer} this\n\t         */\n\t        recognizeWith: function recognizeWith(otherRecognizer) {\n\t            if (invokeArrayArg(otherRecognizer, 'recognizeWith', this)) {\n\t                return this;\n\t            }\n\t\n\t            var simultaneous = this.simultaneous;\n\t            otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n\t            if (!simultaneous[otherRecognizer.id]) {\n\t                simultaneous[otherRecognizer.id] = otherRecognizer;\n\t                otherRecognizer.recognizeWith(this);\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /**\n\t         * drop the simultaneous link. it doesnt remove the link on the other recognizer.\n\t         * @param {Recognizer} otherRecognizer\n\t         * @returns {Recognizer} this\n\t         */\n\t        dropRecognizeWith: function dropRecognizeWith(otherRecognizer) {\n\t            if (invokeArrayArg(otherRecognizer, 'dropRecognizeWith', this)) {\n\t                return this;\n\t            }\n\t\n\t            otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n\t            delete this.simultaneous[otherRecognizer.id];\n\t            return this;\n\t        },\n\t\n\t        /**\n\t         * recognizer can only run when an other is failing\n\t         * @param {Recognizer} otherRecognizer\n\t         * @returns {Recognizer} this\n\t         */\n\t        requireFailure: function requireFailure(otherRecognizer) {\n\t            if (invokeArrayArg(otherRecognizer, 'requireFailure', this)) {\n\t                return this;\n\t            }\n\t\n\t            var requireFail = this.requireFail;\n\t            otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n\t            if (inArray(requireFail, otherRecognizer) === -1) {\n\t                requireFail.push(otherRecognizer);\n\t                otherRecognizer.requireFailure(this);\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /**\n\t         * drop the requireFailure link. it does not remove the link on the other recognizer.\n\t         * @param {Recognizer} otherRecognizer\n\t         * @returns {Recognizer} this\n\t         */\n\t        dropRequireFailure: function dropRequireFailure(otherRecognizer) {\n\t            if (invokeArrayArg(otherRecognizer, 'dropRequireFailure', this)) {\n\t                return this;\n\t            }\n\t\n\t            otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n\t            var index = inArray(this.requireFail, otherRecognizer);\n\t            if (index > -1) {\n\t                this.requireFail.splice(index, 1);\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /**\n\t         * has require failures boolean\n\t         * @returns {boolean}\n\t         */\n\t        hasRequireFailures: function hasRequireFailures() {\n\t            return this.requireFail.length > 0;\n\t        },\n\t\n\t        /**\n\t         * if the recognizer can recognize simultaneous with an other recognizer\n\t         * @param {Recognizer} otherRecognizer\n\t         * @returns {Boolean}\n\t         */\n\t        canRecognizeWith: function canRecognizeWith(otherRecognizer) {\n\t            return !!this.simultaneous[otherRecognizer.id];\n\t        },\n\t\n\t        /**\n\t         * You should use `tryEmit` instead of `emit` directly to check\n\t         * that all the needed recognizers has failed before emitting.\n\t         * @param {Object} input\n\t         */\n\t        emit: function emit(input) {\n\t            var self = this;\n\t            var state = this.state;\n\t\n\t            function emit(event) {\n\t                self.manager.emit(event, input);\n\t            }\n\t\n\t            // 'panstart' and 'panmove'\n\t            if (state < STATE_ENDED) {\n\t                emit(self.options.event + stateStr(state));\n\t            }\n\t\n\t            emit(self.options.event); // simple 'eventName' events\n\t\n\t            if (input.additionalEvent) {\n\t                // additional event(panleft, panright, pinchin, pinchout...)\n\t                emit(input.additionalEvent);\n\t            }\n\t\n\t            // panend and pancancel\n\t            if (state >= STATE_ENDED) {\n\t                emit(self.options.event + stateStr(state));\n\t            }\n\t        },\n\t\n\t        /**\n\t         * Check that all the require failure recognizers has failed,\n\t         * if true, it emits a gesture event,\n\t         * otherwise, setup the state to FAILED.\n\t         * @param {Object} input\n\t         */\n\t        tryEmit: function tryEmit(input) {\n\t            if (this.canEmit()) {\n\t                return this.emit(input);\n\t            }\n\t            // it's failing anyway\n\t            this.state = STATE_FAILED;\n\t        },\n\t\n\t        /**\n\t         * can we emit?\n\t         * @returns {boolean}\n\t         */\n\t        canEmit: function canEmit() {\n\t            var i = 0;\n\t            while (i < this.requireFail.length) {\n\t                if (!(this.requireFail[i].state & (STATE_FAILED | STATE_POSSIBLE))) {\n\t                    return false;\n\t                }\n\t                i++;\n\t            }\n\t            return true;\n\t        },\n\t\n\t        /**\n\t         * update the recognizer\n\t         * @param {Object} inputData\n\t         */\n\t        recognize: function recognize(inputData) {\n\t            // make a new copy of the inputData\n\t            // so we can change the inputData without messing up the other recognizers\n\t            var inputDataClone = assign({}, inputData);\n\t\n\t            // is is enabled and allow recognizing?\n\t            if (!boolOrFn(this.options.enable, [this, inputDataClone])) {\n\t                this.reset();\n\t                this.state = STATE_FAILED;\n\t                return;\n\t            }\n\t\n\t            // reset when we've reached the end\n\t            if (this.state & (STATE_RECOGNIZED | STATE_CANCELLED | STATE_FAILED)) {\n\t                this.state = STATE_POSSIBLE;\n\t            }\n\t\n\t            this.state = this.process(inputDataClone);\n\t\n\t            // the recognizer has recognized a gesture\n\t            // so trigger an event\n\t            if (this.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED | STATE_CANCELLED)) {\n\t                this.tryEmit(inputDataClone);\n\t            }\n\t        },\n\t\n\t        /**\n\t         * return the state of the recognizer\n\t         * the actual recognizing happens in this method\n\t         * @virtual\n\t         * @param {Object} inputData\n\t         * @returns {Const} STATE\n\t         */\n\t        process: function process(inputData) {}, // jshint ignore:line\n\t\n\t        /**\n\t         * return the preferred touch-action\n\t         * @virtual\n\t         * @returns {Array}\n\t         */\n\t        getTouchAction: function getTouchAction() {},\n\t\n\t        /**\n\t         * called when the gesture isn't allowed to recognize\n\t         * like when another is being recognized or it is disabled\n\t         * @virtual\n\t         */\n\t        reset: function reset() {}\n\t    };\n\t\n\t    /**\n\t     * get a usable string, used as event postfix\n\t     * @param {Const} state\n\t     * @returns {String} state\n\t     */\n\t    function stateStr(state) {\n\t        if (state & STATE_CANCELLED) {\n\t            return 'cancel';\n\t        } else if (state & STATE_ENDED) {\n\t            return 'end';\n\t        } else if (state & STATE_CHANGED) {\n\t            return 'move';\n\t        } else if (state & STATE_BEGAN) {\n\t            return 'start';\n\t        }\n\t        return '';\n\t    }\n\t\n\t    /**\n\t     * direction cons to string\n\t     * @param {Const} direction\n\t     * @returns {String}\n\t     */\n\t    function directionStr(direction) {\n\t        if (direction == DIRECTION_DOWN) {\n\t            return 'down';\n\t        } else if (direction == DIRECTION_UP) {\n\t            return 'up';\n\t        } else if (direction == DIRECTION_LEFT) {\n\t            return 'left';\n\t        } else if (direction == DIRECTION_RIGHT) {\n\t            return 'right';\n\t        }\n\t        return '';\n\t    }\n\t\n\t    /**\n\t     * get a recognizer by name if it is bound to a manager\n\t     * @param {Recognizer|String} otherRecognizer\n\t     * @param {Recognizer} recognizer\n\t     * @returns {Recognizer}\n\t     */\n\t    function getRecognizerByNameIfManager(otherRecognizer, recognizer) {\n\t        var manager = recognizer.manager;\n\t        if (manager) {\n\t            return manager.get(otherRecognizer);\n\t        }\n\t        return otherRecognizer;\n\t    }\n\t\n\t    /**\n\t     * This recognizer is just used as a base for the simple attribute recognizers.\n\t     * @constructor\n\t     * @extends Recognizer\n\t     */\n\t    function AttrRecognizer() {\n\t        Recognizer.apply(this, arguments);\n\t    }\n\t\n\t    inherit(AttrRecognizer, Recognizer, {\n\t        /**\n\t         * @namespace\n\t         * @memberof AttrRecognizer\n\t         */\n\t        defaults: {\n\t            /**\n\t             * @type {Number}\n\t             * @default 1\n\t             */\n\t            pointers: 1\n\t        },\n\t\n\t        /**\n\t         * Used to check if it the recognizer receives valid input, like input.distance > 10.\n\t         * @memberof AttrRecognizer\n\t         * @param {Object} input\n\t         * @returns {Boolean} recognized\n\t         */\n\t        attrTest: function attrTest(input) {\n\t            var optionPointers = this.options.pointers;\n\t            return optionPointers === 0 || input.pointers.length === optionPointers;\n\t        },\n\t\n\t        /**\n\t         * Process the input and return the state for the recognizer\n\t         * @memberof AttrRecognizer\n\t         * @param {Object} input\n\t         * @returns {*} State\n\t         */\n\t        process: function process(input) {\n\t            var state = this.state;\n\t            var eventType = input.eventType;\n\t\n\t            var isRecognized = state & (STATE_BEGAN | STATE_CHANGED);\n\t            var isValid = this.attrTest(input);\n\t\n\t            // on cancel input and we've recognized before, return STATE_CANCELLED\n\t            if (isRecognized && (eventType & INPUT_CANCEL || !isValid)) {\n\t                return state | STATE_CANCELLED;\n\t            } else if (isRecognized || isValid) {\n\t                if (eventType & INPUT_END) {\n\t                    return state | STATE_ENDED;\n\t                } else if (!(state & STATE_BEGAN)) {\n\t                    return STATE_BEGAN;\n\t                }\n\t                return state | STATE_CHANGED;\n\t            }\n\t            return STATE_FAILED;\n\t        }\n\t    });\n\t\n\t    /**\n\t     * Pan\n\t     * Recognized when the pointer is down and moved in the allowed direction.\n\t     * @constructor\n\t     * @extends AttrRecognizer\n\t     */\n\t    function PanRecognizer() {\n\t        AttrRecognizer.apply(this, arguments);\n\t\n\t        this.pX = null;\n\t        this.pY = null;\n\t    }\n\t\n\t    inherit(PanRecognizer, AttrRecognizer, {\n\t        /**\n\t         * @namespace\n\t         * @memberof PanRecognizer\n\t         */\n\t        defaults: {\n\t            event: 'pan',\n\t            threshold: 10,\n\t            pointers: 1,\n\t            direction: DIRECTION_ALL\n\t        },\n\t\n\t        getTouchAction: function getTouchAction() {\n\t            var direction = this.options.direction;\n\t            var actions = [];\n\t            if (direction & DIRECTION_HORIZONTAL) {\n\t                actions.push(TOUCH_ACTION_PAN_Y);\n\t            }\n\t            if (direction & DIRECTION_VERTICAL) {\n\t                actions.push(TOUCH_ACTION_PAN_X);\n\t            }\n\t            return actions;\n\t        },\n\t\n\t        directionTest: function directionTest(input) {\n\t            var options = this.options;\n\t            var hasMoved = true;\n\t            var distance = input.distance;\n\t            var direction = input.direction;\n\t            var x = input.deltaX;\n\t            var y = input.deltaY;\n\t\n\t            // lock to axis?\n\t            if (!(direction & options.direction)) {\n\t                if (options.direction & DIRECTION_HORIZONTAL) {\n\t                    direction = x === 0 ? DIRECTION_NONE : x < 0 ? DIRECTION_LEFT : DIRECTION_RIGHT;\n\t                    hasMoved = x != this.pX;\n\t                    distance = Math.abs(input.deltaX);\n\t                } else {\n\t                    direction = y === 0 ? DIRECTION_NONE : y < 0 ? DIRECTION_UP : DIRECTION_DOWN;\n\t                    hasMoved = y != this.pY;\n\t                    distance = Math.abs(input.deltaY);\n\t                }\n\t            }\n\t            input.direction = direction;\n\t            return hasMoved && distance > options.threshold && direction & options.direction;\n\t        },\n\t\n\t        attrTest: function attrTest(input) {\n\t            return AttrRecognizer.prototype.attrTest.call(this, input) && (this.state & STATE_BEGAN || !(this.state & STATE_BEGAN) && this.directionTest(input));\n\t        },\n\t\n\t        emit: function emit(input) {\n\t\n\t            this.pX = input.deltaX;\n\t            this.pY = input.deltaY;\n\t\n\t            var direction = directionStr(input.direction);\n\t\n\t            if (direction) {\n\t                input.additionalEvent = this.options.event + direction;\n\t            }\n\t            this._super.emit.call(this, input);\n\t        }\n\t    });\n\t\n\t    /**\n\t     * Pinch\n\t     * Recognized when two or more pointers are moving toward (zoom-in) or away from each other (zoom-out).\n\t     * @constructor\n\t     * @extends AttrRecognizer\n\t     */\n\t    function PinchRecognizer() {\n\t        AttrRecognizer.apply(this, arguments);\n\t    }\n\t\n\t    inherit(PinchRecognizer, AttrRecognizer, {\n\t        /**\n\t         * @namespace\n\t         * @memberof PinchRecognizer\n\t         */\n\t        defaults: {\n\t            event: 'pinch',\n\t            threshold: 0,\n\t            pointers: 2\n\t        },\n\t\n\t        getTouchAction: function getTouchAction() {\n\t            return [TOUCH_ACTION_NONE];\n\t        },\n\t\n\t        attrTest: function attrTest(input) {\n\t            return this._super.attrTest.call(this, input) && (Math.abs(input.scale - 1) > this.options.threshold || this.state & STATE_BEGAN);\n\t        },\n\t\n\t        emit: function emit(input) {\n\t            if (input.scale !== 1) {\n\t                var inOut = input.scale < 1 ? 'in' : 'out';\n\t                input.additionalEvent = this.options.event + inOut;\n\t            }\n\t            this._super.emit.call(this, input);\n\t        }\n\t    });\n\t\n\t    /**\n\t     * Press\n\t     * Recognized when the pointer is down for x ms without any movement.\n\t     * @constructor\n\t     * @extends Recognizer\n\t     */\n\t    function PressRecognizer() {\n\t        Recognizer.apply(this, arguments);\n\t\n\t        this._timer = null;\n\t        this._input = null;\n\t    }\n\t\n\t    inherit(PressRecognizer, Recognizer, {\n\t        /**\n\t         * @namespace\n\t         * @memberof PressRecognizer\n\t         */\n\t        defaults: {\n\t            event: 'press',\n\t            pointers: 1,\n\t            time: 251, // minimal time of the pointer to be pressed\n\t            threshold: 9 // a minimal movement is ok, but keep it low\n\t        },\n\t\n\t        getTouchAction: function getTouchAction() {\n\t            return [TOUCH_ACTION_AUTO];\n\t        },\n\t\n\t        process: function process(input) {\n\t            var options = this.options;\n\t            var validPointers = input.pointers.length === options.pointers;\n\t            var validMovement = input.distance < options.threshold;\n\t            var validTime = input.deltaTime > options.time;\n\t\n\t            this._input = input;\n\t\n\t            // we only allow little movement\n\t            // and we've reached an end event, so a tap is possible\n\t            if (!validMovement || !validPointers || input.eventType & (INPUT_END | INPUT_CANCEL) && !validTime) {\n\t                this.reset();\n\t            } else if (input.eventType & INPUT_START) {\n\t                this.reset();\n\t                this._timer = setTimeoutContext(function () {\n\t                    this.state = STATE_RECOGNIZED;\n\t                    this.tryEmit();\n\t                }, options.time, this);\n\t            } else if (input.eventType & INPUT_END) {\n\t                return STATE_RECOGNIZED;\n\t            }\n\t            return STATE_FAILED;\n\t        },\n\t\n\t        reset: function reset() {\n\t            clearTimeout(this._timer);\n\t        },\n\t\n\t        emit: function emit(input) {\n\t            if (this.state !== STATE_RECOGNIZED) {\n\t                return;\n\t            }\n\t\n\t            if (input && input.eventType & INPUT_END) {\n\t                this.manager.emit(this.options.event + 'up', input);\n\t            } else {\n\t                this._input.timeStamp = now();\n\t                this.manager.emit(this.options.event, this._input);\n\t            }\n\t        }\n\t    });\n\t\n\t    /**\n\t     * Rotate\n\t     * Recognized when two or more pointer are moving in a circular motion.\n\t     * @constructor\n\t     * @extends AttrRecognizer\n\t     */\n\t    function RotateRecognizer() {\n\t        AttrRecognizer.apply(this, arguments);\n\t    }\n\t\n\t    inherit(RotateRecognizer, AttrRecognizer, {\n\t        /**\n\t         * @namespace\n\t         * @memberof RotateRecognizer\n\t         */\n\t        defaults: {\n\t            event: 'rotate',\n\t            threshold: 0,\n\t            pointers: 2\n\t        },\n\t\n\t        getTouchAction: function getTouchAction() {\n\t            return [TOUCH_ACTION_NONE];\n\t        },\n\t\n\t        attrTest: function attrTest(input) {\n\t            return this._super.attrTest.call(this, input) && (Math.abs(input.rotation) > this.options.threshold || this.state & STATE_BEGAN);\n\t        }\n\t    });\n\t\n\t    /**\n\t     * Swipe\n\t     * Recognized when the pointer is moving fast (velocity), with enough distance in the allowed direction.\n\t     * @constructor\n\t     * @extends AttrRecognizer\n\t     */\n\t    function SwipeRecognizer() {\n\t        AttrRecognizer.apply(this, arguments);\n\t    }\n\t\n\t    inherit(SwipeRecognizer, AttrRecognizer, {\n\t        /**\n\t         * @namespace\n\t         * @memberof SwipeRecognizer\n\t         */\n\t        defaults: {\n\t            event: 'swipe',\n\t            threshold: 10,\n\t            velocity: 0.3,\n\t            direction: DIRECTION_HORIZONTAL | DIRECTION_VERTICAL,\n\t            pointers: 1\n\t        },\n\t\n\t        getTouchAction: function getTouchAction() {\n\t            return PanRecognizer.prototype.getTouchAction.call(this);\n\t        },\n\t\n\t        attrTest: function attrTest(input) {\n\t            var direction = this.options.direction;\n\t            var velocity;\n\t\n\t            if (direction & (DIRECTION_HORIZONTAL | DIRECTION_VERTICAL)) {\n\t                velocity = input.overallVelocity;\n\t            } else if (direction & DIRECTION_HORIZONTAL) {\n\t                velocity = input.overallVelocityX;\n\t            } else if (direction & DIRECTION_VERTICAL) {\n\t                velocity = input.overallVelocityY;\n\t            }\n\t\n\t            return this._super.attrTest.call(this, input) && direction & input.offsetDirection && input.distance > this.options.threshold && input.maxPointers == this.options.pointers && abs(velocity) > this.options.velocity && input.eventType & INPUT_END;\n\t        },\n\t\n\t        emit: function emit(input) {\n\t            var direction = directionStr(input.offsetDirection);\n\t            if (direction) {\n\t                this.manager.emit(this.options.event + direction, input);\n\t            }\n\t\n\t            this.manager.emit(this.options.event, input);\n\t        }\n\t    });\n\t\n\t    /**\n\t     * A tap is ecognized when the pointer is doing a small tap/click. Multiple taps are recognized if they occur\n\t     * between the given interval and position. The delay option can be used to recognize multi-taps without firing\n\t     * a single tap.\n\t     *\n\t     * The eventData from the emitted event contains the property `tapCount`, which contains the amount of\n\t     * multi-taps being recognized.\n\t     * @constructor\n\t     * @extends Recognizer\n\t     */\n\t    function TapRecognizer() {\n\t        Recognizer.apply(this, arguments);\n\t\n\t        // previous time and center,\n\t        // used for tap counting\n\t        this.pTime = false;\n\t        this.pCenter = false;\n\t\n\t        this._timer = null;\n\t        this._input = null;\n\t        this.count = 0;\n\t    }\n\t\n\t    inherit(TapRecognizer, Recognizer, {\n\t        /**\n\t         * @namespace\n\t         * @memberof PinchRecognizer\n\t         */\n\t        defaults: {\n\t            event: 'tap',\n\t            pointers: 1,\n\t            taps: 1,\n\t            interval: 300, // max time between the multi-tap taps\n\t            time: 250, // max time of the pointer to be down (like finger on the screen)\n\t            threshold: 9, // a minimal movement is ok, but keep it low\n\t            posThreshold: 10 // a multi-tap can be a bit off the initial position\n\t        },\n\t\n\t        getTouchAction: function getTouchAction() {\n\t            return [TOUCH_ACTION_MANIPULATION];\n\t        },\n\t\n\t        process: function process(input) {\n\t            var options = this.options;\n\t\n\t            var validPointers = input.pointers.length === options.pointers;\n\t            var validMovement = input.distance < options.threshold;\n\t            var validTouchTime = input.deltaTime < options.time;\n\t\n\t            this.reset();\n\t\n\t            if (input.eventType & INPUT_START && this.count === 0) {\n\t                return this.failTimeout();\n\t            }\n\t\n\t            // we only allow little movement\n\t            // and we've reached an end event, so a tap is possible\n\t            if (validMovement && validTouchTime && validPointers) {\n\t                if (input.eventType != INPUT_END) {\n\t                    return this.failTimeout();\n\t                }\n\t\n\t                var validInterval = this.pTime ? input.timeStamp - this.pTime < options.interval : true;\n\t                var validMultiTap = !this.pCenter || getDistance(this.pCenter, input.center) < options.posThreshold;\n\t\n\t                this.pTime = input.timeStamp;\n\t                this.pCenter = input.center;\n\t\n\t                if (!validMultiTap || !validInterval) {\n\t                    this.count = 1;\n\t                } else {\n\t                    this.count += 1;\n\t                }\n\t\n\t                this._input = input;\n\t\n\t                // if tap count matches we have recognized it,\n\t                // else it has began recognizing...\n\t                var tapCount = this.count % options.taps;\n\t                if (tapCount === 0) {\n\t                    // no failing requirements, immediately trigger the tap event\n\t                    // or wait as long as the multitap interval to trigger\n\t                    if (!this.hasRequireFailures()) {\n\t                        return STATE_RECOGNIZED;\n\t                    } else {\n\t                        this._timer = setTimeoutContext(function () {\n\t                            this.state = STATE_RECOGNIZED;\n\t                            this.tryEmit();\n\t                        }, options.interval, this);\n\t                        return STATE_BEGAN;\n\t                    }\n\t                }\n\t            }\n\t            return STATE_FAILED;\n\t        },\n\t\n\t        failTimeout: function failTimeout() {\n\t            this._timer = setTimeoutContext(function () {\n\t                this.state = STATE_FAILED;\n\t            }, this.options.interval, this);\n\t            return STATE_FAILED;\n\t        },\n\t\n\t        reset: function reset() {\n\t            clearTimeout(this._timer);\n\t        },\n\t\n\t        emit: function emit() {\n\t            if (this.state == STATE_RECOGNIZED) {\n\t                this._input.tapCount = this.count;\n\t                this.manager.emit(this.options.event, this._input);\n\t            }\n\t        }\n\t    });\n\t\n\t    /**\n\t     * Simple way to create a manager with a default set of recognizers.\n\t     * @param {HTMLElement} element\n\t     * @param {Object} [options]\n\t     * @constructor\n\t     */\n\t    function Hammer(element, options) {\n\t        options = options || {};\n\t        options.recognizers = ifUndefined(options.recognizers, Hammer.defaults.preset);\n\t        return new Manager(element, options);\n\t    }\n\t\n\t    /**\n\t     * @const {string}\n\t     */\n\t    Hammer.VERSION = '2.0.7';\n\t\n\t    /**\n\t     * default settings\n\t     * @namespace\n\t     */\n\t    Hammer.defaults = {\n\t        /**\n\t         * set if DOM events are being triggered.\n\t         * But this is slower and unused by simple implementations, so disabled by default.\n\t         * @type {Boolean}\n\t         * @default false\n\t         */\n\t        domEvents: false,\n\t\n\t        /**\n\t         * The value for the touchAction property/fallback.\n\t         * When set to `compute` it will magically set the correct value based on the added recognizers.\n\t         * @type {String}\n\t         * @default compute\n\t         */\n\t        touchAction: TOUCH_ACTION_COMPUTE,\n\t\n\t        /**\n\t         * @type {Boolean}\n\t         * @default true\n\t         */\n\t        enable: true,\n\t\n\t        /**\n\t         * EXPERIMENTAL FEATURE -- can be removed/changed\n\t         * Change the parent input target element.\n\t         * If Null, then it is being set the to main element.\n\t         * @type {Null|EventTarget}\n\t         * @default null\n\t         */\n\t        inputTarget: null,\n\t\n\t        /**\n\t         * force an input class\n\t         * @type {Null|Function}\n\t         * @default null\n\t         */\n\t        inputClass: null,\n\t\n\t        /**\n\t         * Default recognizer setup when calling `Hammer()`\n\t         * When creating a new Manager these will be skipped.\n\t         * @type {Array}\n\t         */\n\t        preset: [\n\t        // RecognizerClass, options, [recognizeWith, ...], [requireFailure, ...]\n\t        [RotateRecognizer, { enable: false }], [PinchRecognizer, { enable: false }, ['rotate']], [SwipeRecognizer, { direction: DIRECTION_HORIZONTAL }], [PanRecognizer, { direction: DIRECTION_HORIZONTAL }, ['swipe']], [TapRecognizer], [TapRecognizer, { event: 'doubletap', taps: 2 }, ['tap']], [PressRecognizer]],\n\t\n\t        /**\n\t         * Some CSS properties can be used to improve the working of Hammer.\n\t         * Add them to this method and they will be set when creating a new Manager.\n\t         * @namespace\n\t         */\n\t        cssProps: {\n\t            /**\n\t             * Disables text selection to improve the dragging gesture. Mainly for desktop browsers.\n\t             * @type {String}\n\t             * @default 'none'\n\t             */\n\t            userSelect: 'none',\n\t\n\t            /**\n\t             * Disable the Windows Phone grippers when pressing an element.\n\t             * @type {String}\n\t             * @default 'none'\n\t             */\n\t            touchSelect: 'none',\n\t\n\t            /**\n\t             * Disables the default callout shown when you touch and hold a touch target.\n\t             * On iOS, when you touch and hold a touch target such as a link, Safari displays\n\t             * a callout containing information about the link. This property allows you to disable that callout.\n\t             * @type {String}\n\t             * @default 'none'\n\t             */\n\t            touchCallout: 'none',\n\t\n\t            /**\n\t             * Specifies whether zooming is enabled. Used by IE10>\n\t             * @type {String}\n\t             * @default 'none'\n\t             */\n\t            contentZooming: 'none',\n\t\n\t            /**\n\t             * Specifies that an entire element should be draggable instead of its contents. Mainly for desktop browsers.\n\t             * @type {String}\n\t             * @default 'none'\n\t             */\n\t            userDrag: 'none',\n\t\n\t            /**\n\t             * Overrides the highlight color shown when the user taps a link or a JavaScript\n\t             * clickable element in iOS. This property obeys the alpha value, if specified.\n\t             * @type {String}\n\t             * @default 'rgba(0,0,0,0)'\n\t             */\n\t            tapHighlightColor: 'rgba(0,0,0,0)'\n\t        }\n\t    };\n\t\n\t    var STOP = 1;\n\t    var FORCED_STOP = 2;\n\t\n\t    /**\n\t     * Manager\n\t     * @param {HTMLElement} element\n\t     * @param {Object} [options]\n\t     * @constructor\n\t     */\n\t    function Manager(element, options) {\n\t        this.options = assign({}, Hammer.defaults, options || {});\n\t\n\t        this.options.inputTarget = this.options.inputTarget || element;\n\t\n\t        this.handlers = {};\n\t        this.session = {};\n\t        this.recognizers = [];\n\t        this.oldCssProps = {};\n\t\n\t        this.element = element;\n\t        this.input = createInputInstance(this);\n\t        this.touchAction = new TouchAction(this, this.options.touchAction);\n\t\n\t        toggleCssProps(this, true);\n\t\n\t        each(this.options.recognizers, function (item) {\n\t            var recognizer = this.add(new item[0](item[1]));\n\t            item[2] && recognizer.recognizeWith(item[2]);\n\t            item[3] && recognizer.requireFailure(item[3]);\n\t        }, this);\n\t    }\n\t\n\t    Manager.prototype = {\n\t        /**\n\t         * set options\n\t         * @param {Object} options\n\t         * @returns {Manager}\n\t         */\n\t        set: function set(options) {\n\t            assign(this.options, options);\n\t\n\t            // Options that need a little more setup\n\t            if (options.touchAction) {\n\t                this.touchAction.update();\n\t            }\n\t            if (options.inputTarget) {\n\t                // Clean up existing event listeners and reinitialize\n\t                this.input.destroy();\n\t                this.input.target = options.inputTarget;\n\t                this.input.init();\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /**\n\t         * stop recognizing for this session.\n\t         * This session will be discarded, when a new [input]start event is fired.\n\t         * When forced, the recognizer cycle is stopped immediately.\n\t         * @param {Boolean} [force]\n\t         */\n\t        stop: function stop(force) {\n\t            this.session.stopped = force ? FORCED_STOP : STOP;\n\t        },\n\t\n\t        /**\n\t         * run the recognizers!\n\t         * called by the inputHandler function on every movement of the pointers (touches)\n\t         * it walks through all the recognizers and tries to detect the gesture that is being made\n\t         * @param {Object} inputData\n\t         */\n\t        recognize: function recognize(inputData) {\n\t            var session = this.session;\n\t            if (session.stopped) {\n\t                return;\n\t            }\n\t\n\t            // run the touch-action polyfill\n\t            this.touchAction.preventDefaults(inputData);\n\t\n\t            var recognizer;\n\t            var recognizers = this.recognizers;\n\t\n\t            // this holds the recognizer that is being recognized.\n\t            // so the recognizer's state needs to be BEGAN, CHANGED, ENDED or RECOGNIZED\n\t            // if no recognizer is detecting a thing, it is set to `null`\n\t            var curRecognizer = session.curRecognizer;\n\t\n\t            // reset when the last recognizer is recognized\n\t            // or when we're in a new session\n\t            if (!curRecognizer || curRecognizer && curRecognizer.state & STATE_RECOGNIZED) {\n\t                curRecognizer = session.curRecognizer = null;\n\t            }\n\t\n\t            var i = 0;\n\t            while (i < recognizers.length) {\n\t                recognizer = recognizers[i];\n\t\n\t                // find out if we are allowed try to recognize the input for this one.\n\t                // 1.   allow if the session is NOT forced stopped (see the .stop() method)\n\t                // 2.   allow if we still haven't recognized a gesture in this session, or the this recognizer is the one\n\t                //      that is being recognized.\n\t                // 3.   allow if the recognizer is allowed to run simultaneous with the current recognized recognizer.\n\t                //      this can be setup with the `recognizeWith()` method on the recognizer.\n\t                if (session.stopped !== FORCED_STOP && ( // 1\n\t                !curRecognizer || recognizer == curRecognizer || // 2\n\t                recognizer.canRecognizeWith(curRecognizer))) {\n\t                    // 3\n\t                    recognizer.recognize(inputData);\n\t                } else {\n\t                    recognizer.reset();\n\t                }\n\t\n\t                // if the recognizer has been recognizing the input as a valid gesture, we want to store this one as the\n\t                // current active recognizer. but only if we don't already have an active recognizer\n\t                if (!curRecognizer && recognizer.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED)) {\n\t                    curRecognizer = session.curRecognizer = recognizer;\n\t                }\n\t                i++;\n\t            }\n\t        },\n\t\n\t        /**\n\t         * get a recognizer by its event name.\n\t         * @param {Recognizer|String} recognizer\n\t         * @returns {Recognizer|Null}\n\t         */\n\t        get: function get(recognizer) {\n\t            if (recognizer instanceof Recognizer) {\n\t                return recognizer;\n\t            }\n\t\n\t            var recognizers = this.recognizers;\n\t            for (var i = 0; i < recognizers.length; i++) {\n\t                if (recognizers[i].options.event == recognizer) {\n\t                    return recognizers[i];\n\t                }\n\t            }\n\t            return null;\n\t        },\n\t\n\t        /**\n\t         * add a recognizer to the manager\n\t         * existing recognizers with the same event name will be removed\n\t         * @param {Recognizer} recognizer\n\t         * @returns {Recognizer|Manager}\n\t         */\n\t        add: function add(recognizer) {\n\t            if (invokeArrayArg(recognizer, 'add', this)) {\n\t                return this;\n\t            }\n\t\n\t            // remove existing\n\t            var existing = this.get(recognizer.options.event);\n\t            if (existing) {\n\t                this.remove(existing);\n\t            }\n\t\n\t            this.recognizers.push(recognizer);\n\t            recognizer.manager = this;\n\t\n\t            this.touchAction.update();\n\t            return recognizer;\n\t        },\n\t\n\t        /**\n\t         * remove a recognizer by name or instance\n\t         * @param {Recognizer|String} recognizer\n\t         * @returns {Manager}\n\t         */\n\t        remove: function remove(recognizer) {\n\t            if (invokeArrayArg(recognizer, 'remove', this)) {\n\t                return this;\n\t            }\n\t\n\t            recognizer = this.get(recognizer);\n\t\n\t            // let's make sure this recognizer exists\n\t            if (recognizer) {\n\t                var recognizers = this.recognizers;\n\t                var index = inArray(recognizers, recognizer);\n\t\n\t                if (index !== -1) {\n\t                    recognizers.splice(index, 1);\n\t                    this.touchAction.update();\n\t                }\n\t            }\n\t\n\t            return this;\n\t        },\n\t\n\t        /**\n\t         * bind event\n\t         * @param {String} events\n\t         * @param {Function} handler\n\t         * @returns {EventEmitter} this\n\t         */\n\t        on: function on(events, handler) {\n\t            if (events === undefined) {\n\t                return;\n\t            }\n\t            if (handler === undefined) {\n\t                return;\n\t            }\n\t\n\t            var handlers = this.handlers;\n\t            each(splitStr(events), function (event) {\n\t                handlers[event] = handlers[event] || [];\n\t                handlers[event].push(handler);\n\t            });\n\t            return this;\n\t        },\n\t\n\t        /**\n\t         * unbind event, leave emit blank to remove all handlers\n\t         * @param {String} events\n\t         * @param {Function} [handler]\n\t         * @returns {EventEmitter} this\n\t         */\n\t        off: function off(events, handler) {\n\t            if (events === undefined) {\n\t                return;\n\t            }\n\t\n\t            var handlers = this.handlers;\n\t            each(splitStr(events), function (event) {\n\t                if (!handler) {\n\t                    delete handlers[event];\n\t                } else {\n\t                    handlers[event] && handlers[event].splice(inArray(handlers[event], handler), 1);\n\t                }\n\t            });\n\t            return this;\n\t        },\n\t\n\t        /**\n\t         * emit event to the listeners\n\t         * @param {String} event\n\t         * @param {Object} data\n\t         */\n\t        emit: function emit(event, data) {\n\t            // we also want to trigger dom events\n\t            if (this.options.domEvents) {\n\t                triggerDomEvent(event, data);\n\t            }\n\t\n\t            // no handlers, so skip it all\n\t            var handlers = this.handlers[event] && this.handlers[event].slice();\n\t            if (!handlers || !handlers.length) {\n\t                return;\n\t            }\n\t\n\t            data.type = event;\n\t            data.preventDefault = function () {\n\t                data.srcEvent.preventDefault();\n\t            };\n\t\n\t            var i = 0;\n\t            while (i < handlers.length) {\n\t                handlers[i](data);\n\t                i++;\n\t            }\n\t        },\n\t\n\t        /**\n\t         * destroy the manager and unbinds all events\n\t         * it doesn't unbind dom events, that is the user own responsibility\n\t         */\n\t        destroy: function destroy() {\n\t            this.element && toggleCssProps(this, false);\n\t\n\t            this.handlers = {};\n\t            this.session = {};\n\t            this.input.destroy();\n\t            this.element = null;\n\t        }\n\t    };\n\t\n\t    /**\n\t     * add/remove the css properties as defined in manager.options.cssProps\n\t     * @param {Manager} manager\n\t     * @param {Boolean} add\n\t     */\n\t    function toggleCssProps(manager, add) {\n\t        var element = manager.element;\n\t        if (!element.style) {\n\t            return;\n\t        }\n\t        var prop;\n\t        each(manager.options.cssProps, function (value, name) {\n\t            prop = prefixed(element.style, name);\n\t            if (add) {\n\t                manager.oldCssProps[prop] = element.style[prop];\n\t                element.style[prop] = value;\n\t            } else {\n\t                element.style[prop] = manager.oldCssProps[prop] || '';\n\t            }\n\t        });\n\t        if (!add) {\n\t            manager.oldCssProps = {};\n\t        }\n\t    }\n\t\n\t    /**\n\t     * trigger dom event\n\t     * @param {String} event\n\t     * @param {Object} data\n\t     */\n\t    function triggerDomEvent(event, data) {\n\t        var gestureEvent = document.createEvent('Event');\n\t        gestureEvent.initEvent(event, true, true);\n\t        gestureEvent.gesture = data;\n\t        data.target.dispatchEvent(gestureEvent);\n\t    }\n\t\n\t    assign(Hammer, {\n\t        INPUT_START: INPUT_START,\n\t        INPUT_MOVE: INPUT_MOVE,\n\t        INPUT_END: INPUT_END,\n\t        INPUT_CANCEL: INPUT_CANCEL,\n\t\n\t        STATE_POSSIBLE: STATE_POSSIBLE,\n\t        STATE_BEGAN: STATE_BEGAN,\n\t        STATE_CHANGED: STATE_CHANGED,\n\t        STATE_ENDED: STATE_ENDED,\n\t        STATE_RECOGNIZED: STATE_RECOGNIZED,\n\t        STATE_CANCELLED: STATE_CANCELLED,\n\t        STATE_FAILED: STATE_FAILED,\n\t\n\t        DIRECTION_NONE: DIRECTION_NONE,\n\t        DIRECTION_LEFT: DIRECTION_LEFT,\n\t        DIRECTION_RIGHT: DIRECTION_RIGHT,\n\t        DIRECTION_UP: DIRECTION_UP,\n\t        DIRECTION_DOWN: DIRECTION_DOWN,\n\t        DIRECTION_HORIZONTAL: DIRECTION_HORIZONTAL,\n\t        DIRECTION_VERTICAL: DIRECTION_VERTICAL,\n\t        DIRECTION_ALL: DIRECTION_ALL,\n\t\n\t        Manager: Manager,\n\t        Input: Input,\n\t        TouchAction: TouchAction,\n\t\n\t        TouchInput: TouchInput,\n\t        MouseInput: MouseInput,\n\t        PointerEventInput: PointerEventInput,\n\t        TouchMouseInput: TouchMouseInput,\n\t        SingleTouchInput: SingleTouchInput,\n\t\n\t        Recognizer: Recognizer,\n\t        AttrRecognizer: AttrRecognizer,\n\t        Tap: TapRecognizer,\n\t        Pan: PanRecognizer,\n\t        Swipe: SwipeRecognizer,\n\t        Pinch: PinchRecognizer,\n\t        Rotate: RotateRecognizer,\n\t        Press: PressRecognizer,\n\t\n\t        on: addEventListeners,\n\t        off: removeEventListeners,\n\t        each: each,\n\t        merge: merge,\n\t        extend: extend,\n\t        assign: assign,\n\t        inherit: inherit,\n\t        bindFn: bindFn,\n\t        prefixed: prefixed\n\t    });\n\t\n\t    // this prevents errors when Hammer is loaded in the presence of an AMD\n\t    //  style loader but by script tag, not by the loader.\n\t    var freeGlobal = typeof window !== 'undefined' ? window : typeof self !== 'undefined' ? self : {}; // jshint ignore:line\n\t    freeGlobal.Hammer = Hammer;\n\t\n\t    if (true) {\n\t        !(__WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t            return Hammer;\n\t        }.call(exports, __webpack_require__, exports, module), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t    } else if (typeof module != 'undefined' && module.exports) {\n\t        module.exports = Hammer;\n\t    } else {\n\t        window[exportName] = Hammer;\n\t    }\n\t})(window, document, 'Hammer');\n\n/***/ },\n/* 22 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(8), __webpack_require__(23)], __WEBPACK_AMD_DEFINE_RESULT__ = function (ut, Gator) {\n\t\n\t\t// Every button should have an :after pseudo-element tooltip prebuilt in CSS.\n\t\t(function () {\n\t\t\tvar inspectingTooltips = false;\n\t\t\tvar waitingPeriod = void 0;\n\t\t\tvar allowanceInterval = void 0;\n\t\t\tvar elementStack = [];\n\t\n\t\t\tGator(document.body).on(\"mouseover\", \".panel__button\", function (e) {\n\t\n\t\t\t\t// Technically unnecessary but DOM call seems to suppress glitching.\n\t\t\t\tif (this.classList.contains(\"panel__button--show-tooltip\")) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\n\t\t\t\tvar button = this;\n\t\n\t\t\t\t// Once tooltips are shown, allow the user to scan quickly between tooltips\n\t\t\t\t// without delay\n\t\t\t\tvar delay = 1000;\n\t\t\t\tif (inspectingTooltips) {\n\t\t\t\t\tdelay = 0;\n\t\t\t\t}\n\t\n\t\t\t\t// Throttle multiple mouseover events.\n\t\t\t\tclearTimeout(waitingPeriod);\n\t\n\t\t\t\t// Still inspecting, don't set false yet\n\t\t\t\tclearTimeout(allowanceInterval);\n\t\n\t\t\t\twaitingPeriod = setTimeout(function () {\n\t\t\t\t\taddTooltip(button);\n\t\t\t\t}, delay);\n\t\t\t\tbutton.addEventListener(\"mouseleave\", abortTooltip);\n\t\t\t});\n\t\n\t\t\tvar addTooltip = function addTooltip(buttonElem) {\n\t\t\t\tinspectingTooltips = true;\n\t\t\t\twaitingPeriod = null;\n\t\n\t\t\t\t// Tooltips need to float above any adjacent panels, so\n\t\t\t\t// move the current panel to the stop of the stack.\n\t\t\t\tvar parentPanel = ut.getClosest(buttonElem, \".panel\");\n\t\t\t\tshufflePanelStack(parentPanel);\n\t\n\t\t\t\tbuttonElem.classList.add(\"panel__button--show-tooltip\");\n\t\t\t};\n\t\n\t\t\tvar abortTooltip = function abortTooltip() {\n\t\n\t\t\t\t// In case the mouse darts in and out, before the tooltip is ever shown.\n\t\t\t\tclearTimeout(waitingPeriod);\n\t\t\t\tthis.classList.remove(\"panel__button--show-tooltip\");\n\t\t\t\tthis.removeEventListener(\"mouseleave\", abortTooltip);\n\t\t\t\tallowanceInterval = setTimeout(function () {\n\t\t\t\t\tinspectingTooltips = false;\n\t\t\t\t}, 200);\n\t\t\t};\n\t\n\t\t\t//\n\t\t\t// Panel Stacking on click\n\t\t\t//\n\t\t\t// Grouped with Tooltips because tooltip show sometimes needs to lift hovered button's\n\t\t\t// panel in the stacking order.\n\t\t\tvar getLayerNumber = function getLayerNumber(elem) {\n\t\t\t\tfor (var i = 0; i < elementStack.length; i += 1) {\n\t\t\t\t\tif (elem === elementStack[i]) {\n\t\t\t\t\t\treturn i;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\n\t\t\tvar applyZindexClasses = function applyZindexClasses() {\n\t\t\t\tvar elem = void 0;\n\t\t\t\tvar len = elementStack.length;\n\t\t\t\tif (!len) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\n\t\t\t\tfor (var i = 0; i < len; i += 1) {\n\t\t\t\t\telem = elementStack[i];\n\t\n\t\t\t\t\tif (elem) {\n\t\t\t\t\t\t// Some mobile-only buttons float free & don't live in a panel.\n\t\n\t\t\t\t\t\t// Remove all the old class names.\n\t\t\t\t\t\tfor (var j = 0; j < len; j += 1) {\n\t\t\t\t\t\t\telem.classList.remove(\"z-index\" + (j + 1));\n\t\t\t\t\t\t}\n\t\n\t\t\t\t\t\t// And apply the new.\n\t\t\t\t\t\telem.classList.add(\"z-index\" + (i + 1));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\n\t\t\tvar shufflePanelStack = function shufflePanelStack(panelToGoOnTop) {\n\t\n\t\t\t\t// If click is on the topmost layer get out.\n\t\t\t\tif (panelToGoOnTop === elementStack[elementStack.length - 1]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\n\t\t\t\tvar currentLayerNumber = getLayerNumber(panelToGoOnTop);\n\t\n\t\t\t\tif (typeof currentLayerNumber === \"number\") {\n\t\n\t\t\t\t\t// Remove from current position.\n\t\t\t\t\telementStack.splice(currentLayerNumber, 1);\n\t\t\t\t}\n\t\n\t\t\t\t// Always apply classes to any panel that has been clicked\n\t\t\t\telementStack.push(panelToGoOnTop);\n\t\t\t\tapplyZindexClasses();\n\t\t\t};\n\t\n\t\t\tGator(document.body).on(\"mousedown\", \".panel\", function () {\n\t\t\t\tshufflePanelStack(this);\n\t\t\t});\n\t\t})();\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 23 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\t/**\n\t * Copyright 2014 Craig Campbell\n\t *\n\t * Licensed under the Apache License, Version 2.0 (the \"License\");\n\t * you may not use this file except in compliance with the License.\n\t * You may obtain a copy of the License at\n\t *\n\t * http://www.apache.org/licenses/LICENSE-2.0\n\t *\n\t * Unless required by applicable law or agreed to in writing, software\n\t * distributed under the License is distributed on an \"AS IS\" BASIS,\n\t * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n\t * See the License for the specific language governing permissions and\n\t * limitations under the License.\n\t *\n\t * GATOR.JS\n\t * Simple Event Delegation\n\t *\n\t * @version 1.2.4\n\t *\n\t * Compatible with IE 9+, FF 3.6+, Safari 5+, Chrome\n\t *\n\t * Include legacy.js for compatibility with older browsers\n\t *\n\t *             .-._   _ _ _ _ _ _ _ _\n\t *  .-''-.__.-'00  '-' ' ' ' ' ' ' ' '-.\n\t * '.___ '    .   .--_'-' '-' '-' _'-' '._\n\t *  V: V 'vv-'   '_   '.       .'  _..' '.'.\n\t *    '=.____.=_.--'   :_.__.__:_   '.   : :\n\t *            (((____.-'        '-.  /   : :\n\t *                              (((-'\\ .' /\n\t *                            _____..'  .'\n\t *                           '-._____.-'\n\t */\n\t(function () {\n\t    var _matcher,\n\t        _level = 0,\n\t        _id = 0,\n\t        _handlers = {},\n\t        _gatorInstances = {};\n\t\n\t    function _addEvent(gator, type, callback) {\n\t\n\t        // blur and focus do not bubble up but if you use event capturing\n\t        // then you will get them\n\t        var useCapture = type == 'blur' || type == 'focus';\n\t        gator.element.addEventListener(type, callback, useCapture);\n\t    }\n\t\n\t    function _cancel(e) {\n\t        e.preventDefault();\n\t        e.stopPropagation();\n\t    }\n\t\n\t    /**\n\t     * returns function to use for determining if an element\n\t     * matches a query selector\n\t     *\n\t     * @returns {Function}\n\t     */\n\t    function _getMatcher(element) {\n\t        if (_matcher) {\n\t            return _matcher;\n\t        }\n\t\n\t        if (element.matches) {\n\t            _matcher = element.matches;\n\t            return _matcher;\n\t        }\n\t\n\t        if (element.webkitMatchesSelector) {\n\t            _matcher = element.webkitMatchesSelector;\n\t            return _matcher;\n\t        }\n\t\n\t        if (element.mozMatchesSelector) {\n\t            _matcher = element.mozMatchesSelector;\n\t            return _matcher;\n\t        }\n\t\n\t        if (element.msMatchesSelector) {\n\t            _matcher = element.msMatchesSelector;\n\t            return _matcher;\n\t        }\n\t\n\t        if (element.oMatchesSelector) {\n\t            _matcher = element.oMatchesSelector;\n\t            return _matcher;\n\t        }\n\t\n\t        // if it doesn't match a native browser method\n\t        // fall back to the gator function\n\t        _matcher = Gator.matchesSelector;\n\t        return _matcher;\n\t    }\n\t\n\t    /**\n\t     * determines if the specified element matches a given selector\n\t     *\n\t     * @param {Node} element - the element to compare against the selector\n\t     * @param {string} selector\n\t     * @param {Node} boundElement - the element the listener was attached to\n\t     * @returns {void|Node}\n\t     */\n\t    function _matchesSelector(element, selector, boundElement) {\n\t\n\t        // no selector means this event was bound directly to this element\n\t        if (selector == '_root') {\n\t            return boundElement;\n\t        }\n\t\n\t        // if we have moved up to the element you bound the event to\n\t        // then we have come too far\n\t        if (element === boundElement) {\n\t            return;\n\t        }\n\t\n\t        // if this is a match then we are done!\n\t        if (_getMatcher(element).call(element, selector)) {\n\t            return element;\n\t        }\n\t\n\t        // if this element did not match but has a parent we should try\n\t        // going up the tree to see if any of the parent elements match\n\t        // for example if you are looking for a click on an <a> tag but there\n\t        // is a <span> inside of the a tag that it is the target,\n\t        // it should still work\n\t        if (element.parentNode) {\n\t            _level++;\n\t            return _matchesSelector(element.parentNode, selector, boundElement);\n\t        }\n\t    }\n\t\n\t    function _addHandler(gator, event, selector, callback) {\n\t        if (!_handlers[gator.id]) {\n\t            _handlers[gator.id] = {};\n\t        }\n\t\n\t        if (!_handlers[gator.id][event]) {\n\t            _handlers[gator.id][event] = {};\n\t        }\n\t\n\t        if (!_handlers[gator.id][event][selector]) {\n\t            _handlers[gator.id][event][selector] = [];\n\t        }\n\t\n\t        _handlers[gator.id][event][selector].push(callback);\n\t    }\n\t\n\t    function _removeHandler(gator, event, selector, callback) {\n\t\n\t        // if there are no events tied to this element at all\n\t        // then don't do anything\n\t        if (!_handlers[gator.id]) {\n\t            return;\n\t        }\n\t\n\t        // if there is no event type specified then remove all events\n\t        // example: Gator(element).off()\n\t        if (!event) {\n\t            for (var type in _handlers[gator.id]) {\n\t                if (_handlers[gator.id].hasOwnProperty(type)) {\n\t                    _handlers[gator.id][type] = {};\n\t                }\n\t            }\n\t            return;\n\t        }\n\t\n\t        // if no callback or selector is specified remove all events of this type\n\t        // example: Gator(element).off('click')\n\t        if (!callback && !selector) {\n\t            _handlers[gator.id][event] = {};\n\t            return;\n\t        }\n\t\n\t        // if a selector is specified but no callback remove all events\n\t        // for this selector\n\t        // example: Gator(element).off('click', '.sub-element')\n\t        if (!callback) {\n\t            delete _handlers[gator.id][event][selector];\n\t            return;\n\t        }\n\t\n\t        // if we have specified an event type, selector, and callback then we\n\t        // need to make sure there are callbacks tied to this selector to\n\t        // begin with.  if there aren't then we can stop here\n\t        if (!_handlers[gator.id][event][selector]) {\n\t            return;\n\t        }\n\t\n\t        // if there are then loop through all the callbacks and if we find\n\t        // one that matches remove it from the array\n\t        for (var i = 0; i < _handlers[gator.id][event][selector].length; i++) {\n\t            if (_handlers[gator.id][event][selector][i] === callback) {\n\t                _handlers[gator.id][event][selector].splice(i, 1);\n\t                break;\n\t            }\n\t        }\n\t    }\n\t\n\t    function _handleEvent(id, e, type) {\n\t        if (!_handlers[id][type]) {\n\t            return;\n\t        }\n\t\n\t        var target = e.target || e.srcElement,\n\t            selector,\n\t            match,\n\t            matches = {},\n\t            i = 0,\n\t            j = 0;\n\t\n\t        // find all events that match\n\t        _level = 0;\n\t        for (selector in _handlers[id][type]) {\n\t            if (_handlers[id][type].hasOwnProperty(selector)) {\n\t                match = _matchesSelector(target, selector, _gatorInstances[id].element);\n\t\n\t                if (match && Gator.matchesEvent(type, _gatorInstances[id].element, match, selector == '_root', e)) {\n\t                    _level++;\n\t                    _handlers[id][type][selector].match = match;\n\t                    matches[_level] = _handlers[id][type][selector];\n\t                }\n\t            }\n\t        }\n\t\n\t        // stopPropagation() fails to set cancelBubble to true in Webkit\n\t        // @see http://code.google.com/p/chromium/issues/detail?id=162270\n\t        e.stopPropagation = function () {\n\t            e.cancelBubble = true;\n\t        };\n\t\n\t        for (i = 0; i <= _level; i++) {\n\t            if (matches[i]) {\n\t                for (j = 0; j < matches[i].length; j++) {\n\t                    if (matches[i][j].call(matches[i].match, e) === false) {\n\t                        Gator.cancel(e);\n\t                        return;\n\t                    }\n\t\n\t                    if (e.cancelBubble) {\n\t                        return;\n\t                    }\n\t                }\n\t            }\n\t        }\n\t    }\n\t\n\t    /**\n\t     * binds the specified events to the element\n\t     *\n\t     * @param {string|Array} events\n\t     * @param {string} selector\n\t     * @param {Function} callback\n\t     * @param {boolean=} remove\n\t     * @returns {Object}\n\t     */\n\t    function _bind(events, selector, callback, remove) {\n\t\n\t        // fail silently if you pass null or undefined as an alement\n\t        // in the Gator constructor\n\t        if (!this.element) {\n\t            return;\n\t        }\n\t\n\t        if (!(events instanceof Array)) {\n\t            events = [events];\n\t        }\n\t\n\t        if (!callback && typeof selector == 'function') {\n\t            callback = selector;\n\t            selector = '_root';\n\t        }\n\t\n\t        var id = this.id,\n\t            i;\n\t\n\t        function _getGlobalCallback(type) {\n\t            return function (e) {\n\t                _handleEvent(id, e, type);\n\t            };\n\t        }\n\t\n\t        for (i = 0; i < events.length; i++) {\n\t            if (remove) {\n\t                _removeHandler(this, events[i], selector, callback);\n\t                continue;\n\t            }\n\t\n\t            if (!_handlers[id] || !_handlers[id][events[i]]) {\n\t                Gator.addEvent(this, events[i], _getGlobalCallback(events[i]));\n\t            }\n\t\n\t            _addHandler(this, events[i], selector, callback);\n\t        }\n\t\n\t        return this;\n\t    }\n\t\n\t    /**\n\t     * Gator object constructor\n\t     *\n\t     * @param {Node} element\n\t     */\n\t    function Gator(element, id) {\n\t\n\t        // called as function\n\t        if (!(this instanceof Gator)) {\n\t            // only keep one Gator instance per node to make sure that\n\t            // we don't create a ton of new objects if you want to delegate\n\t            // multiple events from the same node\n\t            //\n\t            // for example: Gator(document).on(...\n\t            for (var key in _gatorInstances) {\n\t                if (_gatorInstances[key].element === element) {\n\t                    return _gatorInstances[key];\n\t                }\n\t            }\n\t\n\t            _id++;\n\t            _gatorInstances[_id] = new Gator(element, _id);\n\t\n\t            return _gatorInstances[_id];\n\t        }\n\t\n\t        this.element = element;\n\t        this.id = id;\n\t    }\n\t\n\t    /**\n\t     * adds an event\n\t     *\n\t     * @param {string|Array} events\n\t     * @param {string} selector\n\t     * @param {Function} callback\n\t     * @returns {Object}\n\t     */\n\t    Gator.prototype.on = function (events, selector, callback) {\n\t        return _bind.call(this, events, selector, callback);\n\t    };\n\t\n\t    /**\n\t     * removes an event\n\t     *\n\t     * @param {string|Array} events\n\t     * @param {string} selector\n\t     * @param {Function} callback\n\t     * @returns {Object}\n\t     */\n\t    Gator.prototype.off = function (events, selector, callback) {\n\t        return _bind.call(this, events, selector, callback, true);\n\t    };\n\t\n\t    Gator.matchesSelector = function () {};\n\t    Gator.cancel = _cancel;\n\t    Gator.addEvent = _addEvent;\n\t    Gator.matchesEvent = function () {\n\t        return true;\n\t    };\n\t\n\t    if (typeof module !== 'undefined' && module.exports) {\n\t        module.exports = Gator;\n\t    }\n\t\n\t    window.Gator = Gator;\n\t})();\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** app.min.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap d93fc0d6f2d278c250ea\n **/","/*!\n * @overview es6-promise - a tiny implementation of Promises/A+.\n * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)\n * @license   Licensed under MIT license\n *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE\n * @version   4.0.2\n */\n\n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define(factory) :\n    (global.ES6Promise = factory());\n}(this, (function () { 'use strict';\n\nfunction objectOrFunction(x) {\n  return typeof x === 'function' || typeof x === 'object' && x !== null;\n}\n\nfunction isFunction(x) {\n  return typeof x === 'function';\n}\n\nvar _isArray = undefined;\nif (!Array.isArray) {\n  _isArray = function (x) {\n    return Object.prototype.toString.call(x) === '[object Array]';\n  };\n} else {\n  _isArray = Array.isArray;\n}\n\nvar isArray = _isArray;\n\nvar len = 0;\nvar vertxNext = undefined;\nvar customSchedulerFn = undefined;\n\nvar asap = function asap(callback, arg) {\n  queue[len] = callback;\n  queue[len + 1] = arg;\n  len += 2;\n  if (len === 2) {\n    // If len is 2, that means that we need to schedule an async flush.\n    // If additional callbacks are queued before the queue is flushed, they\n    // will be processed by this flush that we are scheduling.\n    if (customSchedulerFn) {\n      customSchedulerFn(flush);\n    } else {\n      scheduleFlush();\n    }\n  }\n};\n\nfunction setScheduler(scheduleFn) {\n  customSchedulerFn = scheduleFn;\n}\n\nfunction setAsap(asapFn) {\n  asap = asapFn;\n}\n\nvar browserWindow = typeof window !== 'undefined' ? window : undefined;\nvar browserGlobal = browserWindow || {};\nvar BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;\nvar isNode = typeof self === 'undefined' && typeof process !== 'undefined' && ({}).toString.call(process) === '[object process]';\n\n// test for web worker but not in IE10\nvar isWorker = typeof Uint8ClampedArray !== 'undefined' && typeof importScripts !== 'undefined' && typeof MessageChannel !== 'undefined';\n\n// node\nfunction useNextTick() {\n  // node version 0.10.x displays a deprecation warning when nextTick is used recursively\n  // see https://github.com/cujojs/when/issues/410 for details\n  return function () {\n    return process.nextTick(flush);\n  };\n}\n\n// vertx\nfunction useVertxTimer() {\n  return function () {\n    vertxNext(flush);\n  };\n}\n\nfunction useMutationObserver() {\n  var iterations = 0;\n  var observer = new BrowserMutationObserver(flush);\n  var node = document.createTextNode('');\n  observer.observe(node, { characterData: true });\n\n  return function () {\n    node.data = iterations = ++iterations % 2;\n  };\n}\n\n// web worker\nfunction useMessageChannel() {\n  var channel = new MessageChannel();\n  channel.port1.onmessage = flush;\n  return function () {\n    return channel.port2.postMessage(0);\n  };\n}\n\nfunction useSetTimeout() {\n  // Store setTimeout reference so es6-promise will be unaffected by\n  // other code modifying setTimeout (like sinon.useFakeTimers())\n  var globalSetTimeout = setTimeout;\n  return function () {\n    return globalSetTimeout(flush, 1);\n  };\n}\n\nvar queue = new Array(1000);\nfunction flush() {\n  for (var i = 0; i < len; i += 2) {\n    var callback = queue[i];\n    var arg = queue[i + 1];\n\n    callback(arg);\n\n    queue[i] = undefined;\n    queue[i + 1] = undefined;\n  }\n\n  len = 0;\n}\n\nfunction attemptVertx() {\n  try {\n    var r = require;\n    var vertx = r('vertx');\n    vertxNext = vertx.runOnLoop || vertx.runOnContext;\n    return useVertxTimer();\n  } catch (e) {\n    return useSetTimeout();\n  }\n}\n\nvar scheduleFlush = undefined;\n// Decide what async method to use to triggering processing of queued callbacks:\nif (isNode) {\n  scheduleFlush = useNextTick();\n} else if (BrowserMutationObserver) {\n  scheduleFlush = useMutationObserver();\n} else if (isWorker) {\n  scheduleFlush = useMessageChannel();\n} else if (browserWindow === undefined && typeof require === 'function') {\n  scheduleFlush = attemptVertx();\n} else {\n  scheduleFlush = useSetTimeout();\n}\n\nfunction then(onFulfillment, onRejection) {\n  var _arguments = arguments;\n\n  var parent = this;\n\n  var child = new this.constructor(noop);\n\n  if (child[PROMISE_ID] === undefined) {\n    makePromise(child);\n  }\n\n  var _state = parent._state;\n\n  if (_state) {\n    (function () {\n      var callback = _arguments[_state - 1];\n      asap(function () {\n        return invokeCallback(_state, child, callback, parent._result);\n      });\n    })();\n  } else {\n    subscribe(parent, child, onFulfillment, onRejection);\n  }\n\n  return child;\n}\n\n/**\n  `Promise.resolve` returns a promise that will become resolved with the\n  passed `value`. It is shorthand for the following:\n\n  ```javascript\n  let promise = new Promise(function(resolve, reject){\n    resolve(1);\n  });\n\n  promise.then(function(value){\n    // value === 1\n  });\n  ```\n\n  Instead of writing the above, your code now simply becomes the following:\n\n  ```javascript\n  let promise = Promise.resolve(1);\n\n  promise.then(function(value){\n    // value === 1\n  });\n  ```\n\n  @method resolve\n  @static\n  @param {Any} value value that the returned promise will be resolved with\n  Useful for tooling.\n  @return {Promise} a promise that will become fulfilled with the given\n  `value`\n*/\nfunction resolve(object) {\n  /*jshint validthis:true */\n  var Constructor = this;\n\n  if (object && typeof object === 'object' && object.constructor === Constructor) {\n    return object;\n  }\n\n  var promise = new Constructor(noop);\n  _resolve(promise, object);\n  return promise;\n}\n\nvar PROMISE_ID = Math.random().toString(36).substring(16);\n\nfunction noop() {}\n\nvar PENDING = void 0;\nvar FULFILLED = 1;\nvar REJECTED = 2;\n\nvar GET_THEN_ERROR = new ErrorObject();\n\nfunction selfFulfillment() {\n  return new TypeError(\"You cannot resolve a promise with itself\");\n}\n\nfunction cannotReturnOwn() {\n  return new TypeError('A promises callback cannot return that same promise.');\n}\n\nfunction getThen(promise) {\n  try {\n    return promise.then;\n  } catch (error) {\n    GET_THEN_ERROR.error = error;\n    return GET_THEN_ERROR;\n  }\n}\n\nfunction tryThen(then, value, fulfillmentHandler, rejectionHandler) {\n  try {\n    then.call(value, fulfillmentHandler, rejectionHandler);\n  } catch (e) {\n    return e;\n  }\n}\n\nfunction handleForeignThenable(promise, thenable, then) {\n  asap(function (promise) {\n    var sealed = false;\n    var error = tryThen(then, thenable, function (value) {\n      if (sealed) {\n        return;\n      }\n      sealed = true;\n      if (thenable !== value) {\n        _resolve(promise, value);\n      } else {\n        fulfill(promise, value);\n      }\n    }, function (reason) {\n      if (sealed) {\n        return;\n      }\n      sealed = true;\n\n      _reject(promise, reason);\n    }, 'Settle: ' + (promise._label || ' unknown promise'));\n\n    if (!sealed && error) {\n      sealed = true;\n      _reject(promise, error);\n    }\n  }, promise);\n}\n\nfunction handleOwnThenable(promise, thenable) {\n  if (thenable._state === FULFILLED) {\n    fulfill(promise, thenable._result);\n  } else if (thenable._state === REJECTED) {\n    _reject(promise, thenable._result);\n  } else {\n    subscribe(thenable, undefined, function (value) {\n      return _resolve(promise, value);\n    }, function (reason) {\n      return _reject(promise, reason);\n    });\n  }\n}\n\nfunction handleMaybeThenable(promise, maybeThenable, then$$) {\n  if (maybeThenable.constructor === promise.constructor && then$$ === then && maybeThenable.constructor.resolve === resolve) {\n    handleOwnThenable(promise, maybeThenable);\n  } else {\n    if (then$$ === GET_THEN_ERROR) {\n      _reject(promise, GET_THEN_ERROR.error);\n    } else if (then$$ === undefined) {\n      fulfill(promise, maybeThenable);\n    } else if (isFunction(then$$)) {\n      handleForeignThenable(promise, maybeThenable, then$$);\n    } else {\n      fulfill(promise, maybeThenable);\n    }\n  }\n}\n\nfunction _resolve(promise, value) {\n  if (promise === value) {\n    _reject(promise, selfFulfillment());\n  } else if (objectOrFunction(value)) {\n    handleMaybeThenable(promise, value, getThen(value));\n  } else {\n    fulfill(promise, value);\n  }\n}\n\nfunction publishRejection(promise) {\n  if (promise._onerror) {\n    promise._onerror(promise._result);\n  }\n\n  publish(promise);\n}\n\nfunction fulfill(promise, value) {\n  if (promise._state !== PENDING) {\n    return;\n  }\n\n  promise._result = value;\n  promise._state = FULFILLED;\n\n  if (promise._subscribers.length !== 0) {\n    asap(publish, promise);\n  }\n}\n\nfunction _reject(promise, reason) {\n  if (promise._state !== PENDING) {\n    return;\n  }\n  promise._state = REJECTED;\n  promise._result = reason;\n\n  asap(publishRejection, promise);\n}\n\nfunction subscribe(parent, child, onFulfillment, onRejection) {\n  var _subscribers = parent._subscribers;\n  var length = _subscribers.length;\n\n  parent._onerror = null;\n\n  _subscribers[length] = child;\n  _subscribers[length + FULFILLED] = onFulfillment;\n  _subscribers[length + REJECTED] = onRejection;\n\n  if (length === 0 && parent._state) {\n    asap(publish, parent);\n  }\n}\n\nfunction publish(promise) {\n  var subscribers = promise._subscribers;\n  var settled = promise._state;\n\n  if (subscribers.length === 0) {\n    return;\n  }\n\n  var child = undefined,\n      callback = undefined,\n      detail = promise._result;\n\n  for (var i = 0; i < subscribers.length; i += 3) {\n    child = subscribers[i];\n    callback = subscribers[i + settled];\n\n    if (child) {\n      invokeCallback(settled, child, callback, detail);\n    } else {\n      callback(detail);\n    }\n  }\n\n  promise._subscribers.length = 0;\n}\n\nfunction ErrorObject() {\n  this.error = null;\n}\n\nvar TRY_CATCH_ERROR = new ErrorObject();\n\nfunction tryCatch(callback, detail) {\n  try {\n    return callback(detail);\n  } catch (e) {\n    TRY_CATCH_ERROR.error = e;\n    return TRY_CATCH_ERROR;\n  }\n}\n\nfunction invokeCallback(settled, promise, callback, detail) {\n  var hasCallback = isFunction(callback),\n      value = undefined,\n      error = undefined,\n      succeeded = undefined,\n      failed = undefined;\n\n  if (hasCallback) {\n    value = tryCatch(callback, detail);\n\n    if (value === TRY_CATCH_ERROR) {\n      failed = true;\n      error = value.error;\n      value = null;\n    } else {\n      succeeded = true;\n    }\n\n    if (promise === value) {\n      _reject(promise, cannotReturnOwn());\n      return;\n    }\n  } else {\n    value = detail;\n    succeeded = true;\n  }\n\n  if (promise._state !== PENDING) {\n    // noop\n  } else if (hasCallback && succeeded) {\n      _resolve(promise, value);\n    } else if (failed) {\n      _reject(promise, error);\n    } else if (settled === FULFILLED) {\n      fulfill(promise, value);\n    } else if (settled === REJECTED) {\n      _reject(promise, value);\n    }\n}\n\nfunction initializePromise(promise, resolver) {\n  try {\n    resolver(function resolvePromise(value) {\n      _resolve(promise, value);\n    }, function rejectPromise(reason) {\n      _reject(promise, reason);\n    });\n  } catch (e) {\n    _reject(promise, e);\n  }\n}\n\nvar id = 0;\nfunction nextId() {\n  return id++;\n}\n\nfunction makePromise(promise) {\n  promise[PROMISE_ID] = id++;\n  promise._state = undefined;\n  promise._result = undefined;\n  promise._subscribers = [];\n}\n\nfunction Enumerator(Constructor, input) {\n  this._instanceConstructor = Constructor;\n  this.promise = new Constructor(noop);\n\n  if (!this.promise[PROMISE_ID]) {\n    makePromise(this.promise);\n  }\n\n  if (isArray(input)) {\n    this._input = input;\n    this.length = input.length;\n    this._remaining = input.length;\n\n    this._result = new Array(this.length);\n\n    if (this.length === 0) {\n      fulfill(this.promise, this._result);\n    } else {\n      this.length = this.length || 0;\n      this._enumerate();\n      if (this._remaining === 0) {\n        fulfill(this.promise, this._result);\n      }\n    }\n  } else {\n    _reject(this.promise, validationError());\n  }\n}\n\nfunction validationError() {\n  return new Error('Array Methods must be provided an Array');\n};\n\nEnumerator.prototype._enumerate = function () {\n  var length = this.length;\n  var _input = this._input;\n\n  for (var i = 0; this._state === PENDING && i < length; i++) {\n    this._eachEntry(_input[i], i);\n  }\n};\n\nEnumerator.prototype._eachEntry = function (entry, i) {\n  var c = this._instanceConstructor;\n  var resolve$$ = c.resolve;\n\n  if (resolve$$ === resolve) {\n    var _then = getThen(entry);\n\n    if (_then === then && entry._state !== PENDING) {\n      this._settledAt(entry._state, i, entry._result);\n    } else if (typeof _then !== 'function') {\n      this._remaining--;\n      this._result[i] = entry;\n    } else if (c === Promise) {\n      var promise = new c(noop);\n      handleMaybeThenable(promise, entry, _then);\n      this._willSettleAt(promise, i);\n    } else {\n      this._willSettleAt(new c(function (resolve$$) {\n        return resolve$$(entry);\n      }), i);\n    }\n  } else {\n    this._willSettleAt(resolve$$(entry), i);\n  }\n};\n\nEnumerator.prototype._settledAt = function (state, i, value) {\n  var promise = this.promise;\n\n  if (promise._state === PENDING) {\n    this._remaining--;\n\n    if (state === REJECTED) {\n      _reject(promise, value);\n    } else {\n      this._result[i] = value;\n    }\n  }\n\n  if (this._remaining === 0) {\n    fulfill(promise, this._result);\n  }\n};\n\nEnumerator.prototype._willSettleAt = function (promise, i) {\n  var enumerator = this;\n\n  subscribe(promise, undefined, function (value) {\n    return enumerator._settledAt(FULFILLED, i, value);\n  }, function (reason) {\n    return enumerator._settledAt(REJECTED, i, reason);\n  });\n};\n\n/**\n  `Promise.all` accepts an array of promises, and returns a new promise which\n  is fulfilled with an array of fulfillment values for the passed promises, or\n  rejected with the reason of the first passed promise to be rejected. It casts all\n  elements of the passed iterable to promises as it runs this algorithm.\n\n  Example:\n\n  ```javascript\n  let promise1 = resolve(1);\n  let promise2 = resolve(2);\n  let promise3 = resolve(3);\n  let promises = [ promise1, promise2, promise3 ];\n\n  Promise.all(promises).then(function(array){\n    // The array here would be [ 1, 2, 3 ];\n  });\n  ```\n\n  If any of the `promises` given to `all` are rejected, the first promise\n  that is rejected will be given as an argument to the returned promises's\n  rejection handler. For example:\n\n  Example:\n\n  ```javascript\n  let promise1 = resolve(1);\n  let promise2 = reject(new Error(\"2\"));\n  let promise3 = reject(new Error(\"3\"));\n  let promises = [ promise1, promise2, promise3 ];\n\n  Promise.all(promises).then(function(array){\n    // Code here never runs because there are rejected promises!\n  }, function(error) {\n    // error.message === \"2\"\n  });\n  ```\n\n  @method all\n  @static\n  @param {Array} entries array of promises\n  @param {String} label optional string for labeling the promise.\n  Useful for tooling.\n  @return {Promise} promise that is fulfilled when all `promises` have been\n  fulfilled, or rejected if any of them become rejected.\n  @static\n*/\nfunction all(entries) {\n  return new Enumerator(this, entries).promise;\n}\n\n/**\n  `Promise.race` returns a new promise which is settled in the same way as the\n  first passed promise to settle.\n\n  Example:\n\n  ```javascript\n  let promise1 = new Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve('promise 1');\n    }, 200);\n  });\n\n  let promise2 = new Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve('promise 2');\n    }, 100);\n  });\n\n  Promise.race([promise1, promise2]).then(function(result){\n    // result === 'promise 2' because it was resolved before promise1\n    // was resolved.\n  });\n  ```\n\n  `Promise.race` is deterministic in that only the state of the first\n  settled promise matters. For example, even if other promises given to the\n  `promises` array argument are resolved, but the first settled promise has\n  become rejected before the other promises became fulfilled, the returned\n  promise will become rejected:\n\n  ```javascript\n  let promise1 = new Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve('promise 1');\n    }, 200);\n  });\n\n  let promise2 = new Promise(function(resolve, reject){\n    setTimeout(function(){\n      reject(new Error('promise 2'));\n    }, 100);\n  });\n\n  Promise.race([promise1, promise2]).then(function(result){\n    // Code here never runs\n  }, function(reason){\n    // reason.message === 'promise 2' because promise 2 became rejected before\n    // promise 1 became fulfilled\n  });\n  ```\n\n  An example real-world use case is implementing timeouts:\n\n  ```javascript\n  Promise.race([ajax('foo.json'), timeout(5000)])\n  ```\n\n  @method race\n  @static\n  @param {Array} promises array of promises to observe\n  Useful for tooling.\n  @return {Promise} a promise which settles in the same way as the first passed\n  promise to settle.\n*/\nfunction race(entries) {\n  /*jshint validthis:true */\n  var Constructor = this;\n\n  if (!isArray(entries)) {\n    return new Constructor(function (_, reject) {\n      return reject(new TypeError('You must pass an array to race.'));\n    });\n  } else {\n    return new Constructor(function (resolve, reject) {\n      var length = entries.length;\n      for (var i = 0; i < length; i++) {\n        Constructor.resolve(entries[i]).then(resolve, reject);\n      }\n    });\n  }\n}\n\n/**\n  `Promise.reject` returns a promise rejected with the passed `reason`.\n  It is shorthand for the following:\n\n  ```javascript\n  let promise = new Promise(function(resolve, reject){\n    reject(new Error('WHOOPS'));\n  });\n\n  promise.then(function(value){\n    // Code here doesn't run because the promise is rejected!\n  }, function(reason){\n    // reason.message === 'WHOOPS'\n  });\n  ```\n\n  Instead of writing the above, your code now simply becomes the following:\n\n  ```javascript\n  let promise = Promise.reject(new Error('WHOOPS'));\n\n  promise.then(function(value){\n    // Code here doesn't run because the promise is rejected!\n  }, function(reason){\n    // reason.message === 'WHOOPS'\n  });\n  ```\n\n  @method reject\n  @static\n  @param {Any} reason value that the returned promise will be rejected with.\n  Useful for tooling.\n  @return {Promise} a promise rejected with the given `reason`.\n*/\nfunction reject(reason) {\n  /*jshint validthis:true */\n  var Constructor = this;\n  var promise = new Constructor(noop);\n  _reject(promise, reason);\n  return promise;\n}\n\nfunction needsResolver() {\n  throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');\n}\n\nfunction needsNew() {\n  throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\");\n}\n\n/**\n  Promise objects represent the eventual result of an asynchronous operation. The\n  primary way of interacting with a promise is through its `then` method, which\n  registers callbacks to receive either a promise's eventual value or the reason\n  why the promise cannot be fulfilled.\n\n  Terminology\n  -----------\n\n  - `promise` is an object or function with a `then` method whose behavior conforms to this specification.\n  - `thenable` is an object or function that defines a `then` method.\n  - `value` is any legal JavaScript value (including undefined, a thenable, or a promise).\n  - `exception` is a value that is thrown using the throw statement.\n  - `reason` is a value that indicates why a promise was rejected.\n  - `settled` the final resting state of a promise, fulfilled or rejected.\n\n  A promise can be in one of three states: pending, fulfilled, or rejected.\n\n  Promises that are fulfilled have a fulfillment value and are in the fulfilled\n  state.  Promises that are rejected have a rejection reason and are in the\n  rejected state.  A fulfillment value is never a thenable.\n\n  Promises can also be said to *resolve* a value.  If this value is also a\n  promise, then the original promise's settled state will match the value's\n  settled state.  So a promise that *resolves* a promise that rejects will\n  itself reject, and a promise that *resolves* a promise that fulfills will\n  itself fulfill.\n\n\n  Basic Usage:\n  ------------\n\n  ```js\n  let promise = new Promise(function(resolve, reject) {\n    // on success\n    resolve(value);\n\n    // on failure\n    reject(reason);\n  });\n\n  promise.then(function(value) {\n    // on fulfillment\n  }, function(reason) {\n    // on rejection\n  });\n  ```\n\n  Advanced Usage:\n  ---------------\n\n  Promises shine when abstracting away asynchronous interactions such as\n  `XMLHttpRequest`s.\n\n  ```js\n  function getJSON(url) {\n    return new Promise(function(resolve, reject){\n      let xhr = new XMLHttpRequest();\n\n      xhr.open('GET', url);\n      xhr.onreadystatechange = handler;\n      xhr.responseType = 'json';\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send();\n\n      function handler() {\n        if (this.readyState === this.DONE) {\n          if (this.status === 200) {\n            resolve(this.response);\n          } else {\n            reject(new Error('getJSON: `' + url + '` failed with status: [' + this.status + ']'));\n          }\n        }\n      };\n    });\n  }\n\n  getJSON('/posts.json').then(function(json) {\n    // on fulfillment\n  }, function(reason) {\n    // on rejection\n  });\n  ```\n\n  Unlike callbacks, promises are great composable primitives.\n\n  ```js\n  Promise.all([\n    getJSON('/posts'),\n    getJSON('/comments')\n  ]).then(function(values){\n    values[0] // => postsJSON\n    values[1] // => commentsJSON\n\n    return values;\n  });\n  ```\n\n  @class Promise\n  @param {function} resolver\n  Useful for tooling.\n  @constructor\n*/\nfunction Promise(resolver) {\n  this[PROMISE_ID] = nextId();\n  this._result = this._state = undefined;\n  this._subscribers = [];\n\n  if (noop !== resolver) {\n    typeof resolver !== 'function' && needsResolver();\n    this instanceof Promise ? initializePromise(this, resolver) : needsNew();\n  }\n}\n\nPromise.all = all;\nPromise.race = race;\nPromise.resolve = resolve;\nPromise.reject = reject;\nPromise._setScheduler = setScheduler;\nPromise._setAsap = setAsap;\nPromise._asap = asap;\n\nPromise.prototype = {\n  constructor: Promise,\n\n  /**\n    The primary way of interacting with a promise is through its `then` method,\n    which registers callbacks to receive either a promise's eventual value or the\n    reason why the promise cannot be fulfilled.\n  \n    ```js\n    findUser().then(function(user){\n      // user is available\n    }, function(reason){\n      // user is unavailable, and you are given the reason why\n    });\n    ```\n  \n    Chaining\n    --------\n  \n    The return value of `then` is itself a promise.  This second, 'downstream'\n    promise is resolved with the return value of the first promise's fulfillment\n    or rejection handler, or rejected if the handler throws an exception.\n  \n    ```js\n    findUser().then(function (user) {\n      return user.name;\n    }, function (reason) {\n      return 'default name';\n    }).then(function (userName) {\n      // If `findUser` fulfilled, `userName` will be the user's name, otherwise it\n      // will be `'default name'`\n    });\n  \n    findUser().then(function (user) {\n      throw new Error('Found user, but still unhappy');\n    }, function (reason) {\n      throw new Error('`findUser` rejected and we're unhappy');\n    }).then(function (value) {\n      // never reached\n    }, function (reason) {\n      // if `findUser` fulfilled, `reason` will be 'Found user, but still unhappy'.\n      // If `findUser` rejected, `reason` will be '`findUser` rejected and we're unhappy'.\n    });\n    ```\n    If the downstream promise does not specify a rejection handler, rejection reasons will be propagated further downstream.\n  \n    ```js\n    findUser().then(function (user) {\n      throw new PedagogicalException('Upstream error');\n    }).then(function (value) {\n      // never reached\n    }).then(function (value) {\n      // never reached\n    }, function (reason) {\n      // The `PedgagocialException` is propagated all the way down to here\n    });\n    ```\n  \n    Assimilation\n    ------------\n  \n    Sometimes the value you want to propagate to a downstream promise can only be\n    retrieved asynchronously. This can be achieved by returning a promise in the\n    fulfillment or rejection handler. The downstream promise will then be pending\n    until the returned promise is settled. This is called *assimilation*.\n  \n    ```js\n    findUser().then(function (user) {\n      return findCommentsByAuthor(user);\n    }).then(function (comments) {\n      // The user's comments are now available\n    });\n    ```\n  \n    If the assimliated promise rejects, then the downstream promise will also reject.\n  \n    ```js\n    findUser().then(function (user) {\n      return findCommentsByAuthor(user);\n    }).then(function (comments) {\n      // If `findCommentsByAuthor` fulfills, we'll have the value here\n    }, function (reason) {\n      // If `findCommentsByAuthor` rejects, we'll have the reason here\n    });\n    ```\n  \n    Simple Example\n    --------------\n  \n    Synchronous Example\n  \n    ```javascript\n    let result;\n  \n    try {\n      result = findResult();\n      // success\n    } catch(reason) {\n      // failure\n    }\n    ```\n  \n    Errback Example\n  \n    ```js\n    findResult(function(result, err){\n      if (err) {\n        // failure\n      } else {\n        // success\n      }\n    });\n    ```\n  \n    Promise Example;\n  \n    ```javascript\n    findResult().then(function(result){\n      // success\n    }, function(reason){\n      // failure\n    });\n    ```\n  \n    Advanced Example\n    --------------\n  \n    Synchronous Example\n  \n    ```javascript\n    let author, books;\n  \n    try {\n      author = findAuthor();\n      books  = findBooksByAuthor(author);\n      // success\n    } catch(reason) {\n      // failure\n    }\n    ```\n  \n    Errback Example\n  \n    ```js\n  \n    function foundBooks(books) {\n  \n    }\n  \n    function failure(reason) {\n  \n    }\n  \n    findAuthor(function(author, err){\n      if (err) {\n        failure(err);\n        // failure\n      } else {\n        try {\n          findBoooksByAuthor(author, function(books, err) {\n            if (err) {\n              failure(err);\n            } else {\n              try {\n                foundBooks(books);\n              } catch(reason) {\n                failure(reason);\n              }\n            }\n          });\n        } catch(error) {\n          failure(err);\n        }\n        // success\n      }\n    });\n    ```\n  \n    Promise Example;\n  \n    ```javascript\n    findAuthor().\n      then(findBooksByAuthor).\n      then(function(books){\n        // found books\n    }).catch(function(reason){\n      // something went wrong\n    });\n    ```\n  \n    @method then\n    @param {Function} onFulfilled\n    @param {Function} onRejected\n    Useful for tooling.\n    @return {Promise}\n  */\n  then: then,\n\n  /**\n    `catch` is simply sugar for `then(undefined, onRejection)` which makes it the same\n    as the catch block of a try/catch statement.\n  \n    ```js\n    function findAuthor(){\n      throw new Error('couldn't find that author');\n    }\n  \n    // synchronous\n    try {\n      findAuthor();\n    } catch(reason) {\n      // something went wrong\n    }\n  \n    // async with promises\n    findAuthor().catch(function(reason){\n      // something went wrong\n    });\n    ```\n  \n    @method catch\n    @param {Function} onRejection\n    Useful for tooling.\n    @return {Promise}\n  */\n  'catch': function _catch(onRejection) {\n    return this.then(null, onRejection);\n  }\n};\n\nfunction polyfill() {\n    var local = undefined;\n\n    if (typeof global !== 'undefined') {\n        local = global;\n    } else if (typeof self !== 'undefined') {\n        local = self;\n    } else {\n        try {\n            local = Function('return this')();\n        } catch (e) {\n            throw new Error('polyfill failed because global object is unavailable in this environment');\n        }\n    }\n\n    var P = local.Promise;\n\n    if (P) {\n        var promiseToString = null;\n        try {\n            promiseToString = Object.prototype.toString.call(P.resolve());\n        } catch (e) {\n            // silently ignored\n        }\n\n        if (promiseToString === '[object Promise]' && !P.cast) {\n            return;\n        }\n    }\n\n    local.Promise = Promise;\n}\n\n// Strange compat..\nPromise.polyfill = polyfill;\nPromise.Promise = Promise;\n\nreturn Promise;\n\n})));\n//# sourceMappingURL=es6-promise.map\n\n\n/** WEBPACK FOOTER **\n ** ./~/es6-promise/dist/es6-promise.js\n **/","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/process/browser.js\n **/","(function(self) {\n  'use strict';\n\n  if (self.fetch) {\n    return\n  }\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob: 'FileReader' in self && 'Blob' in self && (function() {\n      try {\n        new Blob()\n        return true\n      } catch(e) {\n        return false\n      }\n    })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift()\n        return {done: value === undefined, value: value}\n      }\n    }\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      }\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {}\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var list = this.map[name]\n    if (!list) {\n      list = []\n      this.map[name] = list\n    }\n    list.push(value)\n  }\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n\n  Headers.prototype.get = function(name) {\n    var values = this.map[normalizeName(name)]\n    return values ? values[0] : null\n  }\n\n  Headers.prototype.getAll = function(name) {\n    return this.map[normalizeName(name)] || []\n  }\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = [normalizeValue(value)]\n  }\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    Object.getOwnPropertyNames(this.map).forEach(function(name) {\n      this.map[name].forEach(function(value) {\n        callback.call(thisArg, value, name, this)\n      }, this)\n    }, this)\n  }\n\n  Headers.prototype.keys = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push(name) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.values = function() {\n    var items = []\n    this.forEach(function(value) { items.push(value) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.entries = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push([name, value]) })\n    return iteratorFor(items)\n  }\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    reader.readAsArrayBuffer(blob)\n    return fileReaderReady(reader)\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    reader.readAsText(blob)\n    return fileReaderReady(reader)\n  }\n\n  function Body() {\n    this.bodyUsed = false\n\n    this._initBody = function(body) {\n      this._bodyInit = body\n      if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString()\n      } else if (!body) {\n        this._bodyText = ''\n      } else if (support.arrayBuffer && ArrayBuffer.prototype.isPrototypeOf(body)) {\n        // Only support ArrayBuffers for POST method.\n        // Receiving ArrayBuffers happens via Blobs, instead.\n      } else {\n        throw new Error('unsupported BodyInit type')\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n        }\n      }\n    }\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n\n      this.arrayBuffer = function() {\n        return this.blob().then(readBlobAsArrayBuffer)\n      }\n\n      this.text = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return readBlobAsText(this._bodyBlob)\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as text')\n        } else {\n          return Promise.resolve(this._bodyText)\n        }\n      }\n    } else {\n      this.text = function() {\n        var rejected = consumed(this)\n        return rejected ? rejected : Promise.resolve(this._bodyText)\n      }\n    }\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return (methods.indexOf(upcased) > -1) ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n    if (Request.prototype.isPrototypeOf(input)) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      if (!body) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    } else {\n      this.url = input\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.referrer = null\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this)\n  }\n\n  function decode(body) {\n    var form = new FormData()\n    body.trim().split('&').forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n    return form\n  }\n\n  function headers(xhr) {\n    var head = new Headers()\n    var pairs = (xhr.getAllResponseHeaders() || '').trim().split('\\n')\n    pairs.forEach(function(header) {\n      var split = header.trim().split(':')\n      var key = split.shift().trim()\n      var value = split.join(':').trim()\n      head.append(key, value)\n    })\n    return head\n  }\n\n  Body.call(Request.prototype)\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n\n    this.type = 'default'\n    this.status = options.status\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = options.statusText\n    this.headers = options.headers instanceof Headers ? options.headers : new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n\n  Body.call(Response.prototype)\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n\n  var redirectStatuses = [301, 302, 303, 307, 308]\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  }\n\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n\n  self.fetch = function(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request\n      if (Request.prototype.isPrototypeOf(input) && !init) {\n        request = input\n      } else {\n        request = new Request(input, init)\n      }\n\n      var xhr = new XMLHttpRequest()\n\n      function responseURL() {\n        if ('responseURL' in xhr) {\n          return xhr.responseURL\n        }\n\n        // Avoid security warnings on getResponseHeader when not allowed by CORS\n        if (/^X-Request-URL:/m.test(xhr.getAllResponseHeaders())) {\n          return xhr.getResponseHeader('X-Request-URL')\n        }\n\n        return\n      }\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: headers(xhr),\n          url: responseURL()\n        }\n        var body = 'response' in xhr ? xhr.response : xhr.responseText\n        resolve(new Response(body, options))\n      }\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.open(request.method, request.url, true)\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob'\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  self.fetch.polyfill = true\n})(typeof self !== 'undefined' ? self : this);\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/whatwg-fetch/fetch.js\n **/","let Flingable = require( \"Flingable\" );\nlet Resizable = require( \"Resizable\" );\nlet ut = require( \"Utility\" );\nlet Modal = require( \"Modal\" );\nlet modalCanvasSize = require( \"modalCanvasSize\" );\nlet modalOpenPattern = require( \"modalOpenPattern\" );\nlet modalSavePattern = require( \"modalSavePattern\" );\nlet modalSharePattern = require( \"modalSharePattern\" );\nlet parseRLEPixelString = require( \"parseRLEPixelString\" );\nlet parseBMP = require( \"parseBMP\" );\nlet patToRleFileString = require( \"patToRleFileString\" );\nlet dataArrayToRLE = require( \"dataArrayToRLE\" );\nlet saveTextAsFile = require( \"saveTextAsFile\" );\nlet Hammer = require( \"hammerjs\" );\n\n// Tooltips imports Gator for easy event delegation.\nrequire( \"tooltips-and-stacking\" );\n\n// Note: Don't use the broken version of Keymaster on npm.\n// Lifey uses a modified version based on a fork of Keymaster which\n// supports direct binding to single modifier keys e.g. \"shift\":\n// https://github.com/madrobby/keymaster/pull/136\n// (The local version in modules also has other es6-related changes,\n// including not binding to window etc.)\nlet key = require( \"keymaster\" );\n\n//*******************************************\n//*******\n//******* ---- Elements ----\n//*******\n//*******************************************\n\nconst w = window;\nconst doc = document;\n\nconst htmlEl = doc.documentElement;\nconst bodyEl = doc.body;\n\nconst scrollSs = doc.querySelector( \"#scroll-stylesheet\" ).sheet;\n\nconst outerBgEl = doc.querySelector( \".outer-background\" );\nconst innerViewEl = doc.querySelector( \".inner-background\" );\nconst canvasEl = doc.querySelector( \".main-canvas\" );\nconst canvasCtx = canvasEl.getContext( \"2d\" );\n\nconst splashEl = doc.querySelector( \".splash\" );\n\nconst navCanvasEl = doc.querySelector( \".navigator__canvas\" );\nconst navCanvasCtx = navCanvasEl.getContext( \"2d\" );\nconst navOutlineEl = doc.querySelector( \".navigator__canvas-outline\" );\n\nconst toolboxEl = doc.querySelector( \"[data-toolbox]\" );\nconst toolboxButtonEls = doc.querySelectorAll( \".toolbox__button\" );\n\nconst infoCursorXEl = doc.querySelector( \"[data-info-cursor-position-x]\" );\nconst infoCursorYEl = doc.querySelector( \"[data-info-cursor-position-y]\" );\nconst infoDimensionXEl = doc.querySelector( \"[data-info-dimension-x]\" );\nconst infoDimensionYEl = doc.querySelector( \"[data-info-dimension-y]\" );\nconst infoCanvasSizeButtonEl = doc.querySelector( \"[data-info-button='resize']\" );\n\nconst playerPanelEl = doc.querySelector( \".player\" );\nconst playerToroidalWrapperEl = doc.querySelector( \".player__toroidal\" );\nconst playerToroidalInputEl = doc.querySelector( \"[data-player-toroidal]\" );\nconst playerSpeedEl = doc.querySelector( \"[data-player-speed]\" );\nconst playerSpeedInputEl = doc.querySelector( \"[data-player-speed-input]\" );\nconst playerCounterEl = doc.querySelector( \"[data-generations-counter]\" );\nconst playerClearButtonEl = doc.querySelector( \"[data-player-button='clear']\" );\nconst playerResetButtonEl = doc.querySelector( \"[data-player-button='reset']\" );\nconst playerPlayButtonEl = doc.querySelector( \"[data-player-button='play']\" );\nconst playerStepButtonEl = doc.querySelector( \"[data-player-button='step']\" );\n\nconst patternsPanelEl = doc.querySelector( \".patterns\" );\nconst patternsOuterWrapperEl = doc.querySelector( \".patterns__outer-wrapper\" );\nconst patternsOpenButtonEl = doc.querySelector( \"[data-pattern-button=open]\" );\nconst patternsSaveButtonEl = doc.querySelector( \"[data-pattern-button=save]\" );\nconst patternsShareButtonEl = doc.querySelector( \"[data-pattern-button=share]\" );\nconst patternsWrapperEl = doc.querySelector( \".patterns__outer-wrapper\" );\nconst patternsListItemEls = doc.querySelectorAll( \".pat\" );\n\n// Mobile-only UI\nconst meterButtonMobileEl = doc.querySelector( \".meter__mobile-button\" );\nconst menuButtonMobileEl = doc.querySelector( \".menu__mobile-button\" );\nconst patternsButtonMobileEl = doc.querySelector( \".patterns__mobile-button\" );\nconst requestFullscreenButtonEl = doc.querySelector( \".mobile-menu__go-fullscreen\" );\nconst exitFullscreenButtonEl = doc.querySelector( \".mobile-menu__exit-fullscreen\" );\n\n// All panels\nconst panelArray = [\n\tdoc.querySelector( \"[data-toolbox]\" ),\n\tdoc.querySelector( \"[data-navigator]\" ),\n\tdoc.querySelector( \"[data-info]\" ),\n\tdoc.querySelector( \"[data-player]\" ),\n\tdoc.querySelector( \"[data-patterns]\" )\n];\n\n//*******************************************\n//*******\n//******* ---- Browser Specifics/Feature detects ----\n//*******\n//*******************************************\n\n// Note: window.browser is already defined in the <head> for detects and avoiding FOUC.\n\n// Safari currently \"supports\" the 'webkit-crisp-edges' value on CSS\n// image-rendering, but doesn't actually render it for <canvas> elements.\n// Because it's a false positive, it's hard to test for.\n// Use crummy vendor detection for now until Apple fixes it.\nw.browser = w.browser || Object.create( null );\nw.browser.isSafari = navigator.vendor && navigator.vendor.indexOf( \"Apple\" ) > -1;\n\n// Modern Opera also uses this value.\nw.browser.isBlink = navigator.vendor && navigator.vendor === \"Google Inc.\";\n\nw.browser.isMac = navigator.platform &&\n                navigator.platform.toUpperCase().indexOf( \"MAC\" ) >= 0;\n\nw.browser.shortkey = browser.isMac ? \"⌘\" : \"ctrl\";\n\nw.browser.isFirefox = navigator.userAgent.toLowerCase().indexOf( \"firefox\" ) !== -1;\n\n\t// TO DO: INSERT Polyfill for lack of current Firefox support.\n\t// See https://bugzilla.mozilla.org/show_bug.cgi?id=960316\n\t// The document root should never scroll/overscroll.\n\t// (For now FF seems to work without this.)\n\t// if ( !( \"touchAction\" in document.documentElement.style ) ) {\n\t// }\n\n//*******************************************\n//*******\n//******* ---- State ----\n//*******\n//*******************************************\n\nlet state = Object.create( null );\nstate.userIsDrawing = false;\nstate.pointerIsHoveringResizableEdge = false;\n\nstate.innerView = Object.create( null );\nstate.innerView.dragPageStart = Object.create( null );\nstate.innerView.dragScrollStart = Object.create( null );\nstate.innerView.isDragging = false;\nstate.innerView.mouseIsDown = false;\n\n// Scroll values are initially undefined because initial view always fit in window.\nstate.innerView.scroll = Object.create( null );\n\nstate.canvas = Object.create( null );\nstate.canvas.overflowsInnerView = false;\nstate.canvas.domDim = Object.create( null );\nstate.canvas.scale = 6; // Initially match the CSS transform scale() in CSS.\n\nstate.toolbox = Object.create( null );\nstate.toolbox.tool = \"brush\";\nstate.toolbox.selectedButton = doc.querySelector( \".toolbox__button\" ); // Brush is first\n\nstate.nav = Object.create( null );\nstate.nav.canvas = Object.create( null );\nstate.nav.outline = Object.create( null );\nstate.nav.outline.posX = 0;\nstate.nav.outline.posY = 0;\nstate.nav.outline.percentageX = 1; // 100% initial.\nstate.nav.outline.percentageY = 1;\n\nstate.player = Object.create( null );\nstate.player.isPlaying = false;\nstate.player.toroidal = false; // Initially unchecked.\nstate.player.generation = 0;\nstate.player.delay = 500; // Initially the input type=range slider is in the middle.\n\nstate.patterns = Object.create( null );\n\nstate.scrollbarDim = 0; // Assume zero until load.\n\nlet nextFrameID;  // Timeouts set in the player.\n\n//*******************************************\n//*******\n//******* ---- Flingable and Resizable Panels ----\n//*******\n//*******************************************\n\n// Make each panel Flingable except for the last panel (patterns).\nfor ( let i = 0; i < 4; i += 1 ) {\n\tlet panelElement = panelArray[ i ];\n\tObject.create( Flingable )\n\t.initFlingable( panelElement, {\n\t\tflingCoast: false,\n\t\tflingContainer: bodyEl,\n\t\tflingHandleEl: panelElement.querySelector( \"[data-flingable-handle]\" )\n\t} );\n}\n\n// Pattern panel is uniquely both Flingable and Resizable.\nlet patternPanel = Object.create( ut.extend( Object.create( Flingable ), Resizable ) );\n\npatternPanel.rzblAbortResize = function() {\n\treturn state.canvas.isDrawing || state.isModalOpen; // Prevents resize handle behaviors.\n};\n\npatternPanel.reportResizing = function( isResizing ) {\n\tstate.panelIsResizing = isResizing; // Set state when an edge is being resized.\n};\n\npatternPanel.initFlingable( panelArray[ 4 ], {\n\tflingCoast: false,\n\tflingContainer: bodyEl,\n\tflingHandleEl: panelArray[ 4 ].querySelector( \"[data-flingable-handle]\" )\n} )\n.initResizable( panelArray[ 4 ], {\n\trzblTop: false,\n\trzblHorizontalCssProp: \"right\"\n} );\n\n//*******************************************\n//*******\n//******* ---- Prevent Default on Panel drag\n//*******\n//*******************************************\n\n// Suppress the default I-beam cursor when user is mistakenly trying to drag\n// a panel by something other than the \"panel__dragspot\" at the top.\n// The only time we want to allow default native mousedown behavior is when the\n// speed slider is dragged.\nGator( bodyEl ).on( [ \"mousedown\" ], \".panel\", function( e ) {\n\tif ( e.target.className !== \"player__speed-input\" ) {\n\t\te.preventDefault();\n\t}\n} );\n\n//*******************************************\n//*******\n//******* ---- innerView ----\n//*******\n//*******************************************\n\nlet innerView = {\n\tgetVisibleDimensions: function() {\n\n\t\t// The outer background dimensions, minus any scrollbars. offsetDim includes scrollbars.\n\t\t// state.innerView.visibleWidth = outerBgEl.clientWidth - state.scrollbarDim;\n\t\t// state.innerView.visibleHeight = outerBgEl.clientHeight - state.scrollbarDim;\n\t\tstate.innerView.visibleWidth = outerBgEl.clientWidth;\n\t\tstate.innerView.visibleHeight = outerBgEl.clientHeight;\n\n\t},\n\n\tonResize: function() {\n\t\tinnerView.getVisibleDimensions();\n\t\tcanvas.evaluateOverflow(); // Will set dimensions if goes into overflow.\n\t},\n\n\tonScroll: function() {\n\t\tif ( state.innerView.isDragging ) {\n\t\t\treturn; // Bail out, drag memoizes scroll position on its own,\n\t\t\t        // and the debounce breaks it.\n\t\t}\n\n\t\tstate.innerView.scroll.x = state.innerView.dragScrollStart.x = this.scrollLeft;\n\t\tstate.innerView.scroll.y = state.innerView.dragScrollStart.y = this.scrollTop;\n\n\t\tupdateNavOutline( false );\n\t},\n\n\tsetScrollPosition: function( x, y ) {\n\t\tif ( !state.canvas.overflowsInnerView ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// TO-DO: limit the height to max?\n\t\tx = Math.max( 0, x );\n\t\ty = Math.max( 0, y );\n\n\t\touterBgEl.scrollLeft = state.innerView.scroll.x = x;\n\t\touterBgEl.scrollTop = state.innerView.scroll.y = y;\n\t},\n\n\tonPointerDown: function( e ) {\n\n\t\tif ( !state.canvas.overflowsInnerView ||\n\t\t     ( browser.isBig && !key.shift && state.toolbox.tool !== \"hand\" ) ||\n\t\t     ( !browser.isBig && state.toolbox.tool !== \"zoom-in\" ) ) {\n\t\t\treturn; // Get out, don't handle drag by scrolling.\n\t\t}\n\n\t\tstate.innerView.dragPageStart.x = e.pageX;\n\t\tstate.innerView.dragPageStart.y = e.pageY;\n\n\t\t// Record the initial scroll position at the start of the drag.\n\t\t// This is the only place where this property get written.\n\t\tstate.innerView.dragScrollStart.x = state.innerView.scroll.x;\n\t\tstate.innerView.dragScrollStart.y = state.innerView.scroll.y;\n\t\tstate.innerView.isDragging = true;\n\n\t\tbodyEl.addEventListener( \"mousemove\", innerView.onDragMove );\n\t\tbodyEl.addEventListener( \"mouseleave\", innerView.onDragEnd );\n\t\tbodyEl.addEventListener( \"mouseup\", innerView.onDragEnd );\n\n\t},\n\n\tonDragMove: function( e ) {\n\t\tlet pageX = e.pageX;\n\t\tlet pageY = e.pageY;\n\n\t\tlet moveX = pageX - state.innerView.dragPageStart.x;\n\t\tlet moveY = pageY - state.innerView.dragPageStart.y;\n\n\t\t// Set on DOM. These values get clamped by scroll endpoints.\n\t\touterBgEl.scrollLeft = state.innerView.dragScrollStart.x - moveX;\n\t\touterBgEl.scrollTop = state.innerView.dragScrollStart.y - moveY;\n\n\t\t// Read clamped value back into memory for the navigator to use.\n\t\t// Fix this to be cleaner later.\n\t\tstate.innerView.scroll.x = outerBgEl.scrollLeft;\n\t\tstate.innerView.scroll.y = outerBgEl.scrollTop;\n\n\t\tif ( browser.isBig ) {\n\t\t\tw.setTimeout( function() {\n\t\t\t\tupdateNavOutline( false );\n\t\t\t}, 0 );\n\t\t}\n\t},\n\n\tonDragEnd: function( e ) {\n\t\tstate.innerView.isDragging = false;\n\n\t\tbodyEl.removeEventListener( \"mousemove\", innerView.onDragMove );\n\t\tbodyEl.removeEventListener( \"mouseleave\", innerView.onDragEnd );\n\t\tbodyEl.removeEventListener( \"mouseup\", innerView.onDragEnd );\n\n\t\t// Read values back from Dom into memory, to normalize for min/max values\n\t\tstate.innerView.scroll.x = outerBgEl.scrollLeft;\n\t\tstate.innerView.scroll.y = outerBgEl.scrollTop;\n\t}\n};\n\n// ---- innerView Bindings are added on page load, below.\n// Firefox on Android can fire mysterious early resize events which cause trouble.\n\n//*******************************************\n//*******\n//******* ---- Canvas ----\n//*******\n//*******************************************\n\nlet canvas = Object.create( null );\n\ncanvas.setCanvasDim = function( x, y ) {\n\tstate.canvas.domDim.x = canvasEl.width = x;\n\tstate.canvas.domDim.y = canvasEl.height = y;\n\n\t// Turning off canvas image smoothing shouldn't really matter,\n\t// but there may be a very slight performance gain:\n\t// https://jsperf.com/imagesmoothingenabled\n\t// image smoothing must be reset after resize.\n\tcanvasCtx.imageSmoothingEnabled = false;\n\n\t// Whenever a new canvas dimension is specified. Temporarily reset to white\n\t// on eraser mousedown on canvas.\n\tcanvasCtx.fillStyle = \"rgba(0,0,0,1)\";\n\tnavCanvasCtx.fillStyle = \"rgba(0,0,0,1)\";\n\n\tcanvas.clearMainAndNavCanvases();\n\tcanvas.setNavigatorCanvasDimensions();\n\n\t// Set the user-displayed dimensions in the Info panel.\n\tinfoDimensionXEl.textContent = x;\n\tinfoDimensionYEl.textContent = y;\n\n\t// Allows optimized fast 2d drawing in the render loop. See:\n\t// https://hacks.mozilla.org/2011/12/faster-canvas-pixel-manipulation-with-typed-arrays/\n\tstate.canvas.imageData = canvasCtx.getImageData( 0, 0, x, y );\n\tstate.canvas.pixelBuffer = new Int32Array( state.canvas.imageData.data.buffer );\n\n};\n\ncanvas.setNavigatorCanvasDimensions = function() {\n\tconst containerMaxWidth = 158;\n\tconst containerMaxHeight = 164;\n\tlet mainCanvasX = state.canvas.domDim.x;\n\tlet mainCanvasY = state.canvas.domDim.y;\n\tlet navWidth, navHeight;\n\tlet containerAspectRatio = containerMaxWidth / containerMaxWidth;\n\tlet canvasAspectRatio = mainCanvasX / mainCanvasY;\n\n\t// Always maximize nav canvas within the nav container regardless of main canvas dimensions.\n\n\t// The wide case.\n\tif ( canvasAspectRatio >= containerAspectRatio ) {\n\t\tnavWidth = containerMaxWidth;\n\t\tnavHeight = Math.round( containerMaxWidth / canvasAspectRatio );\n\n\t// The tall case.\n\t} else {\n\t\tnavWidth = Math.round( containerMaxHeight * canvasAspectRatio );\n\t\tnavHeight = containerMaxHeight;\n\t}\n\n\t// Inline styles\n\tnavCanvasEl.style.width = navWidth + \"px\";\n\tnavCanvasEl.style.height = navHeight + \"px\";\n\n\t// Stored state.\n\tstate.nav.canvas.width = navWidth;\n\tstate.nav.canvas.height = navHeight;\n\n\t// Navigator Canvas Dom Dimensions match the main canvas.\n\t// This is more efficient for the player loop.\n\tnavCanvasEl.width\t= mainCanvasX;\n\tnavCanvasEl.height = mainCanvasY;\n\n\t// Must be reset after resize.\n\t// Keeps the navigator canvas from being blurry when the main canvas is tiny.\n\t// Otherwise keep smoothing on because it generally looks better.\n\tif ( mainCanvasX <= containerMaxWidth && mainCanvasY <= containerMaxHeight ) {\n\t\tnavCanvasCtx.imageSmoothingEnabled = false;\n\t}\n};\n\ncanvas.clearDataArray = function() {\n\tstate.canvas.dataArray = new Int8Array( state.canvas.domDim.x * state.canvas.domDim.y );\n};\n\ncanvas.clearMainAndNavCanvases = function() {\n\tlet cWidth = state.canvas.domDim.x;\n\tlet cHeight = state.canvas.domDim.y;\n\tcanvasCtx.clearRect( 0, 0, cWidth, cHeight );\n\tnavCanvasCtx.clearRect( 0, 0, cWidth, cHeight );\n};\n\n// Commented out but preserve for performance checking.\nlet paintBothCanvasesPerfCounter = 0;\nlet paintBothCanvasesDuration = 0;\n\ncanvas.paintBothCanvasesBitwise = function() {\n\n\t// Performance checking Main paint start.\n\tlet paintBothCanvasesStart = performance.now();\n\n\tlet dataArr = state.canvas.dataArray;\n\tlet len = dataArr.length;\n\tlet canvasWidth = state.canvas.domDim.x;\n\n\t// Thanks to:\n\t// https://hacks.mozilla.org/2011/12/faster-canvas-pixel-manipulation-with-typed-arrays/\n\t// Note however that 32-bit direct manipulation is actually fastest. See:\n\t// http://jsperf.com/canvas-pixel-manipulation/8\n\n\tlet pixels = state.canvas.pixelBuffer;\n\n\tfor ( let i = 0; i < len; i += 1 ) {\n\n\t\t// Convert 1 (live) to 0. Convert 0 (dead) to 255.\n\t\tlet value = 255 - ( dataArr[ i ] * 255 );\n\n\t\tpixels[ i ] =\n\t\t\t( 255   << 24 ) |    /* alpha always opaque*/\n\t\t\t( value << 16 ) |    /* blue */\n\t\t\t( value <<  8 ) |    /* green */\n\t\t\t  value;             /* red */\n\t}\n\n\tcanvasCtx.putImageData( state.canvas.imageData, 0, 0 );\n\tnavCanvasCtx.putImageData( state.canvas.imageData, 0, 0 );\n\n\t// Performance checking Main paint end.\n\tlet paintBothCanvasesEnd = performance.now();\n\tpaintBothCanvasesDuration += paintBothCanvasesEnd - paintBothCanvasesStart;\n\tif ( paintBothCanvasesPerfCounter  === 59 ) {\n\t\tconsole.log( \"Avg canvas.paintBothCanvasesBitwise: \" +\n\t\t             paintBothCanvasesDuration / 60 + \" ms.\" );\n\t\tpaintBothCanvasesPerfCounter = 0;\n\t\tpaintBothCanvasesDuration = 0;\n\t}\n\tpaintBothCanvasesPerfCounter += 1;\n\n};\n\ncanvas.draw = function( e ) {\n\tlet cWidth = state.canvas.domDim.x;\n\tlet cHeight = state.canvas.domDim.y;\n\tlet sc = state.canvas.scale;\n\tlet scrollX = state.innerView.scroll.x;\n\tlet scrollY = state.innerView.scroll.y;\n\tlet arrayVal = 1; // Assume paint.\n\tlet pageX, pageY, targetOffsetLeft,\ttargetOffsetTop, transOffsetLeft, transOffsetTop, x, y;\n\n\tif ( e.type === \"touchmove\" ) { e.preventDefault(); } // Prevent simulated mouse events.\n\tif ( key.shift ) { return; } // Don't draw anything if shift is held.\n\n\t// Note: clearRect() sometimes leaves ghosting in Blink. Yes, using integers. ARGH!\n\t// Erase on the main canvas by painting with opaque white instead.\n\t// This is super ugly but it's the only way to get clean whites.\n\n\t// Changing the destination mode only works for true 2D erasing. Saving this for\n\t// future reference though:\n\t// canvasCtx.globalCompositeOperation = \"source-over\";\n\t// canvasCtx.globalCompositeOperation = \"destination-out\";\n\n\t// Note that these fill styles will need to be reset to black on mouseup/touchend,\n\t// otherwise the player won't work.\n\tif ( state.toolbox.tool === \"eraser\" ) {\n\t\tarrayVal = 0;\n\t\tcanvasCtx.fillStyle = \"rgba(255,255,255,1)\";\n\t\tnavCanvasCtx.fillStyle = \"rgba(255,255,255,1)\";\n\t}\n\n\t// Handle multitouch drawing/erasing.\n\tlet pointerCount = e.targetTouches && e.targetTouches.length || 1;\n\tlet pointerArray = [];\n\n\t// Synthesize offsetX / Y for all drawing, including mouse.\n\n\t\tfor ( let i = 0; i < pointerCount; i += 1 ) {\n\n\t\t\t// Emulate/synthesize offsetX and offsetY event properties for touch events.\n\t\t\tif ( e.type === \"touchstart\" || e.type === \"touchmove\" ) {\n\t\t\t\tpageX = e.touches[ i ].pageX;\n\t\t\t\tpageY = e.touches[ i ].pageY;\n\t\t\t\ttargetOffsetLeft = e.touches[ i ].target.offsetLeft;\n\t\t\t\ttargetOffsetTop = e.touches[ i ].target.offsetTop;\n\t\t\t} else {\n\t\t\t\tpageX = e.pageX;\n\t\t\t\tpageY = e.pageY;\n\t\t\t\ttargetOffsetLeft = e.target.offsetLeft;\n\t\t\t\ttargetOffsetTop = e.target.offsetTop;\n\t\t\t}\n\n\t\t\ttransOffsetLeft = targetOffsetLeft - ( cWidth * sc - cWidth ) / 2;\n\t\t\ttransOffsetTop = targetOffsetTop - ( cHeight * sc - cHeight ) / 2;\n\n\t\t\tx = ( pageX - transOffsetLeft ) / sc;\n\t\t\ty = ( pageY - transOffsetTop ) / sc;\n\n\t\t\t// Need to check before compensating for scroll.\n\t\t\t// Scroll values are undefined when canvas fits in innerView.\n\t\t\tif ( scrollX ) { x += scrollX / sc; }\n\t\t\tif ( scrollY ) { y += scrollY / sc; }\n\n\t\t\t// Lastly adjust for the \"auto\" left margin value created on\n\t\t\t// tall overflowing canvases.\n\t\t\tpointerArray[ i ] = {\n\t\t\t\tx: Math.floor( x - state.innerView.marginLeft / sc ),\n\t\t\t\ty: Math.floor( y )\n\t\t\t};\n\t\t}\n\n\tfor ( let j = 0; j < pointerCount; j += 1 ) {\n\t\tlet drawX = pointerArray[ j ].x;\n\t\tlet drawY = pointerArray[ j ].y;\n\n\t\t// Note: fillRect() is fastest on modern browsers\n\t\t// http://jsperf.com/setting-canvas-pixel\n\t\tcanvasCtx.fillRect( drawX, drawY, 1, 1 );\n\t\tnavCanvasCtx.fillRect( drawX, drawY, 1, 1 );\n\t\tstate.canvas.dataArray[ drawY * state.canvas.domDim.x + drawX ] = arrayVal;\n\t}\n};\n\ncanvas.onPointerDown = function( e ) {\n\n\t// Early return for non-drawing modes.\n\tif ( state.toolbox.tool !== \"brush\" && state.toolbox.tool !== \"eraser\" || // E.g. hand, zoom\n\t     state.toolbox.override || // Hand keyboard shortcut state.\n\t     state.panelIsResizing || // On canvas but resizing a panel.\n\t     state.isHoveringResizableEdge || // On canvas but near a drag-resizable edge. TO DO?\n\t     state.isModalOpen ||\n\t     e.which === 3  ) { // Right mouse click shouldn't paint.\n\n\t\treturn;\n\t}\n\n\t// Keep below early return.\n\t// Don't prevent default regular native inertial touch-dragging.\n\tif ( e.type === \"touchstart\" ) {\n\t\te.preventDefault();\n\t}\n\n\t// Read and stored for draw positioning when canvas is narrow but overflows vertically,\n\t// and width is less than the inner view width minus all horizontal padding.\n\tstate.innerView.marginLeft = parseInt( w.getComputedStyle( innerViewEl ).marginLeft, 10 );\n\n\t// Drawing on top of a pattern in the library deselects that pattern.\n\tvoidCurrentSelectedPatternLink();\n\tclearAnyHash();\n\n\tcanvas.draw( e );\n\tstate.canvas.isDrawing = true;\n\n\tif ( e.type === \"touchstart\" ) {\n\t\tcanvasEl.addEventListener( \"touchmove\", canvas.draw );\n\t\tw.addEventListener( \"touchend\", canvas.onPointerUp );\n\t} else { // Assume mouse.\n\t\tcanvasEl.addEventListener( \"mousemove\", canvas.draw );\n\t\tw.addEventListener( \"mouseup\", canvas.onPointerUp );\n\t}\n};\n\ncanvas.onPointerUp = function( e ) {\n\tstate.canvas.isDrawing = false;\n\n\t// Canvas fill style must be reset to black on end of eraser (white draw)\n\t// so that player drawing will work.\n\tif ( state.toolbox.tool === \"eraser\" ) {\n\t\tcanvasCtx.fillStyle = \"rgba(0,0,0,1)\";\n\t\tnavCanvasCtx.fillStyle = \"rgba(0,0,0,1)\";\n\t}\n\n\tif ( e.type === \"touchend\" ) {\n\t\te.preventDefault();\n\t\tcanvasEl.removeEventListener( \"touchmove\", canvas.draw );\n\t\tw.removeEventListener( \"touchend\", canvas.onPointerUp );\n\t} else { // Assume mouse.\n\t\tcanvasEl.removeEventListener( \"mousemove\", canvas.draw );\n\t\tw.removeEventListener( \"mouseup\", canvas.onPointerUp );\n\t}\n};\n\ncanvas.handleResize = function( newWidth, newHeight, anchorX, anchorY ) {\n\tlet oldWidth = state.canvas.domDim.x;\n\tlet oldHeight = state.canvas.domDim.y;\n\n\tlet oldDataArray = state.canvas.dataArray;\n\tlet newDataArray = new Int8Array( newWidth * newHeight );\n\n\t// The amount to crop out from the origin (left, top) sides of the original.\n\t// If the new dims are bigger, there will be no crop, and offset will be 0.\n\t// If the new dims are smaller, offset will be a positive integer.\n\t// These are only used to determine where the loop starts.\n\tlet oldCenterMap = Object.create( null, {\n\t\tleft:   { value: 0 },\n\t\tcenter: { value: Math.round( Math.max( oldWidth - newWidth, 0 ) / 2 ) },\n\t\tright:  { value: Math.max( oldWidth - newWidth, 0 ) },\n\t\ttop:    { value: 0 },\n\t\tmiddle: { value: Math.round( Math.max( oldHeight - newHeight, 0 ) / 2 ) },\n\t\tbottom: { value: Math.max( oldHeight - newHeight, 0 ) }\n\t} );\n\n\tlet oldXOffset = oldCenterMap[ anchorX ];\n\tlet oldYOffset = oldCenterMap[ anchorY ];\n\n\t// The endpoint of the loop will be the smaller of the current and new dims.\n\tlet xLen = oldXOffset + Math.min( oldWidth, newWidth );\n\tlet yLen = oldYOffset + Math.min( oldHeight, newHeight );\n\n\t// These offsets handle the cases when the new canvas is bigger.\n\t// Handling these separately keeps the loop clean.\n\tlet newCenterMap = Object.create( null, {\n\t\tleft:   { value: 0 },\n\t\tcenter: { value: Math.round( Math.max( newWidth - oldWidth, 0 ) / 2 ) },\n\t\tright:  { value: Math.max( newWidth - oldWidth, 0 ) },\n\t\ttop:    { value: 0 },\n\t\tmiddle: { value: Math.round( Math.max( newHeight - oldHeight, 0 ) / 2 ) },\n\t\tbottom: { value: Math.max( newHeight - oldHeight, 0 ) }\n\t} );\n\n\tlet newXOffset = newCenterMap[ anchorX ];\n\tlet newYOffset = newCenterMap[ anchorY ];\n\n\t// Loop through all (or part) of the old dataArray,\n\t// applying it with an offset to the newDataArray.\n\tfor ( let i = oldYOffset; i < yLen; i += 1 ) {\n\t\tfor ( let j = oldXOffset; j < xLen; j += 1 ) {\n\t\t\tnewDataArray[ ( i - oldYOffset + newYOffset ) * newWidth +\n\t\t\t              ( j - oldXOffset + newXOffset ) ] =\n\t\t\t              oldDataArray[ i * oldWidth + j ];\n\t\t}\n\t}\n\n\tstate.canvas.dataArray = newDataArray;\n\n\t// Don't reset generations counter on canvas resize.\n\tredrawCanvasFromDataArray( newDataArray, newWidth, newHeight );\n};\n\n//\n// ---- Canvas Drawing Binding ----\n//\n\ncanvasEl.addEventListener( \"touchstart\", canvas.onPointerDown );\ncanvasEl.addEventListener( \"mousedown\", canvas.onPointerDown );\n\n//\n// ---- Zoom Stuff ----\n//\n\ncanvas.repaintBoxShadow = function() {\n\n\t// Blink misrenders the canvas edge as blurry after any zoom.\n\t// Blink also sometimes mistakenly shows scroll bars on the outer bg.\n\t// This is a Blink bug, the internal dim is less than the outer bg.\n\t// Removing the box-shadow class, forcing render, then\n\t// adding it back again fixes it. Yuck!\n\tcanvasEl.classList.remove( \"main-canvas--box-shadow\" );\n\tw.getComputedStyle( canvasEl ); // Force render. Yuck.\n\tw.setTimeout( function() {\n\t\tcanvasEl.classList.add( \"main-canvas--box-shadow\" );\n\t}, 90 ); // Waiting less than 90ms doesn't seem to work. WTF.\n};\n\ncanvas.handleIncrementalZoom = function( e, keybindingZoomDirection ) {\n\n\t// Zoom on touch is handled via pinch. We want to duck synthetic click events.\n\t// For mobile/touch, get out, and don't prevent default.\n\tif ( state.toolbox.tool !== \"zoom-in\" && state.toolbox.tool !== \"zoom-out\" &&\n\t    !keybindingZoomDirection || state.toolbox.override || !browser.isBig ) {\n\t\treturn;\n\t}\n\n\tlet currentScale = state.canvas.scale;\n\tlet newScale = currentScale;\t// Default to same. In case of some mistake below.\n\n\t// Snapshot of previous pre-zoom state for passing to scroll calculator.\n\tlet prevScroll = {\n\t\toverflowed: state.canvas.overflowsInnerView,\n\t\tx: state.innerView.scroll.x,\n\t\ty: state.innerView.scroll.y,\n\t\tscale: currentScale\n\t};\n\n\tlet zoomArray = [\n\t\t0.333, // 0 (index number)\n\t\t0.5,   // 1\n\t\t0.667, // 2\n\t\t1,     // 3 (= 100% scale)\n\t\t2,     // 4\n\t\t3,     // 5\n\t\t4,     // 6\n\t\t5,     // 7\n\t\t6,     // 8\n\t\t7,     // 9\n\t\t8,     // 10\n\t\t12,    // 11\n\t\t16,    // 12\n\t\t32,    // 13\n\t\t64     // 14\n\t];\n\n\tlet direction = state.toolbox.tool; // E.g. \"zoom-in\" or \"zoom-out\"\n\n\t// Keyboard shortcut overrides toolbox\n\tif ( keybindingZoomDirection ) {\n\t\tdirection = keybindingZoomDirection;\t// Again, \"zoom-in\" or \"zoom-out\"\n\t}\n\n\tif ( direction === \"zoom-in\" ) {\n\t\tfor ( let i = 0; i < 15; i += 1 ) {\n\t\t\tif ( zoomArray[ i ] > currentScale ) {\n\t\t\t\tnewScale = zoomArray[ i ];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor ( let i = 14; i > -1; i -= 1 ) {\n\t\t\tif ( zoomArray[ i ] < currentScale ) {\n\t\t\t\tnewScale = zoomArray[ i ];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t// If no change, perhaps we're at one of the ends of the zoom scale, get out.\n\tif ( newScale === currentScale ) { return; }\n\n\t// Set scale since it has changed.\n\tcanvasEl.setAttribute( \"style\", \"transform: scale(\" + newScale + \")\" );\n\tstate.canvas.scale = newScale;\n\tif ( browser.isBlink ) {\n\t\tcanvas.repaintBoxShadow();\n\t}\n\n\t// Toggles classes and styles on innerView, and will remove scroll if canvas is contained.\n\tcanvas.evaluateOverflow( newScale );\n\n\tif ( state.canvas.overflowsInnerView ) {\n\t\tcanvas.setScrollPositionBasedOnZoomEvent( e, prevScroll,\n\t\t                                          keybindingZoomDirection );\n\t}\n};\n\ncanvas.evaluateOverflow = function( newScale ) {\n\tlet canvasWidth = state.canvas.domDim.x;\n\tlet canvasHeight = state.canvas.domDim.y;\n\tlet theScale = state.canvas.scale;\n\tlet newOverflow = false;\n\tlet newInnerViewWidth, newInnerViewHeight;\n\tlet removeNavOutlineDimensions = false;\n\n\t// For example, newScale is undefined when called on resize.\n\t// Also note newScale equals 0 when zoomed all the way out.\n\tif ( newScale !== undefined ) {\n\t\ttheScale = newScale;\n\t}\n\n\t// No overflow on update.\n\tif ( canvasWidth * theScale < state.innerView.visibleWidth &&\n\t     canvasHeight * theScale < state.innerView.visibleHeight ) {\n\n\t\tif ( state.canvas.overflowsInnerView ) {\n\n\t\t\t// Unsure on this. TO DO: review state etc.\n\t\t\tstate.innerView.width = innerView.visibleWidth;\n\t\t\tstate.innerView.height = innerView.visibleHeight;\n\t\t\tstate.innerView.scroll.x = undefined;\n\t\t\tstate.innerView.scroll.y = undefined;\n\n\t\t\tinnerViewEl.classList.remove( \"inner-background--canvas-overflows\" );\n\n\t\t\t// Effectively reverts height and width back to 100% values in stylesheet.\n\t\t\tinnerViewEl.style.width = \"\";\n\t\t\tinnerViewEl.style.height = \"\";\n\t\t\tremoveNavOutlineDimensions = true;\n\t\t}\n\n\t// Else one or more of the dims overflows the innerView,\n\t// so switch into overflow state if we aren't already,\n\t// and set dims using explicit numeric CSS values.\n\t} else {\n\t\tnewOverflow = true;\n\n\t\t// Base innerView dims on canvas.\n\t\t// Note however that height is constrained to min-height: 100% in stylesheet,\n\t\t// in the stylesheet, otherwise vertical centering would break.\n\t\tnewInnerViewWidth = canvasWidth * theScale + state.canvas.zoomPadding * 2;\n\t\tnewInnerViewHeight = canvasHeight * theScale + state.canvas.zoomPadding * 2;\n\n\t\t// But don't let them ever be less than 100% or it breaks centering\n\t\tstate.innerView.width = newInnerViewWidth;\n\t\tstate.innerView.height = newInnerViewHeight;\n\t\tinnerViewEl.style.width = newInnerViewWidth + \"px\";\n\t\tinnerViewEl.style.height = newInnerViewHeight + \"px\";\n\n\t\t// Note that in this case scroll positions will still need to be set.\n\n\t\tif ( !state.canvas.overflowsInnerView ) {\n\t\t\tinnerViewEl.classList.add( \"inner-background--canvas-overflows\" );\n\t\t}\n\t}\n\n\tstate.canvas.overflowsInnerView = newOverflow;\n\tupdateNavOutline( removeNavOutlineDimensions );\n};\n\n// Set scroll position on any overflow.\n// Always called within a conditional. Assume state.canvas.overflowsInnerView true.\ncanvas.setScrollPositionBasedOnZoomEvent = function( e, prevScroll,\n                                                     keybindingZoomDirection,\n                                                     pinchCenterX, pinchCenterY,\n                                                     pinchPanX, pinchPanY ) {\n\tlet cWidth = state.canvas.domDim.x;\n\tlet cHeight = state.canvas.domDim.y;\n\tlet zoomPadding = state.canvas.zoomPadding;\n\tlet prevScale = prevScroll.scale;\n\tlet newScale = state.canvas.scale;\n\tpinchPanX = pinchPanX || 0;\n\tpinchPanY = pinchPanY || 0;\n\n\t// Event pageX/Y will exist for for mouse clicks.\n\t// (Keyboard-shortcut-initiated zooms have a synthetic pageX/Y.)\n\t// e will be null for pinch zooms.\n\tlet zoomCenterX = e && e.pageX || pinchCenterX;\n\tlet zoomCenterY = e && e.pageY || pinchCenterY;\n\n\tlet canvasTransX, canvasTransY,\n\t    curCenteredFromLeft, curCenteredFromTop,\n\t    canvasRawX, canvasRawY,\n\t    newScrollX, newScrollY;\n\n\tif ( prevScroll.overflowed ) {\n\t\tcanvasTransX = zoomCenterX + prevScroll.x - zoomPadding;\n\t\tcanvasTransY = zoomCenterY + prevScroll.y - zoomPadding;\n\n\t// Previously no scroll bars\n\t} else {\n\t\tcurCenteredFromLeft = ( state.innerView.visibleWidth - cWidth * prevScale ) / 2;\n\t\tcurCenteredFromTop = ( state.innerView.visibleHeight - cHeight * prevScale ) / 2;\n\n\t\tcanvasTransX = zoomCenterX - curCenteredFromLeft;\n\t\tcanvasTransY = zoomCenterY - curCenteredFromTop;\n\t}\n\n\tcanvasRawX = canvasTransX / prevScale;\n\tcanvasRawY = canvasTransY / prevScale;\n\n\t// If the user is scroll centered, and zoom-clicks in the center of the canvas,\n\t// the new scroll should scale up in proportion to the\n\t// (new innerView / old Inner view)\n\n\tnewScrollX = zoomPadding + canvasRawX * newScale - zoomCenterX;\n\tnewScrollY = zoomPadding + canvasRawY * newScale - zoomCenterY;\n\n\t// Adjust for possible pinch panning. (Moving the pinch center during the pinch.)\n\tnewScrollX -= pinchPanX;\n\tnewScrollY -= pinchPanY;\n\n\tinnerView.setScrollPosition( newScrollX, newScrollY );\n};\n\ncanvas.handleFitZoom = function() {\n\tlet canvasWidth = state.canvas.domDim.x;\n\tlet canvasHeight = state.canvas.domDim.y;\n\tlet innerViewVisWidth = state.innerView.visibleWidth;\n\tlet innerViewVisHeight = state.innerView.visibleHeight;\n\tlet newScale;\n\tlet innerViewVisibleProportion = innerViewVisWidth / innerViewVisHeight;\n\tlet canvasProportion = canvasWidth / canvasHeight;\n\n\tif ( innerViewVisibleProportion >= canvasProportion ) {\n\n\t\t// The wide Inner View case, fit height\n\t\tnewScale = innerViewVisHeight / canvasHeight;\n\t} else {\n\t\tnewScale = innerViewVisWidth / canvasWidth;\n\t}\n\n\t// Remove any overflow styles\n\tif ( state.canvas.overflowsInnerView ) {\n\t\tinnerViewEl.classList.remove( \"inner-background--canvas-overflows\" );\n\n\t\t// Remove explicit width and height\n\t\tinnerViewEl.removeAttribute( \"style\" );\n\t}\n\n\t// Fit should always center the canvas, removing any CSS translate()\n\tcanvasEl.setAttribute( \"style\", \"transform: scale(\" + newScale + \")\" );\n\n\tstate.canvas.overflowsInnerView = false;\n\n\t// Remove scroll\n\tstate.innerView.scroll.x = undefined;\n\tstate.innerView.scroll.y = undefined;\n\n\t// Reset navigation outline\n\tnavOutlineEl.removeAttribute( \"style\" );\n\tstate.nav.outline.posX = 0;\n\tstate.nav.outline.posY = 0;\n\tstate.nav.outline.percentageX = 1;\n\tstate.nav.outline.percentageY = 1;\n\n\tstate.canvas.scale = newScale;\n\tif ( browser.isBlink ) {\n\t\tcanvas.repaintBoxShadow();\n\t}\n};\n\n// Don't bother binding a listener for touchstart because pinch handles\n// all zoom in the mobile/tablet interface.\ninnerViewEl.addEventListener( \"click\", canvas.handleIncrementalZoom );\n\n//*******************************************\n//*******\n//******* ---- Pinch/Zoom on Touch ----\n//*******\n//*******************************************\n\n// Create a manager for the inner view.\nvar hammerInnerV = new Hammer.Manager( innerViewEl, {\n\ttouchAction: \"pan-x pan-y\" // Allow default native panning behaviors for single touches.\n} );\n\n// Create a recognizer, and add that recognizer to the manager.\nhammerInnerV.add( new Hammer.Pinch() );\n\n// Holds snapshot of pre-pinch state.\nlet initPinch = Object.create( null );\n\nhammerInnerV.on( \"pinchstart\", function( e ) {\n\te.preventDefault(); // Always on pinchstart.\n\tif ( state.toolbox.tool !== \"zoom-in\" ) { return; }\n\n\tinitPinch.overflowed = state.canvas.overflowsInnerView;\n\tinitPinch.x = state.innerView.scroll.x;\n\tinitPinch.y = state.innerView.scroll.y;\n\tinitPinch.scale = state.canvas.scale;\n\tinitPinch.center = e.center;\n\n\t// No CSS scale transition timing.\n\tcanvasEl.classList.remove( \"main-canvas--transition-scale\" );\n} );\n\nhammerInnerV.on( \"pinch\", function( e ) {\n\te.preventDefault(); // Always on pinch.\n\n\tif ( state.toolbox.tool !== \"zoom-in\" ) { return; }\n\n\tlet newScale = initPinch.scale * e.scale;\n\tcanvasEl.style.transform = \"scale(\" +  newScale + \")\";\n\tstate.canvas.scale = newScale;\n\n\tlet initPinchCenter = initPinch.center;\n\tlet newPinchCenter = e.center;\n\n\t// Reevaluate overflow continuously during the pinch.\n\tcanvas.evaluateOverflow( newScale );\n\n\t// When in overflow mode, scroll should adjust so that the center of the pinch on the canvas\n\t// tracks to the same screen position. Also pinch centers can \"pan\" during pinch.\n\tlet pinchPanX = newPinchCenter.x - initPinchCenter.x;\n\tlet pinchPanY = newPinchCenter.y - initPinchCenter.y;\n\n\tcanvas.setScrollPositionBasedOnZoomEvent( null, initPinch, null,\n                                            initPinchCenter.x,\n                                            initPinchCenter.y,\n                                            pinchPanX,\n                                            pinchPanY );\n} );\n\nhammerInnerV.on( \"pinchend\", function( e ) {\n\te.preventDefault(); // Always on pinchend.\n\n\tif ( state.toolbox.tool !== \"zoom-in\" ) { return; }\n\n\tif ( browser.isBlink ) {\n\t\tcanvas.repaintBoxShadow();\n\t}\n} );\n\n//*******************************************\n//*******\n//******* ---- Toolbox ----\n//*******\n//*******************************************\n\n// Arguments are button event, string is \"brush\" or \"eraser or \"hand\" etc.\nlet setToolboxTool = function( e, newToolNameStr ) {\n\tnewToolNameStr = newToolNameStr || this.getAttribute( \"data-tool-button\" );\n\n\tif ( newToolNameStr === state.toolbox.tool ) {return;} // Get out\n\tfor ( let i = 0; i < 5; i += 1 ) {\n\t\ttoolboxButtonEls[ i ].classList.remove( \"panel__button--selected\" );\n\t}\n\tlet selectedButton = doc.querySelector( \"[data-tool-button=\" + newToolNameStr );\n\tselectedButton.classList.add( \"panel__button--selected\" );\n\n\t// Handle CSS cursors.\n\tinnerViewEl.classList.remove( \"brush-tool\",\n\t                              \"eraser-tool\",\n\t                              \"hand-tool\",\n\t                              \"zoom-in-tool\",\n\t                              \"zoom-out-tool\" );\n\tinnerViewEl.classList.add( newToolNameStr + \"-tool\" );\n\n\tstate.toolbox.tool = newToolNameStr;\n};\n\nGator( toolboxEl ).on( [ \"touchstart\", \"mousedown\" ], \".toolbox__button\", setToolboxTool );\n\n//*******************************************\n//*******\n//******* ---- Navigator ----\n//*******\n//*******************************************\n\n// Called by innerView.onUserScroll and canvas.evaluateOverflow\nlet updateNavOutline = function( removeNavOutlineDimensions ) {\n\tif ( !browser.isBig ) { return; }\n\n\t// Called from evaluateOverflow if there's been a change from\n\t// overflow to no overflow.\n\tif ( removeNavOutlineDimensions ) {\n\t\tnavOutlineEl.removeAttribute( \"style\" );\n\t\treturn;\n\t}\n\n\t// This early return must stay in place here. Don't refactor.\n\tif ( !state.canvas.overflowsInnerView ) { return; }\n\n\t// Default if roughly centered, doesn't yet account for scroll position.\n\tlet mainCanvasVisibleX = state.innerView.visibleWidth;\n\tlet mainCanvasVisibleY = state.innerView.visibleHeight;\n\tlet padding = state.canvas.zoomPadding;\n\tlet scale = state.canvas.scale;\n\tlet percentageVisibleX, percentageVisibleY, ratioBetweenCanvases,\n\t    outlinePosX, outlinePosY;\n\n\t// If scrolled to left edge\n\tif ( state.innerView.scroll.x < padding ) {\n\t\tmainCanvasVisibleX -= ( padding - state.innerView.scroll.x );\n\n\t// If scrolled to right edge\n\t}\telse if ( state.innerView.scroll.x > state.innerView.width -\n\t            state.innerView.visibleWidth - padding ) {\n\t\tmainCanvasVisibleX -= state.innerView.scroll.x - ( state.innerView.width -\n\t\t                      state.innerView.visibleWidth - padding );\n\t}\n\n\t// If scrolled to top edge\n\tif ( state.innerView.scroll.y < padding ) {\n\t\tmainCanvasVisibleY -= ( padding - state.innerView.scroll.y );\n\n\t// If scrolled to bottom edge\n\t}\telse if ( state.innerView.scroll.y > state.innerView.height -\n\t            state.innerView.visibleHeight - padding ) {\n\t\tmainCanvasVisibleY -= state.innerView.scroll.y - ( state.innerView.height -\n\t\t                      state.innerView.visibleHeight - padding );\n\t}\n\n\tpercentageVisibleX = mainCanvasVisibleX /\n\t                     ( state.canvas.domDim.x * scale );\n\tpercentageVisibleY = mainCanvasVisibleY /\n\t                     ( state.canvas.domDim.y * scale );\n\n\t// If width or height have changed then set them on the element\n\tif ( percentageVisibleX !== state.nav.outline.percentageX ) {\n\t\tstate.nav.outline.percentageX = percentageVisibleX;\n\t\tnavOutlineEl.style.width = percentageVisibleX * 100 + \"%\";\n\t}\n\tif ( percentageVisibleY !== state.nav.outline.percentageY ) {\n\t\tstate.nav.outline.percentageY = percentageVisibleY;\n\t\tnavOutlineEl.style.height = percentageVisibleY * 100 + \"%\";\n\t}\n\n\t// Use the larger of the two dimensions to calculate the ratio,\n\t// in order to minimize ugly rounding errors.\n\t\tif ( state.nav.canvas.width > state.nav.canvas.height ) {\n\t\t\tratioBetweenCanvases = state.nav.canvas.width /\n\t\t\t                       ( state.canvas.domDim.x * scale );\n\t\t} else {\n\t\t\tratioBetweenCanvases = state.nav.canvas.height /\n\t\t\t                       ( state.canvas.domDim.y * scale );\n\t\t}\n\n\toutlinePosX = ( state.innerView.scroll.x - padding ) * ratioBetweenCanvases;\n\toutlinePosY = ( state.innerView.scroll.y - padding ) * ratioBetweenCanvases;\n\n\t// Clamp outline to 0,0 (don't allow negative).\n\toutlinePosX = Math.max( 0, outlinePosX );\n\toutlinePosY = Math.max( 0, outlinePosY );\n\n\tstate.nav.outline.posX = outlinePosX;\n\tstate.nav.outline.posy = outlinePosY;\n\tnavOutlineEl.style.transform = \"translate(\" + outlinePosX + \"px,\" + outlinePosY + \"px)\";\n};\n\n//*******************************************\n//*******\n//******* ---- Info ----\n//*******\n//*******************************************\n\nlet updateCursorCoordinates = function( e ) {\n\n\t// IE reports non-integer values for offset. Round down.\n\t// Consider removing floor() if never supporting IE.\n\tinfoCursorXEl.textContent = Math.floor( e.offsetX );\n\tinfoCursorYEl.textContent = Math.floor( e.offsetY );\n};\n\nlet handleCoordinatesEnter = function( e ) {\n\tupdateCursorCoordinates( e );\n\tcanvasEl.addEventListener( \"mousemove\", updateCursorCoordinates );\n\tcanvasEl.addEventListener( \"mouseleave\", handleCoordinatesLeave );\n};\n\nlet handleCoordinatesLeave = function( e ) {\n\tinfoCursorXEl.textContent = \"\";\n\tinfoCursorYEl.textContent = \"\";\n\tcanvasEl.removeEventListener( \"mousemove\", updateCursorCoordinates );\n\tcanvasEl.removeEventListener( \"mouseleave\", handleCoordinatesLeave );\n};\n\n//*******************************************\n//*******\n//******* ---- Player ----\n//*******\n//*******************************************\n\nlet player = Object.create( null );\n\nplayer.setSpeed = function( event, num ) {\n\n\t// Arguments will include an Event in case it's being emitted from the input\n\t// slider, but can also be set directly below based on read-in values.\n\tlet val = ( event && event.target ) ? event.target.value : num;\n\tval = Math.max( 0, Math.min( 6, val ) ); // Must be between 0 and 6 inclusive.\n\tstate.player.delay = [ 1600, 750, 200, 100, 50, 25, \"none\" ][ val ]; // Durations in ms.\n\n\tif ( !event ) { playerSpeedInputEl.value = val; }\n\n\t// The data-* attribute creates a CSS hook for the position styling of the SVG thumb.\n\tplayerSpeedInputEl.setAttribute( \"data-player-speed-input\", val );\n};\n\n// Allow the next few often-called fns to live in the outermost scope, to reduce object lookups.\n\n// A 3x3 bitmap has 2^9 = 512 possible states.\n// 000000001 = 1\n// 000000010 = 2\n// 000000011 = 3\n// 000000100 = 4\n// 000000101 = 5\n// 000000110 = 6\n// 000000111 = 7\n// 000001000 = 8\n// 000001001 = 9\n// 000001010 = 10\n// 000001011 = 11\n// 000001100 = 12\n// 000001101 = 13\n// 000001110 = 14\n// 000001111 = 15\n// 111000000 = 448 etc.\n\n// Pre-build and store a lookup array mapping all the possibilities.\n// Stores the number of active cells in the nine cell neighborhood,\n// including the center cell.\nlet bitmapLookupArr = new Uint8Array( 512 );\nfor ( let i = 0; i < 512; i += 1 ) {\n\tbitmapLookupArr[ i ] = i.toString( 2 ).split( \"1\" ).length - 1;\n}\n\nlet bitmap = 0;\n\nlet getTileFromFlatArray = function( x, y, cWidth, dataArray ) {\n\treturn dataArray[ y * cWidth + x ];\n};\n\n// Listlife reference at: http://dotat.at/prog/life/life.html\n// Local cell neighborhood as binary map:\n//  _______________________________________________________\n//  |                  |                 |                 |\n//  |  001000000 = 64  |  000001000 = 8  |  000000001 = 1  |\n//  |__________________|_________________|_________________|\n//  |                  |                 |                 |\n//  |  010000000 = 128 |  000010000 = 16 |  000000010 = 2  |\n//  |__________________|_________________|_________________|\n//  |                  |                 |                 |\n//  |  100000000 = 256 |  000100000 = 32 |  000000100 = 4  |\n//  |__________________|_________________|_________________|\n\nlet countNonToroidal = function( x, y, cWidth, cHeight, dataArray ) {\n\n\tlet ret = 0;\n\tlet leftEdge = x === 0;\n\tlet rightEdge = x === ( cWidth - 1 );\n\tlet topEdge = y === 0;\n\tlet bottomEdge = y === ( cHeight - 1 );\n\tlet centerActive = false;\n\tlet neighborhoodCount;\n\n\tif ( leftEdge ) {\n\t\tbitmap = 0;\n\t} else {\n\n\t\t// Move binary representation three cells to left, adding zeroes from the right.\n\t\t// Using the shift allows 3 array lookups for non-edge cells, instead of 9.\n\t\tbitmap = bitmap << 3;\n\t\tbitmap = bitmap & 511; // 511 = \"111111111\". Set all but the 9 right most digits equal to 0.\n\t\tcenterActive = ( bitmap & 16 ) === 16;\n\t}\n\n\t// Always add cells in column to the right, for all cases.\n\n\t// Top right cell.\n\tif ( !rightEdge && !topEdge && getTileFromFlatArray( x + 1, y - 1, cWidth, dataArray ) ) {\n\t\tbitmap = bitmap | 1;\n\t}\n\n\t// Right cell.\n\tif ( !rightEdge && getTileFromFlatArray( x + 1, y, cWidth, dataArray ) ) {\n\t\tbitmap = bitmap | 2;\n\t}\n\n\t// Bottom right cell.\n\tif ( !rightEdge && !bottomEdge && getTileFromFlatArray( x + 1, y + 1, cWidth, dataArray ) ) {\n\t\tbitmap = bitmap | 4;\n\t}\n\n\tif ( leftEdge ) {\n\n\t\t// Top cell.\n\t\tif ( !topEdge && getTileFromFlatArray( x, y - 1, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 8;\n\t\t}\n\n\t\t// Center cell.\n\t\tif ( getTileFromFlatArray( x, y, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 16;\n\t\t\tcenterActive = true;\n\t\t}\n\n\t\t// Bottom cell.\n\t\tif ( !bottomEdge && getTileFromFlatArray( x, y + 1, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 32;\n\t\t}\n\t}\n\n\tneighborhoodCount = bitmapLookupArr[ bitmap ];\n\tif ( neighborhoodCount === 3 || ( centerActive && neighborhoodCount === 4 ) ) {\n\t\tret = 1;\n\t}\n\treturn ret;\n};\n\n// Substantially similar logic, but putting in a separate function avoids an extra \"if\"\n// statement (or wrapper function) in the typical render loop.\nlet countToroidal = function( x, y, cWidth, cHeight, dataArray ) {\n\n\tlet ret = 0;\n\tlet leftEdge = x === 0;\n\tlet rightEdge = x === ( cWidth - 1 );\n\tlet topEdge = y === 0;\n\tlet bottomEdge = y === ( cHeight - 1 );\n\tlet centerActive = false;\n\tlet neighborhoodCount;\n\n\tif ( leftEdge ) {\n\t\tbitmap = 0;\n\t} else {\n\n\t\t// Move binary representation three cells to left, adding zeroes from the right.\n\t\t// Using the shift allows 3 array lookups for non-edge cells, instead of 9.\n\t\tbitmap = bitmap << 3;\n\t\tbitmap = bitmap & 511; // 511 = \"111111111\". Set all but the 9 right most digits equal to 0.\n\t\tcenterActive = ( bitmap & 16 ) === 16;\n\t}\n\n\t// Account for wrapping behavior.\n\tlet left = x - 1;\n\tlet right = x + 1;\n\tlet top = y - 1;\n\tlet bottom = y + 1;\n\n\tif ( leftEdge ) {\n\t\tleft = cWidth - 1;       // Wrap left edge over to the right.\n\t} else if ( rightEdge ) {\n\t\tright = 0;               // Wrap right edge over to the left.\n\t}\n\tif ( topEdge ) {\n\t\ttop = cHeight - 1;       // Wrap above top over to the bottom.\n\t} else if ( bottomEdge ) {\n\t\tbottom = 0;              // Wrap below bottom over to the top.\n\t}\n\n\t// Always add cells in column to the right, for all cases, even on the edges.\n\n\t// Top right cell.\n\tif ( getTileFromFlatArray( right, top, cWidth, dataArray ) ) {\n\t\tbitmap = bitmap | 1;\n\t}\n\n\t// Right cell.\n\tif ( getTileFromFlatArray( right, y, cWidth, dataArray ) ) {\n\t\tbitmap = bitmap | 2;\n\t}\n\n\t// Bottom right cell.\n\tif ( getTileFromFlatArray( right, bottom, cWidth, dataArray ) ) {\n\t\tbitmap = bitmap | 4;\n\t}\n\n\t// Add center and left columns.\n\tif ( leftEdge ) {\n\n\t\t// Top cell.\n\t\tif ( getTileFromFlatArray( x, top, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 8;\n\t\t}\n\n\t\t// Center cell.\n\t\tif ( getTileFromFlatArray( x, y, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 16;\n\t\t\tcenterActive = true;\n\t\t}\n\n\t\t// Bottom cell.\n\t\tif ( getTileFromFlatArray( x, bottom, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 32;\n\t\t}\n\n\t\t// Top left cell.\n\t\tif ( getTileFromFlatArray( left, top, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 64;\n\t\t}\n\n\t\t// Left cell.\n\t\tif ( getTileFromFlatArray( left, y, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 128;\n\t\t}\n\n\t\t// Bottom left cell.\n\t\tif ( getTileFromFlatArray( left, bottom, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 256;\n\t\t}\n\t}\n\n\tneighborhoodCount = bitmapLookupArr[ bitmap ];\n\tif ( neighborhoodCount === 3 || ( centerActive && neighborhoodCount === 4 ) ) {\n\t\tret = 1;\n\t}\n\treturn ret;\n};\n\nlet countLiveNeighbors = countNonToroidal; // Initial setting.\n\nplayer.setToroidal = function( e ) {\n\tif ( e.target.checked ) {\n\t\tstate.player.toroidal = true;\n\t\tcountLiveNeighbors = countToroidal;\n\t} else {\n\t\tstate.player.toroidal = false;\n\t\tcountLiveNeighbors = countNonToroidal;\n\t}\n};\n\n// Perf Testing.\n// let renderNextGenPerfCounter = 0;\n// let renderNextGenDuration = 0;\n\nplayer.renderNextGeneration = function() {\n\n\t// Performance checking Main paint start.\n\t// let renderNextGenStart = performance.now();\n\n\tlet currentValue, neighborCount;\n\tlet cWidth = state.canvas.domDim.x;\n\tlet cHeight = state.canvas.domDim.y;\n\tlet dataArray = state.canvas.dataArray;\n\tlet newDataArray = new Int8Array( cWidth * cHeight ); // All initially zero.\n\tlet pixels = state.canvas.pixelBuffer;\n\n\t// Performance checking math start.\n\t// let arrayMathStart = performance.now();\n\n\tfor ( let i = 0; i < cHeight; i += 1 ) { // Outer loop is rows.\n\t\tfor ( let j = 0; j < cWidth; j += 1 ) { // Inner loop is columns.\n\n\t\t\t// A 1 (live) or 0 (dead)\n\t\t\tlet value = countLiveNeighbors( j, i, cWidth, cHeight, dataArray );\n\t\t\tnewDataArray[ i * cWidth + j ] = value;\n\n\t\t\t// Repeat the logic from canvas.paintBothCanvasesBitwise here to\n\t\t\t// avoid an separate loop through all pixels.\n\t\t\t// Convert 1 (live) to 0. Convert 0 (dead) to 255.\n\t\t\tlet colorValue = 255 - ( value * 255 );\n\n\t\t\tpixels[ ( i * cWidth ) + j ] =\n\t\t\t\t( 255   << 24 ) |        /* alpha always opaque*/\n\t\t\t\t( colorValue << 16 ) |   /* blue */\n\t\t\t\t( colorValue <<  8 ) |   /* green */\n\t\t\t\t  colorValue;            /* red */\n\t\t}\n\t}\n\n\tcanvasCtx.putImageData( state.canvas.imageData, 0, 0 );\n\tnavCanvasCtx.putImageData( state.canvas.imageData, 0, 0 );\n\n\t// Performance checking Main paint end.\n\t// let renderNextGenEnd = performance.now();\n\t// renderNextGenDuration += renderNextGenEnd - renderNextGenStart;\n\t// if ( renderNextGenPerfCounter  === 59 ) {\n\t// \tconsole.log( \"Avg renderNextGen: \" + ( renderNextGenDuration / 60 ) + \" ms.\" );\n\t// \trenderNextGenPerfCounter = 0;\n\t// \trenderNextGenDuration = 0;\n\t// }\n\t// renderNextGenPerfCounter += 1;\n\n\tstate.canvas.dataArray = newDataArray; // Swap.\n\n\t// Increment the generation counter\n\tplayerCounterEl.textContent = state.player.generation = state.player.generation += 1;\n\n\t// If playing, then loop.\n\tif ( state.player.isPlaying ) {\n\t\tif ( state.player.delay === \"none\" ) {\n\t\t\tnextFrameID = requestAnimationFrame( player.renderNextGeneration );\n\t\t} else {\n\t\t\tnextFrameID = w.setTimeout( function() {\n\t\t\t\trequestAnimationFrame( player.renderNextGeneration );\n\t\t\t}, state.player.delay );\n\t\t}\n\t}\n};\n\nplayer.pause = function() {\n\n\t// Cancel any scheduled stepAll call so that resets while playing don't step forward\n\t// to generation 1.\n\tif ( state.player.isPlaying ) {\n\t\tif ( state.player.delay === \"none\" ) {\n\t\t\tcancelAnimationFrame( nextFrameID );\n\t\t} else {\n\t\t\tw.clearTimeout( nextFrameID );\n\t\t}\n\t}\n\tstate.player.isPlaying = false;\n\tplayerPlayButtonEl.classList.remove( \"player__play-button--is-playing\" );\n};\n\nplayer.onPlayerClearButton = function( e ) {\n\tplayer.onResetGenerationsCounter( e );\n\tvoidCurrentSelectedPatternLink();\n\tcanvas.clearDataArray();\n\tcanvas.clearMainAndNavCanvases();\n};\n\nplayer.onResetGenerationsCounter = function( e ) {\n\tif ( e && e.type === \"touchstart\" ) { e.preventDefault(); }\n\tplayer.pause();\n\tplayerCounterEl.textContent = \"0\";\n\tstate.player.generation = 0;\n};\n\nplayer.onStepButton = function( e ) {\n\tif ( e && e.type === \"touchstart\" ) { e.preventDefault(); }\n\tif ( state.player.isPlaying ) {\n\t\tplayer.pause();\n\t}\n\tvoidCurrentSelectedPatternLink();\n\tclearAnyHash();\n\tplayer.renderNextGeneration();\n};\n\nplayer.play = function() {\n\tstate.player.isPlaying = true;\n\tplayerPlayButtonEl.classList.add( \"player__play-button--is-playing\" );\n\tvoidCurrentSelectedPatternLink();\n\tclearAnyHash();\n\tplayer.renderNextGeneration();\n};\n\nplayer.onPlayStopButton = function( e ) {\n\tif ( e && e.type === \"touchstart\" ) { e.preventDefault(); }\n\tif ( state.player.isPlaying ) {\n\t\tplayer.pause();\n\t} else {\n\t\tplayer.play();\n\t}\n};\n\nplayerToroidalInputEl.addEventListener( \"change\", player.setToroidal );\n\nplayerSpeedInputEl.addEventListener( \"input\", player.setSpeed );\n\nplayerClearButtonEl.addEventListener( \"touchstart\", player.onPlayerClearButton );\nplayerClearButtonEl.addEventListener( \"mousedown\", player.onPlayerClearButton );\n\nplayerResetButtonEl.addEventListener( \"touchstart\", player.onResetGenerationsCounter );\nplayerResetButtonEl.addEventListener( \"mousedown\", player.onResetGenerationsCounter );\n\nplayerPlayButtonEl.addEventListener( \"touchstart\", player.onPlayStopButton );\nplayerPlayButtonEl.addEventListener( \"mousedown\", player.onPlayStopButton );\n\nplayerStepButtonEl.addEventListener( \"touchstart\", player.onStepButton );\nplayerStepButtonEl.addEventListener( \"mousedown\", player.onStepButton );\n\n//*******************************************\n//*******\n//******* ---- Patterns ----\n//*******\n//*******************************************\n\nlet voidCurrentSelectedPatternLink = function() {\n\tlet currentSelectedLink = state.patterns.currentSelectedLink;\n\tif ( currentSelectedLink ) {\n\t\tcurrentSelectedLink.parentNode.classList.remove( \"pat--selected\", \"pat--loading\" );\n\t\tstate.patterns.currentSelectedLink = null;\n\t}\n};\n\n// Patterns need room to breathe.\n// Canvas of an imported pattern that doesn't have a minCanvasX or minCanvasY properties\n// should be at least three times the core pattern dimensions on that side, with a\n// minimum value based on viewport media query.\n// (This helps keep small patterns fast on mobile.)\n// If the pattern includes minimum dimensions and/or offset values for positioning,\n// use those.\nlet addPatternMargins = function( patPixArray, patWidth, patHeight,\n                                  minCanvasX, minCanvasY, offsetX, offsetY ) {\n\n\tlet minMargin = w.browser.isBig ? 200 : 80;\n\tlet outputWidth = minCanvasX || Math.max( patWidth * 3, minMargin );\n\tlet outputHeight = minCanvasY || Math.max( patHeight * 3, minMargin );\n\tlet newPixArray = new Int8Array( outputWidth * outputHeight ); // All zeros initially\n\tlet len = patWidth * patHeight;\n\tlet curX, curY;\n\n\t// Use any pixel offset if supplied, otherwise calculate\n\t// Validate offset values.\n\tif ( !ut.isNonNegativeInteger( offsetX ) ) {\n\t\toffsetX = Math.floor( ( outputWidth - patWidth ) / 2 ); // Default to centered\n\t}\n\tif ( !ut.isNonNegativeInteger( offsetY ) ) {\n\t\toffsetY = Math.floor( ( outputHeight - patHeight ) / 2 );\n\t}\n\n\tfor ( let i = 0; i < len; i += 1 ) {\n\t\tcurX = i % patWidth;\n\t\tcurY = Math.floor( i / patWidth );\n\t\tnewPixArray[ ( curY + offsetY ) * outputWidth + curX + offsetX ] = patPixArray[ i ];\n\t}\n\n\treturn {\n\t\tdataArray: newPixArray,\n\t\twidth: outputWidth,\n\t\theight: outputHeight\n\t};\n};\n\nlet redrawCanvasFromDataArray = function( dataArray, width, height ) {\n\n\t// Don't reset generations counter here, because might be canvas resizing.\n\t// Don't transition-zoom.\n\tcanvasEl.classList.remove( \"main-canvas--transition-scale\" );\n\tcanvas.setCanvasDim( width, height );\n\tstate.canvas.dataArray = dataArray;\n\tcanvas.paintBothCanvasesBitwise();\n\n\tw.requestAnimationFrame( function() {\n\t\tcanvas.handleFitZoom();\n\t\tcanvasEl.classList.add( \"main-canvas--transition-scale\" );\n\t} );\n};\n\n /**\n\t* @param {object} d - The JSON\n\t* @param {Boolean} addMargin - Whether or not additional margins should be considered.\n\t*/\nlet loadPatternJSONToCanvas = function( d, addMargin ) {\n\tlet patternStr = d.pattern;\n\tlet width = d.width;\n\tlet height = d.height;\n\tlet minCanvasX = d.minCanvasX;\n\tlet minCanvasY = d.minCanvasY;\n\tlet offsetX = d.offsetX;\n\tlet offsetY = d.offsetY;\n\tlet isToroidal = !!d.toroidal;\n\n\tif ( !patternStr ) {\n\t\tconsole.log( \"Pattern file parse error\" );\n\t}\n\n\tlet pixelArray = parseRLEPixelString( patternStr, width, height );\n\tlet marginAddedObj;\n\n\t// Add margins for included JSON patterns.\n\tif ( addMargin ) {\n\t\tmarginAddedObj = addPatternMargins( pixelArray, width, height,\n\t                                        minCanvasX, minCanvasY, offsetX, offsetY );\n\t  pixelArray = marginAddedObj.dataArray;\n\t  width = marginAddedObj.width;\n\t  height = marginAddedObj.height;\n\t}\n\n\tredrawCanvasFromDataArray( pixelArray, width, height );\n\tplayer.onResetGenerationsCounter();\n\n\tplayerToroidalInputEl.checked = isToroidal; // Set on DOM element. Doesn't fire a change event.\n\tstate.player.toroidal = isToroidal;\n\tcountLiveNeighbors = isToroidal ? countToroidal : countNonToroidal;\n};\n\nlet onPatternLinkClick = function( e ) {\n\te.preventDefault(); // Always for both touch and mouse.\n\n\t// Hide any mobile UI.\n\t// patternsPanelEl.classList.remove( \"patterns--mobile-show\" );\n\t// patternsButtonMobileEl.classList.remove( \"panel__button--selected\" );\n\n\topenCloseMobileFlyouts(); // Don't need to pass e. Calling w/o arguments closes everything.\n\n\tlet patternListItem = this.parentNode;\n\n\tplayer.pause(); // Stop any current animation.\n\tcanvas.clearMainAndNavCanvases();\n\n\tvoidCurrentSelectedPatternLink();\n\n\t// Remove loading class from all other pattern list items.\n\tfor ( let i = 0; i < patternsListItemEls.length; i += 1 ) {\n\t\tpatternsListItemEls[ i ].classList.remove( \"pat--loading\" );\n\t}\n\tpatternListItem.classList.add( \"pat--selected\", \"pat--loading\" );\n\n\t// Store for comparison when XHR returns, and also for removing classes.\n\tstate.patterns.currentSelectedLink = this;\n\n\tfetch( this.href )\n\t.then( function( response ) {\n\n\t\t// Unlike jQuery.AJAX(), 404 errors do not reject in fetch.\n\t\t// Must check for these manually.\n\t\tif ( !response.ok ) {\n\t\t\tlet error = new Error( response.statusText );\n\t\t\terror.response = response;\n\t\t\tthrow error;\n\t\t} else {\n\t\t\treturn response;\n\t\t}\n\t} ).then( function( response ) {\n\n\t\t// Patterns may return from the network out of the order clicked on.\n\t\tif ( response.url !== state.patterns.currentSelectedLink.href ) {\n\t\t\treturn Promise.reject( \"Pattern loaded was not the most recently clicked\" );\n\t\t}\n\n\t\t// Get relative path from absolute and drop the extension.\n\t\t// Sanity check as there are probably some typos in markup.\n\t\tlet fileName = response.url.split( \"/\" ).pop();\n\t\tif ( fileName.slice( -5 ) === \".json\" ) {\n\t\t\tfileName = fileName.slice( 0, -5 );\n\t\t\tw.history.replaceState( undefined, undefined, \"#\" + fileName );\n\t\t\treturn response.json();\n\t\t} else {\n\t\t\treturn Promise.reject( \"Response didn't have a '.json' extension\" );\n\t\t}\n\t} ).then( function( json ) {\n\n\t\tloadPatternJSONToCanvas( json, true );\n\t} ).catch( function( error ) {\n\n\t\t// Catch and log any error that has happened along the way.\n\t\tconsole.log( \"error:\", error );\n\t} ).then( function() {\n\n\t\t// Always remove the \"loading\" class when the promise is settled\n\t\t// and no longer pending, in all cases.\n\t\tpatternListItem.classList.remove( \"pat--loading\" );\n\t} );\n};\n\n// Attach delegated event handler for patterns.\n// Don't listen for touchstart because the link list needs to be scrollable.\nGator( patternsWrapperEl ).on( \"click\", \".pat__link\", onPatternLinkClick );\n\n//*******************************************\n//*******\n//******* ---- All Modals ----\n//*******\n//*******************************************\n\nModal.modalSetOpenState = function( bool ) {\n\tstate.isModalOpen = bool;\n};\n\n//*******************************************\n//*******\n//******* ---- Canvas Size Modal ----\n//*******\n//*******************************************\n\nmodalCanvasSize.modalBeforeOpen = function() {\n\tthis.currentCanvasWidth = state.canvas.domDim.x;\n\tthis.currentCanvasHeight = state.canvas.domDim.y;\n};\nmodalCanvasSize.modalSubmit = function() {\n\tcanvas.handleResize( this.newWidth, this.newHeight,\n\t                     this.resizeIconPositionX, this.resizeIconPositionY );\n};\nmodalCanvasSize.init( infoCanvasSizeButtonEl );\n\n//*******************************************\n//*******\n//******* ---- Pattern Open Modal ----\n//*******\n//*******************************************\n\nmodalOpenPattern.modalSubmit = function() {\n\tlet fileExt = this.fileExtension;\n\tlet pat = this.parsedPattern;\n\n\t// The selected file should already be parsed by the time the user clicks \"OK\" in modal.\n\t// (We don't currently check for this asynchronicity.)\n\t// Don't ever add any margins to patterns loaded externally.\n\n\t// Text files have RLE string for pattern property.\n\tif ( fileExt === \"JSON\" || fileExt === \"RLE\" ) {\n\t\tloadPatternJSONToCanvas( pat, false );\n\t} else if ( fileExt === \"BMP\" ) {\n\n\t\t// BMP files have data array for pixels property.\n\t\tredrawCanvasFromDataArray( pat.pixels, pat.width, pat.height );\n\t}\n\n\tvoidCurrentSelectedPatternLink();\n\tclearAnyHash();\n\tplayer.onResetGenerationsCounter();\n\tw.history.replaceState( undefined, undefined, w.location.pathname );\n};\n\nmodalOpenPattern.init( patternsOpenButtonEl );\n\n//*******************************************\n//*******\n//******* ---- Pattern Save Modal ----\n//*******\n//*******************************************\n\nmodalSavePattern.modalSubmit = function() {\n\tlet fileFormatEl = doc.querySelector( \"[data-modal-save-file-format]\" );\n\tlet patternNameEl = doc.querySelector( \"[data-modal-save-pattern-name]\" );\n\tlet patternAuthorEl = doc.querySelector( \"[data-modal-save-pattern-author]\" );\n\tlet suppliedPatternName = patternNameEl.value;\n\tlet usedPatternName = suppliedPatternName || \"my-lifey-pattern\";\n\tlet fileType = fileFormatEl.value;\n\tlet outputStr;\n\n\tlet orderedPatternForJSON = Object.create( null );\n\tlet patternObj = dataArrayToRLE( state.canvas.dataArray,\n\t                                 state.canvas.domDim.x, state.canvas.domDim.y );\n\n\t// Add the properties to the new object in the order they should be printed.\n\tif ( suppliedPatternName ) {\n\t\torderedPatternForJSON.name = suppliedPatternName;\n\t}\n\tif ( patternAuthorEl.value ) {\n\t\torderedPatternForJSON.author = patternAuthorEl.value;\n\t}\n\torderedPatternForJSON.width = patternObj.width;\n\torderedPatternForJSON.height = patternObj.height;\n\torderedPatternForJSON.minCanvasX = patternObj.minCanvasX;\n\torderedPatternForJSON.minCanvasY = patternObj.minCanvasY;\n\torderedPatternForJSON.offsetX = patternObj.offsetX;\n\torderedPatternForJSON.offsetY = patternObj.offsetY;\n\torderedPatternForJSON.pattern = patternObj.pattern;\n\n\tif ( fileType === \"json\" ) {\n\t\toutputStr = JSON.stringify( orderedPatternForJSON, null, \"\\t\" );\n\t} else if ( fileType === \"rle\" ) {\n\t\toutputStr = patToRleFileString( orderedPatternForJSON );\n\t}\n\n\tsaveTextAsFile( outputStr, usedPatternName + \".\" + fileType );\n};\n\nmodalSavePattern.init( patternsSaveButtonEl );\n\n//*******************************************\n//*******\n//******* ---- Pattern Share Modal ----\n//*******\n//*******************************************\n\n// Runs after innerMarkup has been added. Not really a binding in this case, but can use.\nmodalSharePattern.modalInternalBinding = function() {\n\tlet modalSharePatternFitsEl = doc.querySelector( \".pattern-fits-in-url\" );\n\tlet urlDivEl = doc.querySelector( \"[data-modal-shareable-url]\" );\n\tlet cWidth = state.canvas.domDim.x;\n\tlet cHeight = state.canvas.domDim.y;\n\tlet baseURL = w.location.href;\n\tlet patRLEObj = dataArrayToRLE( state.canvas.dataArray, cWidth, cHeight );\n\tlet msg, linkURL;\n\n\t// If sharing a pattern from the library, don't use query string data.\n\tif ( state.patterns.currentSelectedLink ) {\n\t\tlinkURL = baseURL;\n\t} else {\n\t\tlinkURL = baseURL + \"#\" + ut.serializeToQueryString( patRLEObj );\n\t}\n\n\tif ( !linkURL || linkURL.length > 4000 ) {\n\t\tmsg = \"Sorry, but your pattern is too large to be shared in a URL.\" +\n\t\t      \" Please consider saving to a JSON or RLE text file instead.\" +\n\t\t      \" You can also right-click directly on the canvas to save it as a PNG.\";\n\t\turlDivEl.classList.add( \"hide-url\" );\n\n\t} else {\n\t\tmsg = \"The following URL is a permanent, shareable link to the current pattern.\" +\n\t\t      \" It has been copied to your system clipboard.\";\n\t\turlDivEl.innerHTML = linkURL;\n\t\turlDivEl.focus();\n\t\tut.copyTextToClipBoard( linkURL );\n\t}\n\n\tmodalSharePatternFitsEl.innerHTML = msg;\n};\n\nmodalSharePattern.init( patternsShareButtonEl );\n\n//*******************************************\n//*******\n//******* ---- Keyboard Shortcuts ----\n//*******\n//*******************************************\n\n// Keymaster defines shortcuts within a particular \"scope\" that corresponds to an area of a\n// single page app. Lifey currently has two areas: \"main\" and \"modal\". Nearly all general\n// keyboard shortcuts are disabled in the modal view.\nkey.setScope( \"main\" ); // Keymaster default scope is \"all\".\n\n// By default, Keymaster doesn't process shortcuts when INPUT, SELECT, or\n// TEXTAREA elements are focused. Loosen this restriction to allow shortcuts\n// to work when INPUT elements are focused.\nkey.filter = function( event ) {\n\tvar tagName = ( event.target || event.srcElement ).tagName;\n\treturn !( tagName == \"SELECT\" || tagName == \"TEXTAREA\" );\n};\n\n// Kill all repeated key events.\nbodyEl.addEventListener( \"keydown\", function( e ) {\n\tif ( e.repeat ) { return false; }\n} );\n\n// ---- Toolbox Shortcuts ----\n\n// Shift key switches toolbox to the hand tool until the key is released.\nkey( \"shift\", \"main\", function() {\n\tbodyEl.classList.add( \"shift-depressed\" );\n\tstate.toolbox.override = \"hand\";\n} );\n\n// Keyup must be done manually without Keymaster.\nbodyEl.addEventListener( \"keyup\", function( e ) {\n\tif ( e.which === 16 ) {\n\t\tbodyEl.classList.remove( \"shift-depressed\" );\n\t\tstate.toolbox.override = null;\n\t}\n} );\n\nkey( \"b\", \"main\", function() {\n\tsetToolboxTool( \"brush\" );\n} );\n\nkey( \"e\", \"main\", function() {\n\tsetToolboxTool( \"eraser\" );\n} );\n\nkey( \"h\", \"main\", function() {\n\tsetToolboxTool( \"hand\" );\n} );\n\nkey( \"z\", \"main\", function() {\n\tsetToolboxTool( \"zoom-in\" );\n} );\n\n// ---- Zoom Shortcuts ----\n\n// Plus key.\nkey( browser.shortkey + \"+=\", \"main\", function( e ) {\n  e.preventDefault();\n\n  // Treat keyboard-shortcut-initiated zooms as occurring at center of the visible innerView.\n  // Synthesize an event property on them for simplicity.\n  e.pageX = state.innerView.visibleWidth / 2;\n\te.pageY = state.innerView.visibleHeight / 2;\n  canvas.handleIncrementalZoom( e, \"zoom-in\" );\n} );\n\n// Minus key.\nkey( browser.shortkey + \"+-\", \"main\", function( e ) {\n  e.preventDefault();\n  e.pageX = state.innerView.visibleWidth / 2;\n\te.pageY = state.innerView.visibleHeight / 2;\n  canvas.handleIncrementalZoom( e, \"zoom-out\" );\n} );\n\n// Zero key.\nkey( browser.shortkey + \"+0\", \"main\", function( e ) {\n  e.preventDefault();\n  canvas.handleFitZoom();\n} );\n\n// ---- Player Shortcut ----\n\n// As in video software, space bar plays/pauses.\nkey( \"space\", \"main\", function() {\n\tplayer.onPlayStopButton();\n} );\n\n// ---- Hide Panels Shortcut ----\n\n// Tab key.\nkey( \"tab\", \"main\", function() {\n\tbodyEl.classList.toggle( \"hide-panels\" );\n\treturn false;\n} );\n\n// ---- Modal Shortcuts ----\n\n// Treat hitting \"enter\" as clicking \"ok\".\nkey( \"enter\", \"modal\", function( e ) {\n\tdoc.querySelector( \"[data-modal-ok]\" ).click();\n} );\n\n//*******************************************\n//*******\n//******* ---- Hash Management ----\n//*******\n//*******************************************\n\nlet clearAnyHash = function() {\n\tif ( w.location.hash ) {\n\t\tw.history.replaceState( undefined, undefined, w.location.pathname );\n\t}\n};\n\n//*******************************************\n//*******\n//******* ---- Fullscreen API\n//*******\n//*******************************************\n\nrequestFullscreenButtonEl.addEventListener( \"click\", function( e ) {\n\tlet requestFullScreen = htmlEl.requestFullscreen ||\n\t                        htmlEl.mozRequestFullScreen ||\n                          htmlEl.webkitRequestFullScreen;\n\n\trequestFullScreen.call( htmlEl );\n} );\n\nexitFullscreenButtonEl.addEventListener( \"click\", function( e ) {\n\tlet exitFullScreen = doc.exitFullscreen ||\n\t                     doc.mozCancelFullScreen ||\n                       doc.webkitExitFullscreen;\n\n\texitFullScreen.call( doc );\n} );\n\n//*******************************************\n//*******\n//******* ---- Refresh from Standalone\n//*******\n//*******************************************\n\nlet mobileRefreshEl = doc.querySelector( \".mobile-menu__refresh\" );\n\nmobileRefreshEl.addEventListener( \"click\", function( e ) {\n\te.preventDefault();\n\tw.location = \"https://bellandwhistle.net/lifey\";\n\n} );\n\n//*******************************************\n//*******\n//******* ---- Mobile-only UI\n//*******\n//*******************************************\n\nlet onPointerStartAnyPanelButton = function( e ) {\n\tif ( e.type === \"touchstart\" ) {\n\t\te.preventDefault();\n\n\t\t// :active styling is screwed up on FF for Android.\n\t\t// Manually add and remove classes instead. :/\n\t\tthis.classList.add( \"panel__button--touch-pressed\" );\n\t}\n\topenCloseMobileFlyouts( e, this );\n};\n\nlet onTouchEndAnyPanelButton = function( e ) {\n\te.preventDefault();\n\tthis.classList.remove( \"panel__button--touch-pressed\" );\n};\n\nlet openCloseMobileFlyouts = ( function() {\n\tlet activeFlyout;\n\tlet flyoutTargets = {\n\t\t\"meter\": {\n\t\t\t\"buttonEl\": meterButtonMobileEl,\n\t\t\t\"targetEl\": playerPanelEl,\n\t\t\t\"className\": \"player--mobile-show-speed\"\n\t\t},\n\t\t\"menu\": {\n\t\t\t\"buttonEl\": menuButtonMobileEl,\n\t\t\t\"targetEl\": playerPanelEl,\n\t\t\t\"className\": \"player--mobile-show-toroidal\"\n\t\t},\n\t\t\"patterns\": {\n\t\t\t\"buttonEl\": patternsButtonMobileEl,\n\t\t\t\"targetEl\": patternsPanelEl,\n\t\t\t\"className\": \"patterns--mobile-show\"\n\t\t}\n\t};\n\n\treturn function( e, button ) {\n\n\t\t// Could be \"meter\", \"menu\", \"patterns\" or undefined.\n\t\tlet pointeredStr;\n\n\t\tif ( button ) {\n\t\t\tpointeredStr = button.getAttribute( \"data-mobile-button\" );\n\t\t}\n\n\t\t// Unified closing logic:\n\t\t// If the clicked button is currently active, close it and return.\n\t\t// If another flyout is active, close it.\n\t\tif ( activeFlyout ) {\n\t\t\tlet activeTarget = flyoutTargets[ activeFlyout ];\n\t\t\tactiveTarget.buttonEl.classList.remove( \"panel__button--selected\" );\n\t\t\tactiveTarget.targetEl.classList.remove( activeTarget.className );\n\n\t\t\t// If clicked button was currently active, get out.\n\t\t\tif ( pointeredStr && pointeredStr === activeFlyout ) {\n\t\t\t\tactiveFlyout = undefined;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tactiveFlyout = undefined; /* May be overridden below. */\n\t\t}\n\n\t\t// Opening logic:\n\t\tif ( button ) {\n\t\t\tlet pointeredTarget = flyoutTargets[ pointeredStr ];\n\t\t\tif ( !pointeredTarget ) { return; }\n\t\t\tpointeredTarget.buttonEl.classList.add( \"panel__button--selected\" );\n\t\t\tpointeredTarget.targetEl.classList.add( pointeredTarget.className );\n\t\t\tactiveFlyout = pointeredStr;\n\t\t}\n\t};\n\n}() );\n\n// This works on all panel buttons everywhere. So canvas size, save as, share buttons all\n// close any current flyout.\nGator( bodyEl ).on( [ \"touchstart\", \"click\" ], \".panel__button\", onPointerStartAnyPanelButton );\n\n// Hamburger menu item click should close the hamburger menu.\n// Use click instead of touchstart here to reduce glitching on the menu item handlers,\n// which fire on touchstart.\nGator( playerToroidalWrapperEl ).on( \"click\", \".mobile-menu__item\", openCloseMobileFlyouts );\n\nGator( bodyEl ).on( \"touchend\", \".panel__button\", onTouchEndAnyPanelButton );\n\n// On touch, tapping tortoise/hare should increment/decrement the input range slider.\nGator( playerSpeedEl ).on( \"touchstart\", \"svg\", function( e ) {\n\tlet val = this.classList.contains( \"player__tortoise\" ) ? -1 : 1;\n\tplayer.setSpeed( null, parseInt( playerSpeedInputEl.value, 10 ) + val );\n} );\n\n//*******************************************\n//*******\n//******* ---- Scrollbar Styles for Firefox\n//*******\n//*******************************************\n\n// Firefox currently doesn't support CSS on scrollbars.\n// Use overlaid dummy elements and CSS mix-blend-mode to style.\n// This is gross but it's better than either of the alternatives.\n\nlet addFirefoxScrollStyleElements = function() {\n\n\tlet widthInvert = doc.createElement( \"div\" );\n\tlet widthLighter = doc.createElement( \"div\" );\n\tlet heightInvert = doc.createElement( \"div\" );\n\tlet heightLighter = doc.createElement( \"div\" );\n\tlet cornerBox = doc.createElement( \"div\" );\n\n\tlet heightInvertPatterns, heightLighterPatterns, heightSingleLine;\n\n\twidthInvert.classList.add(   \"ff-scroll\", \"ff-scroll--horizontal\", \"ff-scroll--invert\" );\n\twidthLighter.classList.add(  \"ff-scroll\", \"ff-scroll--horizontal\", \"ff-scroll--lighter\" );\n\theightInvert.classList.add(  \"ff-scroll\", \"ff-scroll--vertical\",   \"ff-scroll--invert\" );\n\theightLighter.classList.add( \"ff-scroll\", \"ff-scroll--vertical\",   \"ff-scroll--lighter\" );\n\n\tcornerBox.classList.add( \"ff-scroll\", \"ff-scroll-corner\" );\n\n// Clone a full-height set for the patterns panel.\n\theightInvertPatterns = heightInvert.cloneNode();\n\theightInvertPatterns.classList.add( \"ff-scroll--full-height\" );\n\theightLighterPatterns = heightLighter.cloneNode();\n\theightLighterPatterns.classList.add( \"ff-scroll--full-height\" );\n\n// Divs on the main background need to save room for a corner.\n\twidthInvert.classList.add( \"ff-scroll--horizontal-with-corner\" );\n\twidthLighter.classList.add( \"ff-scroll--horizontal-with-corner\" );\n\theightInvert.classList.add( \"ff-scroll--vertical-with-corner\" );\n\theightLighter.classList.add( \"ff-scroll--vertical-with-corner\" );\n\n\theightSingleLine = doc.createElement( \"div\" );\n\theightSingleLine.classList.add( \"ff-scroll\", \"ff-scroll--vertical\",\n\t                                \"ff-scroll--full-height\",\n\t                                \"ff-scroll--single-line\" );\n\n\t// Main panels need to sit in front of the FF color-flipping divs\n\t// otherwise there are weird compositing glitches.\n\tbodyEl.insertBefore( widthInvert,   toolboxEl );\n\tbodyEl.insertBefore( widthLighter,  toolboxEl );\n\tbodyEl.insertBefore( heightInvert,  toolboxEl );\n\tbodyEl.insertBefore( heightLighter, toolboxEl );\n\tbodyEl.insertBefore( cornerBox,     toolboxEl );\n\n\tpatternsOuterWrapperEl.appendChild( heightInvertPatterns );\n\tpatternsOuterWrapperEl.appendChild( heightLighterPatterns );\n\n\t// Black 1px line prevents an occasional weird white line from rendering.\n\tpatternsOuterWrapperEl.appendChild( heightSingleLine );\n};\n\nif ( w.browser.isFirefox ) {\n\taddFirefoxScrollStyleElements();\n}\n\n\t// No way to disable browser-level zoom in Firefox. Rebuild styles on both load and resize.\n// Add rules to existing stylesheet to indent desktop toolbars on the right by the scrollbar width.\nlet writeScrollbarDependentRules = function() {\n\n\tlet rulesLength = scrollSs.cssRules.length;\n\tfor ( let i = 0; i < rulesLength; i += 1 ) { scrollSs.deleteRule( 0 ); }\n\n\t// Always on page load for all browsers.\n\tscrollSs.insertRule( \".panel--right { right: \" + state.scrollbarDim + \"px;}\", 0 );\n\n\tif ( w.browser.isFirefox ) {\n\t\tscrollSs.insertRule( \".ff-scroll--horizontal {\" +\n\t\t                     \"height: \" + state.scrollbarDim + \"px;\", 1 );\n\n\t\tscrollSs.insertRule( \".ff-scroll--vertical  {\" +\n\t\t                     \"width: \" + state.scrollbarDim + \"px;\", 2 );\n\n\t\tscrollSs.insertRule( \".ff-scroll--horizontal-with-corner {\" +\n\t\t                     \"width: calc(100% - \" + state.scrollbarDim + \"px);}\", 3 );\n\n\t\tscrollSs.insertRule( \".ff-scroll--vertical-with-corner {\" +\n\t\t                     \"height: calc(100% - \" + state.scrollbarDim + \"px);}\", 4 );\n\n\t\tscrollSs.insertRule( \".ff-scroll-corner { width: \" + state.scrollbarDim + \"px;\" +\n\t\t                     \"height: \" + state.scrollbarDim + \"px);}\", 5 );\n\n\t}\n};\n\n//*******************************************\n//*******\n//******* ---- Master Window Resize Handler\n//*******\n//*******************************************\n\n// Refer to different padding values in base.SCSS starting at line 46.\nlet deriveViewportDependentConstants = function() {\n\n\t// Track mobile vs desktop state, for layout math.\n\t// Current this is only needed to deal with changing scrollbars and padding.\n\tw.browser.isBig = false;\n\tstate.canvas.zoomPadding = 100;\n\n\t// These breakpoints must match the breakpoints on line 17 of \"_vars.scss\"\n\tif ( w.matchMedia( \"(min-width: 790px) and (min-height: 600px)\" ).matches ) {\n\t\tstate.canvas.zoomPadding = 200;\n\t\tw.browser.isBig = true;\n\n\t\t// Don't track mouse cursor position if we're not actually showing it.\n\t\tcanvasEl.addEventListener( \"mouseenter\", handleCoordinatesEnter );\n\t}\n\n\t// Scrollbar CSS pixel thickness varies between browsers and sometimes zoom levels.\n\tstate.scrollbarDim = outerBgEl.offsetWidth - outerBgEl.clientWidth;\n};\n\nlet onWindowResize = function() {\n\tderiveViewportDependentConstants();\n\tif ( w.browser.isFirefox ) {\n\t\twriteScrollbarDependentRules();\n\t}\n\tinnerView.onResize();\n};\n\n//*******************************************\n//*******\n//******* ---- On Window Load ----\n//*******\n//*******************************************\n\n// Some CSS values can't be read and stored reliably until the load event.\n// Wait, otherwise scaling doesn't work reliably on the initial canvas.\n( function() {\n\n\tlet splashTimeout;\n\n\tlet loadBlankCanvasBasedOnViewportDimensions = function() {\n\n\t\tlet initialWidth, initialHeight;\n\n\t\t// 80% of the available viewport on desktop. More tightly fitted on mobile.\n\t\tif ( w.browser.isBig ) {\n\t\t\tinitialWidth = Math.floor( state.innerView.visibleWidth * 0.8 /\n\t\t                             state.canvas.scale );\n\t\t\tinitialHeight = Math.floor( state.innerView.visibleHeight * 0.8 /\n\t\t                              state.canvas.scale );\n\t\t} else {\n\t\t\tinitialWidth = Math.floor( ( state.innerView.visibleWidth - 30 ) /\n\t\t                             state.canvas.scale );\n\t\t\tinitialHeight = Math.floor( ( state.innerView.visibleHeight - 30 ) /\n\t\t                              state.canvas.scale );\n\t\t}\n\t\tcanvas.setCanvasDim( initialWidth, initialHeight );\n\t\tcanvas.clearDataArray(); // Data Array based on canvas dim state so must come after.\n\t};\n\n\tlet loadInitialCanvas = function() {\n\t\tlet hash = w.location.hash.slice( 1 ); // Remove \"#\"\n\t\tlet link = doc.querySelector( \"[href='pat/\" + hash + \".json']\" );\n\t\tlet qsObj = ut.deserializeQueryString( hash );\n\n\t\t// Show the red navigator outline;\n\t\tnavOutlineEl.classList.remove( \"navigator__canvas-outline--hidden\" );\n\n\t\t// First try parsing as a query string.\n\t\tif ( qsObj && qsObj.pattern && qsObj.width && qsObj.height )   {\n\n\t\t\t// Query string might be malformed or mistyped etc. Fall through to blank canvas.\n\t\t\ttry {\n\t\t\t\tloadPatternJSONToCanvas( qsObj, true ); // Do add margins in queryString.\n\t\t\t} catch ( e ) {\n\t\t\t\tconsole.log( \"Error parsing query string: \", e );\n\t\t\t\tloadBlankCanvasBasedOnViewportDimensions();\n\t\t\t}\n\n\t\t// Else if hash is a named pattern for which a pattern link exists, \"click\" that link.\n\t\t} else if ( link ) {\n\t\t\tlink.click();\n\t\t} else {\n\t\t\tloadBlankCanvasBasedOnViewportDimensions();\n\t\t}\n\n\t\t// Add innerView listeners once canvas exists.\n\t\t/// Firefox on Android fires mysterious early resize events.\n\t\tw.addEventListener( \"resize\", ut.debounce( onWindowResize, 80 ) );\n\t\touterBgEl.addEventListener( \"scroll\", ut.throttleRaf( innerView.onScroll ) );\n\n\t\t// Drag-scroll work natively on touch, in order to get silky inertial scrolling.\n\t\t// Thus no need to bind a touchstart handler.\n\t\tinnerViewEl.addEventListener( \"mousedown\", innerView.onPointerDown );\n\n\t};\n\n\tlet hideSplash = function( e ) {\n\t\tif ( e ) { e.preventDefault(); }\n\t\tclearTimeout( splashTimeout );\n\t\tsplashEl.removeEventListener( \"touchstart\", hideSplash );\n\t\tsplashEl.removeEventListener( \"click\", hideSplash );\n\t\tsplashEl.parentNode.removeChild( splashEl );\n\t\tloadInitialCanvas();\n\t};\n\n\tlet onPageLoad = function() {\n\n\t\t// Init: Read the rateInput value off of the slider.\n\t\t// Preserves slider state across cached page reload.\n\t\tplayer.setSpeed( undefined, playerSpeedInputEl.value );\n\n\t\t// Get scrollbar size and zoom padding dims and set in state.\n\t\t// This must come before the innerView calcs.\n\t\tderiveViewportDependentConstants();\n\t\twriteScrollbarDependentRules();\n\n\t\t// Sets the state.innerView.visibleWidth based on viewport and scrollbar thickness.\n\t\tinnerView.getVisibleDimensions();\n\n\t\t// Width and visibleWidth states will initially be equal.\n\t\tstate.innerView.width = state.innerView.visibleWidth;\n\t\tstate.innerView.height = state.innerView.visibleHeight;\n\n\t\t// Needed for resize handle hover areas to be placed correctly.\n\t\tpatternPanel.recordComputedStyle();\n\n\t\tif ( browser.cutsMustard ) {\n\t\t\tif ( w.location.hash ) {\n\t\t\t\thideSplash(); // Go directly when a hash is being shared.\n\t\t\t} else {\n\t\t\t\tsplashTimeout = w.setTimeout( hideSplash, 2500 );\n\n\t\t\t\t// For the impatient, allow clicking past the initial splash screen.\n\t\t\t\tsplashEl.addEventListener( \"touchstart\", hideSplash );\n\t\t\t\tsplashEl.addEventListener( \"click\", hideSplash );\n\t\t\t}\n\t\t}\n\n\t\tw.removeEventListener( \"load\", onPageLoad );\n\t};\n\n\tif ( doc.readyState === \"complete\" ) {\n\t\tonPageLoad();\n\t} else {\n\t\tw.addEventListener( \"load\", onPageLoad );\n\t}\n}() );\n\n//*******************************************\n//*******\n//******* ---- Expose on the window for Testing ----\n//*******\n//*******************************************\n\n// Uglify should automatically rip the block below out for 'grunt prod' builds.\n// http://philipwalton.com/articles/how-to-unit-test-private-functions-in-javascript/\n// https://github.com/petehunt/webpack-howto\n// Note that this line will throw a \"condition always true\" warning\n// in webpack dev builds.\nif ( __DEV__ ) {\n\tw.Flingable = function() { return Flingable; };\n\tw.Resizable = function() { return Resizable; };\n\tw.ut = function() { return ut; };\n\tw.Modal = function() { return Modal; };\n\tw.modalCanvasSize = function() { return modalCanvasSize; };\n\tw.modalOpenPattern = function() { return modalOpenPattern; };\n\tw.modalSavePattern = function() { return modalSavePattern; };\n\tw.modalSharePattern = function() { return modalSharePattern; };\n\tw.parseRLEPixelString = function() { return parseRLEPixelString; };\n\tw.parseBMP = function() { return parseBMP; };\n\tw.patToRleFileString = function() { return patToRleFileString; };\n\tw.dataArrayToRLE = function() { return dataArrayToRLE; };\n\tw.saveTextAsFile = function() { return saveTextAsFile; };\n\n\tw.state = function() { return state; };\n\tw.innerView = function() { return innerView; };\n\tw.canvas = function() { return canvas; };\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/app.js\n **/","// Flingable\ndefine( function() {\n\nreturn {\n\n\tinitFlingable: function( elem, opts ) {\n\t\tthis.element = elem;\n\t\tthis.background = document.querySelector( \".outer-background\" );\n\t\tthis.flingCoast = false; // Default\n\t\tif ( opts ) {\n\t\t\tthis.flingCoast = !!opts.coast;\n\t\t\tif ( opts.flingFriction ) {\n\t\t\t\tthis.flingFriction = opts.flingFriction;\n\t\t\t}\n\t\t\tif ( opts.flingHandleEl ) {\n\t\t\t\tthis.flingHandleEl = opts.flingHandleEl;\n\t\t\t}\n\t\t\tif ( opts.flingContainer ) {\n\t\t\t\tthis.flingContainer = Object.create( null );\n\t\t\t\tthis.flingContainer.element = opts.flingContainer;\n\t\t\t\tthis.flingContainer.css = Object.create( null );\n\t\t\t}\n\t\t}\n\n\t\t// Initial properties specific to the instance.\n\t\tif ( !this.css ) {\n\t\t\tthis.css = Object.create( null );\n\t\t}\n\t\tthis.isFlingDragging = false;\n\t\tthis.isFlingMoving = false;\n\t\tthis.flingDragPositionX = 0;\n\t\tthis.flingDragPositionY = 0;\n\n\t\tthis.flingPositionX = 0;\n\t\tthis.flingPositionY = 0;\n\t\tthis.flingVelocityX = 0;\n\t\tthis.flingVelocityY = 0;\n\t\tthis.flingAccelX = 0;\n\t\tthis.flingAccelY = 0;\n\n\t\t// Create bound local reference for all the prototype handler methods  :/\n\t\tthis.flingMouseDown = this.flingMouseDown.bind( this );\n\t\tthis.flingMouseMove = this.flingMouseMove.bind( this );\n\t\tthis.flingMouseUp = this.flingMouseUp.bind( this );\n\n\t\tvar elemToListenOn = this.element;\n\t\tif ( this.flingHandleEl ) {\n\t\t\telemToListenOn = this.flingHandleEl;\n\t\t}\n\n\t\telemToListenOn.addEventListener( \"mousedown\", this.flingMouseDown );\n\n\t\treturn this; // Make chainable.\n\t},\n\n\t// On the prototype, figure out if unprefixed 2D Transforms are supported.\n\t// If not, check for prefix support.\n\ttransformProp: ( function( w ) {\n\t\tvar htmlElStyle = w.getComputedStyle( document.documentElement );\n\t\tvar prefixArr = [ \"webkit\", \"ms\" ];\n\t\tvar prefixProp;\n\t\tif ( \"transform\" in htmlElStyle ) {\n\t\t\treturn \"transform\";\n\t\t}\n\t\tfor ( var i = 0; i < 2; i += 1 ) {\n\t\t\tprefixProp = prefixArr[ i ] + \"Transform\";\n\t\t\tif ( prefixProp in htmlElStyle ) {\n\t\t\t\treturn \"-\" + prefixArr[ i ] + \"-transform\";\n\t\t\t}\n\t\t}\n\t}( window ) ),\n\n\tflingMouseDown: function( event ) {\n\t\tevent.preventDefault();\n\n\t\t// Don't fling if this is a resize.\n\t\tif ( this.rzblHoveringEdge ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.element.classList.add( \"panel--is-flinging\" );\n\t\tthis.background.classList.add( \"panel--is-flinging\" );\n\n\t\t// Container may have changed dimensions since init, e.g. viewport resize.\n\t\tthis.measureContainers();\n\n\t\t// Get drag start positions.\n\t\tthis.flingPageStartX = event.pageX;\n\t\tthis.flingPageStartY = event.pageY;\n\n\t\t// The flingDragPosition may reflect the last mouseup position,\n\t\t// not the final resting place, and thus needs to be updated.\n\t\tthis.flingItemBeginX = this.flingDragPositionX = this.flingPositionX;\n\t\tthis.flingItemBeginY = this.flingDragPositionY = this.flingPositionY;\n\n\t\tthis.isFlingDragging = this.isFlingMoving = true;\n\n\t\t// Start a rAF animation loop\n\t\tthis.flingAnimate();\n\n\t\t// Catch all mouse activity, even outside the browser viewport.\n\t\twindow.addEventListener( \"mousemove\", this.flingMouseMove );\n\t\twindow.addEventListener( \"mouseup\", this.flingMouseUp );\n\t},\n\n\tflingMouseMove: function( event ) {\n\n\t\t// Mousemove updates the flingDragPosition, which is one event ahead of the\n\t\t// flingPosition. The difference between the two is what generates the\n\t\t// velocity calculations around line 263. The velocity, adjusted for drag,\n\t\t// is then applied to the flingPosition, which is what is rendered out.\n\t\tvar moveX = event.pageX - this.flingPageStartX;\n\t\tvar moveY = event.pageY - this.flingPageStartY;\n\n\t\tthis.flingDragPositionX = this.flingItemBeginX + moveX;\n\t\tthis.flingDragPositionY = this.flingItemBeginY + moveY;\n\t},\n\n\tflingMouseUp: function() {\n\t\tthis.isFlingDragging = false;\n\n\t\tif ( !this.flingCoast ) {\n\t\t\tthis.isFlingMoving = false; // Stop the animation.\n\t\t\tthis.flingVelocityX = this.flingVelocityY = 0;\n\t\t}\n\n\t\tthis.element.classList.remove( \"panel--is-flinging\" );\n\t\tthis.background.classList.remove( \"panel--is-flinging\" );\n\n\t\twindow.removeEventListener( \"mousemove\", this.flingMouseMove );\n\t\twindow.removeEventListener( \"mouseup\", this.flingMouseUp );\n\t},\n\n\tflingAnimate: function() {\n\n\t\tvar that = this;\n\t\tif ( !this.isFlingMoving || ( !this.isFlingDragging && !this.flingCoast ) ) {\n\n\t\t\t// Animation is over, update the final boundingRect.\n\t\t\tthis.css.boundRect = this.element.getBoundingClientRect();\n\t\t\treturn;\n\t\t}\n\t\tthis.applyDragForce();\n\n\t\t// Containment option.\n\t\tif ( this.flingContainer ) {\n\t\t\tthis.flingPositionX = this.containFling( \"x\", this.flingPositionX );\n\t\t\tthis.flingPositionY = this.containFling( \"y\", this.flingPositionY );\n\t\t}\n\n\t\tthis.renderFling();\n\n\t\trequestAnimationFrame( function() {\n\t\t\tthat.flingAnimate();\n\t\t} );\n\t},\n\n\trenderFling: function() {\n\n\t\t// Round the final translation numbers to three decimal places when it stops.\n\t\tthis.flingPositionX = Math.round( this.flingPositionX * 1000 ) / 1000;\n\t\tthis.flingPositionY = Math.round( this.flingPositionY * 1000 ) / 1000;\n\n\t\tvar str = \"translate(\" + this.flingPositionX + \"px, \" +\n\t\t                         this.flingPositionY + \"px)\";\n\t\tif ( this.scale ) {\n\t\t\tstr += \" scale(\" + this.scale + \")\";\n\t\t}\n\t\tthis.element.style[ this.transformProp ] = str;\n\n\t\t// Store the properties\n\t\tthis.css.translateX = this.flingPositionX;\n\t\tthis.css.translateY = this.flingPositionY;\n\t},\n\n\tflingFriction: 0.93,\n\n\tapplyDragForce: function() {\n\t\tif ( this.isFlingDragging ) {\n\n\t\t\t// Change the position to drag position by applying force to acceleration\n\t\t\tvar flingVelocityX = this.flingDragPositionX - this.flingPositionX;\n\t\t\tvar flingForceX = flingVelocityX - this.flingVelocityX;\n\n\t\t\tvar flingVelocityY = this.flingDragPositionY - this.flingPositionY;\n\t\t\tvar flingForceY = flingVelocityY - this.flingVelocityY;\n\n\t\t\tthis.flingAccelX += flingForceX;\n\t\t\tthis.flingAccelY += flingForceY;\n\t\t}\n\n\t\tthis.flingVelocityX += this.flingAccelX;\n\t\tthis.flingVelocityX *= this.flingFriction;\n\t\tthis.flingPositionX += this.flingVelocityX;\n\n\t\tthis.flingVelocityY += this.flingAccelY;\n\t\tthis.flingVelocityY *= this.flingFriction;\n\t\tthis.flingPositionY += this.flingVelocityY;\n\n\t\t// If the last update was miniscule, set isMoving to break the rAF loop.\n\t\tif ( Math.abs( this.flingVelocityX ) < 0.001 &&\n\t\t     Math.abs( this.flingVelocityY ) < 0.001 &&\n\t\t    !this.isFlingDragging ) {\n\t\t\tthis.isFlingMoving = false;\n\t\t}\n\n\t\tthis.flingAccelX = 0;\n\t\tthis.flingAccelY = 0;\n\t},\n\n\tmeasureContainers: function() {\n\t\tthis.css.boundRect = this.element.getBoundingClientRect();\n\n\t\t// Note: getBoundingClientRect is with transforms applied.\n\t\t// offset positions are without transforms applied.\n\t\tthis.css.offsetTop = this.element.offsetTop;\n\t\tthis.css.offsetLeft = this.element.offsetLeft;\n\n\t\tif ( this.flingContainer && this.flingContainer.element ) {\n\t\t\tthis.flingContainer.css.boundRect = this.flingContainer.element.getBoundingClientRect();\n\t\t}\n\t},\n\n\t// Axis is 'x' or 'y' string, drag is numeric value\n\tcontainFling: function( axis, drag ) {\n\t\tlet span = axis === \"x\" ? \"width\" : \"height\";\n\t\tlet offsetDirection = axis === \"x\" ? \"Left\" : \"Top\";\n\n\t\tlet min = -1 * this.css[ \"offset\" + offsetDirection ];\n\t\tlet max = this.flingContainer.css.boundRect[ span ] - this.css.boundRect[ span ] + min;\n\n\t\treturn Math.min( max, Math.max( min, drag ) );\n\t}\n};\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/Flingable.js\n **/","define( [ \"Utility\" ], function( ut ) {\n\n\treturn {\n\n\t\tinitResizable: function( elem, opts ) {\n\t\t\tlet that = this;\n\t\t\tthis.element = elem;\n\n\t\t\t// Copy options onto the local object\n\t\t\tif ( opts ) {\n\t\t\t\tfor ( let opt in opts ) {\n\n\t\t\t\t\tif ( opts.hasOwnProperty( opt ) ) {\n\t\t\t\t\t\tthis[ opt ] = opts[ opt ];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Check first, might be inheriting.\n\t\t\tif ( !this.css ) {\n\t\t\t\tthis.css = Object.create( null );\n\t\t\t}\n\n\t\t\t// Initial properties specific to the object.\n\t\t\tthis.isResizing = false;\n\t\t\tthis.rzblOnTopEdge = false;\n\t\t\tthis.rzblOnRightEdge = false;\n\t\t\tthis.rzblOnBottomEdge = false;\n\t\t\tthis.rzblOnLeftEdge = false;\n\t\t\tthis.rzblDragStartX = 0;\n\t\t\tthis.rzblDragStartY = 0;\n\n\t\t\tthis.rzblCalcEdges = this.rzblCalcEdges.bind( this );\n\n\t\t\tthis.recordComputedStyle = this.recordComputedStyle.bind( this );\n\t\t\tthis.rzblMouseDown = this.rzblMouseDown.bind( this );\n\t\t\tthis.rzblMouseMove = this.rzblMouseMove.bind( this );\n\t\t\tthis.rzblMouseUp = this.rzblMouseUp.bind( this );\n\n\t\t\t// Must wait for load/layout to internally record the resolved values of CSS\n\t\t\t// properties. This must happen after the scrollbar width is calculated.\n\t\t\tlet recordComputedStyleOnLoad = function() {\n\t\t\t\tthat.recordComputedStyle();\n\t\t\t\twindow.removeEventListener( \"load\", recordComputedStyleOnLoad, true );\n\t\t\t};\n\n\t\t\tif ( document.readyState === \"complete\" ) {\n\t\t\t\trecordComputedStyleOnLoad();\n\t\t\t} else {\n\t\t\t\twindow.addEventListener( \"load\", recordComputedStyleOnLoad, true );\n\t\t\t}\n\n\t\t\twindow.addEventListener( \"resize\", ut.debounce( this.recordComputedStyle, 80 ), true );\n\t\t\twindow.addEventListener( \"mousemove\", this.rzblMouseMove, true );\n\t\t\twindow.addEventListener( \"mousedown\", this.rzblMouseDown, true );\n\n\t\t\treturn this; // Chainability\n\t\t},\n\n\t\trecordComputedStyle: function() {\n\t\t\tlet computedStyle = window.getComputedStyle( this.element );\n\t\t\tthis.css.boundRect = this.element.getBoundingClientRect();\n\t\t\tthis.css.top = ut.stripPixelUnits( computedStyle.top );\n\t\t\tthis.css.right = ut.stripPixelUnits( computedStyle.right );\n\t\t\tthis.css.bottom = ut.stripPixelUnits( computedStyle.bottom );\n\t\t\tthis.css.left = ut.stripPixelUnits( computedStyle.left );\n\t\t},\n\n\t\t// Default settings live on the prototype.\n\t\trzblTop: true,\n\t\trzblRight: true,\n\t\trzblBottom: true,\n\t\trzblLeft: true,\n\t\trzblHorizontalCssProp: \"left\",\n\t\trzblVerticalCssProp: \"top\",\n\t\trzblMinHeight: 100,\n\t\trzblMinWidth: 100,\n\t\trzblTolerance: 4,\n\n\t\t// Meaure cursor's proximity to the edges of the box.\n\t\t// Returns one of the following: \"top\" \"right\" \"left\" \"bottom\" or false\n\t\trzblCalcEdges: function( e ) {\n\t\t\tif ( !this.css.boundRect ) {\n\t\t\t\treturn; // Layout hasn't happened yet, get out.\n\t\t\t}\n\t\t\tlet boundTop = this.css.boundRect.top;\n\t\t\tlet boundRight = this.css.boundRect.right;\n\t\t\tlet boundBottom = this.css.boundRect.bottom;\n\t\t\tlet boundLeft = this.css.boundRect.left;\n\t\t\tlet clientX = e.clientX;\n\t\t\tlet clientY = e.clientY;\n\t\t\tlet tol = this.rzblTolerance;\n\t\t\tlet hoveredEdge = false;\n\n\t\t\tlet withinElementX = ( boundLeft <= clientX ) &&\n\t\t\t                     ( clientX <= boundRight );\n\t\t\tlet withinElementY = ( boundTop <= clientY ) &&\n\t\t\t                     ( clientY <= boundBottom );\n\n\t\t\tlet nearTopLine = Math.abs( clientY - boundTop ) <= tol;\n\t\t\tlet nearRightLine = Math.abs( clientX - boundRight ) <= tol;\n\t\t\tlet nearBottomLine = Math.abs( clientY - boundBottom ) <= tol;\n\t\t\tlet nearLeftLine = Math.abs( clientX - boundLeft ) <= tol;\n\n\t\t\tif ( nearTopLine && withinElementX && this.rzblTop ) {\n\t\t\t\thoveredEdge = \"top\";\n\t\t\t} else if ( nearRightLine && withinElementY && this.rzblRight ) {\n\t\t\t\thoveredEdge = \"right\";\n\t\t\t} else if ( nearBottomLine && withinElementX && this.rzblBottom ) {\n\t\t\t\thoveredEdge = \"bottom\";\n\t\t\t} else if ( nearLeftLine && withinElementY && this.rzblLeft ) {\n\t\t\t\thoveredEdge = \"left\";\n\t\t\t}\n\n\t\t\t// Will be false when mouse leaves edge zone.\n\t\t\t// Assign at the top so canvas drawing can check.\n\t\t\t// Don't yet assign to the local object.\n\t\t\t// this.rzblHoveredEdge = isHoveringEdge;\n\t\t\tif ( typeof this.rzblIsHovering === \"function\" ) {\n\t\t\t\tthis.rzblIsHovering( hoveredEdge );\n\t\t\t}\n\t\t\tif ( hoveredEdge ) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t\treturn hoveredEdge;\n\t\t},\n\n\t\trzblApplyCursorClass: function() {\n\t\t\tconst bodyEl = document.body;\n\t\t\tconst outerBgEl = document.querySelector( \".outer-background\" );\n\t\t\tconst panelEl = this.element;\n\n\t\t\tif ( this.rzblHoveredEdge === \"top\" || this.rzblHoveredEdge === \"bottom\" ) {\n\t\t\t\tif ( this.cursor !== \"ns\" ) {\n\t\t\t\t\tthis.cursor = \"ns\";\n\t\t\t\t\tbodyEl.classList.add( \"ns-resize-cursor\" );\n\t\t\t\t\touterBgEl.classList.add( \"ns-resize-cursor\" );\n\t\t\t\t\tpanelEl.classList.add( \"ns-resize-cursor\" );\n\t\t\t\t}\n\n\t\t\t} else if ( this.rzblHoveredEdge === \"right\" || this.rzblHoveredEdge === \"left\" ) {\n\t\t\t\tif ( this.cursor !== \"ew\" ) {\n\t\t\t\t\tthis.cursor = \"ew\";\n\t\t\t\t\tbodyEl.classList.add( \"ew-resize-cursor\" );\n\t\t\t\t\touterBgEl.classList.add( \"ew-resize-cursor\" );\n\t\t\t\t\tpanelEl.classList.add( \"ew-resize-cursor\" );\n\t\t\t\t}\n\n\t\t\t} else if ( !this.isResizing ) {\n\t\t\t\tif ( this.cursor ) {\n\t\t\t\t\tthis.cursor = \"\";\n\t\t\t\t\tbodyEl.classList.remove( \"ns-resize-cursor\", \"ew-resize-cursor\" );\n\t\t\t\t\touterBgEl.classList.remove( \"ns-resize-cursor\", \"ew-resize-cursor\" );\n\t\t\t\t\tpanelEl.classList.remove( \"ns-resize-cursor\", \"ew-resize-cursor\" );\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\trzblMouseDown: function( e ) {\n\t\t\tlet abort = false;\n\t\t\tif ( this.rzblAbortResize ) {\n\t\t\t\tabort = this.rzblAbortResize();\n\t\t\t}\n\n\t\t\tif ( !this.rzblHoveredEdge || abort ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.stopPropagation();\n\n\t\t\tthis.rzblEdgeClicked = this.rzblHoveredEdge; // E.g. \"left\"\n\n\t\t\t// Allows the resize animation to loop, also checked by canvas paint/erase.\n\t\t\t// A single property for all panels?\n\t\t\tthis.isResizing = true;\n\t\t\tif ( this.reportResizing ) {\n\t\t\t\tthis.reportResizing( true );\n\t\t\t}\n\n\t\t\tthis.recordComputedStyle();\n\n\t\t\tthis.rzblDragStartX = e.clientX;\n\t\t\tthis.rzblDragStartY = e.clientY;\n\t\t\tthis.rzblMoveX = 0;\n\t\t\tthis.rzblMoveY = 0;\n\n\t\t\t// These values can be either right or left, top or bottom CSS.\n\t\t\tthis.flingItemBeginX = this.css[ this.rzblHorizontalCssProp ];\n\t\t\tthis.flingItemBeginY = this.css[ this.rzblVerticalCssProp ];\n\n\t\t\t// Start a rAF animation loop\n\t\t\tthis.rzblAnimate();\n\n\t\t\twindow.addEventListener( \"mouseup\", this.rzblMouseUp, true );\n\t\t},\n\n\t\trzblMouseMove: function( e ) {\n\t\t\tlet currentHoveredEdge = this.rzblHoveredEdge;\n\t\t\tlet newHoveredEdge = this.rzblCalcEdges( e );\n\n\t\t\tif ( this.isResizing ) {\n\n\t\t\t\t// Set the \"move\" properties, which will get\n\t\t\t\t// picked up in the animation loop.\n\t\t\t\tif ( this.rzblEdgeClicked === \"top\" || this.rzblEdgeClicked === \"bottom\" ) {\n\t\t\t\t\tthis.rzblMoveY = e.pageY - this.rzblDragStartY;\n\t\t\t\t} else if ( this.rzblEdgeClicked === \"right\" || this.rzblEdgeClicked === \"left\" ) {\n\t\t\t\t\tthis.rzblMoveX = e.pageX - this.rzblDragStartX;\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// Modify the cursors on hover/hoverend, but only if we're not already\n\t\t\t\t// resizing.\n\t\t\t\tthis.rzblHoveredEdge = newHoveredEdge;\n\n\t\t\t\t// If already painting near the panel edge, don't apply the resize cursor class.\n\t\t\t\tif ( this.rzblAbortResize && this.rzblAbortResize() ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Don't touch the DOM if there hasn't been a change.\n\t\t\t\tif ( newHoveredEdge !== currentHoveredEdge ) {\n\t\t\t\t\tthis.rzblApplyCursorClass();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\trzblMouseUp: function( e ) {\n\n\t\t\t// Breaks the resize animation loop, also checked by canvas paint/erase\n\t\t\tthis.isResizing = false;\n\t\t\tif ( this.reportResizing ) {\n\t\t\t\tthis.reportResizing( false );\n\t\t\t}\n\n\t\t\t// Flushing these seems to reduce glitching\n\t\t\tthis.rzblEdgeClicked = undefined;\n\n\t\t\t// Mouseups can always propagate.\n\t\t\twindow.removeEventListener( \"mouseup\", this.rzblMouseUp, true );\n\t\t},\n\n\t\trzblAnimate: function() {\n\t\t\tlet that = this;\n\t\t\tif ( !this.isResizing ) {\n\n\t\t\t\t// Animation is over. Update the box after resize complete\n\t\t\t\tthis.css.boundRect = this.element.getBoundingClientRect();\n\t\t\t\treturn; // Get out when mouseup breaks the animation loop.\n\t\t\t}\n\t\t\tthis.rzblRender();\n\t\t  requestAnimationFrame( function() {\n\t\t\t\tthat.rzblAnimate();\n\t\t\t} );\n\t\t},\n\n\t// ========= RENDER =========================\n\t//\n\t//  Drag       |  CSS       |  Render\n\t//  From       |  pos prop  |  Outcome\n\t// ------------------------------------------\n\t//  left       |  left      | + left\n\t//             |            | - width\n\t// ------------------------------------------\n\t//  left       |  right     | - width\n\t//             |            |\n\t// ------------------------------------------\n\t//  right      |  right     | - right\n\t//             |            | + width\n\t// ------------------------------------------\n\t//  right      |  left      | + width\n\t//             |            |\n\t// ------------------------------------------\n\t//  top        |  top       | + top\n\t//             |            | - height\n\t// ------------------------------------------\n\t//  top        |  bottom    | - height\n\t//             |            |\n\t// ------------------------------------------\n\t//  bottom     |  bottom    | - bottom\n\t//             |            | + height\n\t// ------------------------------------------\n\t//  bottom     |  top       | + height\n\t//             |            |\n\t// ------------------------------------------\n\n\t\trzblRender: function() {\n\t\t\tif ( this.rzblEdgeClicked === \"left\" ) {\n\t\t\t\tif ( this.rzblHorizontalCssProp === \"left\" ) {\n\t\t\t\t\tthis.css.left = this.flingItemBeginX + this.rzblMoveX;\n\t\t\t\t\tthis.element.style.left = this.css.left + \"px\";\n\t\t\t\t}\n\t\t\t\tthis.element.style.width = this.css.boundRect.width - this.rzblMoveX + \"px\";\n\n\t\t\t} else if ( this.rzblEdgeClicked === \"right\" ) {\n\t\t\t\tif ( this.rzblHorizontalCssProp === \"right\" ) {\n\t\t\t\t\tthis.css.right = this.flingItemBeginX - this.rzblMoveX;\n\t\t\t\t\tthis.element.style.right = this.css.right + \"px\";\n\t\t\t\t}\n\t\t\t\tthis.element.style.width = this.css.boundRect.width + this.rzblMoveX + \"px\";\n\n\t\t\t} else if ( this.rzblEdgeClicked === \"top\" ) {\n\t\t\t\tif ( this.rzblVerticalCssProp === \"top\" ) {\n\t\t\t\t\tthis.css.top = this.flingItemBeginY + this.rzblMoveY;\n\t\t\t\t\tthis.element.style.top = this.css.top + \"px\";\n\t\t\t\t}\n\t\t\t\tthis.element.style.height = this.css.boundRect.height - this.rzblMoveY + \"px\";\n\n\t\t\t} else if ( this.rzblEdgeClicked === \"bottom\" ) {\n\t\t\t\tif ( this.rzblVerticalCssProp === \"bottom\" ) {\n\t\t\t\t\tthis.css.bottom = this.css.bottom - this.rzblMoveY;\n\t\t\t\t\tthis.element.style.bottom = this.css.bottom + \"px\";\n\t\t\t\t}\n\t\t\t\tthis.element.style.height = this.css.boundRect.height + this.rzblMoveY + \"px\";\n\t\t\t}\n\t\t}\n\t};\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/Resizable.js\n **/","define( function() {\n\n\t// Currently needed just for Intern to allow block-scoping. Possibly delete in build?\n\t\"use strict\";\n\n\treturn {\n\n\t\t// http://www.jacklmoore.com/notes/rounding-in-javascript/\n\t\tround: function( value, decimalPlaces ) {\n\t\t\treturn Number( Math.round( value + \"e\" + decimalPlaces ) + \"e-\" + decimalPlaces );\n\t\t},\n\n\t\t// Http://modernjavascript.blogspot.com/2013/08/building-better-debounce.html\n\t\tdebounce: function( func, wait ) {\n\n\t\t\t// We need to save these in the closure\n\t\t\tlet timeout, args, context, timestamp;\n\n\t\t\treturn function() {\n\n\t\t\t\t// Save details of latest call\n\t\t\t\tcontext = this;\n\t\t\t\targs = [].slice.call( arguments, 0 );\n\t\t\t\ttimestamp = new Date();\n\n\t\t\t\t// This is where the magic happens\n\t\t\t\tlet later = function() {\n\n\t\t\t\t\t// How long ago was the last call\n\t\t\t\t\tlet last = ( new Date() ) - timestamp;\n\n\t\t\t\t\t// If the latest call was less that the wait period ago\n\t\t\t\t\t// then we reset the timeout to wait for the difference\n\t\t\t\t\tif ( last < wait ) {\n\t\t\t\t\t\ttimeout = setTimeout( later, wait - last );\n\n\t\t\t\t\t// Or if not we can null out the timer and run the latest\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttimeout = null;\n\t\t\t\t\t\tfunc.apply( context, args );\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\t// We only need to set the timer now if one isn't already running\n\t\t\t\tif ( !timeout ) {\n\t\t\t\t\ttimeout = setTimeout( later, wait );\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\tthrottleRaf: function( func ) {\n\t\t\tlet args, context, ticking;\n\n\t\t\treturn function() {\n\n\t\t\t\t// Save details of latest call, e.g. event properties.\n\t\t\t\tcontext = this;\n\t\t\t\targs = [].slice.call( arguments, 0 );\n\n\t\t\t\tlet later = function() {\n\t\t\t\t\tfunc.apply( context, args );\n\t\t\t\t\tticking = false;\n\t\t\t\t};\n\n\t\t\t\tif ( !ticking ) {\n\t\t\t\t\trequestAnimationFrame( later );\n\t\t\t\t\tticking = true;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// Get closest DOM element up the tree that contains a class, ID, or data attribute\n\t\t// @param  {Node} elem The base element\n\t\t// @param  {String} selector The class, id, data attribute, or tag to look for\n\t\t// @return {Node} Null if no match\n\t\t// http://gomakethings.com/climbing-up-and-down-the-dom-tree-with-vanilla-javascript/\n\t\tgetClosest: function( elem, selector ) {\n\t\t\tlet firstChar = selector.charAt( 0 );\n\n\t\t\t// Get closest match\n\t\t\tfor ( ; elem && elem !== document; elem = elem.parentNode ) {\n\n\t\t\t\t// If selector is a class\n\t\t\t\tif ( firstChar === \".\" ) {\n\t\t\t\t\tif ( elem.classList.contains( selector.substr( 1 ) ) ) {\n\t\t\t\t\t\treturn elem;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If selector is an ID\n\t\t\t\tif ( firstChar === \"#\" ) {\n\t\t\t\t\tif ( elem.id === selector.substr( 1 ) ) {\n\t\t\t\t\t\treturn elem;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If selector is a data attribute\n\t\t\t\tif ( firstChar === \"[\" ) {\n\t\t\t\t\tif ( elem.hasAttribute( selector.substr( 1, selector.length - 2 ) ) ) {\n\t\t\t\t\t\treturn elem;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If selector is a tag\n\t\t\t\tif ( elem.tagName.toLowerCase() === selector ) {\n\t\t\t\t\treturn elem;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\textend: function() {\n\t\t\tfor ( let i = 1; i < arguments.length; i += 1 ) {\n\t\t\t\tfor ( let key in arguments[ i ] ) {\n\t\t\t\t\tif ( arguments[ i ].hasOwnProperty( key ) ) {\n\t\t\t\t\t\targuments[ 0 ][ key ] = arguments[ i ][ key ];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn arguments[ 0 ];\n\t\t},\n\n\t\tisDigit: function( n ) {\n\t\t\treturn Boolean( [ true, true, true, true, true, true, true, true, true, true ][ n ] );\n\t\t},\n\n\t\tisNonNegativeInteger: function( val ) {\n\t\t  return Number.isFinite( val ) && val % 1 === 0 && val >= 0;\n\t\t},\n\n\t\tstripPixelUnits: function( str ) {\n\t\t\tlet ret = str.replace( /px$/i, \"\" );\n\n\t\t\t// Avoid converting \"auto\" to NaN, but still coerce \"6px\" to the number 6.\n\t\t\tif ( this.isDigit( str[ 0 ] ) ) {\n\t\t\t\tret = parseFloat( ret );\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\n\t\t// @param  {object}\n\t\t// @return {string}\n\t\tserializeToQueryString: function( obj ) {\n\t\t\tlet ret = \"\";\n\t\t\tfor ( let prop in obj ) {\n\t\t\t\tret += prop + \"=\"  + obj[ prop ] + \"&\";\n\t\t\t}\n\t\t\tif ( ret ) {\n\t\t\t\tret = ret.slice( 0, -1 ); // Remove final trailing ampersand.\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\n\t\tdeserializeQueryString: function( str ) {\n\t\t\tvar ret = Object.create( null );\n\t\t\tif ( str.indexOf( \"?\" ) > -1 ) {\n\t\t\t\tstr = str.split( \"?\" )[ 1 ];\n\t\t\t}\n\t\t\tvar pairs = str.split( \"&\" );\n\t\t\tpairs.forEach( function( pair ) {\n\t\t\t\tpair = pair.split( \"=\" );\n\t\t\t\tret[ pair[ 0 ] ] = decodeURIComponent( pair[ 1 ] || \"\" );\n\t\t\t} );\n\t\t\treturn ret;\n\t\t},\n\n\t\tselectContents: function( el ) {\n\n\t\t\t// FF doesn\"t support select() method.\n\t\t\t// Webkit throws InvalidStateError on setSelectionRange on an input type=number.\n\t\t\t// https://code.google.com/p/chromium/issues/detail?id=346270\n\t\t\ttry {\n\t\t\t\tel.focus();\n\t\t\t\tel.setSelectionRange( 0, 9999 );\n\t\t\t} catch ( e ) {\n\t\t\t\tel.select();\n\t\t\t}\n\t\t\treturn el;\n\t\t},\n\n\t\tcopyTextToClipBoard: function( text ) {\n\t\t\tlet input = document.createElement( \"textarea\" );\n\t\t\tdocument.body.appendChild( input );\n\t\t\tinput.value = text;\n\t\t\tthis.selectContents( input );\n\t\t\tdocument.execCommand( \"Copy\" );\n\t\t\tdocument.body.removeChild( input );\n\t\t\treturn text;\n\t\t}\n\t};\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/Utility.js\n **/","//Modal\ndefine( function() {\n\n\t// Opening modal changes keymaster \"scope\"\n\tlet key = require( \"keymaster\" );\n\n\t// To be customized per unique modal object:\n\t// this.innerMarkup   html to insert\n\t// this.modalInternalBinding   listeners other than ok/cancel\n\t// this.modalInternalUnbinding  remove listeners other than ok/cancel\n\t// this.modalValidate  optional check on click of OK. returns a Boolean.\n\t// this.modalSubmit   function to run 'ok' click if valid.\n\n\treturn {\n\n\t\tmodalWrapperElement: document.querySelector( \".modal-wrapper\" ),\n\n\t\tmodalTitleEl: document.querySelector( \".modal__title\" ),\n\n\t\tmodalContentsEl: document.querySelector( \".modal__contents\" ),\n\n\t\tinit: function( buttonElementToBind ) {\n\t\t\tthis.modalOpenButtonElement = buttonElementToBind;\n\n\t\t\t// Create bound local reference for all the prototype handler methods  :/\n\t\t\tthis.modalOpen = this.modalOpen.bind( this );\n\t\t\tthis.modalClose = this.modalClose.bind( this );\n\t\t\tthis.modalOnOk = this.modalOnOk.bind( this );\n\t\t\tthis.modalOnCancel = this.modalOnCancel.bind( this );\n\n\t\t\t// Assume for now it's always a button that triggers opening the modal.\n\t\t\tthis.modalOpenButtonElement.addEventListener( \"touchstart\", this.modalOpen );\n\t\t\tthis.modalOpenButtonElement.addEventListener( \"click\", this.modalOpen );\n\t\t},\n\n\t\tmodalOpen: function( e ) {\n\n\t\t\tif ( e.type === \"touchstart\" ) { e.preventDefault(); } /* Suppress ghost click. */\n\n\t\t\t// The custom pre-open fn unique to a particular modal.\n\t\t\tif ( typeof this.modalBeforeOpen === \"function\" ) {\n\t\t\t\tthis.modalBeforeOpen();\n\t\t\t}\n\n\t\t\t// Generic to all Modals but set inside the closure.\n\t\t\tif ( typeof this.modalSetOpenState === \"function\" ) {\n\t\t\t\tthis.modalSetOpenState( true );\n\t\t\t}\n\n\t\t\t// Turn off all Keymaster shortcuts applicable in the main view, so that, for example,\n\t\t\t// tabbing works between form fields in a modal.\n\t\t\t// In the \"modal\" scope, \"enter\" clicks the OK button.\n\t\t\tkey.setScope( \"modal\" );\n\n\t\t\t// Show the modal.\n\t\t\tthis.modalWrapperElement.classList.remove( \"modal-wrapper--hide\" );\n\n\t\t\t// Insert the DOM elements\n\t\t\tthis.modalTitleEl.innerHTML = this.titleText;\n\t\t\tthis.modalContentsEl.innerHTML = this.innerMarkup();\n\n\t\t\tthis.modalOkButton = document.querySelector( \"[data-modal-ok]\" );\n\t\t\tthis.modalCancelButton = document.querySelector( \"[data-modal-cancel]\" );\n\n\t\t\tthis.modalOkButton.addEventListener( \"touchstart\", this.modalOnOk );\n\t\t\tthis.modalOkButton.addEventListener( \"click\", this.modalOnOk );\n\n\t\t\t// Not all modals have a cancel button.\n\t\t\tif ( this.modalCancelButton ) {\n\t\t\t\tthis.modalCancelButton.addEventListener( \"touchstart\", this.modalOnCancel );\n\t\t\t\tthis.modalCancelButton.addEventListener( \"click\", this.modalOnCancel );\n\t\t\t}\n\n\t\t\t// The custom post-open fn unique to a particular modal.\n\t\t\tif ( this.modalInternalBinding ) {\n\t\t\t\tthis.modalInternalBinding();\n\t\t\t}\n\t\t},\n\n\t\tshowError: function( errorText ) {\n\t\t\tthis.errorEl.innerHTML = errorText;\n\t\t},\n\n\t\tmodalOnOk: function( e ) {\n\n\t\t\tif ( e.type === \"touchstart\" ) { e.preventDefault(); } /* Suppress ghost click. */\n\n\t\t\t// Revalidate on click of OK.\n\t\t\t// Assume valid because not all modals use validation.\n\t\t\tif ( typeof this.modalValidate === \"function\" ) {\n\t\t\t\tif ( !this.modalValidate() ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Some \"info\" modals (like share) don't do anything on submit.\n\t\t\tif ( typeof this.modalSubmit === \"function\" ) {\n\t\t\t\tthis.modalSubmit();\n\t\t\t}\n\t\t\tthis.modalClose();\n\t\t},\n\n\t\tmodalOnCancel: function( e ) {\n\t\t\tif ( e.type === \"touchstart\" ) { e.preventDefault(); } /* Suppress ghost click. */\n\t\t\tthis.modalClose();\n\t\t},\n\n\t\tmodalClose: function() {\n\t\t\tif ( this.modalInternalUnbinding ) {\n\t\t\t\tthis.modalInternalBinding();\n\t\t\t}\n\n\t\t\t// Unbind confirmation buttons\n\t\t\tthis.modalOkButton.removeEventListener( \"touchstart\", this.modalOnOk );\n\t\t\tthis.modalOkButton.removeEventListener( \"click\", this.modalOnOk );\n\n\t\t\tif ( this.modalCancelButton ) {\n\t\t\t\tthis.modalCancelButton.removeEventListener( \"touchstart\", this.modalOnCancel );\n\t\t\t\tthis.modalCancelButton.removeEventListener( \"click\", this.modalOnCancel );\n\t\t\t}\n\t\t\tthis.modalWrapperElement.classList.add( \"modal-wrapper--hide\" );\n\n\t\t\tkey.setScope( \"main\" );\n\n\t\t\t// Generic to all Modals but set inside the closure.\n\t\t\tif ( typeof this.modalSetOpenState === \"function\" ) {\n\t\t\t\tthis.modalSetOpenState( false );\n\t\t\t}\n\n\t\t\t// The custom post-open fn unique to a particular modal.\n\t\t\tif ( typeof this.modalAfterClose === \"function\" ) {\n\t\t\t\tthis.modalAfterClose();\n\t\t\t}\n\t\t}\n\t};\n\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/Modal.js\n **/","/* Keymaster.js\n   (c) 2011-2013 Thomas Fuchs\n   keymaster.js may be freely distributed under the MIT license. */\n\n;( function( global ) {\n  var k,\n    _handlers = {},\n    _mods = { 16: false, 18: false, 17: false, 91: false },\n    _scope = \"all\",\n\n    // Modifier keys\n    _MODIFIERS = {\n      \"⇧\": 16, shift: 16,\n      \"⌥\": 18, alt: 18, option: 18,\n      \"⌃\": 17, ctrl: 17, control: 17,\n      \"⌘\": 91, command: 91\n    },\n\n    // Special keys\n    _MAP = {\n      backspace: 8, tab: 9, clear: 12,\n      enter: 13, \"return\": 13,\n      esc: 27, escape: 27, space: 32,\n      left: 37, up: 38,\n      right: 39, down: 40,\n      del: 46, \"delete\": 46,\n      home: 36, end: 35,\n      pageup: 33, pagedown: 34,\n      \",\": 188, \".\": 190, \"/\": 191,\n      \"`\": 192, \"-\": 189, \"=\": 187,\n      \";\": 186, \"\\'\": 222,\n      \"[\": 219, \"]\": 221, \"\\\\\": 220\n    },\n    code = function( x ) {\n      return _MAP[ x ] || x.toUpperCase().charCodeAt( 0 );\n    },\n    _downKeys = [];\n\n\tfor ( k = 1; k < 20; k++ ) {\n\t\t_MAP[ \"f\" + k ] = 111 + k;\n\t}\n\n  // IE doesn't support Array#indexOf, so have a simple replacement\n  function index( array, item ) {\n    var i = array.length;\n    while ( i-- ) if ( array[ i ] === item ) { return i; }\n    return -1;\n  }\n\n  // For comparing mods before unassignment\n  function compareArray( a1, a2 ) {\n    if ( a1.length != a2.length ) { return false; }\n    for ( var i = 0; i < a1.length; i++ ) {\n        if ( a1[ i ] !== a2[ i ] ) { return false; }\n    }\n    return true;\n  }\n\n\tvar modifierMap = {\n\t\t16: \"shiftKey\",\n\t\t18: \"altKey\",\n\t\t17: \"ctrlKey\",\n\t\t91: \"metaKey\"\n\t};\n\n\tfunction updateModifierKey( event ) {\n\t\tfor ( k in _mods ) _mods[ k ] = event[ modifierMap[ k ] ];\n\t}\n\n  // Handle keydown event\n  function dispatch( event ) {\n    var key, handler, k, i, modifiersMatch, scope;\n    key = event.keyCode;\n\n    if ( index( _downKeys, key ) == -1 ) {\n        _downKeys.push( key );\n    }\n\n    // If a modifier key, set the key.<modifierkeyname> property to true and return\n    if ( key == 93 || key == 224 ) { key = 91; } /* right command on webkit, command on Gecko */\n    if ( key in _mods ) {\n      _mods[ key ] = true;\n\n      // 'assignKey' from inside this closure is exported to window.key\n      for ( k in _MODIFIERS ) if ( _MODIFIERS[ k ] == key ) { assignKey[ k ] = true; }\n      if ( !( key in _handlers ) ) { /* allow single modifier shortcuts to execute */\n        return;               /* for combinations, return and wait for the second keypress */\n\t\t\t}\n    }\n    updateModifierKey( event );\n\n    // See if we need to ignore the keypress (filter() can can be overridden)\n    // by default ignore key presses if a select, textarea, or input is focused\n    if ( !assignKey.filter.call( this, event ) ) { return; }\n\n    // Abort if no potentially matching shortcuts found\n    if ( !( key in _handlers ) ) { return; }\n\n    scope = getScope();\n\n    // For each potential shortcut\n    for ( i = 0; i < _handlers[ key ].length; i++ ) {\n      handler = _handlers[ key ][ i ];\n\n      // See if it's in the current scope\n      if ( handler.scope == scope || handler.scope == \"all\" ) {\n\n        // Check if modifiers match if any\n        modifiersMatch = handler.mods.length > 0;\n        for ( k in _mods ) {\n          if ( ( !_mods[ k ] && index( handler.mods, +k ) > -1 ) ||\n               ( _mods[ k ] && index( handler.mods, +k ) == -1 ) ) {\n\t            modifiersMatch = false;\n\t        }\n        }\n\n        // Call the handler and stop the event if neccessary\n        if ( ( handler.mods.length === 0 && !_mods[ 16 ] && !_mods[ 18 ] &&\n               !_mods[ 17 ] && !_mods[ 91 ] ) || modifiersMatch ) {\n          if ( handler.method( event, handler ) === false ) {\n            if ( event.preventDefault ) {\n\t            event.preventDefault();\n\t          } else {\n\t\t          event.returnValue = false;\n\t\t        }\n            if ( event.stopPropagation ) { event.stopPropagation(); }\n            if ( event.cancelBubble ) { event.cancelBubble = true; }\n          }\n        }\n      }\n    }\n  }\n\n  // Unset modifier keys on keyup\n  function clearModifier( event ) {\n    var key = event.keyCode, k,\n        i = index( _downKeys, key );\n\n    // Remove key from _downKeys\n    if ( i >= 0 ) {\n        _downKeys.splice( i, 1 );\n    }\n\n    if ( key == 93 || key == 224 ) { key = 91; }\n    if ( key in _mods ) {\n      _mods[ key ] = false;\n      for ( k in _MODIFIERS ) if ( _MODIFIERS[ k ] == key ) { assignKey[ k ] = false; }\n    }\n  }\n\n  function resetModifiers() {\n    for ( k in _mods ) _mods[ k ] = false;\n    for ( k in _MODIFIERS ) assignKey[ k ] = false;\n  }\n\n  // Parse and assign shortcut\n  function assignKey( key, scope, method ) {\n    var keys, mods;\n    keys = getKeys( key );\n    if ( method === undefined ) {\n      method = scope;\n      scope = \"all\";\n    }\n\n    // For each shortcut\n    for ( var i = 0; i < keys.length; i++ ) {\n\n      // Set modifier keys if any\n      mods = [];\n      key = keys[ i ].split( \"+\" );\n\n      // Account for the case where shortcut is a single modifier\n      if ( key in _MODIFIERS ) {\n        key = _MODIFIERS[ key ];\n        mods = [ key ];\n      }\n\n      // All other cases\n      else {\n        if ( key.length > 1 ) {\n          mods = getMods( key );\n          key = [ key[ key.length - 1 ] ];\n        }\n\n        // Convert to keycode and...\n        key = key[ 0 ];\n        key = code( key );\n      }\n\n      // ...Store handler\n      if ( !( key in _handlers ) ) { _handlers[ key ] = []; }\n      _handlers[ key ].push( {\n\t      shortcut: keys[ i ],\n\t      scope: scope,\n\t      method: method,\n\t      key: keys[ i ],\n\t      mods: mods\n\t    } );\n    }\n  }\n\n  // Unbind all handlers for given key in current scope\n  function unbindKey( key, scope ) {\n    var multipleKeys, keys,\n      mods = [],\n      i, j, obj;\n\n    multipleKeys = getKeys( key );\n\n    for ( j = 0; j < multipleKeys.length; j++ ) {\n      keys = multipleKeys[ j ].split( \"+\" );\n\n      // Account for the case where shortcut is a single modifier\n      if ( key in _MODIFIERS ) {\n        key = _MODIFIERS[ key ];\n        mods = [ key ];\n      }\n\n      // All other cases\n      else {\n        if ( keys.length > 1 ) {\n          mods = getMods( keys );\n        }\n\n        key = keys[ keys.length - 1 ];\n        key = code( key );\n      }\n\n      if ( scope === undefined ) {\n        scope = getScope();\n      }\n      if ( !_handlers[ key ] ) {\n        return;\n      }\n      for ( i = 0; i < _handlers[ key ].length; i++ ) {\n        obj = _handlers[ key ][ i ];\n\n        // Only clear handlers if correct scope and mods match\n        if ( obj.scope === scope && compareArray( obj.mods, mods ) ) {\n          _handlers[ key ][ i ] = {};\n        }\n      }\n    }\n  }\n\n  // Returns true if the key with code 'keyCode' is currently down\n  // Converts strings into key codes.\n  function isPressed( keyCode ) {\n      if ( typeof( keyCode ) == \"string\" ) {\n        keyCode = code( keyCode );\n      }\n      return index( _downKeys, keyCode ) != -1;\n  }\n\n  function getPressedKeyCodes() {\n      return _downKeys.slice( 0 );\n  }\n\n  function filter( event ) {\n    var tagName = ( event.target || event.srcElement ).tagName;\n\n    // Ignore keypressed in any elements that support keyboard data input\n    return !( tagName == \"INPUT\" || tagName == \"SELECT\" || tagName == \"TEXTAREA\" );\n  }\n\n  // Initialize key.<modifier> to false\n  for ( k in _MODIFIERS ) assignKey[ k ] = false;\n\n  // Set current scope (default 'all')\n  function setScope( scope ) { _scope = scope || \"all\"; }\n  function getScope() { return _scope || \"all\"; }\n\n  // Delete all handlers for a given scope\n  function deleteScope( scope ) {\n    var key, handlers, i;\n\n    for ( key in _handlers ) {\n      handlers = _handlers[ key ];\n      for ( i = 0; i < handlers.length; ) {\n        if ( handlers[ i ].scope === scope ) {\n\t        handlers.splice( i, 1 );\n\t      } else {\n\t\t      i++;\n\t\t    }\n      }\n    }\n  }\n\n  // Abstract key logic for assign and unassign\n  function getKeys( key ) {\n    var keys;\n    key = key.replace( /\\s/g, \"\" );\n    keys = key.split( \",\" );\n    if ( ( keys[ keys.length - 1 ] ) === \"\" ) {\n      keys[ keys.length - 2 ] += \",\";\n    }\n    return keys;\n  }\n\n  // Abstract mods logic for assign and unassign\n  function getMods( key ) {\n    var mods = key.slice( 0, key.length - 1 );\n    for ( var mi = 0; mi < mods.length; mi++ )\n    mods[ mi ] = _MODIFIERS[ mods[ mi ] ];\n    return mods;\n  }\n\n  // Cross-browser events\n  function addEvent( object, event, method ) {\n    if ( object.addEventListener ) {\n      object.addEventListener( event, method, false );\n    } else if ( object.attachEvent ) {\n      object.attachEvent( \"on\" + event, function() { method( window.event ); } );\n    }\n  }\n\n  // Set the handlers globally on document\n  // Passing _scope to a callback to ensure it remains the same by execution. Fixes #48\n  addEvent( document, \"keydown\", function( event ) { dispatch( event ); } );\n  addEvent( document, \"keyup\", clearModifier );\n\n  // Reset modifiers to false whenever the window is (re)focused.\n  addEvent( window, \"focus\", resetModifiers );\n\n\t// Store previously defined key\n\tvar previousKey;\n\n\t// Restore previously defined key and return reference to our key object\n\tfunction noConflict() {\n\t\tvar k = global.key;\n\t\tglobal.key = previousKey;\n\t\treturn k;\n\t}\n\n\tvar toExport = assignKey;\n\ttoExport.setScope = setScope;\n\ttoExport.getScope = getScope;\n\ttoExport.deleteScope = deleteScope;\n\ttoExport.filter = filter;\n\ttoExport.isPressed = isPressed;\n\ttoExport.getPressedKeyCodes = getPressedKeyCodes;\n\ttoExport.noConflict = noConflict;\n\ttoExport.unbind = unbindKey;\n\n\t// If window is available set window.key and window.key.set/get/deleteScope,\n\t// and the default filter.\n\tif ( global ) {\n\t\tif ( global.key ) {\n\n\t\t\t// Store for possible recovery\n\t\t\tpreviousKey = global.key;\n\t\t}\n\t\tglobal.key = toExport;\n\t}\n\n\t// If requiring as module\n//\tif( typeof module !== \"undefined\" ) {\n//\t\t module.exports = toExport;\n//\t}\n\n\t// Remove from conditional to suppress Uglify warnings.\n\tmodule.exports = toExport;\n\n} )( this );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/keymaster.js\n **/","define( [ \"Modal\" ], function( Modal ) {\n\n\t// To be added & customized for each unique modal objects:\n\t// this.titleText   html to insert in body of modal\n\t// this.innerMarkup   html to insert in body of modal\n\t// this.modalInternalBinding   listeners other than ok/cancel\n\t// this.modalInternalUnbinding  remove listeners other than ok/cancel\n\t// this.modalValidate  optional check on click of OK. returns a Boolean.\n\t// this.modalSubmit   function to run \"ok\" click if valid.\n\n\tlet modalCanvasSize = Object.create( Modal );\n\n\tmodalCanvasSize.titleText = \"Canvas Size\";\n\n\tmodalCanvasSize.innerMarkup = function() {\n\t\treturn `<div class=\"modal__configure\">\n\t\t\t<div class=\"modal__section\">\n\t\t\t\t<div class=\"modal__section-title\">Current Size</div>\n\t\t\t\t<div class=\"modal__prop modal__prop--text-only\">\n\t\t\t\t\t<span class=\"modal__prop-name modal__prop-name--text-only\">Width:</span>\n\t\t\t\t</div\n\t\t\t\t><div class=\"modal__value modal__value--text-only\">\n\t\t\t\t\t<span class=\"modal__value-name modal__value-name--text-only\"\n\t\t\t\t\t\tdata-modal-canvas-size-current-width >\n\t\t\t\t\t\t${this.currentCanvasWidth}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"modal__prop modal__prop--text-only\">\n\t\t\t\t\t<span class=\"modal__prop-name modal__prop-name--text-only\">Height:</span>\n\t\t\t\t</div\n\t\t\t\t><div class=\"modal__value modal__value--text-only\">\n\t\t\t\t\t<span class=\"modal__value-name modal__value-name--text-only\"\n\t\t\t\t\t\tdata-modal-canvas-size-current-height\n\t\t\t\t\t\t\t>${this.currentCanvasHeight}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"modal__section\">\n\t\t\t\t<div class=\"modal__section-title\">New Size</div>\n\t\t\t\t<div class=\"modal__prop\">\n\t\t\t\t\t<span class=\"modal__prop-name\">Width:</span>\n\t\t\t\t</div\n\t\t\t\t><div class=\"modal__value\">\n\t\t\t\t\t<input id=\"canvas-size-width\" class=\"modal__numeric-input\" type=number min=\"0\"\n\t\t\t\t\t\tstep=\"1\" required value=${this.currentCanvasWidth}\n\t\t\t\t\t\tdata-modal-canvas-size-new-width>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"modal__prop\">\n\t\t\t\t\t<span class=modal__prop-name>Height:</span>\n\t\t\t\t</div\n\t\t\t\t><div class=\"modal__value\">\n\t\t\t\t\t<input class=\"modal__numeric-input\" type=\"number\" min=\"0\" step=\"1\" required\n\t\t\t\t\t\tvalue=${this.currentCanvasHeight}  data-modal-canvas-size-new-height>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"modal__prop\">\n\t\t\t\t\t<span class=modal__prop-name>Anchor:</span>\n\t\t\t\t</div\n\t\t\t\t><div class=\"modal__value modal__canvas-direction-button-container\"\n\t\t\t\t\tdata-canvas-direction-container>\n\t\t\t\t\t<svg class=\"modal__canvas-resize-arrows\" xmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 68 68\" >\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"4,4 4,13.15 7.87,9.3 15.66,16.95 17.14,15.54 9.41,\n\t\t\t\t\t\t\t\t7.71 13.05,4\"/>\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"40,8 34,2 28,8 33,8 33,19 35,19 35,8\"/>\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"64,4 55,4 58.85,7.85 51.2,15.62 52.61,17.1 60.37,9.37 64,13\"/>\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"8,27.5 2,33.5 8,39.5 8,35 19,35 19,33 8,33\"/>\n\t\t\t\t\t\t<circle id=\"circle_4_\" fill=\"#231F20\" cx=\"34\" cy=\"34\" r=\"3\"/>\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"60,39.5 66,33.5 60,27.5 60,33 49,33 49,35 60,35\"/>\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"4,64 13.2,64 9.35,60.2 17,52.45 15.59,50.99 7.73,58.72 4,55.1\"/>\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"28,60 34,66 40,60 35,60 35,49 33,49 33,60\"/>\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"64,64 64,54.95 60.22,58.8 52.49,51.15 51.03,52.56 58.77,\n\t\t\t\t\t\t\t60.34 55.15,64\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"left   top\"    ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"center top\"    ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"right  top\"    ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"left   middle\" ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"center middle\" ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"right  middle\" ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"left   bottom\" ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"center bottom\" ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"right  bottom\" ></button\n\t\t\t\t></div\n\t\t\t></div\n\t\t></div\n\t\t><div class=modal__confirm>\n\t\t\t<button type=button class=\"modal__button modal-ok\" data-modal-ok>OK</button>\n\t\t\t<button type=button class=\"modal__button modal-cancel\" data-modal-cancel>Cancel</button>\n\t\t</div>\n\t\t<div class=\"modal__error-text\"></div>`;\n\t};\n\n\tmodalCanvasSize.modalInternalBinding = function() {\n\t\tlet doc = document; // Shortening only :/\n\t\tthis.resizeIconPositionX = \"center\";\n\t\tthis.resizeIconPositionY = \"middle\";\n\n\t\tthis.onResizeDirectionButtonClick = this.onResizeDirectionButtonClick.bind( this );\n\n\t\tthis.resizeDirectionContainer = doc.querySelector( \"[data-canvas-direction-container]\" );\n\t\tthis.resizeDirectionContainer.addEventListener( \"click\",\n\t\t                                                this.onResizeDirectionButtonClick );\n\n\t\t// Focus the first input box and select (highlight) its contents.\n\t\t// FF doesn\"t support select() method.\n\t\t// Webkit throws InvalidStateError on setSelectionRange on an input type=number element.\n\t\t// https://code.google.com/p/chromium/issues/detail?id=346270\n\t\tlet firstInput = doc.getElementById( \"canvas-size-width\" );\n\t\ttry {\n\t\t\tfirstInput.focus();\n\t\t\tfirstInput.setSelectionRange( 0, 9999 );\n\t\t} catch ( e ) {\n\t\t\tfirstInput.select();\n\t\t}\n\t};\n\n\tmodalCanvasSize.modalInternalUnbinding = function() {\n\t\tlet that = this;\n\t\tthis.resizeDirectionContainer.removeEventListener( \"click\",\n\t\t                                                  that.onResizeDirectionButtonClick );\n\t};\n\n\t// Returns true if user input is valid.\n\tmodalCanvasSize.modalValidate = function() {\n\t\tlet newWidthEl = document.querySelector( \"[data-modal-canvas-size-new-width]\" );\n\t\tlet newHeightEl = document.querySelector( \"[data-modal-canvas-size-new-height]\" );\n\t\tlet newWidth = parseInt( newWidthEl.value );\n\t\tlet newHeight = parseInt( newHeightEl.value );\n\t\tlet errorText;\n\n\t\tthis.errorEl = document.querySelector( \".modal__error-text\" );\n\n\t\tif ( typeof newWidth !== \"number\" || typeof newHeight !== \"number\" ||\n\t\t     Number.isNaN( newWidth ) || Number.isNaN( newHeight ) ) {\n\t\t\terrorText = \"Oops! Please enter a numeric input value.\";\n\t\t} else if ( newWidth < 3 || newHeight < 3 ) {\n\t\t\terrorText = \"Oops! Canvases must be at least three pixels or larger on each dimension.\";\n\t\t} else if ( newWidth >= 5000 || newHeight >= 5000 ) {\n\t\t\terrorText = \"Whoa Nellie! Please keep it under 5000 pixels on each dimension.\";\n\t\t}\n\t\tif ( errorText ) {\n\t\t\tthis.showError( errorText );\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthis.newWidth = newWidth;\n\t\t\tthis.newHeight = newHeight;\n\t\t\treturn true;\n\t\t}\n\t};\n\n\tmodalCanvasSize.onResizeDirectionButtonClick = function( e ) {\n\t\te.preventDefault();\n\t\te.stopImmediatePropagation();\n\n\t\t// Target should be one of the child buttons, split on spaces.\n\t\tlet positions = e.target.getAttribute( \"data-canvas-resize-direction\" );\n\t\tpositions = positions.split( /\\s+/ );\n\n\t\t// Set the new icon positions.\n\t\t// Markup is strictly horizontal value first, then vertical value.\n\t\tthis.resizeIconPositionX = positions[ 0 ];\n\t\tthis.resizeIconPositionY = positions[ 1 ];\n\n\t\t// Remove all old positioning classes. This could surely be improved?\n\t\tthis.resizeDirectionContainer.classList.remove( \"resize-icon-top\",\n\t\t                                                \"resize-icon-middle\",\n\t\t                                                \"resize-icon-bottom\",\n\t\t                                                \"resize-icon-left\",\n\t\t                                                \"resize-icon-center\",\n\t\t                                                \"resize-icon-right\" );\n\n\t\t// And add the new appropriate classes.\n\t\tthis.resizeDirectionContainer.classList.add( \"resize-icon-\" + this.resizeIconPositionX );\n\t\tthis.resizeDirectionContainer.classList.add( \"resize-icon-\" + this.resizeIconPositionY );\n\t};\n\n\treturn modalCanvasSize;\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/modalCanvasSize.js\n **/","define( [ \"Modal\", \"parseRLEFile\", \"parseBMP\" ], function( Modal, parseRLEFile, parseBMP ) {\n\n\t// To be added & customized for each unique modal object:\n\t// this.titleText   html to insert in body of modal\n\t// this.innerMarkup   html to insert in body of modal\n\t// this.modalInternalBinding   listeners other than ok/cancel\n\t// this.modalInternalUnbinding  remove listeners other than ok/cancel\n\t// this.modalValidate  optional check on click of OK. returns a Boolean.\n\t// this.modalSubmit   function to run 'ok' click if valid.\n\n\tlet modalOpenPattern = Object.create( Modal );\n\n\tmodalOpenPattern.titleText = \"Open Pattern\";\n\n\tmodalOpenPattern.innerMarkup = function() {\n\t\treturn \"<div class='modal__open modal__configure'>\" +\n\t\t\t\"<div class='modal__open__instructions'>Choose a JSON, RLE, or 1-bit\" +\n\t\t\t\" Windows BMP file pattern from your file system.\" +\n\t\t\t\"</div>\" +\n\t\t\"</div\" +\n\t\t\"><div class=modal__confirm>\" +\n\t\t\t\"<button type=button class='modal__button modal-ok'\" +\n\t\t\t\t\" data-modal-ok>OK</button>\" +\n\t\t\t\"<button type=button class='modal__button modal-cancel' \" +\n\t\t\t\t\t\"data-modal-cancel>Cancel</button>\" +\n\t\t\"</div>\" +\n\t\t\"<div class='modal__open__error-text modal__error-text'></div>\" +\n\t\t\"<div class=modal__input-file-wrapper>\" +\n\t\t\t\"<input class=modal__file-input type=file>\" +\n\t\t\"</div>\";\n\t};\n\n\tmodalOpenPattern.modalInternalBinding = function() {\n\t\tlet fileInputEl = document.querySelector( \".modal__file-input\" );\n\t\tlet errorEl = document.querySelector( \".modal__error-text\" );\n\n\t\tthis.modalValidateFileInputChoice = this.modalValidateFileInputChoice.bind( this );\n\t\tthis.modalValidateFileInputContents = this.modalValidateFileInputContents.bind( this );\n\n\t\tthis.fileInputEl = fileInputEl;\n\t\tthis.errorEl = errorEl ;\n\n\t\t// Don't wait until \"OK\" click to validate the input.\n\t\tthis.fileInputEl.addEventListener( \"change\", this.modalValidateFileInputChoice );\n\t};\n\n\tmodalOpenPattern.modalInternalUnbinding = function() {\n\t\tthis.fileInputEl.removeEventListener( \"change\", this.modalValidateFileInputChoice );\n\t};\n\n\tmodalOpenPattern.parsedPattern = null;\n\tmodalOpenPattern.isValid = false; // Nothing initially selected.\n\n\tmodalOpenPattern.validateBMP = function( file ) {\n\t\tlet bm = parseBMP( file );\n\t\tlet errorText = \"\";\n\n\t\tif ( bm.iHeader.bitsPerPixel > 1 ) {\n\t\t\terrorText = \"The BMP file can't be read because it has a bit depth of \" +\n\t\t\t            \"greater than one.\";\n\t\t} else if ( bm.iHeader.compressionMethod > 0 ) {\n\t\t\terrorText = \"Lifey currently only supports uncompressed BMP files.\";\n\t\t}\n\t\tif ( errorText ) {\n\t\t\tthis.parsedPattern = null;\n\t\t} else {\n\t\t\tthis.parsedPattern = bm;\n\t\t}\n\t\treturn errorText;\n\t};\n\n\tmodalOpenPattern.readFile = function( file ) {\n\t\tlet fReader = new FileReader();\n\t\tlet that = this;\n\t\tlet ext = this.fileExtension;\n\n\t\tfReader.onload = function( e ) {\n\t\t\tthat.modalValidateFileInputContents( e.target.result );\n\t\t};\n\n\t\t// Read the file differently based on the extension.\n\t\t// This kicks off the onload event above.\n\t\tif ( ext === \"JSON\" || ext === \"RLE\" ) {\n\t\t\tfReader.readAsText( file );\n\t\t} else if ( ext === \"BMP\" ) {\n\n\t\t\t// BMP is binary, read as an Array Buffer.\n\t\t\tfReader.readAsArrayBuffer( file );\n\t\t}\n\t};\n\n\t// Validity can be set by the file(s) being selected, or the file being (mis)read\n\t// or parsed. This gets checked on click of \"ok\" button.\n\tmodalOpenPattern.modalValidate = function() {\n\t\treturn this.isValid;\n\t};\n\n\tmodalOpenPattern.modalValidateFileInputContents = function( file ) {\n\t\tlet ext = this.fileExtension;\n\t\tlet errorText = \"\";\n\n\t\tif ( ext === \"JSON\" ) {\n\t\t\ttry {\n\t\t\t\tthis.parsedPattern = JSON.parse( file );\n\t\t\t} catch ( e ) {\n\t\t\t\terrorText = \"The file text is not valid JSON.\" +\n\t\t\t\t\t\" Please check the file for a possible syntax error.\";\n\t\t\t}\n\n\t\t} else if ( ext === \"RLE\" ) {\n\t\t\tthis.parsedPattern = parseRLEFile( file );\n\n\t\t} else if ( ext === \"BMP\" ) {\n\t\t\terrorText = this.validateBMP( file );\n\t\t}\n\n\t\tthis.showError( errorText );\n\t\tthis.isValid = !errorText;\n\t};\n\n\tmodalOpenPattern.modalValidateFileInputChoice = function() {\n\t\tlet fileList = this.fileInputEl.files;\n\t\tlet file = fileList[ 0 ];\n\t\tlet errorText = \"\"; // Always added, must be a string.\n\t\tlet fileName = file.name;\n\t\tlet fileExtension = fileName.split( \".\" ).pop().toUpperCase();\n\t\tthis.fileExtension = fileExtension;\n\n\t\tif ( !file || fileList.length === 0 ) {\n\t\t\terrorText = \"No file selected.\";\n\t\t} else if ( fileList.length > 1 ) {\n\t\t\terrorText = \"Multiple files selected. Please choose a single file.\";\n\t\t} else if ( fileExtension !== \"JSON\" &&\n\t\t            fileExtension !== \"BMP\" &&\n\t\t            fileExtension !== \"RLE\" ) {\n\t\t\terrorText = \"The file name should end with a dot, followed by either “json”,\" +\n\t\t\t            \" “rle”, or “bmp”.\";\n\t\t}\n\n\t\tif ( errorText ) {\n\t\t\tthis.parsedPattern = null;\n\t\t} else {\n\t\t\tthis.readFile( file );  // Kicks off a second round of validation.\n\t\t}\n\n\t\t// Always \"show\" the error even if it's an empty string, so that a file input\n\t\t// correction erases any previous error messages.\n\t\tthis.showError( errorText );\n\t\tthis.isValid = !errorText;\n\t};\n\n\treturn modalOpenPattern;\n} );\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/modalOpenPattern.js\n **/","/**\n * Parse RLE to JSON\n *\n * Parses \"run-length-encoded\" (.rle) files used for storing\n * cellular automata patterns. Written as AMD module.\n *\n * By Alex Bell |  MIT License\n *\n * @returns {\n *     name: String,\n *     comments: String,\n *     author: String,\n *     coordinates: [Integer, Integer],\n *     rule: String,\n *     width: Integer,\n *     height: Integer,\n *     pattern: str\n *  }\n *\n * Based on the very basic syntax/grammar outline here\n * http://www.mirekw.com/ca/ca_files_formats.html\n *\n *   b = a dead cell\n *   o = a live cell\n *   $ = end of a line of the pattern\n *\n *   #N Beehive at beehive\n *   #C A simple 12-cell still life composed of two beehive.\n *   #C www.conwaylife.com/wiki/index.php?title=Beehive_at_beehive\n *   #O ook \"The Librarian\"@unseen.edu Fri Apr 30 19:38:52 1999\n *   #R -22 -57 (this is the offset from the top left.)\n *   x = 6, y = 6, rule = 23/3\n *   4bob$3bobo$3bobo$b2obob$o2bo2b$b2o!\n */\ndefine( function() {\n\n\treturn function( str ) {\n\t\tlet ret = Object.create( null );\n\n\t\tif ( !str ) { return; } // Stay out of trouble.\n\n\t\tlet pos = 0;\n\t\tlet chrctr;\n\t\tlet inComment = false;\n\t\tlet currentTerm; // Can be \"width\", \"height\", or \"rule\"\n\n\t\tret.name = \"\"; // These are the really the only two properties certain to be included.\n\t\tret.pattern = \"\";\n\n\t\tlet isSpace = function( c ) {\n\t\t\treturn ( c === \"\\u0020\" || // Space\n\t\t\t         c === \"\\u0009\" );  // Horizontal tab\n\t\t};\n\n\t\tlet isNewLine = function( c ) {\n\t\t\treturn ( c === \"\\u000A\" || // New line\n\t\t\t         c === \"\\u000C\" || // Form feed\n\t\t\t         c === \"\\u000D\" );  // Carriage return\n\t\t};\n\n\t\t// http://jsperf.com/isdigittest/5\n\t\tlet isDigit = function( n ) {\n\t\t    return Boolean( [ true, true, true, true, true, true, true, true, true, true ][ n ] );\n\t\t};\n\n\t\tlet stripTrailingSpaces = function( str ) {\n\t\t\twhile ( isSpace( str[ str.length - 1 ] ) ) {\n\t\t\t\tstr = str.substring( 0, str.length - 2 );\n\t\t\t}\n\t\t\treturn str;\n\t\t};\n\n\t\tlet createEmptyPropIfNone = function( str ) {\n\t\t\tif ( !ret[ str ] ) {\n\t\t\t\tret[ str ] = \"\";\n\t\t\t}\n\t\t};\n\n\t\twhile ( true ) {\n\t\t\tchrctr = str[ pos ];\n\n\t\t\t// If string has no length, or we've hit the exclamation point EOF marker,\n\t\t\t// or end of string reached.\n\t\t\tif ( !chrctr || chrctr === \"!\" ) {\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t// Determine if entering a comment\n\t\t\tif ( chrctr === \"#\" ) {\n\t\t\t\tif ( str[ pos + 1 ] === \"N\" || str[ pos + 1 ] === \"n\" ) {\n\t\t\t\t\tinComment = \"name\";\n\t\t\t\t} else if ( str[ pos + 1 ] === \"C\" || str[ pos + 1 ] === \"c\" ) {\n\t\t\t\t\tinComment = \"comments\";\n\t\t\t\t\tcreateEmptyPropIfNone( \"comments\" );\n\t\t\t\t} else if ( str[ pos + 1 ] === \"O\" || str[ pos + 1 ] === \"o\" ) {\n\t\t\t\t\tinComment = \"author\";\n\t\t\t\t\tcreateEmptyPropIfNone( \"author\" );\n\t\t\t\t} else if ( str[ pos + 1 ] === \"R\" ) {\n\t\t\t\t\tinComment = \"coordinates\";\n\t\t\t\t\tcreateEmptyPropIfNone( \"coordinates\" );\n\t\t\t\t}\n\t\t\t\tpos = pos + 2;\n\t\t\t\tcontinue;\n\n\t\t\t// Inside a comment\n\t\t\t} else if ( inComment ) {\n\n\t\t\t\t// Bail out of comment on newline.\n\t\t\t\tif ( isNewLine( chrctr ) ) {\n\n\t\t\t\t\t// Remove trailing spaces from a comment line.\n\t\t\t\t\tret[ inComment ] = stripTrailingSpaces( ret[ inComment ] );\n\n\t\t\t\t\tif ( inComment === \"coordinates\" ) {\n\t\t\t\t\t\tret.coordinates = ret.coordinates.split( \" \" );\n\t\t\t\t\t\tret.coordinates[ 0 ] = parseInt( ret.coordinates[ 0 ], 10 ); // The x\n\t\t\t\t\t\tret.coordinates[ 1 ] = parseInt( ret.coordinates[ 1 ], 10 ); // The y\n\t\t\t\t\t}\n\t\t\t\t\tinComment = false;\n\n\t\t\t\t// Ignore leading spaces and tabcharacters inside a comment if\n\t\t\t\t// the corresponding property is currently an empty string.\n\t\t\t\t} else if ( isSpace( chrctr ) && ret[ inComment ] === \"\" ) {\n\n\t\t\t\t\t\t// Do nothing inside here. Do Not remove.\n\n\t\t\t\t// The coordinates string should be only digits, hyphens, spaces.\n\t\t\t\t// Skip over anything else like letters or punctuation.\n\t\t\t\t} else if ( inComment === \"coordinates\" && !isSpace( chrctr ) &&\n\t\t\t\t           !isDigit( chrctr ) && chrctr !== \"-\" ) {\n\t\t\t\t\t\tpos += 1;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// The general case: add the character to the comment.\n\t\t\t\t\tret[ inComment ] += chrctr;\n\t\t\t\t}\n\n\t\t\t// Not in a comment from here on down.\n\t\t\t// Determine if entering a property\n\t\t\t} else if ( chrctr === \"x\" ) {\n\t\t\t\tcurrentTerm = \"width\";\n\t\t\t\tcreateEmptyPropIfNone( \"width\" );\n\n\t\t\t} else if ( chrctr === \"y\" ) {\n\t\t\t\tcurrentTerm = \"height\";\n\t\t\t\tcreateEmptyPropIfNone( \"height\" );\n\n\t\t\t} else if ( str.substring( pos, pos + 4 ) === \"rule\" ) {\n\t\t\t\tcurrentTerm = \"rule\";\n\t\t\t\tcreateEmptyPropIfNone( \"rule\" );\n\n\t\t\t// Reset currentTerm to empty on commas or newlines\n\t\t\t} else if ( chrctr === \",\" || isNewLine( chrctr ) ) {\n\t\t\t\tcurrentTerm = \"\";\n\n\t\t\t\t// Convert to number\n\t\t\t\tif ( ret.width && ret.height ) {\n\t\t\t\t\tret.width = parseInt( ret.width );\n\t\t\t\t\tret.height = parseInt( ret.height );\n\t\t\t\t}\n\n\t\t\t} else if ( currentTerm ) {\n\n\t\t\t\t// Width, height, and rule all accept any digit.\n\t\t\t\tif ( isDigit( chrctr ) ) {\n\t\t\t\t\tret[ currentTerm ] += chrctr;\n\n\t\t\t\t// \"rule\" additionally accepts a slash\n\t\t\t\t} else if ( currentTerm === \"rule\" && chrctr === \"/\" ) {\n\t\t\t\t\tret[ currentTerm ] += \"/\";\n\t\t\t\t}\n\n\t\t\t// Not in a comment, and not in currentTerm,\n\t\t\t// which means we've reached the actual pattern.\n\t\t\t} else if ( isDigit( chrctr ) || chrctr === \"b\" ||\n\t\t\t            chrctr === \"o\" || chrctr === \"$\" ) {\n\t\t\t ret.pattern += chrctr;\n\t\t\t}\n\n\t\t\tpos += 1;\n\n\t\t} // End of big while loop.\n\t};\n\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/parseRLEFile.js\n **/","define( function() {\n\n\t/**\n\t * @param {Buffer} buffer (from FileReader)\n\t * @returns {Object} with image properties\n\t */\n\treturn function( buffer ) {\n\t\tlet dataV = new DataView( buffer );\n\t\tlet bm = Object.create( null );\n\n\t\t// Omit for brevity:\n\t\t// let decoder = new TextDecoder( \"utf-8\" );\n\n\t\tbm.fHeader = Object.create( null );\n\n\t\t// Much of this could be omitted for brevity, but it's useful for\n\t\t// reference and debugging.\n\n\t\t// Typically \"BM\" for Windows 3, 95, NT +\n\t\t// Ancient unsupported entries include: \"BA\", \"CI\", \"CP\", \"IC\", \"PT\".\n    // bm.fHeader.type = decoder.decode( new DataView( buffer, 0, 2 ) );\n\n\t\t// The file size in bytes\n\t\t// bm.fHeader.byteSize =         dataV.getUint32( 2, true );\n\n\t\t// Reserved, depends on the application\n\t\t// bm.fHeader.reserved1 =        dataV.getUint16( 6, true );\n\n\t\t// Reserved, depends on the application\n\t\t// bm.fHeader.reserved2 =        dataV.getUint16( 8, true );\n\n\t\t// Offset of the byte where the pixel array starts\n\t\tbm.fHeader.offsetToPixArray = dataV.getUint32( 10, true );\n\n\t\tbm.iHeader = Object.create( null );\n\n\t\t// The size of this header, varies with format version #\n\t\t// e.g. V2 = 12; V3 = 40; V4 = 108; V5 = 124\n\t\t// bm.iHeader.headerSize =        dataV.getUint32( 14, true );\n\n\t\t// The bitmap width in pixels (integer).\n\t\tbm.width =                     dataV.getUint32( 18, true );\n\n\t\t// The bitmap height in pixels (integer).\n\t\tbm.height =                    dataV.getUint32( 22, true );\n\n\t\t// Number of color planes used (set to 1).\n\t\t// bm.iHeader.colorPlanes =       dataV.getUint16( 26, true );\n\n\t\t// Number of bits per pixel. Typically: 1, 4, 8, 16, 24 or 32.\n\t\tbm.iHeader.bitsPerPixel =      dataV.getUint16( 28, true );\n\n\t\t// The compression method being used. 0 means uncompressed,\n\t\t// which is currently the only value supported in the validator.\n\t\tbm.iHeader.compressionMethod = dataV.getUint32( 30, true );\n\n\t\t// Image size of raw bitmap data (not file size).\n\t\t// bm.iHeader.imageSize =         dataV.getUint32( 34, true );\n\n\t\t// Irrelevant in this context.\n\t\t// bm.iHeader.pixPerMeterX =      dataV.getUint32( 38, true );\n\t\t// bm.iHeader.pixPerMeterY =      dataV.getUint32( 42, true );\n\n\t\t// Number of colors in the palette. Should be \"0\" for 1 bit.\n\t\t// bm.iHeader.usedColors =        dataV.getUint32( 46, true );\n\n\t\t// Number of important colors used\n\t\t// bm.iHeader.importantColors =   dataV.getUint32( 50, true );\n\n\t\t// Stride is the number of bytes in a row. Stride must be a multiple of 4.\n\t\tbm.stride = Math.ceil( bm.iHeader.bitsPerPixel * bm.width / 32 ) * 4;\n\n\t\t// Total number of pixels in the image\n\t\tbm.pixels = new Uint8Array( bm.width * bm.height ); // Initially all zeros\n\n\t\tlet offset = bm.fHeader.offsetToPixArray;\n\t\tlet indent, byteAddress, bitAddress, byteVal, bitVal;\n\n\t\t// Outer loop iterates image rows\n\t\tfor ( let y = 0; y < bm.height; y += 1 ) {\n\t\t\tindent = bm.stride * y;\n\n\t\t\t// Inner loop iterates image columns\n\t\t\tfor ( let x = 0; x < bm.width; x += 1 ) {\n\t\t\t\tbyteAddress = Math.floor( x / 8 );\n\t\t\t\tbitAddress = x % 8;\n\t\t\t\tbyteVal = dataV.getUint8( offset + indent + byteAddress, true );\n\t\t\t\tbyteVal = byteVal.toString( 2 ); // Convert to base 2\n\n\t\t\t\t// Trick to pad left with zeros to 8 digits\n\t\t\t\tbyteVal = ( \"00000000\" + byteVal ).substring( byteVal.length );\n\t\t\t\tbitVal = byteVal[ bitAddress ];\n\n\t\t\t\t// BMP pixels start at the bottom left, so reverse the row order\n\t\t\t\tbm.pixels[ ( bm.height - 1 - y ) * bm.width + x ] = bitVal;\n\t\t\t}\n\t\t}\n\n\t\treturn bm;\n\t};\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/parseBMP.js\n **/","define( [ \"Modal\" ], function( Modal ) {\n\n\t// To be added & customized for each unique modal objects:\n\t// this.titleText   html to insert in body of modal\n\t// this.innerMarkup   html to insert in body of modal\n\t// this.modalInternalBinding   listeners other than ok/cancel\n\t// this.modalInternalUnbinding  remove listeners other than ok/cancel\n\t// this.modalValidate  optional check on click of OK. returns a Boolean.\n\t// this.modalSubmit   function to run 'ok' click if valid.\n\n\tlet modalSavePattern = Object.create( Modal );\n\n\tmodalSavePattern.titleText = \"Save As\";\n\n\tmodalSavePattern.innerMarkup = function() {\n\t\treturn \"<div class='modal__configure modal__configure--save-as'>\" +\n\t\t\t\"<div class='modal__save-pattern-option'>Format:</div>\" +\n\t\t\t\"<div class='modal__save-pattern-option-input-wrapper'>\" +\n\t\t\t\t\"<select class=modal__save-pattern-option-input name=fileformat\" +\n\t\t\t\t\t\" data-modal-save-file-format>\" +\n\t\t\t\t  \"<option value='json' selected>JavaScript Object Notation (.json)</option>\" +\n\t\t\t\t\t\"<option value='rle'>Run Length Encoded (.rle)</option>\" +\n\t\t\t\t\"</select>\" +\n\t\t\t\"</div>\" +\n\n\t\t\t\"<div class=modal__save-pattern-option>Pattern Name:</div>\" +\n\t\t\t\"<div class=modal__save-pattern-option-input-wrapper>\" +\n\t\t\t\t\"<input type=text class=modal__save-pattern-option-input\" +\n\t\t\t\t\t\" data-modal-save-pattern-name>\" +\n\t\t\t\"</div>\" +\n\t\t\t\"<div class=modal__save-pattern-option>Author:</div>\" +\n\t\t\t\"<div class=modal__save-pattern-option-input-wrapper>\" +\n\t\t\t\t\"<input type=text class=modal__save-pattern-option-input\" +\n\t\t\t\t\t\" data-modal-save-pattern-author>\" +\n\t\t\t\"</div>\" +\n\t\t\t\"<div class=modal__error-text></div>\" +\n\t\t\"</div>\" +\n\t\t\"<div class='modal__confirm modal__confirm--bottom-corner'>\" +\n\t\t\t\"<button type=button class='modal__button modal-cancel modal-cancel--save-as'\" +\n\t\t\t\t\"data-modal-cancel>Cancel</button>\" +\n\t\t\t\"<button type=button class='modal__button modal-ok modal-ok--save-as'\" +\n\t\t\t\t\"data-modal-ok >Save</button>\" +\n\t\t\"</div>\";\n\t};\n\n\treturn modalSavePattern;\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/modalSavePattern.js\n **/","define( [ \"Modal\" ], function( Modal ) {\n\n\t// To be added & customized for each unique modal object:\n\t// this.titleText   html to insert in body of modal.\n\t// this.innerMarkup   html to insert in body of modal.\n\t// this.modalInternalBinding   (optional) listeners other than ok/cancel.\n\t// this.modalInternalUnbinding  (optional) remove listeners other than ok/cancel.\n\t// this.modalValidate  (optional) check on click of OK. returns a Boolean.\n\t// this.modalSubmit   function to run \"ok\" click if valid.\n\n\tlet modalSharePattern = Object.create( Modal );\n\n\tmodalSharePattern.titleText = \"Share Pattern\";\n\n\tmodalSharePattern.innerMarkup = function() {\n\t\treturn \"\" +\n\t\t\"<div class='modal__configure modal__share__configure'>\" +\n\t\t\t\"<div class='modal__section-title--share'>\" +\n\t\t\t\t\t\"<span class=pattern-fits-in-url></span>\" +\n\t\t\t\"</div>\" +\n\t\t\"</div>\" +\n\t\t\"<div class=modal__confirm>\" +\n\t\t\t\"<button type=button class='modal__button modal-ok' data-modal-ok>OK</button>\" +\n\t\t\"</div>\" +\n\t\t\"<div class=modal__shareable-url data-modal-shareable-url></div\";\n\t};\n\n\treturn modalSharePattern;\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/modalSharePattern.js\n **/","/**  ---- Parse RLE pixel string ----\n *\n *\t Based on the syntax outline at:\n *\t http://www.mirekw.com/ca/ca_files_formats.html\n *\n *   b = a dead cell\n *   o = a live cell\n *   $ = end of a line of the pattern\n *\n *   4bob$3bobo$3bobo$b2obob$o2bo2b$b2o!\n *\n *\tReturns a uInt8 Array of pixel data with 0 = dead, 1 = live\n *\n * @param {String} str\n * @param {Number} width\n * @param {Number} height\n * @returns {uInt8 Array}\n */\ndefine( [ \"Utility\" ], function( ut ) {\n\n\t// Currently needed just for Intern to allow block-scoping.\n\t// Consider removing in build.\n\t\"use strict\";\n\n\treturn function( str, width, height ) {\n\t\twidth = width || 0;\n\t\theight = height || 0;\n\t\tlet chrctr;\n\t\tlet pos = 0;\n\t\tlet runCount = \"\"; // Concatenated character by character\n\t\tlet runCountInteger;\n\t\tlet currentX = 0;\n\t\tlet currentY = 0;\n\t\tlet dataArray = new Int8Array( width * height ); // All zeros initially\n\n\t\tif ( !str || !width || !height ) {\n\t\t\treturn; // Stay out of loop.\n\t\t}\n\n\t\t// Loop through each character in the string.\n\t\twhile ( true ) {\n\t\t\tchrctr = str[ pos ];\n\n\t\t\t// If end of string reached, or exclamation point EOF marker.\n\t\t\tif ( !chrctr || chrctr === \"!\" ) {\n\t\t\t\treturn dataArray;                // Main return path\n\n\t\t\t} else if ( ut.isDigit( chrctr ) ) {\n\t\t\t\trunCount += chrctr;\n\n\t\t\t} else if ( chrctr === \"b\" || chrctr === \"o\" ) {\n\t\t\t\trunCountInteger = parseInt( runCount ) || 1;\n\n\t\t\t\t// Don't bother setting empty cells on the typed array,\n\t\t\t\t// because it's pre-populated with all zeroes.\n\t\t\t\tif ( chrctr === \"o\" ) {\n\t\t\t\t\tfor ( let i = 0; i < runCountInteger; i += 1 ) {\n\t\t\t\t\t\tdataArray[ currentY * width + currentX + i ] = 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Advance currentX (whether it's a \"b\" or an \"o\")\n\t\t\t\tcurrentX += runCountInteger;\n\t\t\t\trunCount = \"\"; // Reset\n\n\t\t\t} else if ( chrctr === \"$\" ) {\n\n\t\t\t\t// End of this row, and possibly the next rows, etc.\n\t\t\t\t// Basically treat runCount $s as \"newlines\" in the grid.\n\t\t\t\trunCountInteger = parseInt( runCount ) || 1;\n\n\t\t\t\tcurrentX = 0;\n\t\t\t\tcurrentY += runCountInteger;\n\t\t\t\trunCount = \"\";\n\t\t\t}\n\n\t\t\tpos += 1;\n\t\t}\n\t};\n\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/parseRLEPixelString.js\n **/","/**  ---- Convert Pattern Object to RLE file string ----\n *\n *\t Based on the syntax outline at:\n *\t http://www.mirekw.com/ca/ca_files_formats.html\n *\n *   #N Beehive at beehive\n *   #C A simple 12-cell still life composed of two beehive.\n *   #C www.conwaylife.com/wiki/index.php?title=Beehive_at_beehive\n *   #O ook \"The Librarian\"@unseen.edu Fri Apr 30 19:38:52 1999\n *   #R -22 -57\n *   x = 6, y = 6, rule = 23/3\n *   4bob$3bobo$3bobo$b2obob$o2bo2b$b2o!\n *\n *   TO DO: Integrate #R value with offsetX and offsetY? It's unclear to me\n *   right now what negative #R values here are relative to.\n *\n */\ndefine( function() {\n\n\treturn function( pat ) {\n\t\tlet retStr = \"\";\n\n\t\tif ( pat.name ) {\n\t\t\tretStr += \"#N \" + pat.name + \"\\n\";\n\t\t}\n\t\tif ( pat.author ) {\n\t\t\tretStr += \"#O \" + pat.author + \"\\n\";\n\t\t}\n\t\tretStr += \"x = \" + pat.width + \", y=\" + pat.height + \", rule = B3/S23\\n\";\n\t\tretStr += pat.pattern + \"!\\n\";\n\n\t\treturn retStr;\n\t};\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/patToRleFileString.js\n **/","/**\n * Fn dataArrayToRLE\n * @returns {object}  returns object with properties\n *\t pattern {string},\n *\t width {integer},\n *\t height {integer},\n *   minCanvasX {integer},\n *   minCanvasY {integer},\n *   offsetX {integer},\n *   offsetY {integer}\n */\n\ndefine( [], function() {\n\n\t// Currently needed just for Intern to allow block-scoping.\n\t\"use strict\";\n\n\treturn function( dataArray, canvasWidth, canvasHeight ) {\n\t\tlet len = dataArray.length;\n\t\tif ( len !== canvasWidth * canvasHeight ) {\n\t\t\tconsole.log( \"dataArray doesn't match supplied canvas dimensions.\" );\n\t\t\treturn false;\n\t\t}\n\n\t\tlet posTopMost = 0; // Start at beginning.\n\t\tfor ( ; posTopMost < len; posTopMost += 1 ) {\n\t\t\tif ( dataArray[ posTopMost ] === 1 ) {\n\t\t\t\tbreak; // Exit at first active cell.\n\t\t\t}\n\t\t}\n\n\t\tlet posBottomMost = len - 1; // Start at end.\n\t\tfor ( ; posBottomMost > 0; posBottomMost -= 1 ) {\n\t\t\tif ( dataArray[ posBottomMost ] === 1 ) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Array position of leftmost active. Start all the way right and move left.\n\t\tlet posLeftMost = canvasWidth - 1;\n\t\tfor ( let i = 0; i < len; i += 1 ) {\n\t\t\tif ( dataArray[ i ] === 1 && i % canvasWidth < posLeftMost % canvasWidth ) {\n\t\t\t\tposLeftMost = i; // Must go through the full loop.\n\t\t\t}\n\t\t}\n\n\t\t// Array position of rightmost active. Start all the way left and move right.\n\t\tlet posRightMost = 0;\n\t\tfor ( let i = 0; i < len; i += 1 ) {\n\t\t\tif ( dataArray[ i ] === 1 && i % canvasWidth > posRightMost % canvasWidth ) {\n\t\t\t\tposRightMost = i; // Must go through the full loop.\n\t\t\t}\n\t\t}\n\n\t\tlet patternWidth = posRightMost % canvasWidth  - posLeftMost % canvasWidth + 1;\n\t\tlet patternHeight = Math.floor( posBottomMost / canvasWidth ) -\n\t\t                    Math.floor( posTopMost / canvasWidth ) + 1;\n\t\tlet offsetX = posLeftMost % canvasWidth;\n\t\tlet offsetY = Math.floor( posTopMost / canvasWidth );\n\n\t\tlet croppedDataArray = cropArray( dataArray, canvasWidth, canvasHeight,\n\t\t                                  patternWidth, patternHeight, offsetX, offsetY );\n\n\t\tlet ret = Object.create( null );\n\t\tret.pattern = encodeArrayAsRLEString( croppedDataArray, patternWidth );\n\t\tret.width = patternWidth;\n\t\tret.height = patternHeight;\n\n\t\tif ( patternWidth < canvasWidth ) {\n\t\t\tret.offsetX = offsetX;\n\t\t\tret.minCanvasX = canvasWidth;\n\t\t}\n\t\tif ( patternHeight < canvasHeight ) {\n\t\t\tret.offsetY = offsetY;\n\t\t\tret.minCanvasY = canvasHeight;\n\t\t}\n\n\t\t// Handle the \"completely empty canvas\" case.\n\t\t// Never return a negative width and height.\n\t\tif ( posTopMost === len ) {\n\t\t\tret.width = ret.height = ret.offsetX = ret.offsetY = 0;\n\t\t}\n\n\t\treturn ret;\n\t};\n\n\t/**\n\t *\tReturns a cropped data Array.\n\t *\n\t *  offsetX and offsetY values are from top left.\n\t */\n\tfunction cropArray( arr, currWidth, currHeight, cropWidth, cropHeight, offsetX, offsetY ) {\n\t\tlet newDataArray = new Int8Array( cropWidth * cropHeight );\n\n\t\t// Loop through all of the newDataArray,\n\t\t// getting values from the old DataArray.\n\t\tfor ( let i = 0; i < cropHeight; i += 1 ) {\n\t\t\tfor ( let j = 0; j < cropWidth; j += 1 ) {\n\t\t\t\tnewDataArray[ ( i  * cropWidth + j ) ] =\n\t\t\t\t              arr[ ( i + offsetY ) * currWidth + j + offsetX ];\n\t\t\t}\n\t\t}\n\t\treturn newDataArray;\n\t}\n\nfunction encodeArrayAsRLEString( dataArr, canvasWidth ) {\n\tlet retStr = \"\";\n\tlet currentChar, previousChar;\n\tlet previousCharCount = 0;\n\tlet previousEndRowCount = 0;\n\n\tlet len = dataArr.length;\n\n\tfor ( let i = 0; i < len; i += 1 ) {\n\t\tcurrentChar = dataArr[ i ] ? \"o\" : \"b\";\n\n\t\t// For tailing characters at the end of a row:\n\t\t// bb do nothing.\n\t\t// bo write number of repeats, then \"b\", then \"o\".\n\t\t// ob write number of repeats, then \"o\".\n\t\t// oo write number of repeats + 1, then \"o\".\n\n\t\t// If on the last cell of a row.\n\t\tif ( i > 0 && ( i + 1 ) % canvasWidth === 0 ) {\n\t\t\tif ( currentChar === \"o\" ) {\n\n\t\t\t\t// First, if there are any accumulated end-of-lines, print them\n\t\t\t\t// and reset the blank row counter.\n\t\t\t\tif ( previousEndRowCount ) {\n\t\t\t\t\tif ( previousEndRowCount > 1 ) {\n\t\t\t\t\t\tretStr += previousEndRowCount;\n\t\t\t\t\t}\n\t\t\t\t\tretStr += \"$\";\n\t\t\t\t\tpreviousEndRowCount = 0;\n\t\t\t\t}\n\n\t\t\t\tif ( previousChar === \"o\" ) {\n\n\t\t\t\t\t// INCREMENT\n\t\t\t\t\tpreviousCharCount += 1;\n\t\t\t\t\tretStr += previousCharCount;\n\n\t\t\t\t} else if ( previousChar === \"b\" ) {\n\t\t\t\t\tif ( previousCharCount > 1 ) {\n\t\t\t\t\t\tretStr += previousCharCount;\n\t\t\t\t\t}\n\t\t\t\t\tretStr += \"b\";\n\t\t\t\t}\n\t\t\t\tretStr = retStr + \"o\";\n\n\t\t\t} else if ( currentChar === \"b\" ) {\n\t\t\t\tif ( previousChar === \"o\" ) {\n\t\t\t\t\tif ( previousCharCount > 1 ) {\n\t\t\t\t\t\tretStr += previousCharCount;\n\t\t\t\t\t}\n\t\t\t\t\tretStr += previousChar;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increment the row count, unless we're at the very end of the entire array.\n\t\t\t// TO DO: Consider adding the exclamation mark EOF? Possibly unnecessary in JSON.\n\t\t\tif ( i !== len - 1 ) {\n\t\t\t\tpreviousEndRowCount += 1;\n\t\t\t\tpreviousChar = undefined;\n\t\t\t\tpreviousCharCount = 0;\n\t\t\t}\n\n\t\t// INCREMENT, THE GENERAL CASE.\n\t\t} else if ( currentChar === previousChar ) {\n\t\t\tpreviousCharCount += 1;\n\t\t\tcontinue;\n\n\t\t// WRITE\n\t\t} else {\n\n\t\t\t// We're either:\n\t\t\t// \t- at the beginning of a new row with any value.\n\t\t\t//  - in the middle of a row that has live cells on it, and at\n\t\t\t//    a new character or a different character.\n\n\t\t\t// Write to the output string and reset the counter.\n\n\t\t\t// If reached an active cell and there is are any accumulated\n\t\t\t// end-of-lines, print them first and reset the blank row counter.\n\t\t\tif ( currentChar === \"o\" && previousEndRowCount ) {\n\t\t\t\tif ( previousEndRowCount > 1 ) {\n\t\t\t\t\tretStr += previousEndRowCount;\n\t\t\t\t}\n\t\t\t\tretStr += \"$\";\n\t\t\t\tpreviousEndRowCount = 0;\n\t\t\t}\n\n\t\t\tif ( previousCharCount > 1 ) {\n\t\t\t\tretStr += previousCharCount;\n\t\t\t}\n\t\t\tif ( previousChar ) {\n\t\t\t\tretStr += previousChar;\n\t\t\t}\n\n\t\t\t// Reset for next iteration of loop.\n\t\t\tpreviousChar = currentChar;\n\t\t\tpreviousCharCount = 1;\n\t\t}\n\t}\n\n\treturn retStr;\n}\n\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/dataArrayToRLE.js\n **/","// Adapted and improved from\n// http://thiscouldbebetter.neocities.org/texteditor.html\n\n// If this presents problems in the future consider migrating up to:\n// https://github.com/eligrey/FileSaver.js\n\ndefine( [ \"Utility\" ], function( ut ) {\n\tlet objURL;\n\n\tfunction destroyClickedElement( event ) {\n\t\tevent.target.removeEventListener( \"click\", destroyClickedElement );\n\t\tdocument.body.removeChild( event.target );\n\t}\n\n\treturn function( textStr, fileName ) {\n\n\t\t// Any old reference ought to be released.\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL\n\t\tif ( objURL ) {\n\t\t\twindow.URL.revokeObjectURL( objURL );\n\t\t}\n\t\tlet textFileAsBlob = new Blob( [ textStr ], { type: \"text/plain\" } );\n\t\tlet downloadLink = document.createElement( \"a\" );\n\t\tdownloadLink.download = fileName;\n\t\tobjURL = window.URL.createObjectURL( textFileAsBlob );\n\t\tdownloadLink.href = objURL;\n\n\t\t// Chrome allows the link to be clicked without actually adding it to the DOM.\n\t\t// Firefox requires the link to be added to the DOM before it can be clicked.\n\t\tif ( !( navigator && navigator.vendor && navigator.vendor === \"Google Inc.\" ) ) {\n\t\t\tdownloadLink.addEventListener( \"click\", destroyClickedElement );\n\t\t\tdownloadLink.style.display = \"none\";\n\t\t\tdocument.body.appendChild( downloadLink );\n\t\t}\n\n\t\tdownloadLink.click();\n\t};\n} );\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/saveTextAsFile.js\n **/","/*! Hammer.JS - v2.0.7 - 2016-04-22\n * http://hammerjs.github.io/\n *\n * Copyright (c) 2016 Jorik Tangelder;\n * Licensed under the MIT license */\n(function(window, document, exportName, undefined) {\n  'use strict';\n\nvar VENDOR_PREFIXES = ['', 'webkit', 'Moz', 'MS', 'ms', 'o'];\nvar TEST_ELEMENT = document.createElement('div');\n\nvar TYPE_FUNCTION = 'function';\n\nvar round = Math.round;\nvar abs = Math.abs;\nvar now = Date.now;\n\n/**\n * set a timeout with a given scope\n * @param {Function} fn\n * @param {Number} timeout\n * @param {Object} context\n * @returns {number}\n */\nfunction setTimeoutContext(fn, timeout, context) {\n    return setTimeout(bindFn(fn, context), timeout);\n}\n\n/**\n * if the argument is an array, we want to execute the fn on each entry\n * if it aint an array we don't want to do a thing.\n * this is used by all the methods that accept a single and array argument.\n * @param {*|Array} arg\n * @param {String} fn\n * @param {Object} [context]\n * @returns {Boolean}\n */\nfunction invokeArrayArg(arg, fn, context) {\n    if (Array.isArray(arg)) {\n        each(arg, context[fn], context);\n        return true;\n    }\n    return false;\n}\n\n/**\n * walk objects and arrays\n * @param {Object} obj\n * @param {Function} iterator\n * @param {Object} context\n */\nfunction each(obj, iterator, context) {\n    var i;\n\n    if (!obj) {\n        return;\n    }\n\n    if (obj.forEach) {\n        obj.forEach(iterator, context);\n    } else if (obj.length !== undefined) {\n        i = 0;\n        while (i < obj.length) {\n            iterator.call(context, obj[i], i, obj);\n            i++;\n        }\n    } else {\n        for (i in obj) {\n            obj.hasOwnProperty(i) && iterator.call(context, obj[i], i, obj);\n        }\n    }\n}\n\n/**\n * wrap a method with a deprecation warning and stack trace\n * @param {Function} method\n * @param {String} name\n * @param {String} message\n * @returns {Function} A new function wrapping the supplied method.\n */\nfunction deprecate(method, name, message) {\n    var deprecationMessage = 'DEPRECATED METHOD: ' + name + '\\n' + message + ' AT \\n';\n    return function() {\n        var e = new Error('get-stack-trace');\n        var stack = e && e.stack ? e.stack.replace(/^[^\\(]+?[\\n$]/gm, '')\n            .replace(/^\\s+at\\s+/gm, '')\n            .replace(/^Object.<anonymous>\\s*\\(/gm, '{anonymous}()@') : 'Unknown Stack Trace';\n\n        var log = window.console && (window.console.warn || window.console.log);\n        if (log) {\n            log.call(window.console, deprecationMessage, stack);\n        }\n        return method.apply(this, arguments);\n    };\n}\n\n/**\n * extend object.\n * means that properties in dest will be overwritten by the ones in src.\n * @param {Object} target\n * @param {...Object} objects_to_assign\n * @returns {Object} target\n */\nvar assign;\nif (typeof Object.assign !== 'function') {\n    assign = function assign(target) {\n        if (target === undefined || target === null) {\n            throw new TypeError('Cannot convert undefined or null to object');\n        }\n\n        var output = Object(target);\n        for (var index = 1; index < arguments.length; index++) {\n            var source = arguments[index];\n            if (source !== undefined && source !== null) {\n                for (var nextKey in source) {\n                    if (source.hasOwnProperty(nextKey)) {\n                        output[nextKey] = source[nextKey];\n                    }\n                }\n            }\n        }\n        return output;\n    };\n} else {\n    assign = Object.assign;\n}\n\n/**\n * extend object.\n * means that properties in dest will be overwritten by the ones in src.\n * @param {Object} dest\n * @param {Object} src\n * @param {Boolean} [merge=false]\n * @returns {Object} dest\n */\nvar extend = deprecate(function extend(dest, src, merge) {\n    var keys = Object.keys(src);\n    var i = 0;\n    while (i < keys.length) {\n        if (!merge || (merge && dest[keys[i]] === undefined)) {\n            dest[keys[i]] = src[keys[i]];\n        }\n        i++;\n    }\n    return dest;\n}, 'extend', 'Use `assign`.');\n\n/**\n * merge the values from src in the dest.\n * means that properties that exist in dest will not be overwritten by src\n * @param {Object} dest\n * @param {Object} src\n * @returns {Object} dest\n */\nvar merge = deprecate(function merge(dest, src) {\n    return extend(dest, src, true);\n}, 'merge', 'Use `assign`.');\n\n/**\n * simple class inheritance\n * @param {Function} child\n * @param {Function} base\n * @param {Object} [properties]\n */\nfunction inherit(child, base, properties) {\n    var baseP = base.prototype,\n        childP;\n\n    childP = child.prototype = Object.create(baseP);\n    childP.constructor = child;\n    childP._super = baseP;\n\n    if (properties) {\n        assign(childP, properties);\n    }\n}\n\n/**\n * simple function bind\n * @param {Function} fn\n * @param {Object} context\n * @returns {Function}\n */\nfunction bindFn(fn, context) {\n    return function boundFn() {\n        return fn.apply(context, arguments);\n    };\n}\n\n/**\n * let a boolean value also be a function that must return a boolean\n * this first item in args will be used as the context\n * @param {Boolean|Function} val\n * @param {Array} [args]\n * @returns {Boolean}\n */\nfunction boolOrFn(val, args) {\n    if (typeof val == TYPE_FUNCTION) {\n        return val.apply(args ? args[0] || undefined : undefined, args);\n    }\n    return val;\n}\n\n/**\n * use the val2 when val1 is undefined\n * @param {*} val1\n * @param {*} val2\n * @returns {*}\n */\nfunction ifUndefined(val1, val2) {\n    return (val1 === undefined) ? val2 : val1;\n}\n\n/**\n * addEventListener with multiple events at once\n * @param {EventTarget} target\n * @param {String} types\n * @param {Function} handler\n */\nfunction addEventListeners(target, types, handler) {\n    each(splitStr(types), function(type) {\n        target.addEventListener(type, handler, false);\n    });\n}\n\n/**\n * removeEventListener with multiple events at once\n * @param {EventTarget} target\n * @param {String} types\n * @param {Function} handler\n */\nfunction removeEventListeners(target, types, handler) {\n    each(splitStr(types), function(type) {\n        target.removeEventListener(type, handler, false);\n    });\n}\n\n/**\n * find if a node is in the given parent\n * @method hasParent\n * @param {HTMLElement} node\n * @param {HTMLElement} parent\n * @return {Boolean} found\n */\nfunction hasParent(node, parent) {\n    while (node) {\n        if (node == parent) {\n            return true;\n        }\n        node = node.parentNode;\n    }\n    return false;\n}\n\n/**\n * small indexOf wrapper\n * @param {String} str\n * @param {String} find\n * @returns {Boolean} found\n */\nfunction inStr(str, find) {\n    return str.indexOf(find) > -1;\n}\n\n/**\n * split string on whitespace\n * @param {String} str\n * @returns {Array} words\n */\nfunction splitStr(str) {\n    return str.trim().split(/\\s+/g);\n}\n\n/**\n * find if a array contains the object using indexOf or a simple polyFill\n * @param {Array} src\n * @param {String} find\n * @param {String} [findByKey]\n * @return {Boolean|Number} false when not found, or the index\n */\nfunction inArray(src, find, findByKey) {\n    if (src.indexOf && !findByKey) {\n        return src.indexOf(find);\n    } else {\n        var i = 0;\n        while (i < src.length) {\n            if ((findByKey && src[i][findByKey] == find) || (!findByKey && src[i] === find)) {\n                return i;\n            }\n            i++;\n        }\n        return -1;\n    }\n}\n\n/**\n * convert array-like objects to real arrays\n * @param {Object} obj\n * @returns {Array}\n */\nfunction toArray(obj) {\n    return Array.prototype.slice.call(obj, 0);\n}\n\n/**\n * unique array with objects based on a key (like 'id') or just by the array's value\n * @param {Array} src [{id:1},{id:2},{id:1}]\n * @param {String} [key]\n * @param {Boolean} [sort=False]\n * @returns {Array} [{id:1},{id:2}]\n */\nfunction uniqueArray(src, key, sort) {\n    var results = [];\n    var values = [];\n    var i = 0;\n\n    while (i < src.length) {\n        var val = key ? src[i][key] : src[i];\n        if (inArray(values, val) < 0) {\n            results.push(src[i]);\n        }\n        values[i] = val;\n        i++;\n    }\n\n    if (sort) {\n        if (!key) {\n            results = results.sort();\n        } else {\n            results = results.sort(function sortUniqueArray(a, b) {\n                return a[key] > b[key];\n            });\n        }\n    }\n\n    return results;\n}\n\n/**\n * get the prefixed property\n * @param {Object} obj\n * @param {String} property\n * @returns {String|Undefined} prefixed\n */\nfunction prefixed(obj, property) {\n    var prefix, prop;\n    var camelProp = property[0].toUpperCase() + property.slice(1);\n\n    var i = 0;\n    while (i < VENDOR_PREFIXES.length) {\n        prefix = VENDOR_PREFIXES[i];\n        prop = (prefix) ? prefix + camelProp : property;\n\n        if (prop in obj) {\n            return prop;\n        }\n        i++;\n    }\n    return undefined;\n}\n\n/**\n * get a unique id\n * @returns {number} uniqueId\n */\nvar _uniqueId = 1;\nfunction uniqueId() {\n    return _uniqueId++;\n}\n\n/**\n * get the window object of an element\n * @param {HTMLElement} element\n * @returns {DocumentView|Window}\n */\nfunction getWindowForElement(element) {\n    var doc = element.ownerDocument || element;\n    return (doc.defaultView || doc.parentWindow || window);\n}\n\nvar MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;\n\nvar SUPPORT_TOUCH = ('ontouchstart' in window);\nvar SUPPORT_POINTER_EVENTS = prefixed(window, 'PointerEvent') !== undefined;\nvar SUPPORT_ONLY_TOUCH = SUPPORT_TOUCH && MOBILE_REGEX.test(navigator.userAgent);\n\nvar INPUT_TYPE_TOUCH = 'touch';\nvar INPUT_TYPE_PEN = 'pen';\nvar INPUT_TYPE_MOUSE = 'mouse';\nvar INPUT_TYPE_KINECT = 'kinect';\n\nvar COMPUTE_INTERVAL = 25;\n\nvar INPUT_START = 1;\nvar INPUT_MOVE = 2;\nvar INPUT_END = 4;\nvar INPUT_CANCEL = 8;\n\nvar DIRECTION_NONE = 1;\nvar DIRECTION_LEFT = 2;\nvar DIRECTION_RIGHT = 4;\nvar DIRECTION_UP = 8;\nvar DIRECTION_DOWN = 16;\n\nvar DIRECTION_HORIZONTAL = DIRECTION_LEFT | DIRECTION_RIGHT;\nvar DIRECTION_VERTICAL = DIRECTION_UP | DIRECTION_DOWN;\nvar DIRECTION_ALL = DIRECTION_HORIZONTAL | DIRECTION_VERTICAL;\n\nvar PROPS_XY = ['x', 'y'];\nvar PROPS_CLIENT_XY = ['clientX', 'clientY'];\n\n/**\n * create new input type manager\n * @param {Manager} manager\n * @param {Function} callback\n * @returns {Input}\n * @constructor\n */\nfunction Input(manager, callback) {\n    var self = this;\n    this.manager = manager;\n    this.callback = callback;\n    this.element = manager.element;\n    this.target = manager.options.inputTarget;\n\n    // smaller wrapper around the handler, for the scope and the enabled state of the manager,\n    // so when disabled the input events are completely bypassed.\n    this.domHandler = function(ev) {\n        if (boolOrFn(manager.options.enable, [manager])) {\n            self.handler(ev);\n        }\n    };\n\n    this.init();\n\n}\n\nInput.prototype = {\n    /**\n     * should handle the inputEvent data and trigger the callback\n     * @virtual\n     */\n    handler: function() { },\n\n    /**\n     * bind the events\n     */\n    init: function() {\n        this.evEl && addEventListeners(this.element, this.evEl, this.domHandler);\n        this.evTarget && addEventListeners(this.target, this.evTarget, this.domHandler);\n        this.evWin && addEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\n    },\n\n    /**\n     * unbind the events\n     */\n    destroy: function() {\n        this.evEl && removeEventListeners(this.element, this.evEl, this.domHandler);\n        this.evTarget && removeEventListeners(this.target, this.evTarget, this.domHandler);\n        this.evWin && removeEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\n    }\n};\n\n/**\n * create new input type manager\n * called by the Manager constructor\n * @param {Hammer} manager\n * @returns {Input}\n */\nfunction createInputInstance(manager) {\n    var Type;\n    var inputClass = manager.options.inputClass;\n\n    if (inputClass) {\n        Type = inputClass;\n    } else if (SUPPORT_POINTER_EVENTS) {\n        Type = PointerEventInput;\n    } else if (SUPPORT_ONLY_TOUCH) {\n        Type = TouchInput;\n    } else if (!SUPPORT_TOUCH) {\n        Type = MouseInput;\n    } else {\n        Type = TouchMouseInput;\n    }\n    return new (Type)(manager, inputHandler);\n}\n\n/**\n * handle input events\n * @param {Manager} manager\n * @param {String} eventType\n * @param {Object} input\n */\nfunction inputHandler(manager, eventType, input) {\n    var pointersLen = input.pointers.length;\n    var changedPointersLen = input.changedPointers.length;\n    var isFirst = (eventType & INPUT_START && (pointersLen - changedPointersLen === 0));\n    var isFinal = (eventType & (INPUT_END | INPUT_CANCEL) && (pointersLen - changedPointersLen === 0));\n\n    input.isFirst = !!isFirst;\n    input.isFinal = !!isFinal;\n\n    if (isFirst) {\n        manager.session = {};\n    }\n\n    // source event is the normalized value of the domEvents\n    // like 'touchstart, mouseup, pointerdown'\n    input.eventType = eventType;\n\n    // compute scale, rotation etc\n    computeInputData(manager, input);\n\n    // emit secret event\n    manager.emit('hammer.input', input);\n\n    manager.recognize(input);\n    manager.session.prevInput = input;\n}\n\n/**\n * extend the data with some usable properties like scale, rotate, velocity etc\n * @param {Object} manager\n * @param {Object} input\n */\nfunction computeInputData(manager, input) {\n    var session = manager.session;\n    var pointers = input.pointers;\n    var pointersLength = pointers.length;\n\n    // store the first input to calculate the distance and direction\n    if (!session.firstInput) {\n        session.firstInput = simpleCloneInputData(input);\n    }\n\n    // to compute scale and rotation we need to store the multiple touches\n    if (pointersLength > 1 && !session.firstMultiple) {\n        session.firstMultiple = simpleCloneInputData(input);\n    } else if (pointersLength === 1) {\n        session.firstMultiple = false;\n    }\n\n    var firstInput = session.firstInput;\n    var firstMultiple = session.firstMultiple;\n    var offsetCenter = firstMultiple ? firstMultiple.center : firstInput.center;\n\n    var center = input.center = getCenter(pointers);\n    input.timeStamp = now();\n    input.deltaTime = input.timeStamp - firstInput.timeStamp;\n\n    input.angle = getAngle(offsetCenter, center);\n    input.distance = getDistance(offsetCenter, center);\n\n    computeDeltaXY(session, input);\n    input.offsetDirection = getDirection(input.deltaX, input.deltaY);\n\n    var overallVelocity = getVelocity(input.deltaTime, input.deltaX, input.deltaY);\n    input.overallVelocityX = overallVelocity.x;\n    input.overallVelocityY = overallVelocity.y;\n    input.overallVelocity = (abs(overallVelocity.x) > abs(overallVelocity.y)) ? overallVelocity.x : overallVelocity.y;\n\n    input.scale = firstMultiple ? getScale(firstMultiple.pointers, pointers) : 1;\n    input.rotation = firstMultiple ? getRotation(firstMultiple.pointers, pointers) : 0;\n\n    input.maxPointers = !session.prevInput ? input.pointers.length : ((input.pointers.length >\n        session.prevInput.maxPointers) ? input.pointers.length : session.prevInput.maxPointers);\n\n    computeIntervalInputData(session, input);\n\n    // find the correct target\n    var target = manager.element;\n    if (hasParent(input.srcEvent.target, target)) {\n        target = input.srcEvent.target;\n    }\n    input.target = target;\n}\n\nfunction computeDeltaXY(session, input) {\n    var center = input.center;\n    var offset = session.offsetDelta || {};\n    var prevDelta = session.prevDelta || {};\n    var prevInput = session.prevInput || {};\n\n    if (input.eventType === INPUT_START || prevInput.eventType === INPUT_END) {\n        prevDelta = session.prevDelta = {\n            x: prevInput.deltaX || 0,\n            y: prevInput.deltaY || 0\n        };\n\n        offset = session.offsetDelta = {\n            x: center.x,\n            y: center.y\n        };\n    }\n\n    input.deltaX = prevDelta.x + (center.x - offset.x);\n    input.deltaY = prevDelta.y + (center.y - offset.y);\n}\n\n/**\n * velocity is calculated every x ms\n * @param {Object} session\n * @param {Object} input\n */\nfunction computeIntervalInputData(session, input) {\n    var last = session.lastInterval || input,\n        deltaTime = input.timeStamp - last.timeStamp,\n        velocity, velocityX, velocityY, direction;\n\n    if (input.eventType != INPUT_CANCEL && (deltaTime > COMPUTE_INTERVAL || last.velocity === undefined)) {\n        var deltaX = input.deltaX - last.deltaX;\n        var deltaY = input.deltaY - last.deltaY;\n\n        var v = getVelocity(deltaTime, deltaX, deltaY);\n        velocityX = v.x;\n        velocityY = v.y;\n        velocity = (abs(v.x) > abs(v.y)) ? v.x : v.y;\n        direction = getDirection(deltaX, deltaY);\n\n        session.lastInterval = input;\n    } else {\n        // use latest velocity info if it doesn't overtake a minimum period\n        velocity = last.velocity;\n        velocityX = last.velocityX;\n        velocityY = last.velocityY;\n        direction = last.direction;\n    }\n\n    input.velocity = velocity;\n    input.velocityX = velocityX;\n    input.velocityY = velocityY;\n    input.direction = direction;\n}\n\n/**\n * create a simple clone from the input used for storage of firstInput and firstMultiple\n * @param {Object} input\n * @returns {Object} clonedInputData\n */\nfunction simpleCloneInputData(input) {\n    // make a simple copy of the pointers because we will get a reference if we don't\n    // we only need clientXY for the calculations\n    var pointers = [];\n    var i = 0;\n    while (i < input.pointers.length) {\n        pointers[i] = {\n            clientX: round(input.pointers[i].clientX),\n            clientY: round(input.pointers[i].clientY)\n        };\n        i++;\n    }\n\n    return {\n        timeStamp: now(),\n        pointers: pointers,\n        center: getCenter(pointers),\n        deltaX: input.deltaX,\n        deltaY: input.deltaY\n    };\n}\n\n/**\n * get the center of all the pointers\n * @param {Array} pointers\n * @return {Object} center contains `x` and `y` properties\n */\nfunction getCenter(pointers) {\n    var pointersLength = pointers.length;\n\n    // no need to loop when only one touch\n    if (pointersLength === 1) {\n        return {\n            x: round(pointers[0].clientX),\n            y: round(pointers[0].clientY)\n        };\n    }\n\n    var x = 0, y = 0, i = 0;\n    while (i < pointersLength) {\n        x += pointers[i].clientX;\n        y += pointers[i].clientY;\n        i++;\n    }\n\n    return {\n        x: round(x / pointersLength),\n        y: round(y / pointersLength)\n    };\n}\n\n/**\n * calculate the velocity between two points. unit is in px per ms.\n * @param {Number} deltaTime\n * @param {Number} x\n * @param {Number} y\n * @return {Object} velocity `x` and `y`\n */\nfunction getVelocity(deltaTime, x, y) {\n    return {\n        x: x / deltaTime || 0,\n        y: y / deltaTime || 0\n    };\n}\n\n/**\n * get the direction between two points\n * @param {Number} x\n * @param {Number} y\n * @return {Number} direction\n */\nfunction getDirection(x, y) {\n    if (x === y) {\n        return DIRECTION_NONE;\n    }\n\n    if (abs(x) >= abs(y)) {\n        return x < 0 ? DIRECTION_LEFT : DIRECTION_RIGHT;\n    }\n    return y < 0 ? DIRECTION_UP : DIRECTION_DOWN;\n}\n\n/**\n * calculate the absolute distance between two points\n * @param {Object} p1 {x, y}\n * @param {Object} p2 {x, y}\n * @param {Array} [props] containing x and y keys\n * @return {Number} distance\n */\nfunction getDistance(p1, p2, props) {\n    if (!props) {\n        props = PROPS_XY;\n    }\n    var x = p2[props[0]] - p1[props[0]],\n        y = p2[props[1]] - p1[props[1]];\n\n    return Math.sqrt((x * x) + (y * y));\n}\n\n/**\n * calculate the angle between two coordinates\n * @param {Object} p1\n * @param {Object} p2\n * @param {Array} [props] containing x and y keys\n * @return {Number} angle\n */\nfunction getAngle(p1, p2, props) {\n    if (!props) {\n        props = PROPS_XY;\n    }\n    var x = p2[props[0]] - p1[props[0]],\n        y = p2[props[1]] - p1[props[1]];\n    return Math.atan2(y, x) * 180 / Math.PI;\n}\n\n/**\n * calculate the rotation degrees between two pointersets\n * @param {Array} start array of pointers\n * @param {Array} end array of pointers\n * @return {Number} rotation\n */\nfunction getRotation(start, end) {\n    return getAngle(end[1], end[0], PROPS_CLIENT_XY) + getAngle(start[1], start[0], PROPS_CLIENT_XY);\n}\n\n/**\n * calculate the scale factor between two pointersets\n * no scale is 1, and goes down to 0 when pinched together, and bigger when pinched out\n * @param {Array} start array of pointers\n * @param {Array} end array of pointers\n * @return {Number} scale\n */\nfunction getScale(start, end) {\n    return getDistance(end[0], end[1], PROPS_CLIENT_XY) / getDistance(start[0], start[1], PROPS_CLIENT_XY);\n}\n\nvar MOUSE_INPUT_MAP = {\n    mousedown: INPUT_START,\n    mousemove: INPUT_MOVE,\n    mouseup: INPUT_END\n};\n\nvar MOUSE_ELEMENT_EVENTS = 'mousedown';\nvar MOUSE_WINDOW_EVENTS = 'mousemove mouseup';\n\n/**\n * Mouse events input\n * @constructor\n * @extends Input\n */\nfunction MouseInput() {\n    this.evEl = MOUSE_ELEMENT_EVENTS;\n    this.evWin = MOUSE_WINDOW_EVENTS;\n\n    this.pressed = false; // mousedown state\n\n    Input.apply(this, arguments);\n}\n\ninherit(MouseInput, Input, {\n    /**\n     * handle mouse events\n     * @param {Object} ev\n     */\n    handler: function MEhandler(ev) {\n        var eventType = MOUSE_INPUT_MAP[ev.type];\n\n        // on start we want to have the left mouse button down\n        if (eventType & INPUT_START && ev.button === 0) {\n            this.pressed = true;\n        }\n\n        if (eventType & INPUT_MOVE && ev.which !== 1) {\n            eventType = INPUT_END;\n        }\n\n        // mouse must be down\n        if (!this.pressed) {\n            return;\n        }\n\n        if (eventType & INPUT_END) {\n            this.pressed = false;\n        }\n\n        this.callback(this.manager, eventType, {\n            pointers: [ev],\n            changedPointers: [ev],\n            pointerType: INPUT_TYPE_MOUSE,\n            srcEvent: ev\n        });\n    }\n});\n\nvar POINTER_INPUT_MAP = {\n    pointerdown: INPUT_START,\n    pointermove: INPUT_MOVE,\n    pointerup: INPUT_END,\n    pointercancel: INPUT_CANCEL,\n    pointerout: INPUT_CANCEL\n};\n\n// in IE10 the pointer types is defined as an enum\nvar IE10_POINTER_TYPE_ENUM = {\n    2: INPUT_TYPE_TOUCH,\n    3: INPUT_TYPE_PEN,\n    4: INPUT_TYPE_MOUSE,\n    5: INPUT_TYPE_KINECT // see https://twitter.com/jacobrossi/status/480596438489890816\n};\n\nvar POINTER_ELEMENT_EVENTS = 'pointerdown';\nvar POINTER_WINDOW_EVENTS = 'pointermove pointerup pointercancel';\n\n// IE10 has prefixed support, and case-sensitive\nif (window.MSPointerEvent && !window.PointerEvent) {\n    POINTER_ELEMENT_EVENTS = 'MSPointerDown';\n    POINTER_WINDOW_EVENTS = 'MSPointerMove MSPointerUp MSPointerCancel';\n}\n\n/**\n * Pointer events input\n * @constructor\n * @extends Input\n */\nfunction PointerEventInput() {\n    this.evEl = POINTER_ELEMENT_EVENTS;\n    this.evWin = POINTER_WINDOW_EVENTS;\n\n    Input.apply(this, arguments);\n\n    this.store = (this.manager.session.pointerEvents = []);\n}\n\ninherit(PointerEventInput, Input, {\n    /**\n     * handle mouse events\n     * @param {Object} ev\n     */\n    handler: function PEhandler(ev) {\n        var store = this.store;\n        var removePointer = false;\n\n        var eventTypeNormalized = ev.type.toLowerCase().replace('ms', '');\n        var eventType = POINTER_INPUT_MAP[eventTypeNormalized];\n        var pointerType = IE10_POINTER_TYPE_ENUM[ev.pointerType] || ev.pointerType;\n\n        var isTouch = (pointerType == INPUT_TYPE_TOUCH);\n\n        // get index of the event in the store\n        var storeIndex = inArray(store, ev.pointerId, 'pointerId');\n\n        // start and mouse must be down\n        if (eventType & INPUT_START && (ev.button === 0 || isTouch)) {\n            if (storeIndex < 0) {\n                store.push(ev);\n                storeIndex = store.length - 1;\n            }\n        } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\n            removePointer = true;\n        }\n\n        // it not found, so the pointer hasn't been down (so it's probably a hover)\n        if (storeIndex < 0) {\n            return;\n        }\n\n        // update the event in the store\n        store[storeIndex] = ev;\n\n        this.callback(this.manager, eventType, {\n            pointers: store,\n            changedPointers: [ev],\n            pointerType: pointerType,\n            srcEvent: ev\n        });\n\n        if (removePointer) {\n            // remove from the store\n            store.splice(storeIndex, 1);\n        }\n    }\n});\n\nvar SINGLE_TOUCH_INPUT_MAP = {\n    touchstart: INPUT_START,\n    touchmove: INPUT_MOVE,\n    touchend: INPUT_END,\n    touchcancel: INPUT_CANCEL\n};\n\nvar SINGLE_TOUCH_TARGET_EVENTS = 'touchstart';\nvar SINGLE_TOUCH_WINDOW_EVENTS = 'touchstart touchmove touchend touchcancel';\n\n/**\n * Touch events input\n * @constructor\n * @extends Input\n */\nfunction SingleTouchInput() {\n    this.evTarget = SINGLE_TOUCH_TARGET_EVENTS;\n    this.evWin = SINGLE_TOUCH_WINDOW_EVENTS;\n    this.started = false;\n\n    Input.apply(this, arguments);\n}\n\ninherit(SingleTouchInput, Input, {\n    handler: function TEhandler(ev) {\n        var type = SINGLE_TOUCH_INPUT_MAP[ev.type];\n\n        // should we handle the touch events?\n        if (type === INPUT_START) {\n            this.started = true;\n        }\n\n        if (!this.started) {\n            return;\n        }\n\n        var touches = normalizeSingleTouches.call(this, ev, type);\n\n        // when done, reset the started state\n        if (type & (INPUT_END | INPUT_CANCEL) && touches[0].length - touches[1].length === 0) {\n            this.started = false;\n        }\n\n        this.callback(this.manager, type, {\n            pointers: touches[0],\n            changedPointers: touches[1],\n            pointerType: INPUT_TYPE_TOUCH,\n            srcEvent: ev\n        });\n    }\n});\n\n/**\n * @this {TouchInput}\n * @param {Object} ev\n * @param {Number} type flag\n * @returns {undefined|Array} [all, changed]\n */\nfunction normalizeSingleTouches(ev, type) {\n    var all = toArray(ev.touches);\n    var changed = toArray(ev.changedTouches);\n\n    if (type & (INPUT_END | INPUT_CANCEL)) {\n        all = uniqueArray(all.concat(changed), 'identifier', true);\n    }\n\n    return [all, changed];\n}\n\nvar TOUCH_INPUT_MAP = {\n    touchstart: INPUT_START,\n    touchmove: INPUT_MOVE,\n    touchend: INPUT_END,\n    touchcancel: INPUT_CANCEL\n};\n\nvar TOUCH_TARGET_EVENTS = 'touchstart touchmove touchend touchcancel';\n\n/**\n * Multi-user touch events input\n * @constructor\n * @extends Input\n */\nfunction TouchInput() {\n    this.evTarget = TOUCH_TARGET_EVENTS;\n    this.targetIds = {};\n\n    Input.apply(this, arguments);\n}\n\ninherit(TouchInput, Input, {\n    handler: function MTEhandler(ev) {\n        var type = TOUCH_INPUT_MAP[ev.type];\n        var touches = getTouches.call(this, ev, type);\n        if (!touches) {\n            return;\n        }\n\n        this.callback(this.manager, type, {\n            pointers: touches[0],\n            changedPointers: touches[1],\n            pointerType: INPUT_TYPE_TOUCH,\n            srcEvent: ev\n        });\n    }\n});\n\n/**\n * @this {TouchInput}\n * @param {Object} ev\n * @param {Number} type flag\n * @returns {undefined|Array} [all, changed]\n */\nfunction getTouches(ev, type) {\n    var allTouches = toArray(ev.touches);\n    var targetIds = this.targetIds;\n\n    // when there is only one touch, the process can be simplified\n    if (type & (INPUT_START | INPUT_MOVE) && allTouches.length === 1) {\n        targetIds[allTouches[0].identifier] = true;\n        return [allTouches, allTouches];\n    }\n\n    var i,\n        targetTouches,\n        changedTouches = toArray(ev.changedTouches),\n        changedTargetTouches = [],\n        target = this.target;\n\n    // get target touches from touches\n    targetTouches = allTouches.filter(function(touch) {\n        return hasParent(touch.target, target);\n    });\n\n    // collect touches\n    if (type === INPUT_START) {\n        i = 0;\n        while (i < targetTouches.length) {\n            targetIds[targetTouches[i].identifier] = true;\n            i++;\n        }\n    }\n\n    // filter changed touches to only contain touches that exist in the collected target ids\n    i = 0;\n    while (i < changedTouches.length) {\n        if (targetIds[changedTouches[i].identifier]) {\n            changedTargetTouches.push(changedTouches[i]);\n        }\n\n        // cleanup removed touches\n        if (type & (INPUT_END | INPUT_CANCEL)) {\n            delete targetIds[changedTouches[i].identifier];\n        }\n        i++;\n    }\n\n    if (!changedTargetTouches.length) {\n        return;\n    }\n\n    return [\n        // merge targetTouches with changedTargetTouches so it contains ALL touches, including 'end' and 'cancel'\n        uniqueArray(targetTouches.concat(changedTargetTouches), 'identifier', true),\n        changedTargetTouches\n    ];\n}\n\n/**\n * Combined touch and mouse input\n *\n * Touch has a higher priority then mouse, and while touching no mouse events are allowed.\n * This because touch devices also emit mouse events while doing a touch.\n *\n * @constructor\n * @extends Input\n */\n\nvar DEDUP_TIMEOUT = 2500;\nvar DEDUP_DISTANCE = 25;\n\nfunction TouchMouseInput() {\n    Input.apply(this, arguments);\n\n    var handler = bindFn(this.handler, this);\n    this.touch = new TouchInput(this.manager, handler);\n    this.mouse = new MouseInput(this.manager, handler);\n\n    this.primaryTouch = null;\n    this.lastTouches = [];\n}\n\ninherit(TouchMouseInput, Input, {\n    /**\n     * handle mouse and touch events\n     * @param {Hammer} manager\n     * @param {String} inputEvent\n     * @param {Object} inputData\n     */\n    handler: function TMEhandler(manager, inputEvent, inputData) {\n        var isTouch = (inputData.pointerType == INPUT_TYPE_TOUCH),\n            isMouse = (inputData.pointerType == INPUT_TYPE_MOUSE);\n\n        if (isMouse && inputData.sourceCapabilities && inputData.sourceCapabilities.firesTouchEvents) {\n            return;\n        }\n\n        // when we're in a touch event, record touches to  de-dupe synthetic mouse event\n        if (isTouch) {\n            recordTouches.call(this, inputEvent, inputData);\n        } else if (isMouse && isSyntheticEvent.call(this, inputData)) {\n            return;\n        }\n\n        this.callback(manager, inputEvent, inputData);\n    },\n\n    /**\n     * remove the event listeners\n     */\n    destroy: function destroy() {\n        this.touch.destroy();\n        this.mouse.destroy();\n    }\n});\n\nfunction recordTouches(eventType, eventData) {\n    if (eventType & INPUT_START) {\n        this.primaryTouch = eventData.changedPointers[0].identifier;\n        setLastTouch.call(this, eventData);\n    } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\n        setLastTouch.call(this, eventData);\n    }\n}\n\nfunction setLastTouch(eventData) {\n    var touch = eventData.changedPointers[0];\n\n    if (touch.identifier === this.primaryTouch) {\n        var lastTouch = {x: touch.clientX, y: touch.clientY};\n        this.lastTouches.push(lastTouch);\n        var lts = this.lastTouches;\n        var removeLastTouch = function() {\n            var i = lts.indexOf(lastTouch);\n            if (i > -1) {\n                lts.splice(i, 1);\n            }\n        };\n        setTimeout(removeLastTouch, DEDUP_TIMEOUT);\n    }\n}\n\nfunction isSyntheticEvent(eventData) {\n    var x = eventData.srcEvent.clientX, y = eventData.srcEvent.clientY;\n    for (var i = 0; i < this.lastTouches.length; i++) {\n        var t = this.lastTouches[i];\n        var dx = Math.abs(x - t.x), dy = Math.abs(y - t.y);\n        if (dx <= DEDUP_DISTANCE && dy <= DEDUP_DISTANCE) {\n            return true;\n        }\n    }\n    return false;\n}\n\nvar PREFIXED_TOUCH_ACTION = prefixed(TEST_ELEMENT.style, 'touchAction');\nvar NATIVE_TOUCH_ACTION = PREFIXED_TOUCH_ACTION !== undefined;\n\n// magical touchAction value\nvar TOUCH_ACTION_COMPUTE = 'compute';\nvar TOUCH_ACTION_AUTO = 'auto';\nvar TOUCH_ACTION_MANIPULATION = 'manipulation'; // not implemented\nvar TOUCH_ACTION_NONE = 'none';\nvar TOUCH_ACTION_PAN_X = 'pan-x';\nvar TOUCH_ACTION_PAN_Y = 'pan-y';\nvar TOUCH_ACTION_MAP = getTouchActionProps();\n\n/**\n * Touch Action\n * sets the touchAction property or uses the js alternative\n * @param {Manager} manager\n * @param {String} value\n * @constructor\n */\nfunction TouchAction(manager, value) {\n    this.manager = manager;\n    this.set(value);\n}\n\nTouchAction.prototype = {\n    /**\n     * set the touchAction value on the element or enable the polyfill\n     * @param {String} value\n     */\n    set: function(value) {\n        // find out the touch-action by the event handlers\n        if (value == TOUCH_ACTION_COMPUTE) {\n            value = this.compute();\n        }\n\n        if (NATIVE_TOUCH_ACTION && this.manager.element.style && TOUCH_ACTION_MAP[value]) {\n            this.manager.element.style[PREFIXED_TOUCH_ACTION] = value;\n        }\n        this.actions = value.toLowerCase().trim();\n    },\n\n    /**\n     * just re-set the touchAction value\n     */\n    update: function() {\n        this.set(this.manager.options.touchAction);\n    },\n\n    /**\n     * compute the value for the touchAction property based on the recognizer's settings\n     * @returns {String} value\n     */\n    compute: function() {\n        var actions = [];\n        each(this.manager.recognizers, function(recognizer) {\n            if (boolOrFn(recognizer.options.enable, [recognizer])) {\n                actions = actions.concat(recognizer.getTouchAction());\n            }\n        });\n        return cleanTouchActions(actions.join(' '));\n    },\n\n    /**\n     * this method is called on each input cycle and provides the preventing of the browser behavior\n     * @param {Object} input\n     */\n    preventDefaults: function(input) {\n        var srcEvent = input.srcEvent;\n        var direction = input.offsetDirection;\n\n        // if the touch action did prevented once this session\n        if (this.manager.session.prevented) {\n            srcEvent.preventDefault();\n            return;\n        }\n\n        var actions = this.actions;\n        var hasNone = inStr(actions, TOUCH_ACTION_NONE) && !TOUCH_ACTION_MAP[TOUCH_ACTION_NONE];\n        var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y];\n        var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];\n\n        if (hasNone) {\n            //do not prevent defaults if this is a tap gesture\n\n            var isTapPointer = input.pointers.length === 1;\n            var isTapMovement = input.distance < 2;\n            var isTapTouchTime = input.deltaTime < 250;\n\n            if (isTapPointer && isTapMovement && isTapTouchTime) {\n                return;\n            }\n        }\n\n        if (hasPanX && hasPanY) {\n            // `pan-x pan-y` means browser handles all scrolling/panning, do not prevent\n            return;\n        }\n\n        if (hasNone ||\n            (hasPanY && direction & DIRECTION_HORIZONTAL) ||\n            (hasPanX && direction & DIRECTION_VERTICAL)) {\n            return this.preventSrc(srcEvent);\n        }\n    },\n\n    /**\n     * call preventDefault to prevent the browser's default behavior (scrolling in most cases)\n     * @param {Object} srcEvent\n     */\n    preventSrc: function(srcEvent) {\n        this.manager.session.prevented = true;\n        srcEvent.preventDefault();\n    }\n};\n\n/**\n * when the touchActions are collected they are not a valid value, so we need to clean things up. *\n * @param {String} actions\n * @returns {*}\n */\nfunction cleanTouchActions(actions) {\n    // none\n    if (inStr(actions, TOUCH_ACTION_NONE)) {\n        return TOUCH_ACTION_NONE;\n    }\n\n    var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X);\n    var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y);\n\n    // if both pan-x and pan-y are set (different recognizers\n    // for different directions, e.g. horizontal pan but vertical swipe?)\n    // we need none (as otherwise with pan-x pan-y combined none of these\n    // recognizers will work, since the browser would handle all panning\n    if (hasPanX && hasPanY) {\n        return TOUCH_ACTION_NONE;\n    }\n\n    // pan-x OR pan-y\n    if (hasPanX || hasPanY) {\n        return hasPanX ? TOUCH_ACTION_PAN_X : TOUCH_ACTION_PAN_Y;\n    }\n\n    // manipulation\n    if (inStr(actions, TOUCH_ACTION_MANIPULATION)) {\n        return TOUCH_ACTION_MANIPULATION;\n    }\n\n    return TOUCH_ACTION_AUTO;\n}\n\nfunction getTouchActionProps() {\n    if (!NATIVE_TOUCH_ACTION) {\n        return false;\n    }\n    var touchMap = {};\n    var cssSupports = window.CSS && window.CSS.supports;\n    ['auto', 'manipulation', 'pan-y', 'pan-x', 'pan-x pan-y', 'none'].forEach(function(val) {\n\n        // If css.supports is not supported but there is native touch-action assume it supports\n        // all values. This is the case for IE 10 and 11.\n        touchMap[val] = cssSupports ? window.CSS.supports('touch-action', val) : true;\n    });\n    return touchMap;\n}\n\n/**\n * Recognizer flow explained; *\n * All recognizers have the initial state of POSSIBLE when a input session starts.\n * The definition of a input session is from the first input until the last input, with all it's movement in it. *\n * Example session for mouse-input: mousedown -> mousemove -> mouseup\n *\n * On each recognizing cycle (see Manager.recognize) the .recognize() method is executed\n * which determines with state it should be.\n *\n * If the recognizer has the state FAILED, CANCELLED or RECOGNIZED (equals ENDED), it is reset to\n * POSSIBLE to give it another change on the next cycle.\n *\n *               Possible\n *                  |\n *            +-----+---------------+\n *            |                     |\n *      +-----+-----+               |\n *      |           |               |\n *   Failed      Cancelled          |\n *                          +-------+------+\n *                          |              |\n *                      Recognized       Began\n *                                         |\n *                                      Changed\n *                                         |\n *                                  Ended/Recognized\n */\nvar STATE_POSSIBLE = 1;\nvar STATE_BEGAN = 2;\nvar STATE_CHANGED = 4;\nvar STATE_ENDED = 8;\nvar STATE_RECOGNIZED = STATE_ENDED;\nvar STATE_CANCELLED = 16;\nvar STATE_FAILED = 32;\n\n/**\n * Recognizer\n * Every recognizer needs to extend from this class.\n * @constructor\n * @param {Object} options\n */\nfunction Recognizer(options) {\n    this.options = assign({}, this.defaults, options || {});\n\n    this.id = uniqueId();\n\n    this.manager = null;\n\n    // default is enable true\n    this.options.enable = ifUndefined(this.options.enable, true);\n\n    this.state = STATE_POSSIBLE;\n\n    this.simultaneous = {};\n    this.requireFail = [];\n}\n\nRecognizer.prototype = {\n    /**\n     * @virtual\n     * @type {Object}\n     */\n    defaults: {},\n\n    /**\n     * set options\n     * @param {Object} options\n     * @return {Recognizer}\n     */\n    set: function(options) {\n        assign(this.options, options);\n\n        // also update the touchAction, in case something changed about the directions/enabled state\n        this.manager && this.manager.touchAction.update();\n        return this;\n    },\n\n    /**\n     * recognize simultaneous with an other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    recognizeWith: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'recognizeWith', this)) {\n            return this;\n        }\n\n        var simultaneous = this.simultaneous;\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        if (!simultaneous[otherRecognizer.id]) {\n            simultaneous[otherRecognizer.id] = otherRecognizer;\n            otherRecognizer.recognizeWith(this);\n        }\n        return this;\n    },\n\n    /**\n     * drop the simultaneous link. it doesnt remove the link on the other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    dropRecognizeWith: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'dropRecognizeWith', this)) {\n            return this;\n        }\n\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        delete this.simultaneous[otherRecognizer.id];\n        return this;\n    },\n\n    /**\n     * recognizer can only run when an other is failing\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    requireFailure: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'requireFailure', this)) {\n            return this;\n        }\n\n        var requireFail = this.requireFail;\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        if (inArray(requireFail, otherRecognizer) === -1) {\n            requireFail.push(otherRecognizer);\n            otherRecognizer.requireFailure(this);\n        }\n        return this;\n    },\n\n    /**\n     * drop the requireFailure link. it does not remove the link on the other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    dropRequireFailure: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'dropRequireFailure', this)) {\n            return this;\n        }\n\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        var index = inArray(this.requireFail, otherRecognizer);\n        if (index > -1) {\n            this.requireFail.splice(index, 1);\n        }\n        return this;\n    },\n\n    /**\n     * has require failures boolean\n     * @returns {boolean}\n     */\n    hasRequireFailures: function() {\n        return this.requireFail.length > 0;\n    },\n\n    /**\n     * if the recognizer can recognize simultaneous with an other recognizer\n     * @param {Recognizer} otherRecognizer\n     * @returns {Boolean}\n     */\n    canRecognizeWith: function(otherRecognizer) {\n        return !!this.simultaneous[otherRecognizer.id];\n    },\n\n    /**\n     * You should use `tryEmit` instead of `emit` directly to check\n     * that all the needed recognizers has failed before emitting.\n     * @param {Object} input\n     */\n    emit: function(input) {\n        var self = this;\n        var state = this.state;\n\n        function emit(event) {\n            self.manager.emit(event, input);\n        }\n\n        // 'panstart' and 'panmove'\n        if (state < STATE_ENDED) {\n            emit(self.options.event + stateStr(state));\n        }\n\n        emit(self.options.event); // simple 'eventName' events\n\n        if (input.additionalEvent) { // additional event(panleft, panright, pinchin, pinchout...)\n            emit(input.additionalEvent);\n        }\n\n        // panend and pancancel\n        if (state >= STATE_ENDED) {\n            emit(self.options.event + stateStr(state));\n        }\n    },\n\n    /**\n     * Check that all the require failure recognizers has failed,\n     * if true, it emits a gesture event,\n     * otherwise, setup the state to FAILED.\n     * @param {Object} input\n     */\n    tryEmit: function(input) {\n        if (this.canEmit()) {\n            return this.emit(input);\n        }\n        // it's failing anyway\n        this.state = STATE_FAILED;\n    },\n\n    /**\n     * can we emit?\n     * @returns {boolean}\n     */\n    canEmit: function() {\n        var i = 0;\n        while (i < this.requireFail.length) {\n            if (!(this.requireFail[i].state & (STATE_FAILED | STATE_POSSIBLE))) {\n                return false;\n            }\n            i++;\n        }\n        return true;\n    },\n\n    /**\n     * update the recognizer\n     * @param {Object} inputData\n     */\n    recognize: function(inputData) {\n        // make a new copy of the inputData\n        // so we can change the inputData without messing up the other recognizers\n        var inputDataClone = assign({}, inputData);\n\n        // is is enabled and allow recognizing?\n        if (!boolOrFn(this.options.enable, [this, inputDataClone])) {\n            this.reset();\n            this.state = STATE_FAILED;\n            return;\n        }\n\n        // reset when we've reached the end\n        if (this.state & (STATE_RECOGNIZED | STATE_CANCELLED | STATE_FAILED)) {\n            this.state = STATE_POSSIBLE;\n        }\n\n        this.state = this.process(inputDataClone);\n\n        // the recognizer has recognized a gesture\n        // so trigger an event\n        if (this.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED | STATE_CANCELLED)) {\n            this.tryEmit(inputDataClone);\n        }\n    },\n\n    /**\n     * return the state of the recognizer\n     * the actual recognizing happens in this method\n     * @virtual\n     * @param {Object} inputData\n     * @returns {Const} STATE\n     */\n    process: function(inputData) { }, // jshint ignore:line\n\n    /**\n     * return the preferred touch-action\n     * @virtual\n     * @returns {Array}\n     */\n    getTouchAction: function() { },\n\n    /**\n     * called when the gesture isn't allowed to recognize\n     * like when another is being recognized or it is disabled\n     * @virtual\n     */\n    reset: function() { }\n};\n\n/**\n * get a usable string, used as event postfix\n * @param {Const} state\n * @returns {String} state\n */\nfunction stateStr(state) {\n    if (state & STATE_CANCELLED) {\n        return 'cancel';\n    } else if (state & STATE_ENDED) {\n        return 'end';\n    } else if (state & STATE_CHANGED) {\n        return 'move';\n    } else if (state & STATE_BEGAN) {\n        return 'start';\n    }\n    return '';\n}\n\n/**\n * direction cons to string\n * @param {Const} direction\n * @returns {String}\n */\nfunction directionStr(direction) {\n    if (direction == DIRECTION_DOWN) {\n        return 'down';\n    } else if (direction == DIRECTION_UP) {\n        return 'up';\n    } else if (direction == DIRECTION_LEFT) {\n        return 'left';\n    } else if (direction == DIRECTION_RIGHT) {\n        return 'right';\n    }\n    return '';\n}\n\n/**\n * get a recognizer by name if it is bound to a manager\n * @param {Recognizer|String} otherRecognizer\n * @param {Recognizer} recognizer\n * @returns {Recognizer}\n */\nfunction getRecognizerByNameIfManager(otherRecognizer, recognizer) {\n    var manager = recognizer.manager;\n    if (manager) {\n        return manager.get(otherRecognizer);\n    }\n    return otherRecognizer;\n}\n\n/**\n * This recognizer is just used as a base for the simple attribute recognizers.\n * @constructor\n * @extends Recognizer\n */\nfunction AttrRecognizer() {\n    Recognizer.apply(this, arguments);\n}\n\ninherit(AttrRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof AttrRecognizer\n     */\n    defaults: {\n        /**\n         * @type {Number}\n         * @default 1\n         */\n        pointers: 1\n    },\n\n    /**\n     * Used to check if it the recognizer receives valid input, like input.distance > 10.\n     * @memberof AttrRecognizer\n     * @param {Object} input\n     * @returns {Boolean} recognized\n     */\n    attrTest: function(input) {\n        var optionPointers = this.options.pointers;\n        return optionPointers === 0 || input.pointers.length === optionPointers;\n    },\n\n    /**\n     * Process the input and return the state for the recognizer\n     * @memberof AttrRecognizer\n     * @param {Object} input\n     * @returns {*} State\n     */\n    process: function(input) {\n        var state = this.state;\n        var eventType = input.eventType;\n\n        var isRecognized = state & (STATE_BEGAN | STATE_CHANGED);\n        var isValid = this.attrTest(input);\n\n        // on cancel input and we've recognized before, return STATE_CANCELLED\n        if (isRecognized && (eventType & INPUT_CANCEL || !isValid)) {\n            return state | STATE_CANCELLED;\n        } else if (isRecognized || isValid) {\n            if (eventType & INPUT_END) {\n                return state | STATE_ENDED;\n            } else if (!(state & STATE_BEGAN)) {\n                return STATE_BEGAN;\n            }\n            return state | STATE_CHANGED;\n        }\n        return STATE_FAILED;\n    }\n});\n\n/**\n * Pan\n * Recognized when the pointer is down and moved in the allowed direction.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction PanRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n\n    this.pX = null;\n    this.pY = null;\n}\n\ninherit(PanRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof PanRecognizer\n     */\n    defaults: {\n        event: 'pan',\n        threshold: 10,\n        pointers: 1,\n        direction: DIRECTION_ALL\n    },\n\n    getTouchAction: function() {\n        var direction = this.options.direction;\n        var actions = [];\n        if (direction & DIRECTION_HORIZONTAL) {\n            actions.push(TOUCH_ACTION_PAN_Y);\n        }\n        if (direction & DIRECTION_VERTICAL) {\n            actions.push(TOUCH_ACTION_PAN_X);\n        }\n        return actions;\n    },\n\n    directionTest: function(input) {\n        var options = this.options;\n        var hasMoved = true;\n        var distance = input.distance;\n        var direction = input.direction;\n        var x = input.deltaX;\n        var y = input.deltaY;\n\n        // lock to axis?\n        if (!(direction & options.direction)) {\n            if (options.direction & DIRECTION_HORIZONTAL) {\n                direction = (x === 0) ? DIRECTION_NONE : (x < 0) ? DIRECTION_LEFT : DIRECTION_RIGHT;\n                hasMoved = x != this.pX;\n                distance = Math.abs(input.deltaX);\n            } else {\n                direction = (y === 0) ? DIRECTION_NONE : (y < 0) ? DIRECTION_UP : DIRECTION_DOWN;\n                hasMoved = y != this.pY;\n                distance = Math.abs(input.deltaY);\n            }\n        }\n        input.direction = direction;\n        return hasMoved && distance > options.threshold && direction & options.direction;\n    },\n\n    attrTest: function(input) {\n        return AttrRecognizer.prototype.attrTest.call(this, input) &&\n            (this.state & STATE_BEGAN || (!(this.state & STATE_BEGAN) && this.directionTest(input)));\n    },\n\n    emit: function(input) {\n\n        this.pX = input.deltaX;\n        this.pY = input.deltaY;\n\n        var direction = directionStr(input.direction);\n\n        if (direction) {\n            input.additionalEvent = this.options.event + direction;\n        }\n        this._super.emit.call(this, input);\n    }\n});\n\n/**\n * Pinch\n * Recognized when two or more pointers are moving toward (zoom-in) or away from each other (zoom-out).\n * @constructor\n * @extends AttrRecognizer\n */\nfunction PinchRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(PinchRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof PinchRecognizer\n     */\n    defaults: {\n        event: 'pinch',\n        threshold: 0,\n        pointers: 2\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_NONE];\n    },\n\n    attrTest: function(input) {\n        return this._super.attrTest.call(this, input) &&\n            (Math.abs(input.scale - 1) > this.options.threshold || this.state & STATE_BEGAN);\n    },\n\n    emit: function(input) {\n        if (input.scale !== 1) {\n            var inOut = input.scale < 1 ? 'in' : 'out';\n            input.additionalEvent = this.options.event + inOut;\n        }\n        this._super.emit.call(this, input);\n    }\n});\n\n/**\n * Press\n * Recognized when the pointer is down for x ms without any movement.\n * @constructor\n * @extends Recognizer\n */\nfunction PressRecognizer() {\n    Recognizer.apply(this, arguments);\n\n    this._timer = null;\n    this._input = null;\n}\n\ninherit(PressRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof PressRecognizer\n     */\n    defaults: {\n        event: 'press',\n        pointers: 1,\n        time: 251, // minimal time of the pointer to be pressed\n        threshold: 9 // a minimal movement is ok, but keep it low\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_AUTO];\n    },\n\n    process: function(input) {\n        var options = this.options;\n        var validPointers = input.pointers.length === options.pointers;\n        var validMovement = input.distance < options.threshold;\n        var validTime = input.deltaTime > options.time;\n\n        this._input = input;\n\n        // we only allow little movement\n        // and we've reached an end event, so a tap is possible\n        if (!validMovement || !validPointers || (input.eventType & (INPUT_END | INPUT_CANCEL) && !validTime)) {\n            this.reset();\n        } else if (input.eventType & INPUT_START) {\n            this.reset();\n            this._timer = setTimeoutContext(function() {\n                this.state = STATE_RECOGNIZED;\n                this.tryEmit();\n            }, options.time, this);\n        } else if (input.eventType & INPUT_END) {\n            return STATE_RECOGNIZED;\n        }\n        return STATE_FAILED;\n    },\n\n    reset: function() {\n        clearTimeout(this._timer);\n    },\n\n    emit: function(input) {\n        if (this.state !== STATE_RECOGNIZED) {\n            return;\n        }\n\n        if (input && (input.eventType & INPUT_END)) {\n            this.manager.emit(this.options.event + 'up', input);\n        } else {\n            this._input.timeStamp = now();\n            this.manager.emit(this.options.event, this._input);\n        }\n    }\n});\n\n/**\n * Rotate\n * Recognized when two or more pointer are moving in a circular motion.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction RotateRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(RotateRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof RotateRecognizer\n     */\n    defaults: {\n        event: 'rotate',\n        threshold: 0,\n        pointers: 2\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_NONE];\n    },\n\n    attrTest: function(input) {\n        return this._super.attrTest.call(this, input) &&\n            (Math.abs(input.rotation) > this.options.threshold || this.state & STATE_BEGAN);\n    }\n});\n\n/**\n * Swipe\n * Recognized when the pointer is moving fast (velocity), with enough distance in the allowed direction.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction SwipeRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(SwipeRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof SwipeRecognizer\n     */\n    defaults: {\n        event: 'swipe',\n        threshold: 10,\n        velocity: 0.3,\n        direction: DIRECTION_HORIZONTAL | DIRECTION_VERTICAL,\n        pointers: 1\n    },\n\n    getTouchAction: function() {\n        return PanRecognizer.prototype.getTouchAction.call(this);\n    },\n\n    attrTest: function(input) {\n        var direction = this.options.direction;\n        var velocity;\n\n        if (direction & (DIRECTION_HORIZONTAL | DIRECTION_VERTICAL)) {\n            velocity = input.overallVelocity;\n        } else if (direction & DIRECTION_HORIZONTAL) {\n            velocity = input.overallVelocityX;\n        } else if (direction & DIRECTION_VERTICAL) {\n            velocity = input.overallVelocityY;\n        }\n\n        return this._super.attrTest.call(this, input) &&\n            direction & input.offsetDirection &&\n            input.distance > this.options.threshold &&\n            input.maxPointers == this.options.pointers &&\n            abs(velocity) > this.options.velocity && input.eventType & INPUT_END;\n    },\n\n    emit: function(input) {\n        var direction = directionStr(input.offsetDirection);\n        if (direction) {\n            this.manager.emit(this.options.event + direction, input);\n        }\n\n        this.manager.emit(this.options.event, input);\n    }\n});\n\n/**\n * A tap is ecognized when the pointer is doing a small tap/click. Multiple taps are recognized if they occur\n * between the given interval and position. The delay option can be used to recognize multi-taps without firing\n * a single tap.\n *\n * The eventData from the emitted event contains the property `tapCount`, which contains the amount of\n * multi-taps being recognized.\n * @constructor\n * @extends Recognizer\n */\nfunction TapRecognizer() {\n    Recognizer.apply(this, arguments);\n\n    // previous time and center,\n    // used for tap counting\n    this.pTime = false;\n    this.pCenter = false;\n\n    this._timer = null;\n    this._input = null;\n    this.count = 0;\n}\n\ninherit(TapRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof PinchRecognizer\n     */\n    defaults: {\n        event: 'tap',\n        pointers: 1,\n        taps: 1,\n        interval: 300, // max time between the multi-tap taps\n        time: 250, // max time of the pointer to be down (like finger on the screen)\n        threshold: 9, // a minimal movement is ok, but keep it low\n        posThreshold: 10 // a multi-tap can be a bit off the initial position\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_MANIPULATION];\n    },\n\n    process: function(input) {\n        var options = this.options;\n\n        var validPointers = input.pointers.length === options.pointers;\n        var validMovement = input.distance < options.threshold;\n        var validTouchTime = input.deltaTime < options.time;\n\n        this.reset();\n\n        if ((input.eventType & INPUT_START) && (this.count === 0)) {\n            return this.failTimeout();\n        }\n\n        // we only allow little movement\n        // and we've reached an end event, so a tap is possible\n        if (validMovement && validTouchTime && validPointers) {\n            if (input.eventType != INPUT_END) {\n                return this.failTimeout();\n            }\n\n            var validInterval = this.pTime ? (input.timeStamp - this.pTime < options.interval) : true;\n            var validMultiTap = !this.pCenter || getDistance(this.pCenter, input.center) < options.posThreshold;\n\n            this.pTime = input.timeStamp;\n            this.pCenter = input.center;\n\n            if (!validMultiTap || !validInterval) {\n                this.count = 1;\n            } else {\n                this.count += 1;\n            }\n\n            this._input = input;\n\n            // if tap count matches we have recognized it,\n            // else it has began recognizing...\n            var tapCount = this.count % options.taps;\n            if (tapCount === 0) {\n                // no failing requirements, immediately trigger the tap event\n                // or wait as long as the multitap interval to trigger\n                if (!this.hasRequireFailures()) {\n                    return STATE_RECOGNIZED;\n                } else {\n                    this._timer = setTimeoutContext(function() {\n                        this.state = STATE_RECOGNIZED;\n                        this.tryEmit();\n                    }, options.interval, this);\n                    return STATE_BEGAN;\n                }\n            }\n        }\n        return STATE_FAILED;\n    },\n\n    failTimeout: function() {\n        this._timer = setTimeoutContext(function() {\n            this.state = STATE_FAILED;\n        }, this.options.interval, this);\n        return STATE_FAILED;\n    },\n\n    reset: function() {\n        clearTimeout(this._timer);\n    },\n\n    emit: function() {\n        if (this.state == STATE_RECOGNIZED) {\n            this._input.tapCount = this.count;\n            this.manager.emit(this.options.event, this._input);\n        }\n    }\n});\n\n/**\n * Simple way to create a manager with a default set of recognizers.\n * @param {HTMLElement} element\n * @param {Object} [options]\n * @constructor\n */\nfunction Hammer(element, options) {\n    options = options || {};\n    options.recognizers = ifUndefined(options.recognizers, Hammer.defaults.preset);\n    return new Manager(element, options);\n}\n\n/**\n * @const {string}\n */\nHammer.VERSION = '2.0.7';\n\n/**\n * default settings\n * @namespace\n */\nHammer.defaults = {\n    /**\n     * set if DOM events are being triggered.\n     * But this is slower and unused by simple implementations, so disabled by default.\n     * @type {Boolean}\n     * @default false\n     */\n    domEvents: false,\n\n    /**\n     * The value for the touchAction property/fallback.\n     * When set to `compute` it will magically set the correct value based on the added recognizers.\n     * @type {String}\n     * @default compute\n     */\n    touchAction: TOUCH_ACTION_COMPUTE,\n\n    /**\n     * @type {Boolean}\n     * @default true\n     */\n    enable: true,\n\n    /**\n     * EXPERIMENTAL FEATURE -- can be removed/changed\n     * Change the parent input target element.\n     * If Null, then it is being set the to main element.\n     * @type {Null|EventTarget}\n     * @default null\n     */\n    inputTarget: null,\n\n    /**\n     * force an input class\n     * @type {Null|Function}\n     * @default null\n     */\n    inputClass: null,\n\n    /**\n     * Default recognizer setup when calling `Hammer()`\n     * When creating a new Manager these will be skipped.\n     * @type {Array}\n     */\n    preset: [\n        // RecognizerClass, options, [recognizeWith, ...], [requireFailure, ...]\n        [RotateRecognizer, {enable: false}],\n        [PinchRecognizer, {enable: false}, ['rotate']],\n        [SwipeRecognizer, {direction: DIRECTION_HORIZONTAL}],\n        [PanRecognizer, {direction: DIRECTION_HORIZONTAL}, ['swipe']],\n        [TapRecognizer],\n        [TapRecognizer, {event: 'doubletap', taps: 2}, ['tap']],\n        [PressRecognizer]\n    ],\n\n    /**\n     * Some CSS properties can be used to improve the working of Hammer.\n     * Add them to this method and they will be set when creating a new Manager.\n     * @namespace\n     */\n    cssProps: {\n        /**\n         * Disables text selection to improve the dragging gesture. Mainly for desktop browsers.\n         * @type {String}\n         * @default 'none'\n         */\n        userSelect: 'none',\n\n        /**\n         * Disable the Windows Phone grippers when pressing an element.\n         * @type {String}\n         * @default 'none'\n         */\n        touchSelect: 'none',\n\n        /**\n         * Disables the default callout shown when you touch and hold a touch target.\n         * On iOS, when you touch and hold a touch target such as a link, Safari displays\n         * a callout containing information about the link. This property allows you to disable that callout.\n         * @type {String}\n         * @default 'none'\n         */\n        touchCallout: 'none',\n\n        /**\n         * Specifies whether zooming is enabled. Used by IE10>\n         * @type {String}\n         * @default 'none'\n         */\n        contentZooming: 'none',\n\n        /**\n         * Specifies that an entire element should be draggable instead of its contents. Mainly for desktop browsers.\n         * @type {String}\n         * @default 'none'\n         */\n        userDrag: 'none',\n\n        /**\n         * Overrides the highlight color shown when the user taps a link or a JavaScript\n         * clickable element in iOS. This property obeys the alpha value, if specified.\n         * @type {String}\n         * @default 'rgba(0,0,0,0)'\n         */\n        tapHighlightColor: 'rgba(0,0,0,0)'\n    }\n};\n\nvar STOP = 1;\nvar FORCED_STOP = 2;\n\n/**\n * Manager\n * @param {HTMLElement} element\n * @param {Object} [options]\n * @constructor\n */\nfunction Manager(element, options) {\n    this.options = assign({}, Hammer.defaults, options || {});\n\n    this.options.inputTarget = this.options.inputTarget || element;\n\n    this.handlers = {};\n    this.session = {};\n    this.recognizers = [];\n    this.oldCssProps = {};\n\n    this.element = element;\n    this.input = createInputInstance(this);\n    this.touchAction = new TouchAction(this, this.options.touchAction);\n\n    toggleCssProps(this, true);\n\n    each(this.options.recognizers, function(item) {\n        var recognizer = this.add(new (item[0])(item[1]));\n        item[2] && recognizer.recognizeWith(item[2]);\n        item[3] && recognizer.requireFailure(item[3]);\n    }, this);\n}\n\nManager.prototype = {\n    /**\n     * set options\n     * @param {Object} options\n     * @returns {Manager}\n     */\n    set: function(options) {\n        assign(this.options, options);\n\n        // Options that need a little more setup\n        if (options.touchAction) {\n            this.touchAction.update();\n        }\n        if (options.inputTarget) {\n            // Clean up existing event listeners and reinitialize\n            this.input.destroy();\n            this.input.target = options.inputTarget;\n            this.input.init();\n        }\n        return this;\n    },\n\n    /**\n     * stop recognizing for this session.\n     * This session will be discarded, when a new [input]start event is fired.\n     * When forced, the recognizer cycle is stopped immediately.\n     * @param {Boolean} [force]\n     */\n    stop: function(force) {\n        this.session.stopped = force ? FORCED_STOP : STOP;\n    },\n\n    /**\n     * run the recognizers!\n     * called by the inputHandler function on every movement of the pointers (touches)\n     * it walks through all the recognizers and tries to detect the gesture that is being made\n     * @param {Object} inputData\n     */\n    recognize: function(inputData) {\n        var session = this.session;\n        if (session.stopped) {\n            return;\n        }\n\n        // run the touch-action polyfill\n        this.touchAction.preventDefaults(inputData);\n\n        var recognizer;\n        var recognizers = this.recognizers;\n\n        // this holds the recognizer that is being recognized.\n        // so the recognizer's state needs to be BEGAN, CHANGED, ENDED or RECOGNIZED\n        // if no recognizer is detecting a thing, it is set to `null`\n        var curRecognizer = session.curRecognizer;\n\n        // reset when the last recognizer is recognized\n        // or when we're in a new session\n        if (!curRecognizer || (curRecognizer && curRecognizer.state & STATE_RECOGNIZED)) {\n            curRecognizer = session.curRecognizer = null;\n        }\n\n        var i = 0;\n        while (i < recognizers.length) {\n            recognizer = recognizers[i];\n\n            // find out if we are allowed try to recognize the input for this one.\n            // 1.   allow if the session is NOT forced stopped (see the .stop() method)\n            // 2.   allow if we still haven't recognized a gesture in this session, or the this recognizer is the one\n            //      that is being recognized.\n            // 3.   allow if the recognizer is allowed to run simultaneous with the current recognized recognizer.\n            //      this can be setup with the `recognizeWith()` method on the recognizer.\n            if (session.stopped !== FORCED_STOP && ( // 1\n                    !curRecognizer || recognizer == curRecognizer || // 2\n                    recognizer.canRecognizeWith(curRecognizer))) { // 3\n                recognizer.recognize(inputData);\n            } else {\n                recognizer.reset();\n            }\n\n            // if the recognizer has been recognizing the input as a valid gesture, we want to store this one as the\n            // current active recognizer. but only if we don't already have an active recognizer\n            if (!curRecognizer && recognizer.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED)) {\n                curRecognizer = session.curRecognizer = recognizer;\n            }\n            i++;\n        }\n    },\n\n    /**\n     * get a recognizer by its event name.\n     * @param {Recognizer|String} recognizer\n     * @returns {Recognizer|Null}\n     */\n    get: function(recognizer) {\n        if (recognizer instanceof Recognizer) {\n            return recognizer;\n        }\n\n        var recognizers = this.recognizers;\n        for (var i = 0; i < recognizers.length; i++) {\n            if (recognizers[i].options.event == recognizer) {\n                return recognizers[i];\n            }\n        }\n        return null;\n    },\n\n    /**\n     * add a recognizer to the manager\n     * existing recognizers with the same event name will be removed\n     * @param {Recognizer} recognizer\n     * @returns {Recognizer|Manager}\n     */\n    add: function(recognizer) {\n        if (invokeArrayArg(recognizer, 'add', this)) {\n            return this;\n        }\n\n        // remove existing\n        var existing = this.get(recognizer.options.event);\n        if (existing) {\n            this.remove(existing);\n        }\n\n        this.recognizers.push(recognizer);\n        recognizer.manager = this;\n\n        this.touchAction.update();\n        return recognizer;\n    },\n\n    /**\n     * remove a recognizer by name or instance\n     * @param {Recognizer|String} recognizer\n     * @returns {Manager}\n     */\n    remove: function(recognizer) {\n        if (invokeArrayArg(recognizer, 'remove', this)) {\n            return this;\n        }\n\n        recognizer = this.get(recognizer);\n\n        // let's make sure this recognizer exists\n        if (recognizer) {\n            var recognizers = this.recognizers;\n            var index = inArray(recognizers, recognizer);\n\n            if (index !== -1) {\n                recognizers.splice(index, 1);\n                this.touchAction.update();\n            }\n        }\n\n        return this;\n    },\n\n    /**\n     * bind event\n     * @param {String} events\n     * @param {Function} handler\n     * @returns {EventEmitter} this\n     */\n    on: function(events, handler) {\n        if (events === undefined) {\n            return;\n        }\n        if (handler === undefined) {\n            return;\n        }\n\n        var handlers = this.handlers;\n        each(splitStr(events), function(event) {\n            handlers[event] = handlers[event] || [];\n            handlers[event].push(handler);\n        });\n        return this;\n    },\n\n    /**\n     * unbind event, leave emit blank to remove all handlers\n     * @param {String} events\n     * @param {Function} [handler]\n     * @returns {EventEmitter} this\n     */\n    off: function(events, handler) {\n        if (events === undefined) {\n            return;\n        }\n\n        var handlers = this.handlers;\n        each(splitStr(events), function(event) {\n            if (!handler) {\n                delete handlers[event];\n            } else {\n                handlers[event] && handlers[event].splice(inArray(handlers[event], handler), 1);\n            }\n        });\n        return this;\n    },\n\n    /**\n     * emit event to the listeners\n     * @param {String} event\n     * @param {Object} data\n     */\n    emit: function(event, data) {\n        // we also want to trigger dom events\n        if (this.options.domEvents) {\n            triggerDomEvent(event, data);\n        }\n\n        // no handlers, so skip it all\n        var handlers = this.handlers[event] && this.handlers[event].slice();\n        if (!handlers || !handlers.length) {\n            return;\n        }\n\n        data.type = event;\n        data.preventDefault = function() {\n            data.srcEvent.preventDefault();\n        };\n\n        var i = 0;\n        while (i < handlers.length) {\n            handlers[i](data);\n            i++;\n        }\n    },\n\n    /**\n     * destroy the manager and unbinds all events\n     * it doesn't unbind dom events, that is the user own responsibility\n     */\n    destroy: function() {\n        this.element && toggleCssProps(this, false);\n\n        this.handlers = {};\n        this.session = {};\n        this.input.destroy();\n        this.element = null;\n    }\n};\n\n/**\n * add/remove the css properties as defined in manager.options.cssProps\n * @param {Manager} manager\n * @param {Boolean} add\n */\nfunction toggleCssProps(manager, add) {\n    var element = manager.element;\n    if (!element.style) {\n        return;\n    }\n    var prop;\n    each(manager.options.cssProps, function(value, name) {\n        prop = prefixed(element.style, name);\n        if (add) {\n            manager.oldCssProps[prop] = element.style[prop];\n            element.style[prop] = value;\n        } else {\n            element.style[prop] = manager.oldCssProps[prop] || '';\n        }\n    });\n    if (!add) {\n        manager.oldCssProps = {};\n    }\n}\n\n/**\n * trigger dom event\n * @param {String} event\n * @param {Object} data\n */\nfunction triggerDomEvent(event, data) {\n    var gestureEvent = document.createEvent('Event');\n    gestureEvent.initEvent(event, true, true);\n    gestureEvent.gesture = data;\n    data.target.dispatchEvent(gestureEvent);\n}\n\nassign(Hammer, {\n    INPUT_START: INPUT_START,\n    INPUT_MOVE: INPUT_MOVE,\n    INPUT_END: INPUT_END,\n    INPUT_CANCEL: INPUT_CANCEL,\n\n    STATE_POSSIBLE: STATE_POSSIBLE,\n    STATE_BEGAN: STATE_BEGAN,\n    STATE_CHANGED: STATE_CHANGED,\n    STATE_ENDED: STATE_ENDED,\n    STATE_RECOGNIZED: STATE_RECOGNIZED,\n    STATE_CANCELLED: STATE_CANCELLED,\n    STATE_FAILED: STATE_FAILED,\n\n    DIRECTION_NONE: DIRECTION_NONE,\n    DIRECTION_LEFT: DIRECTION_LEFT,\n    DIRECTION_RIGHT: DIRECTION_RIGHT,\n    DIRECTION_UP: DIRECTION_UP,\n    DIRECTION_DOWN: DIRECTION_DOWN,\n    DIRECTION_HORIZONTAL: DIRECTION_HORIZONTAL,\n    DIRECTION_VERTICAL: DIRECTION_VERTICAL,\n    DIRECTION_ALL: DIRECTION_ALL,\n\n    Manager: Manager,\n    Input: Input,\n    TouchAction: TouchAction,\n\n    TouchInput: TouchInput,\n    MouseInput: MouseInput,\n    PointerEventInput: PointerEventInput,\n    TouchMouseInput: TouchMouseInput,\n    SingleTouchInput: SingleTouchInput,\n\n    Recognizer: Recognizer,\n    AttrRecognizer: AttrRecognizer,\n    Tap: TapRecognizer,\n    Pan: PanRecognizer,\n    Swipe: SwipeRecognizer,\n    Pinch: PinchRecognizer,\n    Rotate: RotateRecognizer,\n    Press: PressRecognizer,\n\n    on: addEventListeners,\n    off: removeEventListeners,\n    each: each,\n    merge: merge,\n    extend: extend,\n    assign: assign,\n    inherit: inherit,\n    bindFn: bindFn,\n    prefixed: prefixed\n});\n\n// this prevents errors when Hammer is loaded in the presence of an AMD\n//  style loader but by script tag, not by the loader.\nvar freeGlobal = (typeof window !== 'undefined' ? window : (typeof self !== 'undefined' ? self : {})); // jshint ignore:line\nfreeGlobal.Hammer = Hammer;\n\nif (typeof define === 'function' && define.amd) {\n    define(function() {\n        return Hammer;\n    });\n} else if (typeof module != 'undefined' && module.exports) {\n    module.exports = Hammer;\n} else {\n    window[exportName] = Hammer;\n}\n\n})(window, document, 'Hammer');\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/hammerjs/hammer.js\n **/","define( [ \"Utility\", \"gator\" ], function( ut, Gator ) {\n\n\t// Every button should have an :after pseudo-element tooltip prebuilt in CSS.\n\t( function() {\n\t\tlet inspectingTooltips = false;\n\t\tlet waitingPeriod;\n\t\tlet allowanceInterval;\n\t\tlet elementStack = [];\n\n\t\tGator( document.body ).on( \"mouseover\", \".panel__button\", function( e ) {\n\n\t\t\t// Technically unnecessary but DOM call seems to suppress glitching.\n\t\t\tif ( this.classList.contains( \"panel__button--show-tooltip\" ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet button = this;\n\n\t\t\t// Once tooltips are shown, allow the user to scan quickly between tooltips\n\t\t\t// without delay\n\t\t\tlet delay = 1000;\n\t\t\tif ( inspectingTooltips ) {\n\t\t\t\tdelay = 0;\n\t\t\t}\n\n\t\t\t// Throttle multiple mouseover events.\n\t\t\tclearTimeout( waitingPeriod );\n\n\t\t\t// Still inspecting, don't set false yet\n\t\t\tclearTimeout( allowanceInterval );\n\n\t\t\twaitingPeriod = setTimeout( function() { addTooltip( button ); }, delay );\n\t\t\tbutton.addEventListener( \"mouseleave\", abortTooltip );\n\t\t} );\n\n\t\tlet addTooltip = function( buttonElem ) {\n\t\t\tinspectingTooltips = true;\n\t\t\twaitingPeriod = null;\n\n\t\t\t// Tooltips need to float above any adjacent panels, so\n\t\t\t// move the current panel to the stop of the stack.\n\t\t\tvar parentPanel = ut.getClosest( buttonElem, \".panel\" );\n\t\t\tshufflePanelStack( parentPanel );\n\n\t\t\tbuttonElem.classList.add( \"panel__button--show-tooltip\" );\n\t\t};\n\n\t\tlet abortTooltip = function() {\n\n\t\t\t// In case the mouse darts in and out, before the tooltip is ever shown.\n\t\t\tclearTimeout( waitingPeriod );\n\t\t\tthis.classList.remove( \"panel__button--show-tooltip\" );\n\t\t\tthis.removeEventListener( \"mouseleave\", abortTooltip );\n\t\t\tallowanceInterval =\tsetTimeout( function() { inspectingTooltips = false; }, 200 );\n\t\t};\n\n\t\t//\n\t\t// Panel Stacking on click\n\t\t//\n\t\t// Grouped with Tooltips because tooltip show sometimes needs to lift hovered button's\n\t\t// panel in the stacking order.\n\t\tlet getLayerNumber = function( elem ) {\n\t\t\tfor ( let i = 0; i < elementStack.length; i += 1 ) {\n\t\t\t\tif ( elem === elementStack[ i ] ) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tlet applyZindexClasses = function() {\n\t\t\tlet elem;\n\t\t\tlet len = elementStack.length;\n\t\t\tif ( !len ) { return; }\n\n\t\t\tfor ( var i = 0; i < len; i += 1 ) {\n\t\t\t\telem = elementStack[ i ];\n\n\t\t\t\tif ( elem ) { // Some mobile-only buttons float free & don't live in a panel.\n\n\t\t\t\t\t// Remove all the old class names.\n\t\t\t\t\tfor ( var j = 0; j < len; j += 1 ) {\n\t\t\t\t\t\telem.classList.remove( \"z-index\" + ( j + 1 ) );\n\t\t\t\t\t}\n\n\t\t\t\t\t// And apply the new.\n\t\t\t\t\telem.classList.add( \"z-index\" + ( i + 1 ) );\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tlet shufflePanelStack = function( panelToGoOnTop ) {\n\n\t\t\t// If click is on the topmost layer get out.\n\t\t\tif ( panelToGoOnTop === elementStack[ elementStack.length - 1 ] ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar currentLayerNumber = getLayerNumber( panelToGoOnTop );\n\n\t\t\tif ( typeof currentLayerNumber === \"number\" ) {\n\n\t\t\t\t// Remove from current position.\n\t\t\t\telementStack.splice( currentLayerNumber, 1 );\n\t\t\t}\n\n\t\t\t// Always apply classes to any panel that has been clicked\n\t\t\telementStack.push( panelToGoOnTop );\n\t\t\tapplyZindexClasses();\n\t\t};\n\n\t\tGator( document.body ).on( \"mousedown\", \".panel\", function() {\n\t\t\tshufflePanelStack( this );\n\t\t} );\n\t}() );\n\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/tooltips-and-stacking.js\n **/","/**\n * Copyright 2014 Craig Campbell\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * GATOR.JS\n * Simple Event Delegation\n *\n * @version 1.2.4\n *\n * Compatible with IE 9+, FF 3.6+, Safari 5+, Chrome\n *\n * Include legacy.js for compatibility with older browsers\n *\n *             .-._   _ _ _ _ _ _ _ _\n *  .-''-.__.-'00  '-' ' ' ' ' ' ' ' '-.\n * '.___ '    .   .--_'-' '-' '-' _'-' '._\n *  V: V 'vv-'   '_   '.       .'  _..' '.'.\n *    '=.____.=_.--'   :_.__.__:_   '.   : :\n *            (((____.-'        '-.  /   : :\n *                              (((-'\\ .' /\n *                            _____..'  .'\n *                           '-._____.-'\n */\n(function() {\n    var _matcher,\n        _level = 0,\n        _id = 0,\n        _handlers = {},\n        _gatorInstances = {};\n\n    function _addEvent(gator, type, callback) {\n\n        // blur and focus do not bubble up but if you use event capturing\n        // then you will get them\n        var useCapture = type == 'blur' || type == 'focus';\n        gator.element.addEventListener(type, callback, useCapture);\n    }\n\n    function _cancel(e) {\n        e.preventDefault();\n        e.stopPropagation();\n    }\n\n    /**\n     * returns function to use for determining if an element\n     * matches a query selector\n     *\n     * @returns {Function}\n     */\n    function _getMatcher(element) {\n        if (_matcher) {\n            return _matcher;\n        }\n\n        if (element.matches) {\n            _matcher = element.matches;\n            return _matcher;\n        }\n\n        if (element.webkitMatchesSelector) {\n            _matcher = element.webkitMatchesSelector;\n            return _matcher;\n        }\n\n        if (element.mozMatchesSelector) {\n            _matcher = element.mozMatchesSelector;\n            return _matcher;\n        }\n\n        if (element.msMatchesSelector) {\n            _matcher = element.msMatchesSelector;\n            return _matcher;\n        }\n\n        if (element.oMatchesSelector) {\n            _matcher = element.oMatchesSelector;\n            return _matcher;\n        }\n\n        // if it doesn't match a native browser method\n        // fall back to the gator function\n        _matcher = Gator.matchesSelector;\n        return _matcher;\n    }\n\n    /**\n     * determines if the specified element matches a given selector\n     *\n     * @param {Node} element - the element to compare against the selector\n     * @param {string} selector\n     * @param {Node} boundElement - the element the listener was attached to\n     * @returns {void|Node}\n     */\n    function _matchesSelector(element, selector, boundElement) {\n\n        // no selector means this event was bound directly to this element\n        if (selector == '_root') {\n            return boundElement;\n        }\n\n        // if we have moved up to the element you bound the event to\n        // then we have come too far\n        if (element === boundElement) {\n            return;\n        }\n\n        // if this is a match then we are done!\n        if (_getMatcher(element).call(element, selector)) {\n            return element;\n        }\n\n        // if this element did not match but has a parent we should try\n        // going up the tree to see if any of the parent elements match\n        // for example if you are looking for a click on an <a> tag but there\n        // is a <span> inside of the a tag that it is the target,\n        // it should still work\n        if (element.parentNode) {\n            _level++;\n            return _matchesSelector(element.parentNode, selector, boundElement);\n        }\n    }\n\n    function _addHandler(gator, event, selector, callback) {\n        if (!_handlers[gator.id]) {\n            _handlers[gator.id] = {};\n        }\n\n        if (!_handlers[gator.id][event]) {\n            _handlers[gator.id][event] = {};\n        }\n\n        if (!_handlers[gator.id][event][selector]) {\n            _handlers[gator.id][event][selector] = [];\n        }\n\n        _handlers[gator.id][event][selector].push(callback);\n    }\n\n    function _removeHandler(gator, event, selector, callback) {\n\n        // if there are no events tied to this element at all\n        // then don't do anything\n        if (!_handlers[gator.id]) {\n            return;\n        }\n\n        // if there is no event type specified then remove all events\n        // example: Gator(element).off()\n        if (!event) {\n            for (var type in _handlers[gator.id]) {\n                if (_handlers[gator.id].hasOwnProperty(type)) {\n                    _handlers[gator.id][type] = {};\n                }\n            }\n            return;\n        }\n\n        // if no callback or selector is specified remove all events of this type\n        // example: Gator(element).off('click')\n        if (!callback && !selector) {\n            _handlers[gator.id][event] = {};\n            return;\n        }\n\n        // if a selector is specified but no callback remove all events\n        // for this selector\n        // example: Gator(element).off('click', '.sub-element')\n        if (!callback) {\n            delete _handlers[gator.id][event][selector];\n            return;\n        }\n\n        // if we have specified an event type, selector, and callback then we\n        // need to make sure there are callbacks tied to this selector to\n        // begin with.  if there aren't then we can stop here\n        if (!_handlers[gator.id][event][selector]) {\n            return;\n        }\n\n        // if there are then loop through all the callbacks and if we find\n        // one that matches remove it from the array\n        for (var i = 0; i < _handlers[gator.id][event][selector].length; i++) {\n            if (_handlers[gator.id][event][selector][i] === callback) {\n                _handlers[gator.id][event][selector].splice(i, 1);\n                break;\n            }\n        }\n    }\n\n    function _handleEvent(id, e, type) {\n        if (!_handlers[id][type]) {\n            return;\n        }\n\n        var target = e.target || e.srcElement,\n            selector,\n            match,\n            matches = {},\n            i = 0,\n            j = 0;\n\n        // find all events that match\n        _level = 0;\n        for (selector in _handlers[id][type]) {\n            if (_handlers[id][type].hasOwnProperty(selector)) {\n                match = _matchesSelector(target, selector, _gatorInstances[id].element);\n\n                if (match && Gator.matchesEvent(type, _gatorInstances[id].element, match, selector == '_root', e)) {\n                    _level++;\n                    _handlers[id][type][selector].match = match;\n                    matches[_level] = _handlers[id][type][selector];\n                }\n            }\n        }\n\n        // stopPropagation() fails to set cancelBubble to true in Webkit\n        // @see http://code.google.com/p/chromium/issues/detail?id=162270\n        e.stopPropagation = function() {\n            e.cancelBubble = true;\n        };\n\n        for (i = 0; i <= _level; i++) {\n            if (matches[i]) {\n                for (j = 0; j < matches[i].length; j++) {\n                    if (matches[i][j].call(matches[i].match, e) === false) {\n                        Gator.cancel(e);\n                        return;\n                    }\n\n                    if (e.cancelBubble) {\n                        return;\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * binds the specified events to the element\n     *\n     * @param {string|Array} events\n     * @param {string} selector\n     * @param {Function} callback\n     * @param {boolean=} remove\n     * @returns {Object}\n     */\n    function _bind(events, selector, callback, remove) {\n\n        // fail silently if you pass null or undefined as an alement\n        // in the Gator constructor\n        if (!this.element) {\n            return;\n        }\n\n        if (!(events instanceof Array)) {\n            events = [events];\n        }\n\n        if (!callback && typeof(selector) == 'function') {\n            callback = selector;\n            selector = '_root';\n        }\n\n        var id = this.id,\n            i;\n\n        function _getGlobalCallback(type) {\n            return function(e) {\n                _handleEvent(id, e, type);\n            };\n        }\n\n        for (i = 0; i < events.length; i++) {\n            if (remove) {\n                _removeHandler(this, events[i], selector, callback);\n                continue;\n            }\n\n            if (!_handlers[id] || !_handlers[id][events[i]]) {\n                Gator.addEvent(this, events[i], _getGlobalCallback(events[i]));\n            }\n\n            _addHandler(this, events[i], selector, callback);\n        }\n\n        return this;\n    }\n\n    /**\n     * Gator object constructor\n     *\n     * @param {Node} element\n     */\n    function Gator(element, id) {\n\n        // called as function\n        if (!(this instanceof Gator)) {\n            // only keep one Gator instance per node to make sure that\n            // we don't create a ton of new objects if you want to delegate\n            // multiple events from the same node\n            //\n            // for example: Gator(document).on(...\n            for (var key in _gatorInstances) {\n                if (_gatorInstances[key].element === element) {\n                    return _gatorInstances[key];\n                }\n            }\n\n            _id++;\n            _gatorInstances[_id] = new Gator(element, _id);\n\n            return _gatorInstances[_id];\n        }\n\n        this.element = element;\n        this.id = id;\n    }\n\n    /**\n     * adds an event\n     *\n     * @param {string|Array} events\n     * @param {string} selector\n     * @param {Function} callback\n     * @returns {Object}\n     */\n    Gator.prototype.on = function(events, selector, callback) {\n        return _bind.call(this, events, selector, callback);\n    };\n\n    /**\n     * removes an event\n     *\n     * @param {string|Array} events\n     * @param {string} selector\n     * @param {Function} callback\n     * @returns {Object}\n     */\n    Gator.prototype.off = function(events, selector, callback) {\n        return _bind.call(this, events, selector, callback, true);\n    };\n\n    Gator.matchesSelector = function() {};\n    Gator.cancel = _cancel;\n    Gator.addEvent = _addEvent;\n    Gator.matchesEvent = function() {\n        return true;\n    };\n\n    if (typeof module !== 'undefined' && module.exports) {\n        module.exports = Gator;\n    }\n\n    window.Gator = Gator;\n}) ();\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/gator/gator.js\n **/"],"sourceRoot":""}