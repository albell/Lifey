{"version":3,"sources":["webpack:///webpack/bootstrap 81c17500430c4ebef0e6","webpack:///./src/app/js/es6/app.js","webpack:///./src/app/js/es6/modules/Flingable.js","webpack:///./src/app/js/es6/modules/Resizable.js","webpack:///./src/app/js/es6/modules/Utility.js","webpack:///./src/app/js/es6/modules/Modal.js","webpack:///./src/app/js/es6/modules/keymaster.js","webpack:///./src/app/js/es6/modules/modalCanvasSize.js","webpack:///./src/app/js/es6/modules/modalOpenPattern.js","webpack:///./src/app/js/es6/modules/parseRLEFile.js","webpack:///./src/app/js/es6/modules/parseBMP.js","webpack:///./src/app/js/es6/modules/modalSavePattern.js","webpack:///./src/app/js/es6/modules/modalSharePattern.js","webpack:///./src/app/js/es6/modules/parseRLEPixelString.js","webpack:///./src/app/js/es6/modules/patToRleFileString.js","webpack:///./src/app/js/es6/modules/dataArrayToRLE.js","webpack:///./src/app/js/es6/modules/saveTextAsFile.js","webpack:///./~/hammerjs/hammer.js","webpack:///./src/app/js/es6/modules/tooltips-and-stacking.js","webpack:///./~/gator/gator.js"],"names":[],"mappings":"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","file":"app.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 81c17500430c4ebef0e6\n **/","let Flingable = require( \"Flingable\" );\nlet Resizable = require( \"Resizable\" );\nlet ut = require( \"Utility\" );\nlet Modal = require( \"Modal\" );\nlet modalCanvasSize = require( \"modalCanvasSize\" );\nlet modalOpenPattern = require( \"modalOpenPattern\" );\nlet modalSavePattern = require( \"modalSavePattern\" );\nlet modalSharePattern = require( \"modalSharePattern\" );\nlet parseRLEPixelString = require( \"parseRLEPixelString\" );\nlet parseBMP = require( \"parseBMP\" );\nlet patToRleFileString = require( \"patToRleFileString\" );\nlet dataArrayToRLE = require( \"dataArrayToRLE\" );\nlet saveTextAsFile = require( \"saveTextAsFile\" );\nlet Hammer = require( \"hammerjs\" );\n\n// Tooltips imports Gator for easy event delegation.\nrequire( \"tooltips-and-stacking\" );\n\n// Note: Don't use the broken version of Keymaster on npm.\n// Lifey uses a modified version based on a fork of Keymaster which\n// supports direct binding to single modifier keys e.g. \"shift\":\n// https://github.com/madrobby/keymaster/pull/136\n// (The local version in modules also has other es6-related changes,\n// including not binding to window etc.)\nlet key = require( \"keymaster\" );\n\n//*******************************************\n//*******\n//******* ---- Elements ----\n//*******\n//*******************************************\n\nconst w = window;\nconst doc = document;\n\nconst htmlEl = doc.documentElement;\nconst bodyEl = doc.body;\n\nconst scrollSs = doc.querySelector( \"#scroll-stylesheet\" ).sheet;\n\nconst outerBgEl = doc.querySelector( \".outer-background\" );\nconst innerViewEl = doc.querySelector( \".inner-background\" );\nconst canvasEl = doc.querySelector( \".main-canvas\" );\nconst canvasCtx = canvasEl.getContext( \"2d\" );\n\nconst splashEl = doc.querySelector( \".splash\" );\n\nconst navCanvasEl = doc.querySelector( \".navigator__canvas\" );\nconst navCanvasCtx = navCanvasEl.getContext( \"2d\" );\nconst navOutlineEl = doc.querySelector( \".navigator__canvas-outline\" );\n\nconst toolboxEl = doc.querySelector( \"[data-toolbox]\" );\nconst toolboxButtonEls = doc.querySelectorAll( \".toolbox__button\" );\n\nconst infoCursorXEl = doc.querySelector( \"[data-info-cursor-position-x]\" );\nconst infoCursorYEl = doc.querySelector( \"[data-info-cursor-position-y]\" );\nconst infoDimensionXEl = doc.querySelector( \"[data-info-dimension-x]\" );\nconst infoDimensionYEl = doc.querySelector( \"[data-info-dimension-y]\" );\nconst infoCanvasSizeButtonEl = doc.querySelector( \"[data-info-button='resize']\" );\n\nconst playerPanelEl = doc.querySelector( \".player\" );\nconst playerToroidalWrapperEl = doc.querySelector( \".player__toroidal\" );\nconst playerToroidalInputEl = doc.querySelector( \"[data-player-toroidal]\" );\nconst playerSpeedEl = doc.querySelector( \"[data-player-speed]\" );\nconst playerSpeedInputEl = doc.querySelector( \"[data-player-speed-input]\" );\nconst playerCounterEl = doc.querySelector( \"[data-generations-counter]\" );\nconst playerClearButtonEl = doc.querySelector( \"[data-player-button='clear']\" );\nconst playerResetButtonEl = doc.querySelector( \"[data-player-button='reset']\" );\nconst playerPlayButtonEl = doc.querySelector( \"[data-player-button='play']\" );\nconst playerStepButtonEl = doc.querySelector( \"[data-player-button='step']\" );\n\nconst patternsPanelEl = doc.querySelector( \".patterns\" );\nconst patternsOuterWrapperEl = doc.querySelector( \".patterns__outer-wrapper\" );\nconst patternsOpenButtonEl = doc.querySelector( \"[data-pattern-button=open]\" );\nconst patternsSaveButtonEl = doc.querySelector( \"[data-pattern-button=save]\" );\nconst patternsShareButtonEl = doc.querySelector( \"[data-pattern-button=share]\" );\nconst patternsWrapperEl = doc.querySelector( \".patterns__outer-wrapper\" );\nconst patternsListItemEls = doc.querySelectorAll( \".pat\" );\n\n// Mobile-only UI\nconst meterButtonMobileEl = doc.querySelector( \".meter__mobile-button\" );\nconst menuButtonMobileEl = doc.querySelector( \".menu__mobile-button\" );\nconst patternsButtonMobileEl = doc.querySelector( \".patterns__mobile-button\" );\nconst requestFullscreenButtonEl = doc.querySelector( \".mobile-menu__go-fullscreen\" );\nconst exitFullscreenButtonEl = doc.querySelector( \".mobile-menu__exit-fullscreen\" );\n\n// All panels\nconst panelArray = [\n\tdoc.querySelector( \"[data-toolbox]\" ),\n\tdoc.querySelector( \"[data-navigator]\" ),\n\tdoc.querySelector( \"[data-info]\" ),\n\tdoc.querySelector( \"[data-player]\" ),\n\tdoc.querySelector( \"[data-patterns]\" )\n];\n\n//*******************************************\n//*******\n//******* ---- Browser Specifics/Feature detects ----\n//*******\n//*******************************************\n\n// Note: window.browser is already defined in the <head> for detects and avoiding FOUC.\n\n// Safari currently \"supports\" the 'webkit-crisp-edges' value on CSS\n// image-rendering, but doesn't actually render it for <canvas> elements.\n// Because it's a false positive, it's hard to test for.\n// Use crummy vendor detection for now until Apple fixes it.\nw.browser = w.browser || Object.create( null );\nw.browser.isSafari = navigator.vendor && navigator.vendor.indexOf( \"Apple\" ) > -1;\n\n// Modern Opera also uses this value.\nw.browser.isBlink = navigator.vendor && navigator.vendor === \"Google Inc.\";\n\nw.browser.isMac = navigator.platform &&\n                navigator.platform.toUpperCase().indexOf( \"MAC\" ) >= 0;\n\nw.browser.shortkey = browser.isMac ? \"⌘\" : \"ctrl\";\n\nw.browser.isFirefox = navigator.userAgent.toLowerCase().indexOf( \"firefox\" ) !== -1;\n\n\t// TO DO: INSERT Polyfill for lack of current Firefox support.\n\t// See https://bugzilla.mozilla.org/show_bug.cgi?id=960316\n\t// The document root should never scroll/overscroll.\n\t// (For now FF seems to work without this.)\n\t// if ( !( \"touchAction\" in document.documentElement.style ) ) {\n\t// }\n\n//*******************************************\n//*******\n//******* ---- State ----\n//*******\n//*******************************************\n\nlet state = Object.create( null );\nstate.userIsDrawing = false;\nstate.pointerIsHoveringResizableEdge = false;\n\nstate.innerView = Object.create( null );\nstate.innerView.dragPageStart = Object.create( null );\nstate.innerView.dragScrollStart = Object.create( null );\nstate.innerView.isDragging = false;\nstate.innerView.mouseIsDown = false;\n\n// Scroll values are initially undefined because initial view always fit in window.\nstate.innerView.scroll = Object.create( null );\n\nstate.canvas = Object.create( null );\nstate.canvas.overflowsInnerView = false;\nstate.canvas.domDim = Object.create( null );\nstate.canvas.scale = 6; // Initially match the CSS transform scale() in CSS.\n\nstate.toolbox = Object.create( null );\nstate.toolbox.tool = \"brush\";\nstate.toolbox.selectedButton = doc.querySelector( \".toolbox__button\" ); // Brush is first\n\nstate.nav = Object.create( null );\nstate.nav.canvas = Object.create( null );\nstate.nav.outline = Object.create( null );\nstate.nav.outline.posX = 0;\nstate.nav.outline.posY = 0;\nstate.nav.outline.percentageX = 1; // 100% initial.\nstate.nav.outline.percentageY = 1;\n\nstate.player = Object.create( null );\nstate.player.isPlaying = false;\nstate.player.toroidal = false; // Initially unchecked.\nstate.player.generation = 0;\nstate.player.delay = 500; // Initially the input type=range slider is in the middle.\n\nstate.patterns = Object.create( null );\n\nstate.scrollbarDim = 0; // Assume zero until load.\n\nlet nextFrameID;  // Timeouts set in the player.\n\n//*******************************************\n//*******\n//******* ---- Flingable and Resizable Panels ----\n//*******\n//*******************************************\n\n// Make each panel Flingable except for the last panel (patterns).\nfor ( let i = 0; i < 4; i += 1 ) {\n\tlet panelElement = panelArray[ i ];\n\tObject.create( Flingable )\n\t.initFlingable( panelElement, {\n\t\tflingCoast: false,\n\t\tflingContainer: bodyEl,\n\t\tflingHandleEl: panelElement.querySelector( \"[data-flingable-handle]\" )\n\t} );\n}\n\n// Pattern panel is uniquely both Flingable and Resizable.\nlet patternPanel = Object.create( ut.extend( Object.create( Flingable ), Resizable ) );\n\npatternPanel.rzblAbortResize = function() {\n\treturn state.canvas.isDrawing || state.isModalOpen; // Prevents resize handle behaviors.\n};\n\npatternPanel.reportResizing = function( isResizing ) {\n\tstate.panelIsResizing = isResizing; // Set state when an edge is being resized.\n};\n\npatternPanel.initFlingable( panelArray[ 4 ], {\n\tflingCoast: false,\n\tflingContainer: bodyEl,\n\tflingHandleEl: panelArray[ 4 ].querySelector( \"[data-flingable-handle]\" )\n} )\n.initResizable( panelArray[ 4 ], {\n\trzblTop: false,\n\trzblHorizontalCssProp: \"right\"\n} );\n\n//*******************************************\n//*******\n//******* ---- Prevent Default on Panel drag\n//*******\n//*******************************************\n\n// Suppress the default I-beam cursor when user is mistakenly trying to drag\n// a panel by something other than the \"panel__dragspot\" at the top.\n// The only time we want to allow default native mousedown behavior is when the\n// speed slider is dragged.\nGator( bodyEl ).on( [ \"mousedown\" ], \".panel\", function( e ) {\n\tif ( e.target.className !== \"player__speed-input\" ) {\n\t\te.preventDefault();\n\t}\n} );\n\n//*******************************************\n//*******\n//******* ---- innerView ----\n//*******\n//*******************************************\n\nlet innerView = {\n\tgetVisibleDimensions: function() {\n\n\t\t// The outer background dimensions, minus any scrollbars. offsetDim includes scrollbars.\n\t\t// state.innerView.visibleWidth = outerBgEl.clientWidth - state.scrollbarDim;\n\t\t// state.innerView.visibleHeight = outerBgEl.clientHeight - state.scrollbarDim;\n\t\tstate.innerView.visibleWidth = outerBgEl.clientWidth;\n\t\tstate.innerView.visibleHeight = outerBgEl.clientHeight;\n\n\t},\n\n\tonResize: function() {\n\t\tinnerView.getVisibleDimensions();\n\t\tcanvas.evaluateOverflow(); // Will set dimensions if goes into overflow.\n\t},\n\n\tonScroll: function() {\n\t\tif ( state.innerView.isDragging ) {\n\t\t\treturn; // Bail out, drag memoizes scroll position on its own,\n\t\t\t        // and the debounce breaks it.\n\t\t}\n\n\t\tstate.innerView.scroll.x = state.innerView.dragScrollStart.x = this.scrollLeft;\n\t\tstate.innerView.scroll.y = state.innerView.dragScrollStart.y = this.scrollTop;\n\n\t\tupdateNavOutline( false );\n\t},\n\n\tsetScrollPosition: function( x, y ) {\n\t\tif ( !state.canvas.overflowsInnerView ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// TO-DO: limit the height to max?\n\t\tx = Math.max( 0, x );\n\t\ty = Math.max( 0, y );\n\n\t\touterBgEl.scrollLeft = state.innerView.scroll.x = x;\n\t\touterBgEl.scrollTop = state.innerView.scroll.y = y;\n\t},\n\n\tonPointerDown: function( e ) {\n\n\t\tif ( !state.canvas.overflowsInnerView ||\n\t\t     ( browser.isBig && !key.shift && state.toolbox.tool !== \"hand\" ) ||\n\t\t     ( !browser.isBig && state.toolbox.tool !== \"zoom-in\" ) ) {\n\t\t\treturn; // Get out, don't handle drag by scrolling.\n\t\t}\n\n\t\tstate.innerView.dragPageStart.x = e.pageX;\n\t\tstate.innerView.dragPageStart.y = e.pageY;\n\n\t\t// Record the initial scroll position at the start of the drag.\n\t\t// This is the only place where this property get written.\n\t\tstate.innerView.dragScrollStart.x = state.innerView.scroll.x;\n\t\tstate.innerView.dragScrollStart.y = state.innerView.scroll.y;\n\t\tstate.innerView.isDragging = true;\n\n\t\tbodyEl.addEventListener( \"mousemove\", innerView.onDragMove );\n\t\tbodyEl.addEventListener( \"mouseleave\", innerView.onDragEnd );\n\t\tbodyEl.addEventListener( \"mouseup\", innerView.onDragEnd );\n\n\t},\n\n\tonDragMove: function( e ) {\n\t\tlet pageX = e.pageX;\n\t\tlet pageY = e.pageY;\n\n\t\tlet moveX = pageX - state.innerView.dragPageStart.x;\n\t\tlet moveY = pageY - state.innerView.dragPageStart.y;\n\n\t\t// Set on DOM. These values get clamped by scroll endpoints.\n\t\touterBgEl.scrollLeft = state.innerView.dragScrollStart.x - moveX;\n\t\touterBgEl.scrollTop = state.innerView.dragScrollStart.y - moveY;\n\n\t\t// Read clamped value back into memory for the navigator to use.\n\t\t// Fix this to be cleaner later.\n\t\tstate.innerView.scroll.x = outerBgEl.scrollLeft;\n\t\tstate.innerView.scroll.y = outerBgEl.scrollTop;\n\n\t\tif ( browser.isBig ) {\n\t\t\tw.setTimeout( function() {\n\t\t\t\tupdateNavOutline( false );\n\t\t\t}, 0 );\n\t\t}\n\t},\n\n\tonDragEnd: function( e ) {\n\t\tstate.innerView.isDragging = false;\n\n\t\tbodyEl.removeEventListener( \"mousemove\", innerView.onDragMove );\n\t\tbodyEl.removeEventListener( \"mouseleave\", innerView.onDragEnd );\n\t\tbodyEl.removeEventListener( \"mouseup\", innerView.onDragEnd );\n\n\t\t// Read values back from Dom into memory, to normalize for min/max values\n\t\tstate.innerView.scroll.x = outerBgEl.scrollLeft;\n\t\tstate.innerView.scroll.y = outerBgEl.scrollTop;\n\t}\n};\n\n// ---- innerView Bindings are added on page load, below.\n// Firefox on Android can fire mysterious early resize events which cause trouble.\n\n//*******************************************\n//*******\n//******* ---- Canvas ----\n//*******\n//*******************************************\n\nlet canvas = Object.create( null );\n\ncanvas.setCanvasDim = function( x, y ) {\n\tstate.canvas.domDim.x = canvasEl.width = x;\n\tstate.canvas.domDim.y = canvasEl.height = y;\n\n\t// Turning off canvas image smoothing shouldn't really matter,\n\t// but there may be a very slight performance gain:\n\t// https://jsperf.com/imagesmoothingenabled\n\t// image smoothing must be reset after resize.\n\tcanvasCtx.imageSmoothingEnabled = false;\n\n\t// Whenever a new canvas dimension is specified. Temporarily reset to white\n\t// on eraser mousedown on canvas.\n\tcanvasCtx.fillStyle = \"rgba(0,0,0,1)\";\n\tnavCanvasCtx.fillStyle = \"rgba(0,0,0,1)\";\n\n\tcanvas.clearMainAndNavCanvases();\n\tcanvas.setNavigatorCanvasDimensions();\n\n\t// Set the user-displayed dimensions in the Info panel.\n\tinfoDimensionXEl.textContent = x;\n\tinfoDimensionYEl.textContent = y;\n\n\t// Allows optimized fast 2d drawing in the render loop. See:\n\t// https://hacks.mozilla.org/2011/12/faster-canvas-pixel-manipulation-with-typed-arrays/\n\tstate.canvas.imageData = canvasCtx.getImageData( 0, 0, x, y );\n\tstate.canvas.pixelBuffer = new Int32Array( state.canvas.imageData.data.buffer );\n\n};\n\ncanvas.setNavigatorCanvasDimensions = function() {\n\tconst containerMaxWidth = 158;\n\tconst containerMaxHeight = 164;\n\tlet mainCanvasX = state.canvas.domDim.x;\n\tlet mainCanvasY = state.canvas.domDim.y;\n\tlet navWidth, navHeight;\n\tlet containerAspectRatio = containerMaxWidth / containerMaxWidth;\n\tlet canvasAspectRatio = mainCanvasX / mainCanvasY;\n\n\t// Always maximize nav canvas within the nav container regardless of main canvas dimensions.\n\n\t// The wide case.\n\tif ( canvasAspectRatio >= containerAspectRatio ) {\n\t\tnavWidth = containerMaxWidth;\n\t\tnavHeight = Math.round( containerMaxWidth / canvasAspectRatio );\n\n\t// The tall case.\n\t} else {\n\t\tnavWidth = Math.round( containerMaxHeight * canvasAspectRatio );\n\t\tnavHeight = containerMaxHeight;\n\t}\n\n\t// Inline styles\n\tnavCanvasEl.style.width = navWidth + \"px\";\n\tnavCanvasEl.style.height = navHeight + \"px\";\n\n\t// Stored state.\n\tstate.nav.canvas.width = navWidth;\n\tstate.nav.canvas.height = navHeight;\n\n\t// Navigator Canvas Dom Dimensions match the main canvas.\n\t// This is more efficient for the player loop.\n\tnavCanvasEl.width\t= mainCanvasX;\n\tnavCanvasEl.height = mainCanvasY;\n\n\t// Must be reset after resize.\n\t// Keeps the navigator canvas from being blurry when the main canvas is tiny.\n\t// Otherwise keep smoothing on because it generally looks better.\n\tif ( mainCanvasX <= containerMaxWidth && mainCanvasY <= containerMaxHeight ) {\n\t\tnavCanvasCtx.imageSmoothingEnabled = false;\n\t}\n};\n\ncanvas.clearDataArray = function() {\n\tstate.canvas.dataArray = new Int8Array( state.canvas.domDim.x * state.canvas.domDim.y );\n};\n\ncanvas.clearMainAndNavCanvases = function() {\n\tlet cWidth = state.canvas.domDim.x;\n\tlet cHeight = state.canvas.domDim.y;\n\tcanvasCtx.clearRect( 0, 0, cWidth, cHeight );\n\tnavCanvasCtx.clearRect( 0, 0, cWidth, cHeight );\n};\n\n// Commented out but preserve for performance checking.\nlet paintBothCanvasesPerfCounter = 0;\nlet paintBothCanvasesDuration = 0;\n\ncanvas.paintBothCanvasesBitwise = function() {\n\n\t// Performance checking Main paint start.\n\tlet paintBothCanvasesStart = performance.now();\n\n\tlet dataArr = state.canvas.dataArray;\n\tlet len = dataArr.length;\n\tlet canvasWidth = state.canvas.domDim.x;\n\n\t// Thanks to:\n\t// https://hacks.mozilla.org/2011/12/faster-canvas-pixel-manipulation-with-typed-arrays/\n\t// Note however that 32-bit direct manipulation is actually fastest. See:\n\t// http://jsperf.com/canvas-pixel-manipulation/8\n\n\tlet pixels = state.canvas.pixelBuffer;\n\n\tfor ( let i = 0; i < len; i += 1 ) {\n\n\t\t// Convert 1 (live) to 0. Convert 0 (dead) to 255.\n\t\tlet value = 255 - ( dataArr[ i ] * 255 );\n\n\t\tpixels[ i ] =\n\t\t\t( 255   << 24 ) |    /* alpha always opaque*/\n\t\t\t( value << 16 ) |    /* blue */\n\t\t\t( value <<  8 ) |    /* green */\n\t\t\t  value;             /* red */\n\t}\n\n\tcanvasCtx.putImageData( state.canvas.imageData, 0, 0 );\n\tnavCanvasCtx.putImageData( state.canvas.imageData, 0, 0 );\n\n\t// Performance checking Main paint end.\n\tlet paintBothCanvasesEnd = performance.now();\n\tpaintBothCanvasesDuration += paintBothCanvasesEnd - paintBothCanvasesStart;\n\tif ( paintBothCanvasesPerfCounter  === 59 ) {\n\t\tconsole.log( \"Avg canvas.paintBothCanvasesBitwise: \" +\n\t\t             paintBothCanvasesDuration / 60 + \" ms.\" );\n\t\tpaintBothCanvasesPerfCounter = 0;\n\t\tpaintBothCanvasesDuration = 0;\n\t}\n\tpaintBothCanvasesPerfCounter += 1;\n\n};\n\ncanvas.draw = function( e ) {\n\tlet cWidth = state.canvas.domDim.x;\n\tlet cHeight = state.canvas.domDim.y;\n\tlet sc = state.canvas.scale;\n\tlet scrollX = state.innerView.scroll.x;\n\tlet scrollY = state.innerView.scroll.y;\n\tlet arrayVal = 1; // Assume paint.\n\tlet pageX, pageY, targetOffsetLeft,\ttargetOffsetTop, transOffsetLeft, transOffsetTop, x, y;\n\n\tif ( e.type === \"touchmove\" ) { e.preventDefault(); } // Prevent simulated mouse events.\n\tif ( key.shift ) { return; } // Don't draw anything if shift is held.\n\n\t// Note: clearRect() sometimes leaves ghosting in Blink. Yes, using integers. ARGH!\n\t// Erase on the main canvas by painting with opaque white instead.\n\t// This is super ugly but it's the only way to get clean whites.\n\n\t// Changing the destination mode only works for true 2D erasing. Saving this for\n\t// future reference though:\n\t// canvasCtx.globalCompositeOperation = \"source-over\";\n\t// canvasCtx.globalCompositeOperation = \"destination-out\";\n\n\t// Note that these fill styles will need to be reset to black on mouseup/touchend,\n\t// otherwise the player won't work.\n\tif ( state.toolbox.tool === \"eraser\" ) {\n\t\tarrayVal = 0;\n\t\tcanvasCtx.fillStyle = \"rgba(255,255,255,1)\";\n\t\tnavCanvasCtx.fillStyle = \"rgba(255,255,255,1)\";\n\t}\n\n\t// Handle multitouch drawing/erasing.\n\tlet pointerCount = e.targetTouches && e.targetTouches.length || 1;\n\tlet pointerArray = [];\n\n\t// Synthesize offsetX / Y for all drawing, including mouse.\n\n\t\tfor ( let i = 0; i < pointerCount; i += 1 ) {\n\n\t\t\t// Emulate/synthesize offsetX and offsetY event properties for touch events.\n\t\t\tif ( e.type === \"touchstart\" || e.type === \"touchmove\" ) {\n\t\t\t\tpageX = e.touches[ i ].pageX;\n\t\t\t\tpageY = e.touches[ i ].pageY;\n\t\t\t\ttargetOffsetLeft = e.touches[ i ].target.offsetLeft;\n\t\t\t\ttargetOffsetTop = e.touches[ i ].target.offsetTop;\n\t\t\t} else {\n\t\t\t\tpageX = e.pageX;\n\t\t\t\tpageY = e.pageY;\n\t\t\t\ttargetOffsetLeft = e.target.offsetLeft;\n\t\t\t\ttargetOffsetTop = e.target.offsetTop;\n\t\t\t}\n\n\t\t\ttransOffsetLeft = targetOffsetLeft - ( cWidth * sc - cWidth ) / 2;\n\t\t\ttransOffsetTop = targetOffsetTop - ( cHeight * sc - cHeight ) / 2;\n\n\t\t\tx = ( pageX - transOffsetLeft ) / sc;\n\t\t\ty = ( pageY - transOffsetTop ) / sc;\n\n\t\t\t// Need to check before compensating for scroll.\n\t\t\t// Scroll values are undefined when canvas fits in innerView.\n\t\t\tif ( scrollX ) { x += scrollX / sc; }\n\t\t\tif ( scrollY ) { y += scrollY / sc; }\n\n\t\t\t// Lastly adjust for the \"auto\" left margin value created on\n\t\t\t// tall overflowing canvases.\n\t\t\tpointerArray[ i ] = {\n\t\t\t\tx: Math.floor( x - state.innerView.marginLeft / sc ),\n\t\t\t\ty: Math.floor( y )\n\t\t\t};\n\t\t}\n\n\tfor ( let j = 0; j < pointerCount; j += 1 ) {\n\t\tlet drawX = pointerArray[ j ].x;\n\t\tlet drawY = pointerArray[ j ].y;\n\n\t\t// Note: fillRect() is fastest on modern browsers\n\t\t// http://jsperf.com/setting-canvas-pixel\n\t\tcanvasCtx.fillRect( drawX, drawY, 1, 1 );\n\t\tnavCanvasCtx.fillRect( drawX, drawY, 1, 1 );\n\t\tstate.canvas.dataArray[ drawY * state.canvas.domDim.x + drawX ] = arrayVal;\n\t}\n};\n\ncanvas.onPointerDown = function( e ) {\n\n\t// Early return for non-drawing modes.\n\tif ( state.toolbox.tool !== \"brush\" && state.toolbox.tool !== \"eraser\" || // E.g. hand, zoom\n\t     state.toolbox.override || // Hand keyboard shortcut state.\n\t     state.panelIsResizing || // On canvas but resizing a panel.\n\t     state.isHoveringResizableEdge || // On canvas but near a drag-resizable edge. TO DO?\n\t     state.isModalOpen ||\n\t     e.which === 3  ) { // Right mouse click shouldn't paint.\n\n\t\treturn;\n\t}\n\n\t// Keep below early return.\n\t// Don't prevent default regular native inertial touch-dragging.\n\tif ( e.type === \"touchstart\" ) {\n\t\te.preventDefault();\n\t}\n\n\t// Read and stored for draw positioning when canvas is narrow but overflows vertically,\n\t// and width is less than the inner view width minus all horizontal padding.\n\tstate.innerView.marginLeft = parseInt( w.getComputedStyle( innerViewEl ).marginLeft, 10 );\n\n\t// Drawing on top of a pattern in the library deselects that pattern.\n\tvoidCurrentSelectedPatternLink();\n\tclearAnyHash();\n\n\tcanvas.draw( e );\n\tstate.canvas.isDrawing = true;\n\n\tif ( e.type === \"touchstart\" ) {\n\t\tcanvasEl.addEventListener( \"touchmove\", canvas.draw );\n\t\tw.addEventListener( \"touchend\", canvas.onPointerUp );\n\t} else { // Assume mouse.\n\t\tcanvasEl.addEventListener( \"mousemove\", canvas.draw );\n\t\tw.addEventListener( \"mouseup\", canvas.onPointerUp );\n\t}\n};\n\ncanvas.onPointerUp = function( e ) {\n\tstate.canvas.isDrawing = false;\n\n\t// Canvas fill style must be reset to black on end of eraser (white draw)\n\t// so that player drawing will work.\n\tif ( state.toolbox.tool === \"eraser\" ) {\n\t\tcanvasCtx.fillStyle = \"rgba(0,0,0,1)\";\n\t\tnavCanvasCtx.fillStyle = \"rgba(0,0,0,1)\";\n\t}\n\n\tif ( e.type === \"touchend\" ) {\n\t\te.preventDefault();\n\t\tcanvasEl.removeEventListener( \"touchmove\", canvas.draw );\n\t\tw.removeEventListener( \"touchend\", canvas.onPointerUp );\n\t} else { // Assume mouse.\n\t\tcanvasEl.removeEventListener( \"mousemove\", canvas.draw );\n\t\tw.removeEventListener( \"mouseup\", canvas.onPointerUp );\n\t}\n};\n\ncanvas.handleResize = function( newWidth, newHeight, anchorX, anchorY ) {\n\tlet oldWidth = state.canvas.domDim.x;\n\tlet oldHeight = state.canvas.domDim.y;\n\n\tlet oldDataArray = state.canvas.dataArray;\n\tlet newDataArray = new Int8Array( newWidth * newHeight );\n\n\t// The amount to crop out from the origin (left, top) sides of the original.\n\t// If the new dims are bigger, there will be no crop, and offset will be 0.\n\t// If the new dims are smaller, offset will be a positive integer.\n\t// These are only used to determine where the loop starts.\n\tlet oldCenterMap = Object.create( null, {\n\t\tleft:   { value: 0 },\n\t\tcenter: { value: Math.round( Math.max( oldWidth - newWidth, 0 ) / 2 ) },\n\t\tright:  { value: Math.max( oldWidth - newWidth, 0 ) },\n\t\ttop:    { value: 0 },\n\t\tmiddle: { value: Math.round( Math.max( oldHeight - newHeight, 0 ) / 2 ) },\n\t\tbottom: { value: Math.max( oldHeight - newHeight, 0 ) }\n\t} );\n\n\tlet oldXOffset = oldCenterMap[ anchorX ];\n\tlet oldYOffset = oldCenterMap[ anchorY ];\n\n\t// The endpoint of the loop will be the smaller of the current and new dims.\n\tlet xLen = oldXOffset + Math.min( oldWidth, newWidth );\n\tlet yLen = oldYOffset + Math.min( oldHeight, newHeight );\n\n\t// These offsets handle the cases when the new canvas is bigger.\n\t// Handling these separately keeps the loop clean.\n\tlet newCenterMap = Object.create( null, {\n\t\tleft:   { value: 0 },\n\t\tcenter: { value: Math.round( Math.max( newWidth - oldWidth, 0 ) / 2 ) },\n\t\tright:  { value: Math.max( newWidth - oldWidth, 0 ) },\n\t\ttop:    { value: 0 },\n\t\tmiddle: { value: Math.round( Math.max( newHeight - oldHeight, 0 ) / 2 ) },\n\t\tbottom: { value: Math.max( newHeight - oldHeight, 0 ) }\n\t} );\n\n\tlet newXOffset = newCenterMap[ anchorX ];\n\tlet newYOffset = newCenterMap[ anchorY ];\n\n\t// Loop through all (or part) of the old dataArray,\n\t// applying it with an offset to the newDataArray.\n\tfor ( let i = oldYOffset; i < yLen; i += 1 ) {\n\t\tfor ( let j = oldXOffset; j < xLen; j += 1 ) {\n\t\t\tnewDataArray[ ( i - oldYOffset + newYOffset ) * newWidth +\n\t\t\t              ( j - oldXOffset + newXOffset ) ] =\n\t\t\t              oldDataArray[ i * oldWidth + j ];\n\t\t}\n\t}\n\n\tstate.canvas.dataArray = newDataArray;\n\n\t// Don't reset generations counter on canvas resize.\n\tredrawCanvasFromDataArray( newDataArray, newWidth, newHeight );\n};\n\n//\n// ---- Canvas Drawing Binding ----\n//\n\ncanvasEl.addEventListener( \"touchstart\", canvas.onPointerDown );\ncanvasEl.addEventListener( \"mousedown\", canvas.onPointerDown );\n\n//\n// ---- Zoom Stuff ----\n//\n\ncanvas.repaintBoxShadow = function() {\n\n\t// Blink misrenders the canvas edge as blurry after any zoom.\n\t// Blink also sometimes mistakenly shows scroll bars on the outer bg.\n\t// This is a Blink bug, the internal dim is less than the outer bg.\n\t// Removing the box-shadow class, forcing render, then\n\t// adding it back again fixes it. Yuck!\n\tcanvasEl.classList.remove( \"main-canvas--box-shadow\" );\n\tw.getComputedStyle( canvasEl ); // Force render. Yuck.\n\tw.setTimeout( function() {\n\t\tcanvasEl.classList.add( \"main-canvas--box-shadow\" );\n\t}, 90 ); // Waiting less than 90ms doesn't seem to work. WTF.\n};\n\ncanvas.handleIncrementalZoom = function( e, keybindingZoomDirection ) {\n\n\t// Zoom on touch is handled via pinch. We want to duck synthetic click events.\n\t// For mobile/touch, get out, and don't prevent default.\n\tif ( state.toolbox.tool !== \"zoom-in\" && state.toolbox.tool !== \"zoom-out\" &&\n\t    !keybindingZoomDirection || state.toolbox.override || !browser.isBig ) {\n\t\treturn;\n\t}\n\n\tlet currentScale = state.canvas.scale;\n\tlet newScale = currentScale;\t// Default to same. In case of some mistake below.\n\n\t// Snapshot of previous pre-zoom state for passing to scroll calculator.\n\tlet prevScroll = {\n\t\toverflowed: state.canvas.overflowsInnerView,\n\t\tx: state.innerView.scroll.x,\n\t\ty: state.innerView.scroll.y,\n\t\tscale: currentScale\n\t};\n\n\tlet zoomArray = [\n\t\t0.333, // 0 (index number)\n\t\t0.5,   // 1\n\t\t0.667, // 2\n\t\t1,     // 3 (= 100% scale)\n\t\t2,     // 4\n\t\t3,     // 5\n\t\t4,     // 6\n\t\t5,     // 7\n\t\t6,     // 8\n\t\t7,     // 9\n\t\t8,     // 10\n\t\t12,    // 11\n\t\t16,    // 12\n\t\t32,    // 13\n\t\t64     // 14\n\t];\n\n\tlet direction = state.toolbox.tool; // E.g. \"zoom-in\" or \"zoom-out\"\n\n\t// Keyboard shortcut overrides toolbox\n\tif ( keybindingZoomDirection ) {\n\t\tdirection = keybindingZoomDirection;\t// Again, \"zoom-in\" or \"zoom-out\"\n\t}\n\n\tif ( direction === \"zoom-in\" ) {\n\t\tfor ( let i = 0; i < 15; i += 1 ) {\n\t\t\tif ( zoomArray[ i ] > currentScale ) {\n\t\t\t\tnewScale = zoomArray[ i ];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor ( let i = 14; i > -1; i -= 1 ) {\n\t\t\tif ( zoomArray[ i ] < currentScale ) {\n\t\t\t\tnewScale = zoomArray[ i ];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t// If no change, perhaps we're at one of the ends of the zoom scale, get out.\n\tif ( newScale === currentScale ) { return; }\n\n\t// Set scale since it has changed.\n\tcanvasEl.setAttribute( \"style\", \"transform: scale(\" + newScale + \")\" );\n\tstate.canvas.scale = newScale;\n\tif ( browser.isBlink ) {\n\t\tcanvas.repaintBoxShadow();\n\t}\n\n\t// Toggles classes and styles on innerView, and will remove scroll if canvas is contained.\n\tcanvas.evaluateOverflow( newScale );\n\n\tif ( state.canvas.overflowsInnerView ) {\n\t\tcanvas.setScrollPositionBasedOnZoomEvent( e, prevScroll,\n\t\t                                          keybindingZoomDirection );\n\t}\n};\n\ncanvas.evaluateOverflow = function( newScale ) {\n\tlet canvasWidth = state.canvas.domDim.x;\n\tlet canvasHeight = state.canvas.domDim.y;\n\tlet theScale = state.canvas.scale;\n\tlet newOverflow = false;\n\tlet newInnerViewWidth, newInnerViewHeight;\n\tlet removeNavOutlineDimensions = false;\n\n\t// For example, newScale is undefined when called on resize.\n\t// Also note newScale equals 0 when zoomed all the way out.\n\tif ( newScale !== undefined ) {\n\t\ttheScale = newScale;\n\t}\n\n\t// No overflow on update.\n\tif ( canvasWidth * theScale < state.innerView.visibleWidth &&\n\t     canvasHeight * theScale < state.innerView.visibleHeight ) {\n\n\t\tif ( state.canvas.overflowsInnerView ) {\n\n\t\t\t// Unsure on this. TO DO: review state etc.\n\t\t\tstate.innerView.width = innerView.visibleWidth;\n\t\t\tstate.innerView.height = innerView.visibleHeight;\n\t\t\tstate.innerView.scroll.x = undefined;\n\t\t\tstate.innerView.scroll.y = undefined;\n\n\t\t\tinnerViewEl.classList.remove( \"inner-background--canvas-overflows\" );\n\n\t\t\t// Effectively reverts height and width back to 100% values in stylesheet.\n\t\t\tinnerViewEl.style.width = \"\";\n\t\t\tinnerViewEl.style.height = \"\";\n\t\t\tremoveNavOutlineDimensions = true;\n\t\t}\n\n\t// Else one or more of the dims overflows the innerView,\n\t// so switch into overflow state if we aren't already,\n\t// and set dims using explicit numeric CSS values.\n\t} else {\n\t\tnewOverflow = true;\n\n\t\t// Base innerView dims on canvas.\n\t\t// Note however that height is constrained to min-height: 100% in stylesheet,\n\t\t// in the stylesheet, otherwise vertical centering would break.\n\t\tnewInnerViewWidth = canvasWidth * theScale + state.canvas.zoomPadding * 2;\n\t\tnewInnerViewHeight = canvasHeight * theScale + state.canvas.zoomPadding * 2;\n\n\t\t// But don't let them ever be less than 100% or it breaks centering\n\t\tstate.innerView.width = newInnerViewWidth;\n\t\tstate.innerView.height = newInnerViewHeight;\n\t\tinnerViewEl.style.width = newInnerViewWidth + \"px\";\n\t\tinnerViewEl.style.height = newInnerViewHeight + \"px\";\n\n\t\t// Note that in this case scroll positions will still need to be set.\n\n\t\tif ( !state.canvas.overflowsInnerView ) {\n\t\t\tinnerViewEl.classList.add( \"inner-background--canvas-overflows\" );\n\t\t}\n\t}\n\n\tstate.canvas.overflowsInnerView = newOverflow;\n\tupdateNavOutline( removeNavOutlineDimensions );\n};\n\n// Set scroll position on any overflow.\n// Always called within a conditional. Assume state.canvas.overflowsInnerView true.\ncanvas.setScrollPositionBasedOnZoomEvent = function( e, prevScroll,\n                                                     keybindingZoomDirection,\n                                                     pinchCenterX, pinchCenterY,\n                                                     pinchPanX, pinchPanY ) {\n\tlet cWidth = state.canvas.domDim.x;\n\tlet cHeight = state.canvas.domDim.y;\n\tlet zoomPadding = state.canvas.zoomPadding;\n\tlet prevScale = prevScroll.scale;\n\tlet newScale = state.canvas.scale;\n\tpinchPanX = pinchPanX || 0;\n\tpinchPanY = pinchPanY || 0;\n\n\t// Event pageX/Y will exist for for mouse clicks.\n\t// (Keyboard-shortcut-initiated zooms have a synthetic pageX/Y.)\n\t// e will be null for pinch zooms.\n\tlet zoomCenterX = e && e.pageX || pinchCenterX;\n\tlet zoomCenterY = e && e.pageY || pinchCenterY;\n\n\tlet canvasTransX, canvasTransY,\n\t    curCenteredFromLeft, curCenteredFromTop,\n\t    canvasRawX, canvasRawY,\n\t    newScrollX, newScrollY;\n\n\tif ( prevScroll.overflowed ) {\n\t\tcanvasTransX = zoomCenterX + prevScroll.x - zoomPadding;\n\t\tcanvasTransY = zoomCenterY + prevScroll.y - zoomPadding;\n\n\t// Previously no scroll bars\n\t} else {\n\t\tcurCenteredFromLeft = ( state.innerView.visibleWidth - cWidth * prevScale ) / 2;\n\t\tcurCenteredFromTop = ( state.innerView.visibleHeight - cHeight * prevScale ) / 2;\n\n\t\tcanvasTransX = zoomCenterX - curCenteredFromLeft;\n\t\tcanvasTransY = zoomCenterY - curCenteredFromTop;\n\t}\n\n\tcanvasRawX = canvasTransX / prevScale;\n\tcanvasRawY = canvasTransY / prevScale;\n\n\t// If the user is scroll centered, and zoom-clicks in the center of the canvas,\n\t// the new scroll should scale up in proportion to the\n\t// (new innerView / old Inner view)\n\n\tnewScrollX = zoomPadding + canvasRawX * newScale - zoomCenterX;\n\tnewScrollY = zoomPadding + canvasRawY * newScale - zoomCenterY;\n\n\t// Adjust for possible pinch panning. (Moving the pinch center during the pinch.)\n\tnewScrollX -= pinchPanX;\n\tnewScrollY -= pinchPanY;\n\n\tinnerView.setScrollPosition( newScrollX, newScrollY );\n};\n\ncanvas.handleFitZoom = function() {\n\tlet canvasWidth = state.canvas.domDim.x;\n\tlet canvasHeight = state.canvas.domDim.y;\n\tlet innerViewVisWidth = state.innerView.visibleWidth;\n\tlet innerViewVisHeight = state.innerView.visibleHeight;\n\tlet newScale;\n\tlet innerViewVisibleProportion = innerViewVisWidth / innerViewVisHeight;\n\tlet canvasProportion = canvasWidth / canvasHeight;\n\n\tif ( innerViewVisibleProportion >= canvasProportion ) {\n\n\t\t// The wide Inner View case, fit height\n\t\tnewScale = innerViewVisHeight / canvasHeight;\n\t} else {\n\t\tnewScale = innerViewVisWidth / canvasWidth;\n\t}\n\n\t// Remove any overflow styles\n\tif ( state.canvas.overflowsInnerView ) {\n\t\tinnerViewEl.classList.remove( \"inner-background--canvas-overflows\" );\n\n\t\t// Remove explicit width and height\n\t\tinnerViewEl.removeAttribute( \"style\" );\n\t}\n\n\t// Fit should always center the canvas, removing any CSS translate()\n\tcanvasEl.setAttribute( \"style\", \"transform: scale(\" + newScale + \")\" );\n\n\tstate.canvas.overflowsInnerView = false;\n\n\t// Remove scroll\n\tstate.innerView.scroll.x = undefined;\n\tstate.innerView.scroll.y = undefined;\n\n\t// Reset navigation outline\n\tnavOutlineEl.removeAttribute( \"style\" );\n\tstate.nav.outline.posX = 0;\n\tstate.nav.outline.posY = 0;\n\tstate.nav.outline.percentageX = 1;\n\tstate.nav.outline.percentageY = 1;\n\n\tstate.canvas.scale = newScale;\n\tif ( browser.isBlink ) {\n\t\tcanvas.repaintBoxShadow();\n\t}\n};\n\n// Don't bother binding a listener for touchstart because pinch handles\n// all zoom in the mobile/tablet interface.\ninnerViewEl.addEventListener( \"click\", canvas.handleIncrementalZoom );\n\n//*******************************************\n//*******\n//******* ---- Pinch/Zoom on Touch ----\n//*******\n//*******************************************\n\n// Create a manager for the inner view.\nvar hammerInnerV = new Hammer.Manager( innerViewEl, {\n\ttouchAction: \"pan-x pan-y\" // Allow default native panning behaviors for single touches.\n} );\n\n// Create a recognizer, and add that recognizer to the manager.\nhammerInnerV.add( new Hammer.Pinch() );\n\n// Holds snapshot of pre-pinch state.\nlet initPinch = Object.create( null );\n\nhammerInnerV.on( \"pinchstart\", function( e ) {\n\te.preventDefault(); // Always on pinchstart.\n\tif ( state.toolbox.tool !== \"zoom-in\" ) { return; }\n\n\tinitPinch.overflowed = state.canvas.overflowsInnerView;\n\tinitPinch.x = state.innerView.scroll.x;\n\tinitPinch.y = state.innerView.scroll.y;\n\tinitPinch.scale = state.canvas.scale;\n\tinitPinch.center = e.center;\n\n\t// No CSS scale transition timing.\n\tcanvasEl.classList.remove( \"main-canvas--transition-scale\" );\n} );\n\nhammerInnerV.on( \"pinch\", function( e ) {\n\te.preventDefault(); // Always on pinch.\n\n\tif ( state.toolbox.tool !== \"zoom-in\" ) { return; }\n\n\tlet newScale = initPinch.scale * e.scale;\n\tcanvasEl.style.transform = \"scale(\" +  newScale + \")\";\n\tstate.canvas.scale = newScale;\n\n\tlet initPinchCenter = initPinch.center;\n\tlet newPinchCenter = e.center;\n\n\t// Reevaluate overflow continuously during the pinch.\n\tcanvas.evaluateOverflow( newScale );\n\n\t// When in overflow mode, scroll should adjust so that the center of the pinch on the canvas\n\t// tracks to the same screen position. Also pinch centers can \"pan\" during pinch.\n\tlet pinchPanX = newPinchCenter.x - initPinchCenter.x;\n\tlet pinchPanY = newPinchCenter.y - initPinchCenter.y;\n\n\tcanvas.setScrollPositionBasedOnZoomEvent( null, initPinch, null,\n                                            initPinchCenter.x,\n                                            initPinchCenter.y,\n                                            pinchPanX,\n                                            pinchPanY );\n} );\n\nhammerInnerV.on( \"pinchend\", function( e ) {\n\te.preventDefault(); // Always on pinchend.\n\n\tif ( state.toolbox.tool !== \"zoom-in\" ) { return; }\n\n\tif ( browser.isBlink ) {\n\t\tcanvas.repaintBoxShadow();\n\t}\n} );\n\n//*******************************************\n//*******\n//******* ---- Toolbox ----\n//*******\n//*******************************************\n\n// Arguments are button event, string is \"brush\" or \"eraser or \"hand\" etc.\nlet setToolboxTool = function( e, newToolNameStr ) {\n\tnewToolNameStr = newToolNameStr || this.getAttribute( \"data-tool-button\" );\n\n\tif ( newToolNameStr === state.toolbox.tool ) {return;} // Get out\n\tfor ( let i = 0; i < 5; i += 1 ) {\n\t\ttoolboxButtonEls[ i ].classList.remove( \"panel__button--selected\" );\n\t}\n\tlet selectedButton = doc.querySelector( \"[data-tool-button=\" + newToolNameStr );\n\tselectedButton.classList.add( \"panel__button--selected\" );\n\n\t// Handle CSS cursors.\n\tinnerViewEl.classList.remove( \"brush-tool\",\n\t                              \"eraser-tool\",\n\t                              \"hand-tool\",\n\t                              \"zoom-in-tool\",\n\t                              \"zoom-out-tool\" );\n\tinnerViewEl.classList.add( newToolNameStr + \"-tool\" );\n\n\tstate.toolbox.tool = newToolNameStr;\n};\n\nGator( toolboxEl ).on( [ \"touchstart\", \"mousedown\" ], \".toolbox__button\", setToolboxTool );\n\n//*******************************************\n//*******\n//******* ---- Navigator ----\n//*******\n//*******************************************\n\n// Called by innerView.onUserScroll and canvas.evaluateOverflow\nlet updateNavOutline = function( removeNavOutlineDimensions ) {\n\tif ( !browser.isBig ) { return; }\n\n\t// Called from evaluateOverflow if there's been a change from\n\t// overflow to no overflow.\n\tif ( removeNavOutlineDimensions ) {\n\t\tnavOutlineEl.removeAttribute( \"style\" );\n\t\treturn;\n\t}\n\n\t// This early return must stay in place here. Don't refactor.\n\tif ( !state.canvas.overflowsInnerView ) { return; }\n\n\t// Default if roughly centered, doesn't yet account for scroll position.\n\tlet mainCanvasVisibleX = state.innerView.visibleWidth;\n\tlet mainCanvasVisibleY = state.innerView.visibleHeight;\n\tlet padding = state.canvas.zoomPadding;\n\tlet scale = state.canvas.scale;\n\tlet percentageVisibleX, percentageVisibleY, ratioBetweenCanvases,\n\t    outlinePosX, outlinePosY;\n\n\t// If scrolled to left edge\n\tif ( state.innerView.scroll.x < padding ) {\n\t\tmainCanvasVisibleX -= ( padding - state.innerView.scroll.x );\n\n\t// If scrolled to right edge\n\t}\telse if ( state.innerView.scroll.x > state.innerView.width -\n\t            state.innerView.visibleWidth - padding ) {\n\t\tmainCanvasVisibleX -= state.innerView.scroll.x - ( state.innerView.width -\n\t\t                      state.innerView.visibleWidth - padding );\n\t}\n\n\t// If scrolled to top edge\n\tif ( state.innerView.scroll.y < padding ) {\n\t\tmainCanvasVisibleY -= ( padding - state.innerView.scroll.y );\n\n\t// If scrolled to bottom edge\n\t}\telse if ( state.innerView.scroll.y > state.innerView.height -\n\t            state.innerView.visibleHeight - padding ) {\n\t\tmainCanvasVisibleY -= state.innerView.scroll.y - ( state.innerView.height -\n\t\t                      state.innerView.visibleHeight - padding );\n\t}\n\n\tpercentageVisibleX = mainCanvasVisibleX /\n\t                     ( state.canvas.domDim.x * scale );\n\tpercentageVisibleY = mainCanvasVisibleY /\n\t                     ( state.canvas.domDim.y * scale );\n\n\t// If width or height have changed then set them on the element\n\tif ( percentageVisibleX !== state.nav.outline.percentageX ) {\n\t\tstate.nav.outline.percentageX = percentageVisibleX;\n\t\tnavOutlineEl.style.width = percentageVisibleX * 100 + \"%\";\n\t}\n\tif ( percentageVisibleY !== state.nav.outline.percentageY ) {\n\t\tstate.nav.outline.percentageY = percentageVisibleY;\n\t\tnavOutlineEl.style.height = percentageVisibleY * 100 + \"%\";\n\t}\n\n\t// Use the larger of the two dimensions to calculate the ratio,\n\t// in order to minimize ugly rounding errors.\n\t\tif ( state.nav.canvas.width > state.nav.canvas.height ) {\n\t\t\tratioBetweenCanvases = state.nav.canvas.width /\n\t\t\t                       ( state.canvas.domDim.x * scale );\n\t\t} else {\n\t\t\tratioBetweenCanvases = state.nav.canvas.height /\n\t\t\t                       ( state.canvas.domDim.y * scale );\n\t\t}\n\n\toutlinePosX = ( state.innerView.scroll.x - padding ) * ratioBetweenCanvases;\n\toutlinePosY = ( state.innerView.scroll.y - padding ) * ratioBetweenCanvases;\n\n\t// Clamp outline to 0,0 (don't allow negative).\n\toutlinePosX = Math.max( 0, outlinePosX );\n\toutlinePosY = Math.max( 0, outlinePosY );\n\n\tstate.nav.outline.posX = outlinePosX;\n\tstate.nav.outline.posy = outlinePosY;\n\tnavOutlineEl.style.transform = \"translate(\" + outlinePosX + \"px,\" + outlinePosY + \"px)\";\n};\n\n//*******************************************\n//*******\n//******* ---- Info ----\n//*******\n//*******************************************\n\nlet updateCursorCoordinates = function( e ) {\n\n\t// IE reports non-integer values for offset. Round down.\n\t// Consider removing floor() if never supporting IE.\n\tinfoCursorXEl.textContent = Math.floor( e.offsetX );\n\tinfoCursorYEl.textContent = Math.floor( e.offsetY );\n};\n\nlet handleCoordinatesEnter = function( e ) {\n\tupdateCursorCoordinates( e );\n\tcanvasEl.addEventListener( \"mousemove\", updateCursorCoordinates );\n\tcanvasEl.addEventListener( \"mouseleave\", handleCoordinatesLeave );\n};\n\nlet handleCoordinatesLeave = function( e ) {\n\tinfoCursorXEl.textContent = \"\";\n\tinfoCursorYEl.textContent = \"\";\n\tcanvasEl.removeEventListener( \"mousemove\", updateCursorCoordinates );\n\tcanvasEl.removeEventListener( \"mouseleave\", handleCoordinatesLeave );\n};\n\n//*******************************************\n//*******\n//******* ---- Player ----\n//*******\n//*******************************************\n\nlet player = Object.create( null );\n\nplayer.setSpeed = function( event, num ) {\n\n\t// Arguments will include an Event in case it's being emitted from the input\n\t// slider, but can also be set directly below based on read-in values.\n\tlet val = ( event && event.target ) ? event.target.value : num;\n\tval = Math.max( 0, Math.min( 6, val ) ); // Must be between 0 and 6 inclusive.\n\tstate.player.delay = [ 1600, 750, 200, 100, 50, 25, \"none\" ][ val ]; // Durations in ms.\n\n\tif ( !event ) { playerSpeedInputEl.value = val; }\n\n\t// The data-* attribute creates a CSS hook for the position styling of the SVG thumb.\n\tplayerSpeedInputEl.setAttribute( \"data-player-speed-input\", val );\n};\n\n// Allow the next few often-called fns to live in the outermost scope, to reduce object lookups.\n\n// A 3x3 bitmap has 2^9 = 512 possible states.\n// 000000001 = 1\n// 000000010 = 2\n// 000000011 = 3\n// 000000100 = 4\n// 000000101 = 5\n// 000000110 = 6\n// 000000111 = 7\n// 000001000 = 8\n// 000001001 = 9\n// 000001010 = 10\n// 000001011 = 11\n// 000001100 = 12\n// 000001101 = 13\n// 000001110 = 14\n// 000001111 = 15\n// 111000000 = 448 etc.\n\n// Pre-build and store a lookup array mapping all the possibilities.\n// Stores the number of active cells in the nine cell neighborhood,\n// including the center cell.\nlet bitmapLookupArr = new Uint8Array( 512 );\nfor ( let i = 0; i < 512; i += 1 ) {\n\tbitmapLookupArr[ i ] = i.toString( 2 ).split( \"1\" ).length - 1;\n}\n\nlet bitmap = 0;\n\nlet getTileFromFlatArray = function( x, y, cWidth, dataArray ) {\n\treturn dataArray[ y * cWidth + x ];\n};\n\n// Listlife reference at: http://dotat.at/prog/life/life.html\n// Local cell neighborhood as binary map:\n//  _______________________________________________________\n//  |                  |                 |                 |\n//  |  001000000 = 64  |  000001000 = 8  |  000000001 = 1  |\n//  |__________________|_________________|_________________|\n//  |                  |                 |                 |\n//  |  010000000 = 128 |  000010000 = 16 |  000000010 = 2  |\n//  |__________________|_________________|_________________|\n//  |                  |                 |                 |\n//  |  100000000 = 256 |  000100000 = 32 |  000000100 = 4  |\n//  |__________________|_________________|_________________|\n\nlet countNonToroidal = function( x, y, cWidth, cHeight, dataArray ) {\n\n\tlet ret = 0;\n\tlet leftEdge = x === 0;\n\tlet rightEdge = x === ( cWidth - 1 );\n\tlet topEdge = y === 0;\n\tlet bottomEdge = y === ( cHeight - 1 );\n\tlet centerActive = false;\n\tlet neighborhoodCount;\n\n\tif ( leftEdge ) {\n\t\tbitmap = 0;\n\t} else {\n\n\t\t// Move binary representation three cells to left, adding zeroes from the right.\n\t\t// Using the shift allows 3 array lookups for non-edge cells, instead of 9.\n\t\tbitmap = bitmap << 3;\n\t\tbitmap = bitmap & 511; // 511 = \"111111111\". Set all but the 9 right most digits equal to 0.\n\t\tcenterActive = ( bitmap & 16 ) === 16;\n\t}\n\n\t// Always add cells in column to the right, for all cases.\n\n\t// Top right cell.\n\tif ( !rightEdge && !topEdge && getTileFromFlatArray( x + 1, y - 1, cWidth, dataArray ) ) {\n\t\tbitmap = bitmap | 1;\n\t}\n\n\t// Right cell.\n\tif ( !rightEdge && getTileFromFlatArray( x + 1, y, cWidth, dataArray ) ) {\n\t\tbitmap = bitmap | 2;\n\t}\n\n\t// Bottom right cell.\n\tif ( !rightEdge && !bottomEdge && getTileFromFlatArray( x + 1, y + 1, cWidth, dataArray ) ) {\n\t\tbitmap = bitmap | 4;\n\t}\n\n\tif ( leftEdge ) {\n\n\t\t// Top cell.\n\t\tif ( !topEdge && getTileFromFlatArray( x, y - 1, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 8;\n\t\t}\n\n\t\t// Center cell.\n\t\tif ( getTileFromFlatArray( x, y, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 16;\n\t\t\tcenterActive = true;\n\t\t}\n\n\t\t// Bottom cell.\n\t\tif ( !bottomEdge && getTileFromFlatArray( x, y + 1, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 32;\n\t\t}\n\t}\n\n\tneighborhoodCount = bitmapLookupArr[ bitmap ];\n\tif ( neighborhoodCount === 3 || ( centerActive && neighborhoodCount === 4 ) ) {\n\t\tret = 1;\n\t}\n\treturn ret;\n};\n\n// Substantially similar logic, but putting in a separate function avoids an extra \"if\"\n// statement (or wrapper function) in the typical render loop.\nlet countToroidal = function( x, y, cWidth, cHeight, dataArray ) {\n\n\tlet ret = 0;\n\tlet leftEdge = x === 0;\n\tlet rightEdge = x === ( cWidth - 1 );\n\tlet topEdge = y === 0;\n\tlet bottomEdge = y === ( cHeight - 1 );\n\tlet centerActive = false;\n\tlet neighborhoodCount;\n\n\tif ( leftEdge ) {\n\t\tbitmap = 0;\n\t} else {\n\n\t\t// Move binary representation three cells to left, adding zeroes from the right.\n\t\t// Using the shift allows 3 array lookups for non-edge cells, instead of 9.\n\t\tbitmap = bitmap << 3;\n\t\tbitmap = bitmap & 511; // 511 = \"111111111\". Set all but the 9 right most digits equal to 0.\n\t\tcenterActive = ( bitmap & 16 ) === 16;\n\t}\n\n\t// Account for wrapping behavior.\n\tlet left = x - 1;\n\tlet right = x + 1;\n\tlet top = y - 1;\n\tlet bottom = y + 1;\n\n\tif ( leftEdge ) {\n\t\tleft = cWidth - 1;       // Wrap left edge over to the right.\n\t} else if ( rightEdge ) {\n\t\tright = 0;               // Wrap right edge over to the left.\n\t}\n\tif ( topEdge ) {\n\t\ttop = cHeight - 1;       // Wrap above top over to the bottom.\n\t} else if ( bottomEdge ) {\n\t\tbottom = 0;              // Wrap below bottom over to the top.\n\t}\n\n\t// Always add cells in column to the right, for all cases, even on the edges.\n\n\t// Top right cell.\n\tif ( getTileFromFlatArray( right, top, cWidth, dataArray ) ) {\n\t\tbitmap = bitmap | 1;\n\t}\n\n\t// Right cell.\n\tif ( getTileFromFlatArray( right, y, cWidth, dataArray ) ) {\n\t\tbitmap = bitmap | 2;\n\t}\n\n\t// Bottom right cell.\n\tif ( getTileFromFlatArray( right, bottom, cWidth, dataArray ) ) {\n\t\tbitmap = bitmap | 4;\n\t}\n\n\t// Add center and left columns.\n\tif ( leftEdge ) {\n\n\t\t// Top cell.\n\t\tif ( getTileFromFlatArray( x, top, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 8;\n\t\t}\n\n\t\t// Center cell.\n\t\tif ( getTileFromFlatArray( x, y, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 16;\n\t\t\tcenterActive = true;\n\t\t}\n\n\t\t// Bottom cell.\n\t\tif ( getTileFromFlatArray( x, bottom, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 32;\n\t\t}\n\n\t\t// Top left cell.\n\t\tif ( getTileFromFlatArray( left, top, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 64;\n\t\t}\n\n\t\t// Left cell.\n\t\tif ( getTileFromFlatArray( left, y, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 128;\n\t\t}\n\n\t\t// Bottom left cell.\n\t\tif ( getTileFromFlatArray( left, bottom, cWidth, dataArray ) ) {\n\t\t\tbitmap = bitmap | 256;\n\t\t}\n\t}\n\n\tneighborhoodCount = bitmapLookupArr[ bitmap ];\n\tif ( neighborhoodCount === 3 || ( centerActive && neighborhoodCount === 4 ) ) {\n\t\tret = 1;\n\t}\n\treturn ret;\n};\n\nlet countLiveNeighbors = countNonToroidal; // Initial setting.\n\nplayer.setToroidal = function( e ) {\n\tif ( e.target.checked ) {\n\t\tstate.player.toroidal = true;\n\t\tcountLiveNeighbors = countToroidal;\n\t} else {\n\t\tstate.player.toroidal = false;\n\t\tcountLiveNeighbors = countNonToroidal;\n\t}\n};\n\n// Perf Testing.\n// let renderNextGenPerfCounter = 0;\n// let renderNextGenDuration = 0;\n\nplayer.renderNextGeneration = function() {\n\n\t// Performance checking Main paint start.\n\t// let renderNextGenStart = performance.now();\n\n\tlet currentValue, neighborCount;\n\tlet cWidth = state.canvas.domDim.x;\n\tlet cHeight = state.canvas.domDim.y;\n\tlet dataArray = state.canvas.dataArray;\n\tlet newDataArray = new Int8Array( cWidth * cHeight ); // All initially zero.\n\tlet pixels = state.canvas.pixelBuffer;\n\n\t// Performance checking math start.\n\t// let arrayMathStart = performance.now();\n\n\tfor ( let i = 0; i < cHeight; i += 1 ) { // Outer loop is rows.\n\t\tfor ( let j = 0; j < cWidth; j += 1 ) { // Inner loop is columns.\n\n\t\t\t// A 1 (live) or 0 (dead)\n\t\t\tlet value = countLiveNeighbors( j, i, cWidth, cHeight, dataArray );\n\t\t\tnewDataArray[ i * cWidth + j ] = value;\n\n\t\t\t// Repeat the logic from canvas.paintBothCanvasesBitwise here to\n\t\t\t// avoid an separate loop through all pixels.\n\t\t\t// Convert 1 (live) to 0. Convert 0 (dead) to 255.\n\t\t\tlet colorValue = 255 - ( value * 255 );\n\n\t\t\tpixels[ ( i * cWidth ) + j ] =\n\t\t\t\t( 255   << 24 ) |        /* alpha always opaque*/\n\t\t\t\t( colorValue << 16 ) |   /* blue */\n\t\t\t\t( colorValue <<  8 ) |   /* green */\n\t\t\t\t  colorValue;            /* red */\n\t\t}\n\t}\n\n\tcanvasCtx.putImageData( state.canvas.imageData, 0, 0 );\n\tnavCanvasCtx.putImageData( state.canvas.imageData, 0, 0 );\n\n\t// Performance checking Main paint end.\n\t// let renderNextGenEnd = performance.now();\n\t// renderNextGenDuration += renderNextGenEnd - renderNextGenStart;\n\t// if ( renderNextGenPerfCounter  === 59 ) {\n\t// \tconsole.log( \"Avg renderNextGen: \" + ( renderNextGenDuration / 60 ) + \" ms.\" );\n\t// \trenderNextGenPerfCounter = 0;\n\t// \trenderNextGenDuration = 0;\n\t// }\n\t// renderNextGenPerfCounter += 1;\n\n\tstate.canvas.dataArray = newDataArray; // Swap.\n\n\t// Increment the generation counter\n\tplayerCounterEl.textContent = state.player.generation = state.player.generation += 1;\n\n\t// If playing, then loop.\n\tif ( state.player.isPlaying ) {\n\t\tif ( state.player.delay === \"none\" ) {\n\t\t\tnextFrameID = requestAnimationFrame( player.renderNextGeneration );\n\t\t} else {\n\t\t\tnextFrameID = w.setTimeout( function() {\n\t\t\t\trequestAnimationFrame( player.renderNextGeneration );\n\t\t\t}, state.player.delay );\n\t\t}\n\t}\n};\n\nplayer.pause = function() {\n\n\t// Cancel any scheduled stepAll call so that resets while playing don't step forward\n\t// to generation 1.\n\tif ( state.player.isPlaying ) {\n\t\tif ( state.player.delay === \"none\" ) {\n\t\t\tcancelAnimationFrame( nextFrameID );\n\t\t} else {\n\t\t\tw.clearTimeout( nextFrameID );\n\t\t}\n\t}\n\tstate.player.isPlaying = false;\n\tplayerPlayButtonEl.classList.remove( \"player__play-button--is-playing\" );\n};\n\nplayer.onPlayerClearButton = function( e ) {\n\tplayer.onResetGenerationsCounter( e );\n\tvoidCurrentSelectedPatternLink();\n\tcanvas.clearDataArray();\n\tcanvas.clearMainAndNavCanvases();\n};\n\nplayer.onResetGenerationsCounter = function( e ) {\n\tif ( e && e.type === \"touchstart\" ) { e.preventDefault(); }\n\tplayer.pause();\n\tplayerCounterEl.textContent = \"0\";\n\tstate.player.generation = 0;\n};\n\nplayer.onStepButton = function( e ) {\n\tif ( e && e.type === \"touchstart\" ) { e.preventDefault(); }\n\tif ( state.player.isPlaying ) {\n\t\tplayer.pause();\n\t}\n\tvoidCurrentSelectedPatternLink();\n\tclearAnyHash();\n\tplayer.renderNextGeneration();\n};\n\nplayer.play = function() {\n\tstate.player.isPlaying = true;\n\tplayerPlayButtonEl.classList.add( \"player__play-button--is-playing\" );\n\tvoidCurrentSelectedPatternLink();\n\tclearAnyHash();\n\tplayer.renderNextGeneration();\n};\n\nplayer.onPlayStopButton = function( e ) {\n\tif ( e && e.type === \"touchstart\" ) { e.preventDefault(); }\n\tif ( state.player.isPlaying ) {\n\t\tplayer.pause();\n\t} else {\n\t\tplayer.play();\n\t}\n};\n\nplayerToroidalInputEl.addEventListener( \"change\", player.setToroidal );\n\nplayerSpeedInputEl.addEventListener( \"input\", player.setSpeed );\n\nplayerClearButtonEl.addEventListener( \"touchstart\", player.onPlayerClearButton );\nplayerClearButtonEl.addEventListener( \"mousedown\", player.onPlayerClearButton );\n\nplayerResetButtonEl.addEventListener( \"touchstart\", player.onResetGenerationsCounter );\nplayerResetButtonEl.addEventListener( \"mousedown\", player.onResetGenerationsCounter );\n\nplayerPlayButtonEl.addEventListener( \"touchstart\", player.onPlayStopButton );\nplayerPlayButtonEl.addEventListener( \"mousedown\", player.onPlayStopButton );\n\nplayerStepButtonEl.addEventListener( \"touchstart\", player.onStepButton );\nplayerStepButtonEl.addEventListener( \"mousedown\", player.onStepButton );\n\n//*******************************************\n//*******\n//******* ---- Patterns ----\n//*******\n//*******************************************\n\nlet voidCurrentSelectedPatternLink = function() {\n\tlet currentSelectedLink = state.patterns.currentSelectedLink;\n\tif ( currentSelectedLink ) {\n\t\tcurrentSelectedLink.parentNode.classList.remove( \"pat--selected\", \"pat--loading\" );\n\t\tstate.patterns.currentSelectedLink = null;\n\t}\n};\n\n// Patterns need room to breathe.\n// Canvas of an imported pattern that doesn't have a minCanvasX or minCanvasY properties\n// should be at least three times the core pattern dimensions on that side, with a\n// minimum value based on viewport media query.\n// (This helps keep small patterns fast on mobile.)\n// If the pattern includes minimum dimensions and/or offset values for positioning,\n// use those.\nlet addPatternMargins = function( patPixArray, patWidth, patHeight,\n                                  minCanvasX, minCanvasY, offsetX, offsetY ) {\n\n\tlet minMargin = w.browser.isBig ? 200 : 80;\n\tlet outputWidth = minCanvasX || Math.max( patWidth * 3, minMargin );\n\tlet outputHeight = minCanvasY || Math.max( patHeight * 3, minMargin );\n\tlet newPixArray = new Int8Array( outputWidth * outputHeight ); // All zeros initially\n\tlet len = patWidth * patHeight;\n\tlet curX, curY;\n\n\t// Use any pixel offset if supplied, otherwise calculate\n\t// Validate offset values.\n\tif ( !ut.isNonNegativeInteger( offsetX ) ) {\n\t\toffsetX = Math.floor( ( outputWidth - patWidth ) / 2 ); // Default to centered\n\t}\n\tif ( !ut.isNonNegativeInteger( offsetY ) ) {\n\t\toffsetY = Math.floor( ( outputHeight - patHeight ) / 2 );\n\t}\n\n\tfor ( let i = 0; i < len; i += 1 ) {\n\t\tcurX = i % patWidth;\n\t\tcurY = Math.floor( i / patWidth );\n\t\tnewPixArray[ ( curY + offsetY ) * outputWidth + curX + offsetX ] = patPixArray[ i ];\n\t}\n\n\treturn {\n\t\tdataArray: newPixArray,\n\t\twidth: outputWidth,\n\t\theight: outputHeight\n\t};\n};\n\nlet redrawCanvasFromDataArray = function( dataArray, width, height ) {\n\n\t// Don't reset generations counter here, because might be canvas resizing.\n\t// Don't transition-zoom.\n\tcanvasEl.classList.remove( \"main-canvas--transition-scale\" );\n\tcanvas.setCanvasDim( width, height );\n\tstate.canvas.dataArray = dataArray;\n\tcanvas.paintBothCanvasesBitwise();\n\n\tw.requestAnimationFrame( function() {\n\t\tcanvas.handleFitZoom();\n\t\tcanvasEl.classList.add( \"main-canvas--transition-scale\" );\n\t} );\n};\n\n /**\n\t* @param {object} d - The JSON\n\t* @param {Boolean} addMargin - Whether or not additional margins should be considered.\n\t*/\nlet loadPatternJSONToCanvas = function( d, addMargin ) {\n\tlet patternStr = d.pattern;\n\tlet width = d.width;\n\tlet height = d.height;\n\tlet minCanvasX = d.minCanvasX;\n\tlet minCanvasY = d.minCanvasY;\n\tlet offsetX = d.offsetX;\n\tlet offsetY = d.offsetY;\n\tlet isToroidal = !!d.toroidal;\n\n\tif ( !patternStr ) {\n\t\tconsole.log( \"Pattern file parse error\" );\n\t}\n\n\tlet pixelArray = parseRLEPixelString( patternStr, width, height );\n\tlet marginAddedObj;\n\n\t// Add margins for included JSON patterns.\n\tif ( addMargin ) {\n\t\tmarginAddedObj = addPatternMargins( pixelArray, width, height,\n\t                                        minCanvasX, minCanvasY, offsetX, offsetY );\n\t  pixelArray = marginAddedObj.dataArray;\n\t  width = marginAddedObj.width;\n\t  height = marginAddedObj.height;\n\t}\n\n\tredrawCanvasFromDataArray( pixelArray, width, height );\n\tplayer.onResetGenerationsCounter();\n\n\tplayerToroidalInputEl.checked = isToroidal; // Set on DOM element. Doesn't fire a change event.\n\tstate.player.toroidal = isToroidal;\n\tcountLiveNeighbors = isToroidal ? countToroidal : countNonToroidal;\n};\n\nlet onPatternLinkClick = function( e ) {\n\te.preventDefault(); // Always for both touch and mouse.\n\n\t// Hide any mobile UI.\n\t// patternsPanelEl.classList.remove( \"patterns--mobile-show\" );\n\t// patternsButtonMobileEl.classList.remove( \"panel__button--selected\" );\n\n\topenCloseMobileFlyouts(); // Don't need to pass e. Calling w/o arguments closes everything.\n\n\tlet patternListItem = this.parentNode;\n\n\tplayer.pause(); // Stop any current animation.\n\tcanvas.clearMainAndNavCanvases();\n\n\tvoidCurrentSelectedPatternLink();\n\n\t// Remove loading class from all other pattern list items.\n\tfor ( let i = 0; i < patternsListItemEls.length; i += 1 ) {\n\t\tpatternsListItemEls[ i ].classList.remove( \"pat--loading\" );\n\t}\n\tpatternListItem.classList.add( \"pat--selected\", \"pat--loading\" );\n\n\t// Store for comparison when XHR returns, and also for removing classes.\n\tstate.patterns.currentSelectedLink = this;\n\n\tfetch( this.href )\n\t.then( function( response ) {\n\n\t\t// Unlike jQuery.AJAX(), 404 errors do not reject in fetch.\n\t\t// Must check for these manually.\n\t\tif ( !response.ok ) {\n\t\t\tlet error = new Error( response.statusText );\n\t\t\terror.response = response;\n\t\t\tthrow error;\n\t\t} else {\n\t\t\treturn response;\n\t\t}\n\t} ).then( function( response ) {\n\n\t\t// Patterns may return from the network out of the order clicked on.\n\t\tif ( response.url !== state.patterns.currentSelectedLink.href ) {\n\t\t\treturn Promise.reject( \"Pattern loaded was not the most recently clicked\" );\n\t\t}\n\n\t\t// Get relative path from absolute and drop the extension.\n\t\t// Sanity check as there are probably some typos in markup.\n\t\tlet fileName = response.url.split( \"/\" ).pop();\n\t\tif ( fileName.slice( -5 ) === \".json\" ) {\n\t\t\tfileName = fileName.slice( 0, -5 );\n\t\t\tw.history.replaceState( undefined, undefined, \"#\" + fileName );\n\t\t\treturn response.json();\n\t\t} else {\n\t\t\treturn Promise.reject( \"Response didn't have a '.json' extension\" );\n\t\t}\n\t} ).then( function( json ) {\n\n\t\tloadPatternJSONToCanvas( json, true );\n\t} ).catch( function( error ) {\n\n\t\t// Catch and log any error that has happened along the way.\n\t\tconsole.log( \"error:\", error );\n\t} ).then( function() {\n\n\t\t// Always remove the \"loading\" class when the promise is settled\n\t\t// and no longer pending, in all cases.\n\t\tpatternListItem.classList.remove( \"pat--loading\" );\n\t} );\n};\n\n// Attach delegated event handler for patterns.\n// Don't listen for touchstart because the link list needs to be scrollable.\nGator( patternsWrapperEl ).on( \"click\", \".pat__link\", onPatternLinkClick );\n\n//*******************************************\n//*******\n//******* ---- All Modals ----\n//*******\n//*******************************************\n\nModal.modalSetOpenState = function( bool ) {\n\tstate.isModalOpen = bool;\n};\n\n//*******************************************\n//*******\n//******* ---- Canvas Size Modal ----\n//*******\n//*******************************************\n\nmodalCanvasSize.modalBeforeOpen = function() {\n\tthis.currentCanvasWidth = state.canvas.domDim.x;\n\tthis.currentCanvasHeight = state.canvas.domDim.y;\n};\nmodalCanvasSize.modalSubmit = function() {\n\tcanvas.handleResize( this.newWidth, this.newHeight,\n\t                     this.resizeIconPositionX, this.resizeIconPositionY );\n};\nmodalCanvasSize.init( infoCanvasSizeButtonEl );\n\n//*******************************************\n//*******\n//******* ---- Pattern Open Modal ----\n//*******\n//*******************************************\n\nmodalOpenPattern.modalSubmit = function() {\n\tlet fileExt = this.fileExtension;\n\tlet pat = this.parsedPattern;\n\n\t// The selected file should already be parsed by the time the user clicks \"OK\" in modal.\n\t// (We don't currently check for this asynchronicity.)\n\t// Don't ever add any margins to patterns loaded externally.\n\n\t// Text files have RLE string for pattern property.\n\tif ( fileExt === \"JSON\" || fileExt === \"RLE\" ) {\n\t\tloadPatternJSONToCanvas( pat, false );\n\t} else if ( fileExt === \"BMP\" ) {\n\n\t\t// BMP files have data array for pixels property.\n\t\tredrawCanvasFromDataArray( pat.pixels, pat.width, pat.height );\n\t}\n\n\tvoidCurrentSelectedPatternLink();\n\tclearAnyHash();\n\tplayer.onResetGenerationsCounter();\n\tw.history.replaceState( undefined, undefined, w.location.pathname );\n};\n\nmodalOpenPattern.init( patternsOpenButtonEl );\n\n//*******************************************\n//*******\n//******* ---- Pattern Save Modal ----\n//*******\n//*******************************************\n\nmodalSavePattern.modalSubmit = function() {\n\tlet fileFormatEl = doc.querySelector( \"[data-modal-save-file-format]\" );\n\tlet patternNameEl = doc.querySelector( \"[data-modal-save-pattern-name]\" );\n\tlet patternAuthorEl = doc.querySelector( \"[data-modal-save-pattern-author]\" );\n\tlet suppliedPatternName = patternNameEl.value;\n\tlet usedPatternName = suppliedPatternName || \"my-lifey-pattern\";\n\tlet fileType = fileFormatEl.value;\n\tlet outputStr;\n\n\tlet orderedPatternForJSON = Object.create( null );\n\tlet patternObj = dataArrayToRLE( state.canvas.dataArray,\n\t                                 state.canvas.domDim.x, state.canvas.domDim.y );\n\n\t// Add the properties to the new object in the order they should be printed.\n\tif ( suppliedPatternName ) {\n\t\torderedPatternForJSON.name = suppliedPatternName;\n\t}\n\tif ( patternAuthorEl.value ) {\n\t\torderedPatternForJSON.author = patternAuthorEl.value;\n\t}\n\torderedPatternForJSON.width = patternObj.width;\n\torderedPatternForJSON.height = patternObj.height;\n\torderedPatternForJSON.minCanvasX = patternObj.minCanvasX;\n\torderedPatternForJSON.minCanvasY = patternObj.minCanvasY;\n\torderedPatternForJSON.offsetX = patternObj.offsetX;\n\torderedPatternForJSON.offsetY = patternObj.offsetY;\n\torderedPatternForJSON.pattern = patternObj.pattern;\n\n\tif ( fileType === \"json\" ) {\n\t\toutputStr = JSON.stringify( orderedPatternForJSON, null, \"\\t\" );\n\t} else if ( fileType === \"rle\" ) {\n\t\toutputStr = patToRleFileString( orderedPatternForJSON );\n\t}\n\n\tsaveTextAsFile( outputStr, usedPatternName + \".\" + fileType );\n};\n\nmodalSavePattern.init( patternsSaveButtonEl );\n\n//*******************************************\n//*******\n//******* ---- Pattern Share Modal ----\n//*******\n//*******************************************\n\n// Runs after innerMarkup has been added. Not really a binding in this case, but can use.\nmodalSharePattern.modalInternalBinding = function() {\n\tlet modalSharePatternFitsEl = doc.querySelector( \".pattern-fits-in-url\" );\n\tlet urlDivEl = doc.querySelector( \"[data-modal-shareable-url]\" );\n\tlet cWidth = state.canvas.domDim.x;\n\tlet cHeight = state.canvas.domDim.y;\n\tlet baseURL = w.location.href;\n\tlet patRLEObj = dataArrayToRLE( state.canvas.dataArray, cWidth, cHeight );\n\tlet msg, linkURL;\n\n\t// If sharing a pattern from the library, don't use query string data.\n\tif ( state.patterns.currentSelectedLink ) {\n\t\tlinkURL = baseURL;\n\t} else {\n\t\tlinkURL = baseURL + \"#\" + ut.serializeToQueryString( patRLEObj );\n\t}\n\n\tif ( !linkURL || linkURL.length > 4000 ) {\n\t\tmsg = \"Sorry, but your pattern is too large to be shared in a URL.\" +\n\t\t      \" Please consider saving to a JSON or RLE text file instead.\" +\n\t\t      \" You can also right-click directly on the canvas to save it as a PNG.\";\n\t\turlDivEl.classList.add( \"hide-url\" );\n\n\t} else {\n\t\tmsg = \"The following URL is a permanent, shareable link to the current pattern.\" +\n\t\t      \" It has been copied to your system clipboard.\";\n\t\turlDivEl.innerHTML = linkURL;\n\t\turlDivEl.focus();\n\t\tut.copyTextToClipBoard( linkURL );\n\t}\n\n\tmodalSharePatternFitsEl.innerHTML = msg;\n};\n\nmodalSharePattern.init( patternsShareButtonEl );\n\n//*******************************************\n//*******\n//******* ---- Keyboard Shortcuts ----\n//*******\n//*******************************************\n\n// Keymaster defines shortcuts within a particular \"scope\" that corresponds to an area of a\n// single page app. Lifey currently has two areas: \"main\" and \"modal\". Nearly all general\n// keyboard shortcuts are disabled in the modal view.\nkey.setScope( \"main\" ); // Keymaster default scope is \"all\".\n\n// By default, Keymaster doesn't process shortcuts when INPUT, SELECT, or\n// TEXTAREA elements are focused. Loosen this restriction to allow shortcuts\n// to work when INPUT elements are focused.\nkey.filter = function( event ) {\n\tvar tagName = ( event.target || event.srcElement ).tagName;\n\treturn !( tagName == \"SELECT\" || tagName == \"TEXTAREA\" );\n};\n\n// Kill all repeated key events.\nbodyEl.addEventListener( \"keydown\", function( e ) {\n\tif ( e.repeat ) { return false; }\n} );\n\n// ---- Toolbox Shortcuts ----\n\n// Shift key switches toolbox to the hand tool until the key is released.\nkey( \"shift\", \"main\", function() {\n\tbodyEl.classList.add( \"shift-depressed\" );\n\tstate.toolbox.override = \"hand\";\n} );\n\n// Keyup must be done manually without Keymaster.\nbodyEl.addEventListener( \"keyup\", function( e ) {\n\tif ( e.which === 16 ) {\n\t\tbodyEl.classList.remove( \"shift-depressed\" );\n\t\tstate.toolbox.override = null;\n\t}\n} );\n\nkey( \"b\", \"main\", function() {\n\tsetToolboxTool( \"brush\" );\n} );\n\nkey( \"e\", \"main\", function() {\n\tsetToolboxTool( \"eraser\" );\n} );\n\nkey( \"h\", \"main\", function() {\n\tsetToolboxTool( \"hand\" );\n} );\n\nkey( \"z\", \"main\", function() {\n\tsetToolboxTool( \"zoom-in\" );\n} );\n\n// ---- Zoom Shortcuts ----\n\n// Plus key.\nkey( browser.shortkey + \"+=\", \"main\", function( e ) {\n  e.preventDefault();\n\n  // Treat keyboard-shortcut-initiated zooms as occurring at center of the visible innerView.\n  // Synthesize an event property on them for simplicity.\n  e.pageX = state.innerView.visibleWidth / 2;\n\te.pageY = state.innerView.visibleHeight / 2;\n  canvas.handleIncrementalZoom( e, \"zoom-in\" );\n} );\n\n// Minus key.\nkey( browser.shortkey + \"+-\", \"main\", function( e ) {\n  e.preventDefault();\n  e.pageX = state.innerView.visibleWidth / 2;\n\te.pageY = state.innerView.visibleHeight / 2;\n  canvas.handleIncrementalZoom( e, \"zoom-out\" );\n} );\n\n// Zero key.\nkey( browser.shortkey + \"+0\", \"main\", function( e ) {\n  e.preventDefault();\n  canvas.handleFitZoom();\n} );\n\n// ---- Player Shortcut ----\n\n// As in video software, space bar plays/pauses.\nkey( \"space\", \"main\", function() {\n\tplayer.onPlayStopButton();\n} );\n\n// ---- Hide Panels Shortcut ----\n\n// Tab key.\nkey( \"tab\", \"main\", function() {\n\tbodyEl.classList.toggle( \"hide-panels\" );\n\treturn false;\n} );\n\n// ---- Modal Shortcuts ----\n\n// Treat hitting \"enter\" as clicking \"ok\".\nkey( \"enter\", \"modal\", function( e ) {\n\tdoc.querySelector( \"[data-modal-ok]\" ).click();\n} );\n\n//*******************************************\n//*******\n//******* ---- Hash Management ----\n//*******\n//*******************************************\n\nlet clearAnyHash = function() {\n\tif ( w.location.hash ) {\n\t\tw.history.replaceState( undefined, undefined, w.location.pathname );\n\t}\n};\n\n//*******************************************\n//*******\n//******* ---- Fullscreen API\n//*******\n//*******************************************\n\nrequestFullscreenButtonEl.addEventListener( \"click\", function( e ) {\n\tlet requestFullScreen = htmlEl.requestFullscreen ||\n\t                        htmlEl.mozRequestFullScreen ||\n                          htmlEl.webkitRequestFullScreen;\n\n\trequestFullScreen.call( htmlEl );\n} );\n\nexitFullscreenButtonEl.addEventListener( \"click\", function( e ) {\n\tlet exitFullScreen = doc.exitFullscreen ||\n\t                     doc.mozCancelFullScreen ||\n                       doc.webkitExitFullscreen;\n\n\texitFullScreen.call( doc );\n} );\n\n//*******************************************\n//*******\n//******* ---- Refresh from Standalone\n//*******\n//*******************************************\n\nlet mobileRefreshEl = doc.querySelector( \".mobile-menu__refresh\" );\n\nmobileRefreshEl.addEventListener( \"click\", function( e ) {\n\te.preventDefault();\n\tw.location = \"https://bellandwhistle.net/lifey\";\n\n} );\n\n//*******************************************\n//*******\n//******* ---- Mobile-only UI\n//*******\n//*******************************************\n\nlet onPointerStartAnyPanelButton = function( e ) {\n\tif ( e.type === \"touchstart\" ) {\n\t\te.preventDefault();\n\n\t\t// :active styling is screwed up on FF for Android.\n\t\t// Manually add and remove classes instead. :/\n\t\tthis.classList.add( \"panel__button--touch-pressed\" );\n\t}\n\topenCloseMobileFlyouts( e, this );\n};\n\nlet onTouchEndAnyPanelButton = function( e ) {\n\te.preventDefault();\n\tthis.classList.remove( \"panel__button--touch-pressed\" );\n};\n\nlet openCloseMobileFlyouts = ( function() {\n\tlet activeFlyout;\n\tlet flyoutTargets = {\n\t\t\"meter\": {\n\t\t\t\"buttonEl\": meterButtonMobileEl,\n\t\t\t\"targetEl\": playerPanelEl,\n\t\t\t\"className\": \"player--mobile-show-speed\"\n\t\t},\n\t\t\"menu\": {\n\t\t\t\"buttonEl\": menuButtonMobileEl,\n\t\t\t\"targetEl\": playerPanelEl,\n\t\t\t\"className\": \"player--mobile-show-toroidal\"\n\t\t},\n\t\t\"patterns\": {\n\t\t\t\"buttonEl\": patternsButtonMobileEl,\n\t\t\t\"targetEl\": patternsPanelEl,\n\t\t\t\"className\": \"patterns--mobile-show\"\n\t\t}\n\t};\n\n\treturn function( e, button ) {\n\n\t\t// Could be \"meter\", \"menu\", \"patterns\" or undefined.\n\t\tlet pointeredStr;\n\n\t\tif ( button ) {\n\t\t\tpointeredStr = button.getAttribute( \"data-mobile-button\" );\n\t\t}\n\n\t\t// Unified closing logic:\n\t\t// If the clicked button is currently active, close it and return.\n\t\t// If another flyout is active, close it.\n\t\tif ( activeFlyout ) {\n\t\t\tlet activeTarget = flyoutTargets[ activeFlyout ];\n\t\t\tactiveTarget.buttonEl.classList.remove( \"panel__button--selected\" );\n\t\t\tactiveTarget.targetEl.classList.remove( activeTarget.className );\n\n\t\t\t// If clicked button was currently active, get out.\n\t\t\tif ( pointeredStr && pointeredStr === activeFlyout ) {\n\t\t\t\tactiveFlyout = undefined;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tactiveFlyout = undefined; /* May be overridden below. */\n\t\t}\n\n\t\t// Opening logic:\n\t\tif ( button ) {\n\t\t\tlet pointeredTarget = flyoutTargets[ pointeredStr ];\n\t\t\tif ( !pointeredTarget ) { return; }\n\t\t\tpointeredTarget.buttonEl.classList.add( \"panel__button--selected\" );\n\t\t\tpointeredTarget.targetEl.classList.add( pointeredTarget.className );\n\t\t\tactiveFlyout = pointeredStr;\n\t\t}\n\t};\n\n}() );\n\n// This works on all panel buttons everywhere. So canvas size, save as, share buttons all\n// close any current flyout.\nGator( bodyEl ).on( [ \"touchstart\", \"click\" ], \".panel__button\", onPointerStartAnyPanelButton );\n\n// Hamburger menu item click should close the hamburger menu.\n// Use click instead of touchstart here to reduce glitching on the menu item handlers,\n// which fire on touchstart.\nGator( playerToroidalWrapperEl ).on( \"click\", \".mobile-menu__item\", openCloseMobileFlyouts );\n\nGator( bodyEl ).on( \"touchend\", \".panel__button\", onTouchEndAnyPanelButton );\n\n// On touch, tapping tortoise/hare should increment/decrement the input range slider.\nGator( playerSpeedEl ).on( \"touchstart\", \"svg\", function( e ) {\n\tlet val = this.classList.contains( \"player__tortoise\" ) ? -1 : 1;\n\tplayer.setSpeed( null, parseInt( playerSpeedInputEl.value, 10 ) + val );\n} );\n\n//*******************************************\n//*******\n//******* ---- Scrollbar Styles for Firefox\n//*******\n//*******************************************\n\n// Firefox currently doesn't support CSS on scrollbars.\n// Use overlaid dummy elements and CSS mix-blend-mode to style.\n// This is gross but it's better than either of the alternatives.\n\nlet addFirefoxScrollStyleElements = function() {\n\n\tlet widthInvert = doc.createElement( \"div\" );\n\tlet widthLighter = doc.createElement( \"div\" );\n\tlet heightInvert = doc.createElement( \"div\" );\n\tlet heightLighter = doc.createElement( \"div\" );\n\tlet cornerBox = doc.createElement( \"div\" );\n\n\tlet heightInvertPatterns, heightLighterPatterns, heightSingleLine;\n\n\twidthInvert.classList.add(   \"ff-scroll\", \"ff-scroll--horizontal\", \"ff-scroll--invert\" );\n\twidthLighter.classList.add(  \"ff-scroll\", \"ff-scroll--horizontal\", \"ff-scroll--lighter\" );\n\theightInvert.classList.add(  \"ff-scroll\", \"ff-scroll--vertical\",   \"ff-scroll--invert\" );\n\theightLighter.classList.add( \"ff-scroll\", \"ff-scroll--vertical\",   \"ff-scroll--lighter\" );\n\n\tcornerBox.classList.add( \"ff-scroll\", \"ff-scroll-corner\" );\n\n// Clone a full-height set for the patterns panel.\n\theightInvertPatterns = heightInvert.cloneNode();\n\theightInvertPatterns.classList.add( \"ff-scroll--full-height\" );\n\theightLighterPatterns = heightLighter.cloneNode();\n\theightLighterPatterns.classList.add( \"ff-scroll--full-height\" );\n\n// Divs on the main background need to save room for a corner.\n\twidthInvert.classList.add( \"ff-scroll--horizontal-with-corner\" );\n\twidthLighter.classList.add( \"ff-scroll--horizontal-with-corner\" );\n\theightInvert.classList.add( \"ff-scroll--vertical-with-corner\" );\n\theightLighter.classList.add( \"ff-scroll--vertical-with-corner\" );\n\n\theightSingleLine = doc.createElement( \"div\" );\n\theightSingleLine.classList.add( \"ff-scroll\", \"ff-scroll--vertical\",\n\t                                \"ff-scroll--full-height\",\n\t                                \"ff-scroll--single-line\" );\n\n\t// Main panels need to sit in front of the FF color-flipping divs\n\t// otherwise there are weird compositing glitches.\n\tbodyEl.insertBefore( widthInvert,   toolboxEl );\n\tbodyEl.insertBefore( widthLighter,  toolboxEl );\n\tbodyEl.insertBefore( heightInvert,  toolboxEl );\n\tbodyEl.insertBefore( heightLighter, toolboxEl );\n\tbodyEl.insertBefore( cornerBox,     toolboxEl );\n\n\tpatternsOuterWrapperEl.appendChild( heightInvertPatterns );\n\tpatternsOuterWrapperEl.appendChild( heightLighterPatterns );\n\n\t// Black 1px line prevents an occasional weird white line from rendering.\n\tpatternsOuterWrapperEl.appendChild( heightSingleLine );\n};\n\nif ( w.browser.isFirefox ) {\n\taddFirefoxScrollStyleElements();\n}\n\n\t// No way to disable browser-level zoom in Firefox. Rebuild styles on both load and resize.\n// Add rules to existing stylesheet to indent desktop toolbars on the right by the scrollbar width.\nlet writeScrollbarDependentRules = function() {\n\n\tlet rulesLength = scrollSs.cssRules.length;\n\tfor ( let i = 0; i < rulesLength; i += 1 ) { scrollSs.deleteRule( 0 ); }\n\n\t// Always on page load for all browsers.\n\tscrollSs.insertRule( \".panel--right { right: \" + state.scrollbarDim + \"px;}\", 0 );\n\n\tif ( w.browser.isFirefox ) {\n\t\tscrollSs.insertRule( \".ff-scroll--horizontal {\" +\n\t\t                     \"height: \" + state.scrollbarDim + \"px;\", 1 );\n\n\t\tscrollSs.insertRule( \".ff-scroll--vertical  {\" +\n\t\t                     \"width: \" + state.scrollbarDim + \"px;\", 2 );\n\n\t\tscrollSs.insertRule( \".ff-scroll--horizontal-with-corner {\" +\n\t\t                     \"width: calc(100% - \" + state.scrollbarDim + \"px);}\", 3 );\n\n\t\tscrollSs.insertRule( \".ff-scroll--vertical-with-corner {\" +\n\t\t                     \"height: calc(100% - \" + state.scrollbarDim + \"px);}\", 4 );\n\n\t\tscrollSs.insertRule( \".ff-scroll-corner { width: \" + state.scrollbarDim + \"px;\" +\n\t\t                     \"height: \" + state.scrollbarDim + \"px);}\", 5 );\n\n\t}\n};\n\n//*******************************************\n//*******\n//******* ---- Master Window Resize Handler\n//*******\n//*******************************************\n\n// Refer to different padding values in base.SCSS starting at line 46.\nlet deriveViewportDependentConstants = function() {\n\n\t// Track mobile vs desktop state, for layout math.\n\t// Current this is only needed to deal with changing scrollbars and padding.\n\tw.browser.isBig = false;\n\tstate.canvas.zoomPadding = 100;\n\n\t// These breakpoints must match the breakpoints on line 17 of \"_vars.scss\"\n\tif ( w.matchMedia( \"(min-width: 790px) and (min-height: 600px)\" ).matches ) {\n\t\tstate.canvas.zoomPadding = 200;\n\t\tw.browser.isBig = true;\n\n\t\t// Don't track mouse cursor position if we're not actually showing it.\n\t\tcanvasEl.addEventListener( \"mouseenter\", handleCoordinatesEnter );\n\t}\n\n\t// Scrollbar CSS pixel thickness varies between browsers and sometimes zoom levels.\n\tstate.scrollbarDim = outerBgEl.offsetWidth - outerBgEl.clientWidth;\n};\n\nlet onWindowResize = function() {\n\tderiveViewportDependentConstants();\n\tif ( w.browser.isFirefox ) {\n\t\twriteScrollbarDependentRules();\n\t}\n\tinnerView.onResize();\n};\n\n//*******************************************\n//*******\n//******* ---- On Window Load ----\n//*******\n//*******************************************\n\n// Some CSS values can't be read and stored reliably until the load event.\n// Wait, otherwise scaling doesn't work reliably on the initial canvas.\n( function() {\n\n\tlet splashTimeout;\n\n\tlet loadBlankCanvasBasedOnViewportDimensions = function() {\n\n\t\tlet initialWidth, initialHeight;\n\n\t\t// 80% of the available viewport on desktop. More tightly fitted on mobile.\n\t\tif ( w.browser.isBig ) {\n\t\t\tinitialWidth = Math.floor( state.innerView.visibleWidth * 0.8 /\n\t\t                             state.canvas.scale );\n\t\t\tinitialHeight = Math.floor( state.innerView.visibleHeight * 0.8 /\n\t\t                              state.canvas.scale );\n\t\t} else {\n\t\t\tinitialWidth = Math.floor( ( state.innerView.visibleWidth - 30 ) /\n\t\t                             state.canvas.scale );\n\t\t\tinitialHeight = Math.floor( ( state.innerView.visibleHeight - 30 ) /\n\t\t                              state.canvas.scale );\n\t\t}\n\t\tcanvas.setCanvasDim( initialWidth, initialHeight );\n\t\tcanvas.clearDataArray(); // Data Array based on canvas dim state so must come after.\n\t};\n\n\tlet loadInitialCanvas = function() {\n\t\tlet hash = w.location.hash.slice( 1 ); // Remove \"#\"\n\t\tlet link = doc.querySelector( \"[href='pat/\" + hash + \".json']\" );\n\t\tlet qsObj = ut.deserializeQueryString( hash );\n\n\t\t// Show the red navigator outline;\n\t\tnavOutlineEl.classList.remove( \"navigator__canvas-outline--hidden\" );\n\n\t\t// First try parsing as a query string.\n\t\tif ( qsObj && qsObj.pattern && qsObj.width && qsObj.height )   {\n\n\t\t\t// Query string might be malformed or mistyped etc. Fall through to blank canvas.\n\t\t\ttry {\n\t\t\t\tloadPatternJSONToCanvas( qsObj, true ); // Do add margins in queryString.\n\t\t\t} catch ( e ) {\n\t\t\t\tconsole.log( \"Error parsing query string: \", e );\n\t\t\t\tloadBlankCanvasBasedOnViewportDimensions();\n\t\t\t}\n\n\t\t// Else if hash is a named pattern for which a pattern link exists, \"click\" that link.\n\t\t} else if ( link ) {\n\t\t\tlink.click();\n\t\t} else {\n\t\t\tloadBlankCanvasBasedOnViewportDimensions();\n\t\t}\n\n\t\t// Add innerView listeners once canvas exists.\n\t\t/// Firefox on Android fires mysterious early resize events.\n\t\tw.addEventListener( \"resize\", ut.debounce( onWindowResize, 80 ) );\n\t\touterBgEl.addEventListener( \"scroll\", ut.throttleRaf( innerView.onScroll ) );\n\n\t\t// Drag-scroll work natively on touch, in order to get silky inertial scrolling.\n\t\t// Thus no need to bind a touchstart handler.\n\t\tinnerViewEl.addEventListener( \"mousedown\", innerView.onPointerDown );\n\n\t};\n\n\tlet hideSplash = function( e ) {\n\t\tif ( e ) { e.preventDefault(); }\n\t\tclearTimeout( splashTimeout );\n\t\tsplashEl.removeEventListener( \"touchstart\", hideSplash );\n\t\tsplashEl.removeEventListener( \"click\", hideSplash );\n\t\tsplashEl.parentNode.removeChild( splashEl );\n\t\tloadInitialCanvas();\n\t};\n\n\tlet onPageLoad = function() {\n\n\t\t// Init: Read the rateInput value off of the slider.\n\t\t// Preserves slider state across cached page reload.\n\t\tplayer.setSpeed( undefined, playerSpeedInputEl.value );\n\n\t\t// Get scrollbar size and zoom padding dims and set in state.\n\t\t// This must come before the innerView calcs.\n\t\tderiveViewportDependentConstants();\n\t\twriteScrollbarDependentRules();\n\n\t\t// Sets the state.innerView.visibleWidth based on viewport and scrollbar thickness.\n\t\tinnerView.getVisibleDimensions();\n\n\t\t// Width and visibleWidth states will initially be equal.\n\t\tstate.innerView.width = state.innerView.visibleWidth;\n\t\tstate.innerView.height = state.innerView.visibleHeight;\n\n\t\t// Needed for resize handle hover areas to be placed correctly.\n\t\tpatternPanel.recordComputedStyle();\n\n\t\tif ( browser.cutsMustard ) {\n\t\t\tif ( w.location.hash ) {\n\t\t\t\thideSplash(); // Go directly when a hash is being shared.\n\t\t\t} else {\n\t\t\t\tsplashTimeout = w.setTimeout( hideSplash, 2500 );\n\n\t\t\t\t// For the impatient, allow clicking past the initial splash screen.\n\t\t\t\tsplashEl.addEventListener( \"touchstart\", hideSplash );\n\t\t\t\tsplashEl.addEventListener( \"click\", hideSplash );\n\t\t\t}\n\t\t}\n\n\t\tw.removeEventListener( \"load\", onPageLoad );\n\t};\n\n\tif ( doc.readyState === \"complete\" ) {\n\t\tonPageLoad();\n\t} else {\n\t\tw.addEventListener( \"load\", onPageLoad );\n\t}\n}() );\n\n//*******************************************\n//*******\n//******* ---- Expose on the window for Testing ----\n//*******\n//*******************************************\n\n// Uglify should automatically rip the block below out for production builds.\n// http://philipwalton.com/articles/how-to-unit-test-private-functions-in-javascript/\n// https://github.com/petehunt/webpack-howto\n// Note that this line will throw a \"condition always true\" warning in webpack dev builds.\nif ( __DEV__ ) {\n\tw.Flingable = function() { return Flingable; };\n\tw.Resizable = function() { return Resizable; };\n\tw.ut = function() { return ut; };\n\tw.Modal = function() { return Modal; };\n\tw.modalCanvasSize = function() { return modalCanvasSize; };\n\tw.modalOpenPattern = function() { return modalOpenPattern; };\n\tw.modalSavePattern = function() { return modalSavePattern; };\n\tw.modalSharePattern = function() { return modalSharePattern; };\n\tw.parseRLEPixelString = function() { return parseRLEPixelString; };\n\tw.parseBMP = function() { return parseBMP; };\n\tw.patToRleFileString = function() { return patToRleFileString; };\n\tw.dataArrayToRLE = function() { return dataArrayToRLE; };\n\tw.saveTextAsFile = function() { return saveTextAsFile; };\n\n\tw.state = function() { return state; };\n\tw.innerView = function() { return innerView; };\n\tw.canvas = function() { return canvas; };\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/app.js\n **/","// Flingable\ndefine( function() {\n\nreturn {\n\n\tinitFlingable: function( elem, opts ) {\n\t\tthis.element = elem;\n\t\tthis.background = document.querySelector( \".outer-background\" );\n\t\tthis.flingCoast = false; // Default\n\t\tif ( opts ) {\n\t\t\tthis.flingCoast = !!opts.coast;\n\t\t\tif ( opts.flingFriction ) {\n\t\t\t\tthis.flingFriction = opts.flingFriction;\n\t\t\t}\n\t\t\tif ( opts.flingHandleEl ) {\n\t\t\t\tthis.flingHandleEl = opts.flingHandleEl;\n\t\t\t}\n\t\t\tif ( opts.flingContainer ) {\n\t\t\t\tthis.flingContainer = Object.create( null );\n\t\t\t\tthis.flingContainer.element = opts.flingContainer;\n\t\t\t\tthis.flingContainer.css = Object.create( null );\n\t\t\t}\n\t\t}\n\n\t\t// Initial properties specific to the instance.\n\t\tif ( !this.css ) {\n\t\t\tthis.css = Object.create( null );\n\t\t}\n\t\tthis.isFlingDragging = false;\n\t\tthis.isFlingMoving = false;\n\t\tthis.flingDragPositionX = 0;\n\t\tthis.flingDragPositionY = 0;\n\n\t\tthis.flingPositionX = 0;\n\t\tthis.flingPositionY = 0;\n\t\tthis.flingVelocityX = 0;\n\t\tthis.flingVelocityY = 0;\n\t\tthis.flingAccelX = 0;\n\t\tthis.flingAccelY = 0;\n\n\t\t// Create bound local reference for all the prototype handler methods  :/\n\t\tthis.flingMouseDown = this.flingMouseDown.bind( this );\n\t\tthis.flingMouseMove = this.flingMouseMove.bind( this );\n\t\tthis.flingMouseUp = this.flingMouseUp.bind( this );\n\n\t\tvar elemToListenOn = this.element;\n\t\tif ( this.flingHandleEl ) {\n\t\t\telemToListenOn = this.flingHandleEl;\n\t\t}\n\n\t\telemToListenOn.addEventListener( \"mousedown\", this.flingMouseDown );\n\n\t\treturn this; // Make chainable.\n\t},\n\n\t// On the prototype, figure out if unprefixed 2D Transforms are supported.\n\t// If not, check for prefix support.\n\ttransformProp: ( function( w ) {\n\t\tvar htmlElStyle = w.getComputedStyle( document.documentElement );\n\t\tvar prefixArr = [ \"webkit\", \"ms\" ];\n\t\tvar prefixProp;\n\t\tif ( \"transform\" in htmlElStyle ) {\n\t\t\treturn \"transform\";\n\t\t}\n\t\tfor ( var i = 0; i < 2; i += 1 ) {\n\t\t\tprefixProp = prefixArr[ i ] + \"Transform\";\n\t\t\tif ( prefixProp in htmlElStyle ) {\n\t\t\t\treturn \"-\" + prefixArr[ i ] + \"-transform\";\n\t\t\t}\n\t\t}\n\t}( window ) ),\n\n\tflingMouseDown: function( event ) {\n\t\tevent.preventDefault();\n\n\t\t// Don't fling if this is a resize.\n\t\tif ( this.rzblHoveringEdge ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.element.classList.add( \"panel--is-flinging\" );\n\t\tthis.background.classList.add( \"panel--is-flinging\" );\n\n\t\t// Container may have changed dimensions since init, e.g. viewport resize.\n\t\tthis.measureContainers();\n\n\t\t// Get drag start positions.\n\t\tthis.flingPageStartX = event.pageX;\n\t\tthis.flingPageStartY = event.pageY;\n\n\t\t// The flingDragPosition may reflect the last mouseup position,\n\t\t// not the final resting place, and thus needs to be updated.\n\t\tthis.flingItemBeginX = this.flingDragPositionX = this.flingPositionX;\n\t\tthis.flingItemBeginY = this.flingDragPositionY = this.flingPositionY;\n\n\t\tthis.isFlingDragging = this.isFlingMoving = true;\n\n\t\t// Start a rAF animation loop\n\t\tthis.flingAnimate();\n\n\t\t// Catch all mouse activity, even outside the browser viewport.\n\t\twindow.addEventListener( \"mousemove\", this.flingMouseMove );\n\t\twindow.addEventListener( \"mouseup\", this.flingMouseUp );\n\t},\n\n\tflingMouseMove: function( event ) {\n\n\t\t// Mousemove updates the flingDragPosition, which is one event ahead of the\n\t\t// flingPosition. The difference between the two is what generates the\n\t\t// velocity calculations around line 263. The velocity, adjusted for drag,\n\t\t// is then applied to the flingPosition, which is what is rendered out.\n\t\tvar moveX = event.pageX - this.flingPageStartX;\n\t\tvar moveY = event.pageY - this.flingPageStartY;\n\n\t\tthis.flingDragPositionX = this.flingItemBeginX + moveX;\n\t\tthis.flingDragPositionY = this.flingItemBeginY + moveY;\n\t},\n\n\tflingMouseUp: function() {\n\t\tthis.isFlingDragging = false;\n\n\t\tif ( !this.flingCoast ) {\n\t\t\tthis.isFlingMoving = false; // Stop the animation.\n\t\t\tthis.flingVelocityX = this.flingVelocityY = 0;\n\t\t}\n\n\t\tthis.element.classList.remove( \"panel--is-flinging\" );\n\t\tthis.background.classList.remove( \"panel--is-flinging\" );\n\n\t\twindow.removeEventListener( \"mousemove\", this.flingMouseMove );\n\t\twindow.removeEventListener( \"mouseup\", this.flingMouseUp );\n\t},\n\n\tflingAnimate: function() {\n\n\t\tvar that = this;\n\t\tif ( !this.isFlingMoving || ( !this.isFlingDragging && !this.flingCoast ) ) {\n\n\t\t\t// Animation is over, update the final boundingRect.\n\t\t\tthis.css.boundRect = this.element.getBoundingClientRect();\n\t\t\treturn;\n\t\t}\n\t\tthis.applyDragForce();\n\n\t\t// Containment option.\n\t\tif ( this.flingContainer ) {\n\t\t\tthis.flingPositionX = this.containFling( \"x\", this.flingPositionX );\n\t\t\tthis.flingPositionY = this.containFling( \"y\", this.flingPositionY );\n\t\t}\n\n\t\tthis.renderFling();\n\n\t\trequestAnimationFrame( function() {\n\t\t\tthat.flingAnimate();\n\t\t} );\n\t},\n\n\trenderFling: function() {\n\n\t\t// Round the final translation numbers to three decimal places when it stops.\n\t\tthis.flingPositionX = Math.round( this.flingPositionX * 1000 ) / 1000;\n\t\tthis.flingPositionY = Math.round( this.flingPositionY * 1000 ) / 1000;\n\n\t\tvar str = \"translate(\" + this.flingPositionX + \"px, \" +\n\t\t                         this.flingPositionY + \"px)\";\n\t\tif ( this.scale ) {\n\t\t\tstr += \" scale(\" + this.scale + \")\";\n\t\t}\n\t\tthis.element.style[ this.transformProp ] = str;\n\n\t\t// Store the properties\n\t\tthis.css.translateX = this.flingPositionX;\n\t\tthis.css.translateY = this.flingPositionY;\n\t},\n\n\tflingFriction: 0.93,\n\n\tapplyDragForce: function() {\n\t\tif ( this.isFlingDragging ) {\n\n\t\t\t// Change the position to drag position by applying force to acceleration\n\t\t\tvar flingVelocityX = this.flingDragPositionX - this.flingPositionX;\n\t\t\tvar flingForceX = flingVelocityX - this.flingVelocityX;\n\n\t\t\tvar flingVelocityY = this.flingDragPositionY - this.flingPositionY;\n\t\t\tvar flingForceY = flingVelocityY - this.flingVelocityY;\n\n\t\t\tthis.flingAccelX += flingForceX;\n\t\t\tthis.flingAccelY += flingForceY;\n\t\t}\n\n\t\tthis.flingVelocityX += this.flingAccelX;\n\t\tthis.flingVelocityX *= this.flingFriction;\n\t\tthis.flingPositionX += this.flingVelocityX;\n\n\t\tthis.flingVelocityY += this.flingAccelY;\n\t\tthis.flingVelocityY *= this.flingFriction;\n\t\tthis.flingPositionY += this.flingVelocityY;\n\n\t\t// If the last update was miniscule, set isMoving to break the rAF loop.\n\t\tif ( Math.abs( this.flingVelocityX ) < 0.001 &&\n\t\t     Math.abs( this.flingVelocityY ) < 0.001 &&\n\t\t    !this.isFlingDragging ) {\n\t\t\tthis.isFlingMoving = false;\n\t\t}\n\n\t\tthis.flingAccelX = 0;\n\t\tthis.flingAccelY = 0;\n\t},\n\n\tmeasureContainers: function() {\n\t\tthis.css.boundRect = this.element.getBoundingClientRect();\n\n\t\t// Note: getBoundingClientRect is with transforms applied.\n\t\t// offset positions are without transforms applied.\n\t\tthis.css.offsetTop = this.element.offsetTop;\n\t\tthis.css.offsetLeft = this.element.offsetLeft;\n\n\t\tif ( this.flingContainer && this.flingContainer.element ) {\n\t\t\tthis.flingContainer.css.boundRect = this.flingContainer.element.getBoundingClientRect();\n\t\t}\n\t},\n\n\t// Axis is 'x' or 'y' string, drag is numeric value\n\tcontainFling: function( axis, drag ) {\n\t\tlet span = axis === \"x\" ? \"width\" : \"height\";\n\t\tlet offsetDirection = axis === \"x\" ? \"Left\" : \"Top\";\n\n\t\tlet min = -1 * this.css[ \"offset\" + offsetDirection ];\n\t\tlet max = this.flingContainer.css.boundRect[ span ] - this.css.boundRect[ span ] + min;\n\n\t\treturn Math.min( max, Math.max( min, drag ) );\n\t}\n};\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/Flingable.js\n **/","define( [ \"Utility\" ], function( ut ) {\n\n\treturn {\n\n\t\tinitResizable: function( elem, opts ) {\n\t\t\tlet that = this;\n\t\t\tthis.element = elem;\n\n\t\t\t// Copy options onto the local object\n\t\t\tif ( opts ) {\n\t\t\t\tfor ( let opt in opts ) {\n\n\t\t\t\t\tif ( opts.hasOwnProperty( opt ) ) {\n\t\t\t\t\t\tthis[ opt ] = opts[ opt ];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Check first, might be inheriting.\n\t\t\tif ( !this.css ) {\n\t\t\t\tthis.css = Object.create( null );\n\t\t\t}\n\n\t\t\t// Initial properties specific to the object.\n\t\t\tthis.isResizing = false;\n\t\t\tthis.rzblOnTopEdge = false;\n\t\t\tthis.rzblOnRightEdge = false;\n\t\t\tthis.rzblOnBottomEdge = false;\n\t\t\tthis.rzblOnLeftEdge = false;\n\t\t\tthis.rzblDragStartX = 0;\n\t\t\tthis.rzblDragStartY = 0;\n\n\t\t\tthis.rzblCalcEdges = this.rzblCalcEdges.bind( this );\n\n\t\t\tthis.recordComputedStyle = this.recordComputedStyle.bind( this );\n\t\t\tthis.rzblMouseDown = this.rzblMouseDown.bind( this );\n\t\t\tthis.rzblMouseMove = this.rzblMouseMove.bind( this );\n\t\t\tthis.rzblMouseUp = this.rzblMouseUp.bind( this );\n\n\t\t\t// Must wait for load/layout to internally record the resolved values of CSS\n\t\t\t// properties. This must happen after the scrollbar width is calculated.\n\t\t\tlet recordComputedStyleOnLoad = function() {\n\t\t\t\tthat.recordComputedStyle();\n\t\t\t\twindow.removeEventListener( \"load\", recordComputedStyleOnLoad, true );\n\t\t\t};\n\n\t\t\tif ( document.readyState === \"complete\" ) {\n\t\t\t\trecordComputedStyleOnLoad();\n\t\t\t} else {\n\t\t\t\twindow.addEventListener( \"load\", recordComputedStyleOnLoad, true );\n\t\t\t}\n\n\t\t\twindow.addEventListener( \"resize\", ut.debounce( this.recordComputedStyle, 80 ), true );\n\t\t\twindow.addEventListener( \"mousemove\", this.rzblMouseMove, true );\n\t\t\twindow.addEventListener( \"mousedown\", this.rzblMouseDown, true );\n\n\t\t\treturn this; // Chainability\n\t\t},\n\n\t\trecordComputedStyle: function() {\n\t\t\tlet computedStyle = window.getComputedStyle( this.element );\n\t\t\tthis.css.boundRect = this.element.getBoundingClientRect();\n\t\t\tthis.css.top = ut.stripPixelUnits( computedStyle.top );\n\t\t\tthis.css.right = ut.stripPixelUnits( computedStyle.right );\n\t\t\tthis.css.bottom = ut.stripPixelUnits( computedStyle.bottom );\n\t\t\tthis.css.left = ut.stripPixelUnits( computedStyle.left );\n\t\t},\n\n\t\t// Default settings live on the prototype.\n\t\trzblTop: true,\n\t\trzblRight: true,\n\t\trzblBottom: true,\n\t\trzblLeft: true,\n\t\trzblHorizontalCssProp: \"left\",\n\t\trzblVerticalCssProp: \"top\",\n\t\trzblMinHeight: 100,\n\t\trzblMinWidth: 100,\n\t\trzblTolerance: 4,\n\n\t\t// Meaure cursor's proximity to the edges of the box.\n\t\t// Returns one of the following: \"top\" \"right\" \"left\" \"bottom\" or false\n\t\trzblCalcEdges: function( e ) {\n\t\t\tif ( !this.css.boundRect ) {\n\t\t\t\treturn; // Layout hasn't happened yet, get out.\n\t\t\t}\n\t\t\tlet boundTop = this.css.boundRect.top;\n\t\t\tlet boundRight = this.css.boundRect.right;\n\t\t\tlet boundBottom = this.css.boundRect.bottom;\n\t\t\tlet boundLeft = this.css.boundRect.left;\n\t\t\tlet clientX = e.clientX;\n\t\t\tlet clientY = e.clientY;\n\t\t\tlet tol = this.rzblTolerance;\n\t\t\tlet hoveredEdge = false;\n\n\t\t\tlet withinElementX = ( boundLeft <= clientX ) &&\n\t\t\t                     ( clientX <= boundRight );\n\t\t\tlet withinElementY = ( boundTop <= clientY ) &&\n\t\t\t                     ( clientY <= boundBottom );\n\n\t\t\tlet nearTopLine = Math.abs( clientY - boundTop ) <= tol;\n\t\t\tlet nearRightLine = Math.abs( clientX - boundRight ) <= tol;\n\t\t\tlet nearBottomLine = Math.abs( clientY - boundBottom ) <= tol;\n\t\t\tlet nearLeftLine = Math.abs( clientX - boundLeft ) <= tol;\n\n\t\t\tif ( nearTopLine && withinElementX && this.rzblTop ) {\n\t\t\t\thoveredEdge = \"top\";\n\t\t\t} else if ( nearRightLine && withinElementY && this.rzblRight ) {\n\t\t\t\thoveredEdge = \"right\";\n\t\t\t} else if ( nearBottomLine && withinElementX && this.rzblBottom ) {\n\t\t\t\thoveredEdge = \"bottom\";\n\t\t\t} else if ( nearLeftLine && withinElementY && this.rzblLeft ) {\n\t\t\t\thoveredEdge = \"left\";\n\t\t\t}\n\n\t\t\t// Will be false when mouse leaves edge zone.\n\t\t\t// Assign at the top so canvas drawing can check.\n\t\t\t// Don't yet assign to the local object.\n\t\t\t// this.rzblHoveredEdge = isHoveringEdge;\n\t\t\tif ( typeof this.rzblIsHovering === \"function\" ) {\n\t\t\t\tthis.rzblIsHovering( hoveredEdge );\n\t\t\t}\n\t\t\tif ( hoveredEdge ) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t\treturn hoveredEdge;\n\t\t},\n\n\t\trzblApplyCursorClass: function() {\n\t\t\tconst bodyEl = document.body;\n\t\t\tconst outerBgEl = document.querySelector( \".outer-background\" );\n\t\t\tconst panelEl = this.element;\n\n\t\t\tif ( this.rzblHoveredEdge === \"top\" || this.rzblHoveredEdge === \"bottom\" ) {\n\t\t\t\tif ( this.cursor !== \"ns\" ) {\n\t\t\t\t\tthis.cursor = \"ns\";\n\t\t\t\t\tbodyEl.classList.add( \"ns-resize-cursor\" );\n\t\t\t\t\touterBgEl.classList.add( \"ns-resize-cursor\" );\n\t\t\t\t\tpanelEl.classList.add( \"ns-resize-cursor\" );\n\t\t\t\t}\n\n\t\t\t} else if ( this.rzblHoveredEdge === \"right\" || this.rzblHoveredEdge === \"left\" ) {\n\t\t\t\tif ( this.cursor !== \"ew\" ) {\n\t\t\t\t\tthis.cursor = \"ew\";\n\t\t\t\t\tbodyEl.classList.add( \"ew-resize-cursor\" );\n\t\t\t\t\touterBgEl.classList.add( \"ew-resize-cursor\" );\n\t\t\t\t\tpanelEl.classList.add( \"ew-resize-cursor\" );\n\t\t\t\t}\n\n\t\t\t} else if ( !this.isResizing ) {\n\t\t\t\tif ( this.cursor ) {\n\t\t\t\t\tthis.cursor = \"\";\n\t\t\t\t\tbodyEl.classList.remove( \"ns-resize-cursor\", \"ew-resize-cursor\" );\n\t\t\t\t\touterBgEl.classList.remove( \"ns-resize-cursor\", \"ew-resize-cursor\" );\n\t\t\t\t\tpanelEl.classList.remove( \"ns-resize-cursor\", \"ew-resize-cursor\" );\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\trzblMouseDown: function( e ) {\n\t\t\tlet abort = false;\n\t\t\tif ( this.rzblAbortResize ) {\n\t\t\t\tabort = this.rzblAbortResize();\n\t\t\t}\n\n\t\t\tif ( !this.rzblHoveredEdge || abort ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.stopPropagation();\n\n\t\t\tthis.rzblEdgeClicked = this.rzblHoveredEdge; // E.g. \"left\"\n\n\t\t\t// Allows the resize animation to loop, also checked by canvas paint/erase.\n\t\t\t// A single property for all panels?\n\t\t\tthis.isResizing = true;\n\t\t\tif ( this.reportResizing ) {\n\t\t\t\tthis.reportResizing( true );\n\t\t\t}\n\n\t\t\tthis.recordComputedStyle();\n\n\t\t\tthis.rzblDragStartX = e.clientX;\n\t\t\tthis.rzblDragStartY = e.clientY;\n\t\t\tthis.rzblMoveX = 0;\n\t\t\tthis.rzblMoveY = 0;\n\n\t\t\t// These values can be either right or left, top or bottom CSS.\n\t\t\tthis.flingItemBeginX = this.css[ this.rzblHorizontalCssProp ];\n\t\t\tthis.flingItemBeginY = this.css[ this.rzblVerticalCssProp ];\n\n\t\t\t// Start a rAF animation loop\n\t\t\tthis.rzblAnimate();\n\n\t\t\twindow.addEventListener( \"mouseup\", this.rzblMouseUp, true );\n\t\t},\n\n\t\trzblMouseMove: function( e ) {\n\t\t\tlet currentHoveredEdge = this.rzblHoveredEdge;\n\t\t\tlet newHoveredEdge = this.rzblCalcEdges( e );\n\n\t\t\tif ( this.isResizing ) {\n\n\t\t\t\t// Set the \"move\" properties, which will get\n\t\t\t\t// picked up in the animation loop.\n\t\t\t\tif ( this.rzblEdgeClicked === \"top\" || this.rzblEdgeClicked === \"bottom\" ) {\n\t\t\t\t\tthis.rzblMoveY = e.pageY - this.rzblDragStartY;\n\t\t\t\t} else if ( this.rzblEdgeClicked === \"right\" || this.rzblEdgeClicked === \"left\" ) {\n\t\t\t\t\tthis.rzblMoveX = e.pageX - this.rzblDragStartX;\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// Modify the cursors on hover/hoverend, but only if we're not already\n\t\t\t\t// resizing.\n\t\t\t\tthis.rzblHoveredEdge = newHoveredEdge;\n\n\t\t\t\t// If already painting near the panel edge, don't apply the resize cursor class.\n\t\t\t\tif ( this.rzblAbortResize && this.rzblAbortResize() ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Don't touch the DOM if there hasn't been a change.\n\t\t\t\tif ( newHoveredEdge !== currentHoveredEdge ) {\n\t\t\t\t\tthis.rzblApplyCursorClass();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\trzblMouseUp: function( e ) {\n\n\t\t\t// Breaks the resize animation loop, also checked by canvas paint/erase\n\t\t\tthis.isResizing = false;\n\t\t\tif ( this.reportResizing ) {\n\t\t\t\tthis.reportResizing( false );\n\t\t\t}\n\n\t\t\t// Flushing these seems to reduce glitching\n\t\t\tthis.rzblEdgeClicked = undefined;\n\n\t\t\t// Mouseups can always propagate.\n\t\t\twindow.removeEventListener( \"mouseup\", this.rzblMouseUp, true );\n\t\t},\n\n\t\trzblAnimate: function() {\n\t\t\tlet that = this;\n\t\t\tif ( !this.isResizing ) {\n\n\t\t\t\t// Animation is over. Update the box after resize complete\n\t\t\t\tthis.css.boundRect = this.element.getBoundingClientRect();\n\t\t\t\treturn; // Get out when mouseup breaks the animation loop.\n\t\t\t}\n\t\t\tthis.rzblRender();\n\t\t  requestAnimationFrame( function() {\n\t\t\t\tthat.rzblAnimate();\n\t\t\t} );\n\t\t},\n\n\t// ========= RENDER =========================\n\t//\n\t//  Drag       |  CSS       |  Render\n\t//  From       |  pos prop  |  Outcome\n\t// ------------------------------------------\n\t//  left       |  left      | + left\n\t//             |            | - width\n\t// ------------------------------------------\n\t//  left       |  right     | - width\n\t//             |            |\n\t// ------------------------------------------\n\t//  right      |  right     | - right\n\t//             |            | + width\n\t// ------------------------------------------\n\t//  right      |  left      | + width\n\t//             |            |\n\t// ------------------------------------------\n\t//  top        |  top       | + top\n\t//             |            | - height\n\t// ------------------------------------------\n\t//  top        |  bottom    | - height\n\t//             |            |\n\t// ------------------------------------------\n\t//  bottom     |  bottom    | - bottom\n\t//             |            | + height\n\t// ------------------------------------------\n\t//  bottom     |  top       | + height\n\t//             |            |\n\t// ------------------------------------------\n\n\t\trzblRender: function() {\n\t\t\tif ( this.rzblEdgeClicked === \"left\" ) {\n\t\t\t\tif ( this.rzblHorizontalCssProp === \"left\" ) {\n\t\t\t\t\tthis.css.left = this.flingItemBeginX + this.rzblMoveX;\n\t\t\t\t\tthis.element.style.left = this.css.left + \"px\";\n\t\t\t\t}\n\t\t\t\tthis.element.style.width = this.css.boundRect.width - this.rzblMoveX + \"px\";\n\n\t\t\t} else if ( this.rzblEdgeClicked === \"right\" ) {\n\t\t\t\tif ( this.rzblHorizontalCssProp === \"right\" ) {\n\t\t\t\t\tthis.css.right = this.flingItemBeginX - this.rzblMoveX;\n\t\t\t\t\tthis.element.style.right = this.css.right + \"px\";\n\t\t\t\t}\n\t\t\t\tthis.element.style.width = this.css.boundRect.width + this.rzblMoveX + \"px\";\n\n\t\t\t} else if ( this.rzblEdgeClicked === \"top\" ) {\n\t\t\t\tif ( this.rzblVerticalCssProp === \"top\" ) {\n\t\t\t\t\tthis.css.top = this.flingItemBeginY + this.rzblMoveY;\n\t\t\t\t\tthis.element.style.top = this.css.top + \"px\";\n\t\t\t\t}\n\t\t\t\tthis.element.style.height = this.css.boundRect.height - this.rzblMoveY + \"px\";\n\n\t\t\t} else if ( this.rzblEdgeClicked === \"bottom\" ) {\n\t\t\t\tif ( this.rzblVerticalCssProp === \"bottom\" ) {\n\t\t\t\t\tthis.css.bottom = this.css.bottom - this.rzblMoveY;\n\t\t\t\t\tthis.element.style.bottom = this.css.bottom + \"px\";\n\t\t\t\t}\n\t\t\t\tthis.element.style.height = this.css.boundRect.height + this.rzblMoveY + \"px\";\n\t\t\t}\n\t\t}\n\t};\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/Resizable.js\n **/","define( function() {\n\n\t// Currently needed just for Intern to allow block-scoping. Possibly delete in build?\n\t\"use strict\";\n\n\treturn {\n\n\t\t// http://www.jacklmoore.com/notes/rounding-in-javascript/\n\t\tround: function( value, decimalPlaces ) {\n\t\t\treturn Number( Math.round( value + \"e\" + decimalPlaces ) + \"e-\" + decimalPlaces );\n\t\t},\n\n\t\t// Http://modernjavascript.blogspot.com/2013/08/building-better-debounce.html\n\t\tdebounce: function( func, wait ) {\n\n\t\t\t// We need to save these in the closure\n\t\t\tlet timeout, args, context, timestamp;\n\n\t\t\treturn function() {\n\n\t\t\t\t// Save details of latest call\n\t\t\t\tcontext = this;\n\t\t\t\targs = [].slice.call( arguments, 0 );\n\t\t\t\ttimestamp = new Date();\n\n\t\t\t\t// This is where the magic happens\n\t\t\t\tlet later = function() {\n\n\t\t\t\t\t// How long ago was the last call\n\t\t\t\t\tlet last = ( new Date() ) - timestamp;\n\n\t\t\t\t\t// If the latest call was less that the wait period ago\n\t\t\t\t\t// then we reset the timeout to wait for the difference\n\t\t\t\t\tif ( last < wait ) {\n\t\t\t\t\t\ttimeout = setTimeout( later, wait - last );\n\n\t\t\t\t\t// Or if not we can null out the timer and run the latest\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttimeout = null;\n\t\t\t\t\t\tfunc.apply( context, args );\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\t// We only need to set the timer now if one isn't already running\n\t\t\t\tif ( !timeout ) {\n\t\t\t\t\ttimeout = setTimeout( later, wait );\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\tthrottleRaf: function( func ) {\n\t\t\tlet args, context, ticking;\n\n\t\t\treturn function() {\n\n\t\t\t\t// Save details of latest call, e.g. event properties.\n\t\t\t\tcontext = this;\n\t\t\t\targs = [].slice.call( arguments, 0 );\n\n\t\t\t\tlet later = function() {\n\t\t\t\t\tfunc.apply( context, args );\n\t\t\t\t\tticking = false;\n\t\t\t\t};\n\n\t\t\t\tif ( !ticking ) {\n\t\t\t\t\trequestAnimationFrame( later );\n\t\t\t\t\tticking = true;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// Get closest DOM element up the tree that contains a class, ID, or data attribute\n\t\t// @param  {Node} elem The base element\n\t\t// @param  {String} selector The class, id, data attribute, or tag to look for\n\t\t// @return {Node} Null if no match\n\t\t// http://gomakethings.com/climbing-up-and-down-the-dom-tree-with-vanilla-javascript/\n\t\tgetClosest: function( elem, selector ) {\n\t\t\tlet firstChar = selector.charAt( 0 );\n\n\t\t\t// Get closest match\n\t\t\tfor ( ; elem && elem !== document; elem = elem.parentNode ) {\n\n\t\t\t\t// If selector is a class\n\t\t\t\tif ( firstChar === \".\" ) {\n\t\t\t\t\tif ( elem.classList.contains( selector.substr( 1 ) ) ) {\n\t\t\t\t\t\treturn elem;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If selector is an ID\n\t\t\t\tif ( firstChar === \"#\" ) {\n\t\t\t\t\tif ( elem.id === selector.substr( 1 ) ) {\n\t\t\t\t\t\treturn elem;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If selector is a data attribute\n\t\t\t\tif ( firstChar === \"[\" ) {\n\t\t\t\t\tif ( elem.hasAttribute( selector.substr( 1, selector.length - 2 ) ) ) {\n\t\t\t\t\t\treturn elem;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If selector is a tag\n\t\t\t\tif ( elem.tagName.toLowerCase() === selector ) {\n\t\t\t\t\treturn elem;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\textend: function() {\n\t\t\tfor ( let i = 1; i < arguments.length; i += 1 ) {\n\t\t\t\tfor ( let key in arguments[ i ] ) {\n\t\t\t\t\tif ( arguments[ i ].hasOwnProperty( key ) ) {\n\t\t\t\t\t\targuments[ 0 ][ key ] = arguments[ i ][ key ];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn arguments[ 0 ];\n\t\t},\n\n\t\tisDigit: function( n ) {\n\t\t\treturn Boolean( [ true, true, true, true, true, true, true, true, true, true ][ n ] );\n\t\t},\n\n\t\tisNonNegativeInteger: function( val ) {\n\t\t  return Number.isFinite( val ) && val % 1 === 0 && val >= 0;\n\t\t},\n\n\t\tstripPixelUnits: function( str ) {\n\t\t\tlet ret = str.replace( /px$/i, \"\" );\n\n\t\t\t// Avoid converting \"auto\" to NaN, but still coerce \"6px\" to the number 6.\n\t\t\tif ( this.isDigit( str[ 0 ] ) ) {\n\t\t\t\tret = parseFloat( ret );\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\n\t\t// @param  {object}\n\t\t// @return {string}\n\t\tserializeToQueryString: function( obj ) {\n\t\t\tlet ret = \"\";\n\t\t\tfor ( let prop in obj ) {\n\t\t\t\tret += prop + \"=\"  + obj[ prop ] + \"&\";\n\t\t\t}\n\t\t\tif ( ret ) {\n\t\t\t\tret = ret.slice( 0, -1 ); // Remove final trailing ampersand.\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\n\t\tdeserializeQueryString: function( str ) {\n\t\t\tvar ret = Object.create( null );\n\t\t\tif ( str.indexOf( \"?\" ) > -1 ) {\n\t\t\t\tstr = str.split( \"?\" )[ 1 ];\n\t\t\t}\n\t\t\tvar pairs = str.split( \"&\" );\n\t\t\tpairs.forEach( function( pair ) {\n\t\t\t\tpair = pair.split( \"=\" );\n\t\t\t\tret[ pair[ 0 ] ] = decodeURIComponent( pair[ 1 ] || \"\" );\n\t\t\t} );\n\t\t\treturn ret;\n\t\t},\n\n\t\tselectContents: function( el ) {\n\n\t\t\t// FF doesn\"t support select() method.\n\t\t\t// Webkit throws InvalidStateError on setSelectionRange on an input type=number.\n\t\t\t// https://code.google.com/p/chromium/issues/detail?id=346270\n\t\t\ttry {\n\t\t\t\tel.focus();\n\t\t\t\tel.setSelectionRange( 0, 9999 );\n\t\t\t} catch ( e ) {\n\t\t\t\tel.select();\n\t\t\t}\n\t\t\treturn el;\n\t\t},\n\n\t\tcopyTextToClipBoard: function( text ) {\n\t\t\tlet input = document.createElement( \"textarea\" );\n\t\t\tdocument.body.appendChild( input );\n\t\t\tinput.value = text;\n\t\t\tthis.selectContents( input );\n\t\t\tdocument.execCommand( \"Copy\" );\n\t\t\tdocument.body.removeChild( input );\n\t\t\treturn text;\n\t\t}\n\t};\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/Utility.js\n **/","//Modal\ndefine( function() {\n\n\t// Opening modal changes keymaster \"scope\"\n\tlet key = require( \"keymaster\" );\n\n\t// To be customized per unique modal object:\n\t// this.innerMarkup   html to insert\n\t// this.modalInternalBinding   listeners other than ok/cancel\n\t// this.modalInternalUnbinding  remove listeners other than ok/cancel\n\t// this.modalValidate  optional check on click of OK. returns a Boolean.\n\t// this.modalSubmit   function to run 'ok' click if valid.\n\n\treturn {\n\n\t\tmodalWrapperElement: document.querySelector( \".modal-wrapper\" ),\n\n\t\tmodalTitleEl: document.querySelector( \".modal__title\" ),\n\n\t\tmodalContentsEl: document.querySelector( \".modal__contents\" ),\n\n\t\tinit: function( buttonElementToBind ) {\n\t\t\tthis.modalOpenButtonElement = buttonElementToBind;\n\n\t\t\t// Create bound local reference for all the prototype handler methods  :/\n\t\t\tthis.modalOpen = this.modalOpen.bind( this );\n\t\t\tthis.modalClose = this.modalClose.bind( this );\n\t\t\tthis.modalOnOk = this.modalOnOk.bind( this );\n\t\t\tthis.modalOnCancel = this.modalOnCancel.bind( this );\n\n\t\t\t// Assume for now it's always a button that triggers opening the modal.\n\t\t\tthis.modalOpenButtonElement.addEventListener( \"touchstart\", this.modalOpen );\n\t\t\tthis.modalOpenButtonElement.addEventListener( \"click\", this.modalOpen );\n\t\t},\n\n\t\tmodalOpen: function( e ) {\n\n\t\t\tif ( e.type === \"touchstart\" ) { e.preventDefault(); } /* Suppress ghost click. */\n\n\t\t\t// The custom pre-open fn unique to a particular modal.\n\t\t\tif ( typeof this.modalBeforeOpen === \"function\" ) {\n\t\t\t\tthis.modalBeforeOpen();\n\t\t\t}\n\n\t\t\t// Generic to all Modals but set inside the closure.\n\t\t\tif ( typeof this.modalSetOpenState === \"function\" ) {\n\t\t\t\tthis.modalSetOpenState( true );\n\t\t\t}\n\n\t\t\t// Turn off all Keymaster shortcuts applicable in the main view, so that, for example,\n\t\t\t// tabbing works between form fields in a modal.\n\t\t\t// In the \"modal\" scope, \"enter\" clicks the OK button.\n\t\t\tkey.setScope( \"modal\" );\n\n\t\t\t// Show the modal.\n\t\t\tthis.modalWrapperElement.classList.remove( \"modal-wrapper--hide\" );\n\n\t\t\t// Insert the DOM elements\n\t\t\tthis.modalTitleEl.innerHTML = this.titleText;\n\t\t\tthis.modalContentsEl.innerHTML = this.innerMarkup();\n\n\t\t\tthis.modalOkButton = document.querySelector( \"[data-modal-ok]\" );\n\t\t\tthis.modalCancelButton = document.querySelector( \"[data-modal-cancel]\" );\n\n\t\t\tthis.modalOkButton.addEventListener( \"touchstart\", this.modalOnOk );\n\t\t\tthis.modalOkButton.addEventListener( \"click\", this.modalOnOk );\n\n\t\t\t// Not all modals have a cancel button.\n\t\t\tif ( this.modalCancelButton ) {\n\t\t\t\tthis.modalCancelButton.addEventListener( \"touchstart\", this.modalOnCancel );\n\t\t\t\tthis.modalCancelButton.addEventListener( \"click\", this.modalOnCancel );\n\t\t\t}\n\n\t\t\t// The custom post-open fn unique to a particular modal.\n\t\t\tif ( this.modalInternalBinding ) {\n\t\t\t\tthis.modalInternalBinding();\n\t\t\t}\n\t\t},\n\n\t\tshowError: function( errorText ) {\n\t\t\tthis.errorEl.innerHTML = errorText;\n\t\t},\n\n\t\tmodalOnOk: function( e ) {\n\n\t\t\tif ( e.type === \"touchstart\" ) { e.preventDefault(); } /* Suppress ghost click. */\n\n\t\t\t// Revalidate on click of OK.\n\t\t\t// Assume valid because not all modals use validation.\n\t\t\tif ( typeof this.modalValidate === \"function\" ) {\n\t\t\t\tif ( !this.modalValidate() ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Some \"info\" modals (like share) don't do anything on submit.\n\t\t\tif ( typeof this.modalSubmit === \"function\" ) {\n\t\t\t\tthis.modalSubmit();\n\t\t\t}\n\t\t\tthis.modalClose();\n\t\t},\n\n\t\tmodalOnCancel: function( e ) {\n\t\t\tif ( e.type === \"touchstart\" ) { e.preventDefault(); } /* Suppress ghost click. */\n\t\t\tthis.modalClose();\n\t\t},\n\n\t\tmodalClose: function() {\n\t\t\tif ( this.modalInternalUnbinding ) {\n\t\t\t\tthis.modalInternalBinding();\n\t\t\t}\n\n\t\t\t// Unbind confirmation buttons\n\t\t\tthis.modalOkButton.removeEventListener( \"touchstart\", this.modalOnOk );\n\t\t\tthis.modalOkButton.removeEventListener( \"click\", this.modalOnOk );\n\n\t\t\tif ( this.modalCancelButton ) {\n\t\t\t\tthis.modalCancelButton.removeEventListener( \"touchstart\", this.modalOnCancel );\n\t\t\t\tthis.modalCancelButton.removeEventListener( \"click\", this.modalOnCancel );\n\t\t\t}\n\t\t\tthis.modalWrapperElement.classList.add( \"modal-wrapper--hide\" );\n\n\t\t\tkey.setScope( \"main\" );\n\n\t\t\t// Generic to all Modals but set inside the closure.\n\t\t\tif ( typeof this.modalSetOpenState === \"function\" ) {\n\t\t\t\tthis.modalSetOpenState( false );\n\t\t\t}\n\n\t\t\t// The custom post-open fn unique to a particular modal.\n\t\t\tif ( typeof this.modalAfterClose === \"function\" ) {\n\t\t\t\tthis.modalAfterClose();\n\t\t\t}\n\t\t}\n\t};\n\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/Modal.js\n **/","/* Keymaster.js\n   (c) 2011-2013 Thomas Fuchs\n   keymaster.js may be freely distributed under the MIT license. */\n\n;( function( global ) {\n  var k,\n    _handlers = {},\n    _mods = { 16: false, 18: false, 17: false, 91: false },\n    _scope = \"all\",\n\n    // Modifier keys\n    _MODIFIERS = {\n      \"⇧\": 16, shift: 16,\n      \"⌥\": 18, alt: 18, option: 18,\n      \"⌃\": 17, ctrl: 17, control: 17,\n      \"⌘\": 91, command: 91\n    },\n\n    // Special keys\n    _MAP = {\n      backspace: 8, tab: 9, clear: 12,\n      enter: 13, \"return\": 13,\n      esc: 27, escape: 27, space: 32,\n      left: 37, up: 38,\n      right: 39, down: 40,\n      del: 46, \"delete\": 46,\n      home: 36, end: 35,\n      pageup: 33, pagedown: 34,\n      \",\": 188, \".\": 190, \"/\": 191,\n      \"`\": 192, \"-\": 189, \"=\": 187,\n      \";\": 186, \"\\'\": 222,\n      \"[\": 219, \"]\": 221, \"\\\\\": 220\n    },\n    code = function( x ) {\n      return _MAP[ x ] || x.toUpperCase().charCodeAt( 0 );\n    },\n    _downKeys = [];\n\n\tfor ( k = 1; k < 20; k++ ) {\n\t\t_MAP[ \"f\" + k ] = 111 + k;\n\t}\n\n  // IE doesn't support Array#indexOf, so have a simple replacement\n  function index( array, item ) {\n    var i = array.length;\n    while ( i-- ) if ( array[ i ] === item ) { return i; }\n    return -1;\n  }\n\n  // For comparing mods before unassignment\n  function compareArray( a1, a2 ) {\n    if ( a1.length != a2.length ) { return false; }\n    for ( var i = 0; i < a1.length; i++ ) {\n        if ( a1[ i ] !== a2[ i ] ) { return false; }\n    }\n    return true;\n  }\n\n\tvar modifierMap = {\n\t\t16: \"shiftKey\",\n\t\t18: \"altKey\",\n\t\t17: \"ctrlKey\",\n\t\t91: \"metaKey\"\n\t};\n\n\tfunction updateModifierKey( event ) {\n\t\tfor ( k in _mods ) _mods[ k ] = event[ modifierMap[ k ] ];\n\t}\n\n  // Handle keydown event\n  function dispatch( event ) {\n    var key, handler, k, i, modifiersMatch, scope;\n    key = event.keyCode;\n\n    if ( index( _downKeys, key ) == -1 ) {\n        _downKeys.push( key );\n    }\n\n    // If a modifier key, set the key.<modifierkeyname> property to true and return\n    if ( key == 93 || key == 224 ) { key = 91; } /* right command on webkit, command on Gecko */\n    if ( key in _mods ) {\n      _mods[ key ] = true;\n\n      // 'assignKey' from inside this closure is exported to window.key\n      for ( k in _MODIFIERS ) if ( _MODIFIERS[ k ] == key ) { assignKey[ k ] = true; }\n      if ( !( key in _handlers ) ) { /* allow single modifier shortcuts to execute */\n        return;               /* for combinations, return and wait for the second keypress */\n\t\t\t}\n    }\n    updateModifierKey( event );\n\n    // See if we need to ignore the keypress (filter() can can be overridden)\n    // by default ignore key presses if a select, textarea, or input is focused\n    if ( !assignKey.filter.call( this, event ) ) { return; }\n\n    // Abort if no potentially matching shortcuts found\n    if ( !( key in _handlers ) ) { return; }\n\n    scope = getScope();\n\n    // For each potential shortcut\n    for ( i = 0; i < _handlers[ key ].length; i++ ) {\n      handler = _handlers[ key ][ i ];\n\n      // See if it's in the current scope\n      if ( handler.scope == scope || handler.scope == \"all\" ) {\n\n        // Check if modifiers match if any\n        modifiersMatch = handler.mods.length > 0;\n        for ( k in _mods ) {\n          if ( ( !_mods[ k ] && index( handler.mods, +k ) > -1 ) ||\n               ( _mods[ k ] && index( handler.mods, +k ) == -1 ) ) {\n\t            modifiersMatch = false;\n\t        }\n        }\n\n        // Call the handler and stop the event if neccessary\n        if ( ( handler.mods.length === 0 && !_mods[ 16 ] && !_mods[ 18 ] &&\n               !_mods[ 17 ] && !_mods[ 91 ] ) || modifiersMatch ) {\n          if ( handler.method( event, handler ) === false ) {\n            if ( event.preventDefault ) {\n\t            event.preventDefault();\n\t          } else {\n\t\t          event.returnValue = false;\n\t\t        }\n            if ( event.stopPropagation ) { event.stopPropagation(); }\n            if ( event.cancelBubble ) { event.cancelBubble = true; }\n          }\n        }\n      }\n    }\n  }\n\n  // Unset modifier keys on keyup\n  function clearModifier( event ) {\n    var key = event.keyCode, k,\n        i = index( _downKeys, key );\n\n    // Remove key from _downKeys\n    if ( i >= 0 ) {\n        _downKeys.splice( i, 1 );\n    }\n\n    if ( key == 93 || key == 224 ) { key = 91; }\n    if ( key in _mods ) {\n      _mods[ key ] = false;\n      for ( k in _MODIFIERS ) if ( _MODIFIERS[ k ] == key ) { assignKey[ k ] = false; }\n    }\n  }\n\n  function resetModifiers() {\n    for ( k in _mods ) _mods[ k ] = false;\n    for ( k in _MODIFIERS ) assignKey[ k ] = false;\n  }\n\n  // Parse and assign shortcut\n  function assignKey( key, scope, method ) {\n    var keys, mods;\n    keys = getKeys( key );\n    if ( method === undefined ) {\n      method = scope;\n      scope = \"all\";\n    }\n\n    // For each shortcut\n    for ( var i = 0; i < keys.length; i++ ) {\n\n      // Set modifier keys if any\n      mods = [];\n      key = keys[ i ].split( \"+\" );\n\n      // Account for the case where shortcut is a single modifier\n      if ( key in _MODIFIERS ) {\n        key = _MODIFIERS[ key ];\n        mods = [ key ];\n      }\n\n      // All other cases\n      else {\n        if ( key.length > 1 ) {\n          mods = getMods( key );\n          key = [ key[ key.length - 1 ] ];\n        }\n\n        // Convert to keycode and...\n        key = key[ 0 ];\n        key = code( key );\n      }\n\n      // ...Store handler\n      if ( !( key in _handlers ) ) { _handlers[ key ] = []; }\n      _handlers[ key ].push( {\n\t      shortcut: keys[ i ],\n\t      scope: scope,\n\t      method: method,\n\t      key: keys[ i ],\n\t      mods: mods\n\t    } );\n    }\n  }\n\n  // Unbind all handlers for given key in current scope\n  function unbindKey( key, scope ) {\n    var multipleKeys, keys,\n      mods = [],\n      i, j, obj;\n\n    multipleKeys = getKeys( key );\n\n    for ( j = 0; j < multipleKeys.length; j++ ) {\n      keys = multipleKeys[ j ].split( \"+\" );\n\n      // Account for the case where shortcut is a single modifier\n      if ( key in _MODIFIERS ) {\n        key = _MODIFIERS[ key ];\n        mods = [ key ];\n      }\n\n      // All other cases\n      else {\n        if ( keys.length > 1 ) {\n          mods = getMods( keys );\n        }\n\n        key = keys[ keys.length - 1 ];\n        key = code( key );\n      }\n\n      if ( scope === undefined ) {\n        scope = getScope();\n      }\n      if ( !_handlers[ key ] ) {\n        return;\n      }\n      for ( i = 0; i < _handlers[ key ].length; i++ ) {\n        obj = _handlers[ key ][ i ];\n\n        // Only clear handlers if correct scope and mods match\n        if ( obj.scope === scope && compareArray( obj.mods, mods ) ) {\n          _handlers[ key ][ i ] = {};\n        }\n      }\n    }\n  }\n\n  // Returns true if the key with code 'keyCode' is currently down\n  // Converts strings into key codes.\n  function isPressed( keyCode ) {\n      if ( typeof( keyCode ) == \"string\" ) {\n        keyCode = code( keyCode );\n      }\n      return index( _downKeys, keyCode ) != -1;\n  }\n\n  function getPressedKeyCodes() {\n      return _downKeys.slice( 0 );\n  }\n\n  function filter( event ) {\n    var tagName = ( event.target || event.srcElement ).tagName;\n\n    // Ignore keypressed in any elements that support keyboard data input\n    return !( tagName == \"INPUT\" || tagName == \"SELECT\" || tagName == \"TEXTAREA\" );\n  }\n\n  // Initialize key.<modifier> to false\n  for ( k in _MODIFIERS ) assignKey[ k ] = false;\n\n  // Set current scope (default 'all')\n  function setScope( scope ) { _scope = scope || \"all\"; }\n  function getScope() { return _scope || \"all\"; }\n\n  // Delete all handlers for a given scope\n  function deleteScope( scope ) {\n    var key, handlers, i;\n\n    for ( key in _handlers ) {\n      handlers = _handlers[ key ];\n      for ( i = 0; i < handlers.length; ) {\n        if ( handlers[ i ].scope === scope ) {\n\t        handlers.splice( i, 1 );\n\t      } else {\n\t\t      i++;\n\t\t    }\n      }\n    }\n  }\n\n  // Abstract key logic for assign and unassign\n  function getKeys( key ) {\n    var keys;\n    key = key.replace( /\\s/g, \"\" );\n    keys = key.split( \",\" );\n    if ( ( keys[ keys.length - 1 ] ) === \"\" ) {\n      keys[ keys.length - 2 ] += \",\";\n    }\n    return keys;\n  }\n\n  // Abstract mods logic for assign and unassign\n  function getMods( key ) {\n    var mods = key.slice( 0, key.length - 1 );\n    for ( var mi = 0; mi < mods.length; mi++ )\n    mods[ mi ] = _MODIFIERS[ mods[ mi ] ];\n    return mods;\n  }\n\n  // Cross-browser events\n  function addEvent( object, event, method ) {\n    if ( object.addEventListener ) {\n      object.addEventListener( event, method, false );\n    } else if ( object.attachEvent ) {\n      object.attachEvent( \"on\" + event, function() { method( window.event ); } );\n    }\n  }\n\n  // Set the handlers globally on document\n  // Passing _scope to a callback to ensure it remains the same by execution. Fixes #48\n  addEvent( document, \"keydown\", function( event ) { dispatch( event ); } );\n  addEvent( document, \"keyup\", clearModifier );\n\n  // Reset modifiers to false whenever the window is (re)focused.\n  addEvent( window, \"focus\", resetModifiers );\n\n\t// Store previously defined key\n\tvar previousKey;\n\n\t// Restore previously defined key and return reference to our key object\n\tfunction noConflict() {\n\t\tvar k = global.key;\n\t\tglobal.key = previousKey;\n\t\treturn k;\n\t}\n\n\tvar toExport = assignKey;\n\ttoExport.setScope = setScope;\n\ttoExport.getScope = getScope;\n\ttoExport.deleteScope = deleteScope;\n\ttoExport.filter = filter;\n\ttoExport.isPressed = isPressed;\n\ttoExport.getPressedKeyCodes = getPressedKeyCodes;\n\ttoExport.noConflict = noConflict;\n\ttoExport.unbind = unbindKey;\n\n\t// If window is available set window.key and window.key.set/get/deleteScope,\n\t// and the default filter.\n\tif ( global ) {\n\t\tif ( global.key ) {\n\n\t\t\t// Store for possible recovery\n\t\t\tpreviousKey = global.key;\n\t\t}\n\t\tglobal.key = toExport;\n\t}\n\n\t// If requiring as module\n//\tif( typeof module !== \"undefined\" ) {\n//\t\t module.exports = toExport;\n//\t}\n\n\t// Remove from conditional to suppress Uglify warnings.\n\tmodule.exports = toExport;\n\n} )( this );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/keymaster.js\n **/","define( [ \"Modal\" ], function( Modal ) {\n\n\t// To be added & customized for each unique modal objects:\n\t// this.titleText   html to insert in body of modal\n\t// this.innerMarkup   html to insert in body of modal\n\t// this.modalInternalBinding   listeners other than ok/cancel\n\t// this.modalInternalUnbinding  remove listeners other than ok/cancel\n\t// this.modalValidate  optional check on click of OK. returns a Boolean.\n\t// this.modalSubmit   function to run \"ok\" click if valid.\n\n\tlet modalCanvasSize = Object.create( Modal );\n\n\tmodalCanvasSize.titleText = \"Canvas Size\";\n\n\tmodalCanvasSize.innerMarkup = function() {\n\t\treturn `<div class=\"modal__configure\">\n\t\t\t<div class=\"modal__section\">\n\t\t\t\t<div class=\"modal__section-title\">Current Size</div>\n\t\t\t\t<div class=\"modal__prop modal__prop--text-only\">\n\t\t\t\t\t<span class=\"modal__prop-name modal__prop-name--text-only\">Width:</span>\n\t\t\t\t</div\n\t\t\t\t><div class=\"modal__value modal__value--text-only\">\n\t\t\t\t\t<span class=\"modal__value-name modal__value-name--text-only\"\n\t\t\t\t\t\tdata-modal-canvas-size-current-width >\n\t\t\t\t\t\t${this.currentCanvasWidth}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"modal__prop modal__prop--text-only\">\n\t\t\t\t\t<span class=\"modal__prop-name modal__prop-name--text-only\">Height:</span>\n\t\t\t\t</div\n\t\t\t\t><div class=\"modal__value modal__value--text-only\">\n\t\t\t\t\t<span class=\"modal__value-name modal__value-name--text-only\"\n\t\t\t\t\t\tdata-modal-canvas-size-current-height\n\t\t\t\t\t\t\t>${this.currentCanvasHeight}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"modal__section\">\n\t\t\t\t<div class=\"modal__section-title\">New Size</div>\n\t\t\t\t<div class=\"modal__prop\">\n\t\t\t\t\t<span class=\"modal__prop-name\">Width:</span>\n\t\t\t\t</div\n\t\t\t\t><div class=\"modal__value\">\n\t\t\t\t\t<input id=\"canvas-size-width\" class=\"modal__numeric-input\" type=number min=\"0\"\n\t\t\t\t\t\tstep=\"1\" required value=${this.currentCanvasWidth}\n\t\t\t\t\t\tdata-modal-canvas-size-new-width>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"modal__prop\">\n\t\t\t\t\t<span class=modal__prop-name>Height:</span>\n\t\t\t\t</div\n\t\t\t\t><div class=\"modal__value\">\n\t\t\t\t\t<input class=\"modal__numeric-input\" type=\"number\" min=\"0\" step=\"1\" required\n\t\t\t\t\t\tvalue=${this.currentCanvasHeight}  data-modal-canvas-size-new-height>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"modal__prop\">\n\t\t\t\t\t<span class=modal__prop-name>Anchor:</span>\n\t\t\t\t</div\n\t\t\t\t><div class=\"modal__value modal__canvas-direction-button-container\"\n\t\t\t\t\tdata-canvas-direction-container>\n\t\t\t\t\t<svg class=\"modal__canvas-resize-arrows\" xmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 68 68\" >\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"4,4 4,13.15 7.87,9.3 15.66,16.95 17.14,15.54 9.41,\n\t\t\t\t\t\t\t\t7.71 13.05,4\"/>\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"40,8 34,2 28,8 33,8 33,19 35,19 35,8\"/>\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"64,4 55,4 58.85,7.85 51.2,15.62 52.61,17.1 60.37,9.37 64,13\"/>\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"8,27.5 2,33.5 8,39.5 8,35 19,35 19,33 8,33\"/>\n\t\t\t\t\t\t<circle id=\"circle_4_\" fill=\"#231F20\" cx=\"34\" cy=\"34\" r=\"3\"/>\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"60,39.5 66,33.5 60,27.5 60,33 49,33 49,35 60,35\"/>\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"4,64 13.2,64 9.35,60.2 17,52.45 15.59,50.99 7.73,58.72 4,55.1\"/>\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"28,60 34,66 40,60 35,60 35,49 33,49 33,60\"/>\n\t\t\t\t\t\t<polygon fill=\"#231F20\"\n\t\t\t\t\t\t\tpoints=\"64,64 64,54.95 60.22,58.8 52.49,51.15 51.03,52.56 58.77,\n\t\t\t\t\t\t\t60.34 55.15,64\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"left   top\"    ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"center top\"    ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"right  top\"    ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"left   middle\" ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"center middle\" ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"right  middle\" ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"left   bottom\" ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"center bottom\" ></button\n\t\t\t\t\t><button type=button class=\"modal__canvas-direction-button\" tabindex=-1\n\t\t\t\t\t\tdata-canvas-resize-direction=\"right  bottom\" ></button\n\t\t\t\t></div\n\t\t\t></div\n\t\t></div\n\t\t><div class=modal__confirm>\n\t\t\t<button type=button class=\"modal__button modal-ok\" data-modal-ok>OK</button>\n\t\t\t<button type=button class=\"modal__button modal-cancel\" data-modal-cancel>Cancel</button>\n\t\t</div>\n\t\t<div class=\"modal__error-text\"></div>`;\n\t};\n\n\tmodalCanvasSize.modalInternalBinding = function() {\n\t\tlet doc = document; // Shortening only :/\n\t\tthis.resizeIconPositionX = \"center\";\n\t\tthis.resizeIconPositionY = \"middle\";\n\n\t\tthis.onResizeDirectionButtonClick = this.onResizeDirectionButtonClick.bind( this );\n\n\t\tthis.resizeDirectionContainer = doc.querySelector( \"[data-canvas-direction-container]\" );\n\t\tthis.resizeDirectionContainer.addEventListener( \"click\",\n\t\t                                                this.onResizeDirectionButtonClick );\n\n\t\t// Focus the first input box and select (highlight) its contents.\n\t\t// FF doesn\"t support select() method.\n\t\t// Webkit throws InvalidStateError on setSelectionRange on an input type=number element.\n\t\t// https://code.google.com/p/chromium/issues/detail?id=346270\n\t\tlet firstInput = doc.getElementById( \"canvas-size-width\" );\n\t\ttry {\n\t\t\tfirstInput.focus();\n\t\t\tfirstInput.setSelectionRange( 0, 9999 );\n\t\t} catch ( e ) {\n\t\t\tfirstInput.select();\n\t\t}\n\t};\n\n\tmodalCanvasSize.modalInternalUnbinding = function() {\n\t\tlet that = this;\n\t\tthis.resizeDirectionContainer.removeEventListener( \"click\",\n\t\t                                                  that.onResizeDirectionButtonClick );\n\t};\n\n\t// Returns true if user input is valid.\n\tmodalCanvasSize.modalValidate = function() {\n\t\tlet newWidthEl = document.querySelector( \"[data-modal-canvas-size-new-width]\" );\n\t\tlet newHeightEl = document.querySelector( \"[data-modal-canvas-size-new-height]\" );\n\t\tlet newWidth = parseInt( newWidthEl.value );\n\t\tlet newHeight = parseInt( newHeightEl.value );\n\t\tlet errorText;\n\n\t\tthis.errorEl = document.querySelector( \".modal__error-text\" );\n\n\t\tif ( typeof newWidth !== \"number\" || typeof newHeight !== \"number\" ||\n\t\t     Number.isNaN( newWidth ) || Number.isNaN( newHeight ) ) {\n\t\t\terrorText = \"Oops! Please enter a numeric input value.\";\n\t\t} else if ( newWidth < 3 || newHeight < 3 ) {\n\t\t\terrorText = \"Oops! Canvases must be at least three pixels or larger on each dimension.\";\n\t\t} else if ( newWidth >= 5000 || newHeight >= 5000 ) {\n\t\t\terrorText = \"Whoa Nellie! Please keep it under 5000 pixels on each dimension.\";\n\t\t}\n\t\tif ( errorText ) {\n\t\t\tthis.showError( errorText );\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthis.newWidth = newWidth;\n\t\t\tthis.newHeight = newHeight;\n\t\t\treturn true;\n\t\t}\n\t};\n\n\tmodalCanvasSize.onResizeDirectionButtonClick = function( e ) {\n\t\te.preventDefault();\n\t\te.stopImmediatePropagation();\n\n\t\t// Target should be one of the child buttons, split on spaces.\n\t\tlet positions = e.target.getAttribute( \"data-canvas-resize-direction\" );\n\t\tpositions = positions.split( /\\s+/ );\n\n\t\t// Set the new icon positions.\n\t\t// Markup is strictly horizontal value first, then vertical value.\n\t\tthis.resizeIconPositionX = positions[ 0 ];\n\t\tthis.resizeIconPositionY = positions[ 1 ];\n\n\t\t// Remove all old positioning classes. This could surely be improved?\n\t\tthis.resizeDirectionContainer.classList.remove( \"resize-icon-top\",\n\t\t                                                \"resize-icon-middle\",\n\t\t                                                \"resize-icon-bottom\",\n\t\t                                                \"resize-icon-left\",\n\t\t                                                \"resize-icon-center\",\n\t\t                                                \"resize-icon-right\" );\n\n\t\t// And add the new appropriate classes.\n\t\tthis.resizeDirectionContainer.classList.add( \"resize-icon-\" + this.resizeIconPositionX );\n\t\tthis.resizeDirectionContainer.classList.add( \"resize-icon-\" + this.resizeIconPositionY );\n\t};\n\n\treturn modalCanvasSize;\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/modalCanvasSize.js\n **/","define( [ \"Modal\", \"parseRLEFile\", \"parseBMP\" ], function( Modal, parseRLEFile, parseBMP ) {\n\n\t// To be added & customized for each unique modal object:\n\t// this.titleText   html to insert in body of modal\n\t// this.innerMarkup   html to insert in body of modal\n\t// this.modalInternalBinding   listeners other than ok/cancel\n\t// this.modalInternalUnbinding  remove listeners other than ok/cancel\n\t// this.modalValidate  optional check on click of OK. returns a Boolean.\n\t// this.modalSubmit   function to run 'ok' click if valid.\n\n\tlet modalOpenPattern = Object.create( Modal );\n\n\tmodalOpenPattern.titleText = \"Open Pattern\";\n\n\tmodalOpenPattern.innerMarkup = function() {\n\t\treturn \"<div class='modal__open modal__configure'>\" +\n\t\t\t\"<div class='modal__open__instructions'>Choose a JSON, RLE, or 1-bit\" +\n\t\t\t\" Windows BMP file pattern from your file system.\" +\n\t\t\t\"</div>\" +\n\t\t\"</div\" +\n\t\t\"><div class=modal__confirm>\" +\n\t\t\t\"<button type=button class='modal__button modal-ok'\" +\n\t\t\t\t\" data-modal-ok>OK</button>\" +\n\t\t\t\"<button type=button class='modal__button modal-cancel' \" +\n\t\t\t\t\t\"data-modal-cancel>Cancel</button>\" +\n\t\t\"</div>\" +\n\t\t\"<div class='modal__open__error-text modal__error-text'></div>\" +\n\t\t\"<div class=modal__input-file-wrapper>\" +\n\t\t\t\"<input class=modal__file-input type=file>\" +\n\t\t\"</div>\";\n\t};\n\n\tmodalOpenPattern.modalInternalBinding = function() {\n\t\tlet fileInputEl = document.querySelector( \".modal__file-input\" );\n\t\tlet errorEl = document.querySelector( \".modal__error-text\" );\n\n\t\tthis.modalValidateFileInputChoice = this.modalValidateFileInputChoice.bind( this );\n\t\tthis.modalValidateFileInputContents = this.modalValidateFileInputContents.bind( this );\n\n\t\tthis.fileInputEl = fileInputEl;\n\t\tthis.errorEl = errorEl ;\n\n\t\t// Don't wait until \"OK\" click to validate the input.\n\t\tthis.fileInputEl.addEventListener( \"change\", this.modalValidateFileInputChoice );\n\t};\n\n\tmodalOpenPattern.modalInternalUnbinding = function() {\n\t\tthis.fileInputEl.removeEventListener( \"change\", this.modalValidateFileInputChoice );\n\t};\n\n\tmodalOpenPattern.parsedPattern = null;\n\tmodalOpenPattern.isValid = false; // Nothing initially selected.\n\n\tmodalOpenPattern.validateBMP = function( file ) {\n\t\tlet bm = parseBMP( file );\n\t\tlet errorText = \"\";\n\n\t\tif ( bm.iHeader.bitsPerPixel > 1 ) {\n\t\t\terrorText = \"The BMP file can't be read because it has a bit depth of \" +\n\t\t\t            \"greater than one.\";\n\t\t} else if ( bm.iHeader.compressionMethod > 0 ) {\n\t\t\terrorText = \"Lifey currently only supports uncompressed BMP files.\";\n\t\t}\n\t\tif ( errorText ) {\n\t\t\tthis.parsedPattern = null;\n\t\t} else {\n\t\t\tthis.parsedPattern = bm;\n\t\t}\n\t\treturn errorText;\n\t};\n\n\tmodalOpenPattern.readFile = function( file ) {\n\t\tlet fReader = new FileReader();\n\t\tlet that = this;\n\t\tlet ext = this.fileExtension;\n\n\t\tfReader.onload = function( e ) {\n\t\t\tthat.modalValidateFileInputContents( e.target.result );\n\t\t};\n\n\t\t// Read the file differently based on the extension.\n\t\t// This kicks off the onload event above.\n\t\tif ( ext === \"JSON\" || ext === \"RLE\" ) {\n\t\t\tfReader.readAsText( file );\n\t\t} else if ( ext === \"BMP\" ) {\n\n\t\t\t// BMP is binary, read as an Array Buffer.\n\t\t\tfReader.readAsArrayBuffer( file );\n\t\t}\n\t};\n\n\t// Validity can be set by the file(s) being selected, or the file being (mis)read\n\t// or parsed. This gets checked on click of \"ok\" button.\n\tmodalOpenPattern.modalValidate = function() {\n\t\treturn this.isValid;\n\t};\n\n\tmodalOpenPattern.modalValidateFileInputContents = function( file ) {\n\t\tlet ext = this.fileExtension;\n\t\tlet errorText = \"\";\n\n\t\tif ( ext === \"JSON\" ) {\n\t\t\ttry {\n\t\t\t\tthis.parsedPattern = JSON.parse( file );\n\t\t\t} catch ( e ) {\n\t\t\t\terrorText = \"The file text is not valid JSON.\" +\n\t\t\t\t\t\" Please check the file for a possible syntax error.\";\n\t\t\t}\n\n\t\t} else if ( ext === \"RLE\" ) {\n\t\t\tthis.parsedPattern = parseRLEFile( file );\n\n\t\t} else if ( ext === \"BMP\" ) {\n\t\t\terrorText = this.validateBMP( file );\n\t\t}\n\n\t\tthis.showError( errorText );\n\t\tthis.isValid = !errorText;\n\t};\n\n\tmodalOpenPattern.modalValidateFileInputChoice = function() {\n\t\tlet fileList = this.fileInputEl.files;\n\t\tlet file = fileList[ 0 ];\n\t\tlet errorText = \"\"; // Always added, must be a string.\n\t\tlet fileName = file.name;\n\t\tlet fileExtension = fileName.split( \".\" ).pop().toUpperCase();\n\t\tthis.fileExtension = fileExtension;\n\n\t\tif ( !file || fileList.length === 0 ) {\n\t\t\terrorText = \"No file selected.\";\n\t\t} else if ( fileList.length > 1 ) {\n\t\t\terrorText = \"Multiple files selected. Please choose a single file.\";\n\t\t} else if ( fileExtension !== \"JSON\" &&\n\t\t            fileExtension !== \"BMP\" &&\n\t\t            fileExtension !== \"RLE\" ) {\n\t\t\terrorText = \"The file name should end with a dot, followed by either “json”,\" +\n\t\t\t            \" “rle”, or “bmp”.\";\n\t\t}\n\n\t\tif ( errorText ) {\n\t\t\tthis.parsedPattern = null;\n\t\t} else {\n\t\t\tthis.readFile( file );  // Kicks off a second round of validation.\n\t\t}\n\n\t\t// Always \"show\" the error even if it's an empty string, so that a file input\n\t\t// correction erases any previous error messages.\n\t\tthis.showError( errorText );\n\t\tthis.isValid = !errorText;\n\t};\n\n\treturn modalOpenPattern;\n} );\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/modalOpenPattern.js\n **/","/**\n * Parse RLE to JSON\n *\n * Parses \"run-length-encoded\" (.rle) files used for storing\n * cellular automata patterns. Written as AMD module.\n *\n * By Alex Bell |  MIT License\n *\n * @returns {\n *     name: String,\n *     comments: String,\n *     author: String,\n *     coordinates: [Integer, Integer],\n *     rule: String,\n *     width: Integer,\n *     height: Integer,\n *     pattern: str\n *  }\n *\n * Based on the very basic syntax/grammar outline here\n * http://www.mirekw.com/ca/ca_files_formats.html\n *\n *   b = a dead cell\n *   o = a live cell\n *   $ = end of a line of the pattern\n *\n *   #N Beehive at beehive\n *   #C A simple 12-cell still life composed of two beehive.\n *   #C www.conwaylife.com/wiki/index.php?title=Beehive_at_beehive\n *   #O ook \"The Librarian\"@unseen.edu Fri Apr 30 19:38:52 1999\n *   #R -22 -57 (this is the offset from the top left.)\n *   x = 6, y = 6, rule = 23/3\n *   4bob$3bobo$3bobo$b2obob$o2bo2b$b2o!\n */\ndefine( function() {\n\n\treturn function( str ) {\n\t\tlet ret = Object.create( null );\n\n\t\tif ( !str ) { return; } // Stay out of trouble.\n\n\t\tlet pos = 0;\n\t\tlet chrctr;\n\t\tlet inComment = false;\n\t\tlet currentTerm; // Can be \"width\", \"height\", or \"rule\"\n\n\t\tret.name = \"\"; // These are the really the only two properties certain to be included.\n\t\tret.pattern = \"\";\n\n\t\tlet isSpace = function( c ) {\n\t\t\treturn ( c === \"\\u0020\" || // Space\n\t\t\t         c === \"\\u0009\" );  // Horizontal tab\n\t\t};\n\n\t\tlet isNewLine = function( c ) {\n\t\t\treturn ( c === \"\\u000A\" || // New line\n\t\t\t         c === \"\\u000C\" || // Form feed\n\t\t\t         c === \"\\u000D\" );  // Carriage return\n\t\t};\n\n\t\t// http://jsperf.com/isdigittest/5\n\t\tlet isDigit = function( n ) {\n\t\t    return Boolean( [ true, true, true, true, true, true, true, true, true, true ][ n ] );\n\t\t};\n\n\t\tlet stripTrailingSpaces = function( str ) {\n\t\t\twhile ( isSpace( str[ str.length - 1 ] ) ) {\n\t\t\t\tstr = str.substring( 0, str.length - 2 );\n\t\t\t}\n\t\t\treturn str;\n\t\t};\n\n\t\tlet createEmptyPropIfNone = function( str ) {\n\t\t\tif ( !ret[ str ] ) {\n\t\t\t\tret[ str ] = \"\";\n\t\t\t}\n\t\t};\n\n\t\twhile ( true ) {\n\t\t\tchrctr = str[ pos ];\n\n\t\t\t// If string has no length, or we've hit the exclamation point EOF marker,\n\t\t\t// or end of string reached.\n\t\t\tif ( !chrctr || chrctr === \"!\" ) {\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t// Determine if entering a comment\n\t\t\tif ( chrctr === \"#\" ) {\n\t\t\t\tif ( str[ pos + 1 ] === \"N\" || str[ pos + 1 ] === \"n\" ) {\n\t\t\t\t\tinComment = \"name\";\n\t\t\t\t} else if ( str[ pos + 1 ] === \"C\" || str[ pos + 1 ] === \"c\" ) {\n\t\t\t\t\tinComment = \"comments\";\n\t\t\t\t\tcreateEmptyPropIfNone( \"comments\" );\n\t\t\t\t} else if ( str[ pos + 1 ] === \"O\" || str[ pos + 1 ] === \"o\" ) {\n\t\t\t\t\tinComment = \"author\";\n\t\t\t\t\tcreateEmptyPropIfNone( \"author\" );\n\t\t\t\t} else if ( str[ pos + 1 ] === \"R\" ) {\n\t\t\t\t\tinComment = \"coordinates\";\n\t\t\t\t\tcreateEmptyPropIfNone( \"coordinates\" );\n\t\t\t\t}\n\t\t\t\tpos = pos + 2;\n\t\t\t\tcontinue;\n\n\t\t\t// Inside a comment\n\t\t\t} else if ( inComment ) {\n\n\t\t\t\t// Bail out of comment on newline.\n\t\t\t\tif ( isNewLine( chrctr ) ) {\n\n\t\t\t\t\t// Remove trailing spaces from a comment line.\n\t\t\t\t\tret[ inComment ] = stripTrailingSpaces( ret[ inComment ] );\n\n\t\t\t\t\tif ( inComment === \"coordinates\" ) {\n\t\t\t\t\t\tret.coordinates = ret.coordinates.split( \" \" );\n\t\t\t\t\t\tret.coordinates[ 0 ] = parseInt( ret.coordinates[ 0 ], 10 ); // The x\n\t\t\t\t\t\tret.coordinates[ 1 ] = parseInt( ret.coordinates[ 1 ], 10 ); // The y\n\t\t\t\t\t}\n\t\t\t\t\tinComment = false;\n\n\t\t\t\t// Ignore leading spaces and tabcharacters inside a comment if\n\t\t\t\t// the corresponding property is currently an empty string.\n\t\t\t\t} else if ( isSpace( chrctr ) && ret[ inComment ] === \"\" ) {\n\n\t\t\t\t\t\t// Do nothing inside here. Do Not remove.\n\n\t\t\t\t// The coordinates string should be only digits, hyphens, spaces.\n\t\t\t\t// Skip over anything else like letters or punctuation.\n\t\t\t\t} else if ( inComment === \"coordinates\" && !isSpace( chrctr ) &&\n\t\t\t\t           !isDigit( chrctr ) && chrctr !== \"-\" ) {\n\t\t\t\t\t\tpos += 1;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// The general case: add the character to the comment.\n\t\t\t\t\tret[ inComment ] += chrctr;\n\t\t\t\t}\n\n\t\t\t// Not in a comment from here on down.\n\t\t\t// Determine if entering a property\n\t\t\t} else if ( chrctr === \"x\" ) {\n\t\t\t\tcurrentTerm = \"width\";\n\t\t\t\tcreateEmptyPropIfNone( \"width\" );\n\n\t\t\t} else if ( chrctr === \"y\" ) {\n\t\t\t\tcurrentTerm = \"height\";\n\t\t\t\tcreateEmptyPropIfNone( \"height\" );\n\n\t\t\t} else if ( str.substring( pos, pos + 4 ) === \"rule\" ) {\n\t\t\t\tcurrentTerm = \"rule\";\n\t\t\t\tcreateEmptyPropIfNone( \"rule\" );\n\n\t\t\t// Reset currentTerm to empty on commas or newlines\n\t\t\t} else if ( chrctr === \",\" || isNewLine( chrctr ) ) {\n\t\t\t\tcurrentTerm = \"\";\n\n\t\t\t\t// Convert to number\n\t\t\t\tif ( ret.width && ret.height ) {\n\t\t\t\t\tret.width = parseInt( ret.width );\n\t\t\t\t\tret.height = parseInt( ret.height );\n\t\t\t\t}\n\n\t\t\t} else if ( currentTerm ) {\n\n\t\t\t\t// Width, height, and rule all accept any digit.\n\t\t\t\tif ( isDigit( chrctr ) ) {\n\t\t\t\t\tret[ currentTerm ] += chrctr;\n\n\t\t\t\t// \"rule\" additionally accepts a slash\n\t\t\t\t} else if ( currentTerm === \"rule\" && chrctr === \"/\" ) {\n\t\t\t\t\tret[ currentTerm ] += \"/\";\n\t\t\t\t}\n\n\t\t\t// Not in a comment, and not in currentTerm,\n\t\t\t// which means we've reached the actual pattern.\n\t\t\t} else if ( isDigit( chrctr ) || chrctr === \"b\" ||\n\t\t\t            chrctr === \"o\" || chrctr === \"$\" ) {\n\t\t\t ret.pattern += chrctr;\n\t\t\t}\n\n\t\t\tpos += 1;\n\n\t\t} // End of big while loop.\n\t};\n\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/parseRLEFile.js\n **/","define( function() {\n\n\t/**\n\t * @param {Buffer} buffer (from FileReader)\n\t * @returns {Object} with image properties\n\t */\n\treturn function( buffer ) {\n\t\tlet dataV = new DataView( buffer );\n\t\tlet bm = Object.create( null );\n\n\t\t// Omit for brevity:\n\t\t// let decoder = new TextDecoder( \"utf-8\" );\n\n\t\tbm.fHeader = Object.create( null );\n\n\t\t// Much of this could be omitted for brevity, but it's useful for\n\t\t// reference and debugging.\n\n\t\t// Typically \"BM\" for Windows 3, 95, NT +\n\t\t// Ancient unsupported entries include: \"BA\", \"CI\", \"CP\", \"IC\", \"PT\".\n    // bm.fHeader.type = decoder.decode( new DataView( buffer, 0, 2 ) );\n\n\t\t// The file size in bytes\n\t\t// bm.fHeader.byteSize =         dataV.getUint32( 2, true );\n\n\t\t// Reserved, depends on the application\n\t\t// bm.fHeader.reserved1 =        dataV.getUint16( 6, true );\n\n\t\t// Reserved, depends on the application\n\t\t// bm.fHeader.reserved2 =        dataV.getUint16( 8, true );\n\n\t\t// Offset of the byte where the pixel array starts\n\t\tbm.fHeader.offsetToPixArray = dataV.getUint32( 10, true );\n\n\t\tbm.iHeader = Object.create( null );\n\n\t\t// The size of this header, varies with format version #\n\t\t// e.g. V2 = 12; V3 = 40; V4 = 108; V5 = 124\n\t\t// bm.iHeader.headerSize =        dataV.getUint32( 14, true );\n\n\t\t// The bitmap width in pixels (integer).\n\t\tbm.width =                     dataV.getUint32( 18, true );\n\n\t\t// The bitmap height in pixels (integer).\n\t\tbm.height =                    dataV.getUint32( 22, true );\n\n\t\t// Number of color planes used (set to 1).\n\t\t// bm.iHeader.colorPlanes =       dataV.getUint16( 26, true );\n\n\t\t// Number of bits per pixel. Typically: 1, 4, 8, 16, 24 or 32.\n\t\tbm.iHeader.bitsPerPixel =      dataV.getUint16( 28, true );\n\n\t\t// The compression method being used. 0 means uncompressed,\n\t\t// which is currently the only value supported in the validator.\n\t\tbm.iHeader.compressionMethod = dataV.getUint32( 30, true );\n\n\t\t// Image size of raw bitmap data (not file size).\n\t\t// bm.iHeader.imageSize =         dataV.getUint32( 34, true );\n\n\t\t// Irrelevant in this context.\n\t\t// bm.iHeader.pixPerMeterX =      dataV.getUint32( 38, true );\n\t\t// bm.iHeader.pixPerMeterY =      dataV.getUint32( 42, true );\n\n\t\t// Number of colors in the palette. Should be \"0\" for 1 bit.\n\t\t// bm.iHeader.usedColors =        dataV.getUint32( 46, true );\n\n\t\t// Number of important colors used\n\t\t// bm.iHeader.importantColors =   dataV.getUint32( 50, true );\n\n\t\t// Stride is the number of bytes in a row. Stride must be a multiple of 4.\n\t\tbm.stride = Math.ceil( bm.iHeader.bitsPerPixel * bm.width / 32 ) * 4;\n\n\t\t// Total number of pixels in the image\n\t\tbm.pixels = new Uint8Array( bm.width * bm.height ); // Initially all zeros\n\n\t\tlet offset = bm.fHeader.offsetToPixArray;\n\t\tlet indent, byteAddress, bitAddress, byteVal, bitVal;\n\n\t\t// Outer loop iterates image rows\n\t\tfor ( let y = 0; y < bm.height; y += 1 ) {\n\t\t\tindent = bm.stride * y;\n\n\t\t\t// Inner loop iterates image columns\n\t\t\tfor ( let x = 0; x < bm.width; x += 1 ) {\n\t\t\t\tbyteAddress = Math.floor( x / 8 );\n\t\t\t\tbitAddress = x % 8;\n\t\t\t\tbyteVal = dataV.getUint8( offset + indent + byteAddress, true );\n\t\t\t\tbyteVal = byteVal.toString( 2 ); // Convert to base 2\n\n\t\t\t\t// Trick to pad left with zeros to 8 digits\n\t\t\t\tbyteVal = ( \"00000000\" + byteVal ).substring( byteVal.length );\n\t\t\t\tbitVal = byteVal[ bitAddress ];\n\n\t\t\t\t// BMP pixels start at the bottom left, so reverse the row order\n\t\t\t\tbm.pixels[ ( bm.height - 1 - y ) * bm.width + x ] = bitVal;\n\t\t\t}\n\t\t}\n\n\t\treturn bm;\n\t};\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/parseBMP.js\n **/","define( [ \"Modal\" ], function( Modal ) {\n\n\t// To be added & customized for each unique modal objects:\n\t// this.titleText   html to insert in body of modal\n\t// this.innerMarkup   html to insert in body of modal\n\t// this.modalInternalBinding   listeners other than ok/cancel\n\t// this.modalInternalUnbinding  remove listeners other than ok/cancel\n\t// this.modalValidate  optional check on click of OK. returns a Boolean.\n\t// this.modalSubmit   function to run 'ok' click if valid.\n\n\tlet modalSavePattern = Object.create( Modal );\n\n\tmodalSavePattern.titleText = \"Save As\";\n\n\tmodalSavePattern.innerMarkup = function() {\n\t\treturn \"<div class='modal__configure modal__configure--save-as'>\" +\n\t\t\t\"<div class='modal__save-pattern-option'>Format:</div>\" +\n\t\t\t\"<div class='modal__save-pattern-option-input-wrapper'>\" +\n\t\t\t\t\"<select class=modal__save-pattern-option-input name=fileformat\" +\n\t\t\t\t\t\" data-modal-save-file-format>\" +\n\t\t\t\t  \"<option value='json' selected>JavaScript Object Notation (.json)</option>\" +\n\t\t\t\t\t\"<option value='rle'>Run Length Encoded (.rle)</option>\" +\n\t\t\t\t\"</select>\" +\n\t\t\t\"</div>\" +\n\n\t\t\t\"<div class=modal__save-pattern-option>Pattern Name:</div>\" +\n\t\t\t\"<div class=modal__save-pattern-option-input-wrapper>\" +\n\t\t\t\t\"<input type=text class=modal__save-pattern-option-input\" +\n\t\t\t\t\t\" data-modal-save-pattern-name>\" +\n\t\t\t\"</div>\" +\n\t\t\t\"<div class=modal__save-pattern-option>Author:</div>\" +\n\t\t\t\"<div class=modal__save-pattern-option-input-wrapper>\" +\n\t\t\t\t\"<input type=text class=modal__save-pattern-option-input\" +\n\t\t\t\t\t\" data-modal-save-pattern-author>\" +\n\t\t\t\"</div>\" +\n\t\t\t\"<div class=modal__error-text></div>\" +\n\t\t\"</div>\" +\n\t\t\"<div class='modal__confirm modal__confirm--bottom-corner'>\" +\n\t\t\t\"<button type=button class='modal__button modal-cancel modal-cancel--save-as'\" +\n\t\t\t\t\"data-modal-cancel>Cancel</button>\" +\n\t\t\t\"<button type=button class='modal__button modal-ok modal-ok--save-as'\" +\n\t\t\t\t\"data-modal-ok >Save</button>\" +\n\t\t\"</div>\";\n\t};\n\n\treturn modalSavePattern;\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/modalSavePattern.js\n **/","define( [ \"Modal\" ], function( Modal ) {\n\n\t// To be added & customized for each unique modal object:\n\t// this.titleText   html to insert in body of modal.\n\t// this.innerMarkup   html to insert in body of modal.\n\t// this.modalInternalBinding   (optional) listeners other than ok/cancel.\n\t// this.modalInternalUnbinding  (optional) remove listeners other than ok/cancel.\n\t// this.modalValidate  (optional) check on click of OK. returns a Boolean.\n\t// this.modalSubmit   function to run \"ok\" click if valid.\n\n\tlet modalSharePattern = Object.create( Modal );\n\n\tmodalSharePattern.titleText = \"Share Pattern\";\n\n\tmodalSharePattern.innerMarkup = function() {\n\t\treturn \"\" +\n\t\t\"<div class='modal__configure modal__share__configure'>\" +\n\t\t\t\"<div class='modal__section-title--share'>\" +\n\t\t\t\t\t\"<span class=pattern-fits-in-url></span>\" +\n\t\t\t\"</div>\" +\n\t\t\"</div>\" +\n\t\t\"<div class=modal__confirm>\" +\n\t\t\t\"<button type=button class='modal__button modal-ok' data-modal-ok>OK</button>\" +\n\t\t\"</div>\" +\n\t\t\"<div class=modal__shareable-url data-modal-shareable-url></div\";\n\t};\n\n\treturn modalSharePattern;\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/modalSharePattern.js\n **/","/**  ---- Parse RLE pixel string ----\n *\n *\t Based on the syntax outline at:\n *\t http://www.mirekw.com/ca/ca_files_formats.html\n *\n *   b = a dead cell\n *   o = a live cell\n *   $ = end of a line of the pattern\n *\n *   4bob$3bobo$3bobo$b2obob$o2bo2b$b2o!\n *\n *\tReturns a uInt8 Array of pixel data with 0 = dead, 1 = live\n *\n * @param {String} str\n * @param {Number} width\n * @param {Number} height\n * @returns {uInt8 Array}\n */\ndefine( [ \"Utility\" ], function( ut ) {\n\n\t// Currently needed just for Intern to allow block-scoping.\n\t// Consider removing in build.\n\t\"use strict\";\n\n\treturn function( str, width, height ) {\n\t\twidth = width || 0;\n\t\theight = height || 0;\n\t\tlet chrctr;\n\t\tlet pos = 0;\n\t\tlet runCount = \"\"; // Concatenated character by character\n\t\tlet runCountInteger;\n\t\tlet currentX = 0;\n\t\tlet currentY = 0;\n\t\tlet dataArray = new Int8Array( width * height ); // All zeros initially\n\n\t\tif ( !str || !width || !height ) {\n\t\t\treturn; // Stay out of loop.\n\t\t}\n\n\t\t// Loop through each character in the string.\n\t\twhile ( true ) {\n\t\t\tchrctr = str[ pos ];\n\n\t\t\t// If end of string reached, or exclamation point EOF marker.\n\t\t\tif ( !chrctr || chrctr === \"!\" ) {\n\t\t\t\treturn dataArray;                // Main return path\n\n\t\t\t} else if ( ut.isDigit( chrctr ) ) {\n\t\t\t\trunCount += chrctr;\n\n\t\t\t} else if ( chrctr === \"b\" || chrctr === \"o\" ) {\n\t\t\t\trunCountInteger = parseInt( runCount ) || 1;\n\n\t\t\t\t// Don't bother setting empty cells on the typed array,\n\t\t\t\t// because it's pre-populated with all zeroes.\n\t\t\t\tif ( chrctr === \"o\" ) {\n\t\t\t\t\tfor ( let i = 0; i < runCountInteger; i += 1 ) {\n\t\t\t\t\t\tdataArray[ currentY * width + currentX + i ] = 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Advance currentX (whether it's a \"b\" or an \"o\")\n\t\t\t\tcurrentX += runCountInteger;\n\t\t\t\trunCount = \"\"; // Reset\n\n\t\t\t} else if ( chrctr === \"$\" ) {\n\n\t\t\t\t// End of this row, and possibly the next rows, etc.\n\t\t\t\t// Basically treat runCount $s as \"newlines\" in the grid.\n\t\t\t\trunCountInteger = parseInt( runCount ) || 1;\n\n\t\t\t\tcurrentX = 0;\n\t\t\t\tcurrentY += runCountInteger;\n\t\t\t\trunCount = \"\";\n\t\t\t}\n\n\t\t\tpos += 1;\n\t\t}\n\t};\n\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/parseRLEPixelString.js\n **/","/**  ---- Convert Pattern Object to RLE file string ----\n *\n *\t Based on the syntax outline at:\n *\t http://www.mirekw.com/ca/ca_files_formats.html\n *\n *   #N Beehive at beehive\n *   #C A simple 12-cell still life composed of two beehive.\n *   #C www.conwaylife.com/wiki/index.php?title=Beehive_at_beehive\n *   #O ook \"The Librarian\"@unseen.edu Fri Apr 30 19:38:52 1999\n *   #R -22 -57\n *   x = 6, y = 6, rule = 23/3\n *   4bob$3bobo$3bobo$b2obob$o2bo2b$b2o!\n *\n *   TO DO: Integrate #R value with offsetX and offsetY? It's unclear to me\n *   right now what negative #R values here are relative to.\n *\n */\ndefine( function() {\n\n\treturn function( pat ) {\n\t\tlet retStr = \"\";\n\n\t\tif ( pat.name ) {\n\t\t\tretStr += \"#N \" + pat.name + \"\\n\";\n\t\t}\n\t\tif ( pat.author ) {\n\t\t\tretStr += \"#O \" + pat.author + \"\\n\";\n\t\t}\n\t\tretStr += \"x = \" + pat.width + \", y=\" + pat.height + \", rule = B3/S23\\n\";\n\t\tretStr += pat.pattern + \"!\\n\";\n\n\t\treturn retStr;\n\t};\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/patToRleFileString.js\n **/","/**\n * Fn dataArrayToRLE\n * @returns {object}  returns object with properties\n *\t pattern {string},\n *\t width {integer},\n *\t height {integer},\n *   minCanvasX {integer},\n *   minCanvasY {integer},\n *   offsetX {integer},\n *   offsetY {integer}\n */\n\ndefine( [], function() {\n\n\t// Currently needed just for Intern to allow block-scoping.\n\t\"use strict\";\n\n\treturn function( dataArray, canvasWidth, canvasHeight ) {\n\t\tlet len = dataArray.length;\n\t\tif ( len !== canvasWidth * canvasHeight ) {\n\t\t\tconsole.log( \"dataArray doesn't match supplied canvas dimensions.\" );\n\t\t\treturn false;\n\t\t}\n\n\t\tlet posTopMost = 0; // Start at beginning.\n\t\tfor ( ; posTopMost < len; posTopMost += 1 ) {\n\t\t\tif ( dataArray[ posTopMost ] === 1 ) {\n\t\t\t\tbreak; // Exit at first active cell.\n\t\t\t}\n\t\t}\n\n\t\tlet posBottomMost = len - 1; // Start at end.\n\t\tfor ( ; posBottomMost > 0; posBottomMost -= 1 ) {\n\t\t\tif ( dataArray[ posBottomMost ] === 1 ) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Array position of leftmost active. Start all the way right and move left.\n\t\tlet posLeftMost = canvasWidth - 1;\n\t\tfor ( let i = 0; i < len; i += 1 ) {\n\t\t\tif ( dataArray[ i ] === 1 && i % canvasWidth < posLeftMost % canvasWidth ) {\n\t\t\t\tposLeftMost = i; // Must go through the full loop.\n\t\t\t}\n\t\t}\n\n\t\t// Array position of rightmost active. Start all the way left and move right.\n\t\tlet posRightMost = 0;\n\t\tfor ( let i = 0; i < len; i += 1 ) {\n\t\t\tif ( dataArray[ i ] === 1 && i % canvasWidth > posRightMost % canvasWidth ) {\n\t\t\t\tposRightMost = i; // Must go through the full loop.\n\t\t\t}\n\t\t}\n\n\t\tlet patternWidth = posRightMost % canvasWidth  - posLeftMost % canvasWidth + 1;\n\t\tlet patternHeight = Math.floor( posBottomMost / canvasWidth ) -\n\t\t                    Math.floor( posTopMost / canvasWidth ) + 1;\n\t\tlet offsetX = posLeftMost % canvasWidth;\n\t\tlet offsetY = Math.floor( posTopMost / canvasWidth );\n\n\t\tlet croppedDataArray = cropArray( dataArray, canvasWidth, canvasHeight,\n\t\t                                  patternWidth, patternHeight, offsetX, offsetY );\n\n\t\tlet ret = Object.create( null );\n\t\tret.pattern = encodeArrayAsRLEString( croppedDataArray, patternWidth );\n\t\tret.width = patternWidth;\n\t\tret.height = patternHeight;\n\n\t\tif ( patternWidth < canvasWidth ) {\n\t\t\tret.offsetX = offsetX;\n\t\t\tret.minCanvasX = canvasWidth;\n\t\t}\n\t\tif ( patternHeight < canvasHeight ) {\n\t\t\tret.offsetY = offsetY;\n\t\t\tret.minCanvasY = canvasHeight;\n\t\t}\n\n\t\t// Handle the \"completely empty canvas\" case.\n\t\t// Never return a negative width and height.\n\t\tif ( posTopMost === len ) {\n\t\t\tret.width = ret.height = ret.offsetX = ret.offsetY = 0;\n\t\t}\n\n\t\treturn ret;\n\t};\n\n\t/**\n\t *\tReturns a cropped data Array.\n\t *\n\t *  offsetX and offsetY values are from top left.\n\t */\n\tfunction cropArray( arr, currWidth, currHeight, cropWidth, cropHeight, offsetX, offsetY ) {\n\t\tlet newDataArray = new Int8Array( cropWidth * cropHeight );\n\n\t\t// Loop through all of the newDataArray,\n\t\t// getting values from the old DataArray.\n\t\tfor ( let i = 0; i < cropHeight; i += 1 ) {\n\t\t\tfor ( let j = 0; j < cropWidth; j += 1 ) {\n\t\t\t\tnewDataArray[ ( i  * cropWidth + j ) ] =\n\t\t\t\t              arr[ ( i + offsetY ) * currWidth + j + offsetX ];\n\t\t\t}\n\t\t}\n\t\treturn newDataArray;\n\t}\n\nfunction encodeArrayAsRLEString( dataArr, canvasWidth ) {\n\tlet retStr = \"\";\n\tlet currentChar, previousChar;\n\tlet previousCharCount = 0;\n\tlet previousEndRowCount = 0;\n\n\tlet len = dataArr.length;\n\n\tfor ( let i = 0; i < len; i += 1 ) {\n\t\tcurrentChar = dataArr[ i ] ? \"o\" : \"b\";\n\n\t\t// For tailing characters at the end of a row:\n\t\t// bb do nothing.\n\t\t// bo write number of repeats, then \"b\", then \"o\".\n\t\t// ob write number of repeats, then \"o\".\n\t\t// oo write number of repeats + 1, then \"o\".\n\n\t\t// If on the last cell of a row.\n\t\tif ( i > 0 && ( i + 1 ) % canvasWidth === 0 ) {\n\t\t\tif ( currentChar === \"o\" ) {\n\n\t\t\t\t// First, if there are any accumulated end-of-lines, print them\n\t\t\t\t// and reset the blank row counter.\n\t\t\t\tif ( previousEndRowCount ) {\n\t\t\t\t\tif ( previousEndRowCount > 1 ) {\n\t\t\t\t\t\tretStr += previousEndRowCount;\n\t\t\t\t\t}\n\t\t\t\t\tretStr += \"$\";\n\t\t\t\t\tpreviousEndRowCount = 0;\n\t\t\t\t}\n\n\t\t\t\tif ( previousChar === \"o\" ) {\n\n\t\t\t\t\t// INCREMENT\n\t\t\t\t\tpreviousCharCount += 1;\n\t\t\t\t\tretStr += previousCharCount;\n\n\t\t\t\t} else if ( previousChar === \"b\" ) {\n\t\t\t\t\tif ( previousCharCount > 1 ) {\n\t\t\t\t\t\tretStr += previousCharCount;\n\t\t\t\t\t}\n\t\t\t\t\tretStr += \"b\";\n\t\t\t\t}\n\t\t\t\tretStr = retStr + \"o\";\n\n\t\t\t} else if ( currentChar === \"b\" ) {\n\t\t\t\tif ( previousChar === \"o\" ) {\n\t\t\t\t\tif ( previousCharCount > 1 ) {\n\t\t\t\t\t\tretStr += previousCharCount;\n\t\t\t\t\t}\n\t\t\t\t\tretStr += previousChar;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increment the row count, unless we're at the very end of the entire array.\n\t\t\t// TO DO: Consider adding the exclamation mark EOF? Possibly unnecessary in JSON.\n\t\t\tif ( i !== len - 1 ) {\n\t\t\t\tpreviousEndRowCount += 1;\n\t\t\t\tpreviousChar = undefined;\n\t\t\t\tpreviousCharCount = 0;\n\t\t\t}\n\n\t\t// INCREMENT, THE GENERAL CASE.\n\t\t} else if ( currentChar === previousChar ) {\n\t\t\tpreviousCharCount += 1;\n\t\t\tcontinue;\n\n\t\t// WRITE\n\t\t} else {\n\n\t\t\t// We're either:\n\t\t\t// \t- at the beginning of a new row with any value.\n\t\t\t//  - in the middle of a row that has live cells on it, and at\n\t\t\t//    a new character or a different character.\n\n\t\t\t// Write to the output string and reset the counter.\n\n\t\t\t// If reached an active cell and there is are any accumulated\n\t\t\t// end-of-lines, print them first and reset the blank row counter.\n\t\t\tif ( currentChar === \"o\" && previousEndRowCount ) {\n\t\t\t\tif ( previousEndRowCount > 1 ) {\n\t\t\t\t\tretStr += previousEndRowCount;\n\t\t\t\t}\n\t\t\t\tretStr += \"$\";\n\t\t\t\tpreviousEndRowCount = 0;\n\t\t\t}\n\n\t\t\tif ( previousCharCount > 1 ) {\n\t\t\t\tretStr += previousCharCount;\n\t\t\t}\n\t\t\tif ( previousChar ) {\n\t\t\t\tretStr += previousChar;\n\t\t\t}\n\n\t\t\t// Reset for next iteration of loop.\n\t\t\tpreviousChar = currentChar;\n\t\t\tpreviousCharCount = 1;\n\t\t}\n\t}\n\n\treturn retStr;\n}\n\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/dataArrayToRLE.js\n **/","// Adapted and improved from\n// http://thiscouldbebetter.neocities.org/texteditor.html\n\n// If this presents problems in the future consider migrating up to:\n// https://github.com/eligrey/FileSaver.js\n\ndefine( [ \"Utility\" ], function( ut ) {\n\tlet objURL;\n\n\tfunction destroyClickedElement( event ) {\n\t\tevent.target.removeEventListener( \"click\", destroyClickedElement );\n\t\tdocument.body.removeChild( event.target );\n\t}\n\n\treturn function( textStr, fileName ) {\n\n\t\t// Any old reference ought to be released.\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL\n\t\tif ( objURL ) {\n\t\t\twindow.URL.revokeObjectURL( objURL );\n\t\t}\n\t\tlet textFileAsBlob = new Blob( [ textStr ], { type: \"text/plain\" } );\n\t\tlet downloadLink = document.createElement( \"a\" );\n\t\tdownloadLink.download = fileName;\n\t\tobjURL = window.URL.createObjectURL( textFileAsBlob );\n\t\tdownloadLink.href = objURL;\n\n\t\t// Chrome allows the link to be clicked without actually adding it to the DOM.\n\t\t// Firefox requires the link to be added to the DOM before it can be clicked.\n\t\tif ( !( navigator && navigator.vendor && navigator.vendor === \"Google Inc.\" ) ) {\n\t\t\tdownloadLink.addEventListener( \"click\", destroyClickedElement );\n\t\t\tdownloadLink.style.display = \"none\";\n\t\t\tdocument.body.appendChild( downloadLink );\n\t\t}\n\n\t\tdownloadLink.click();\n\t};\n} );\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/saveTextAsFile.js\n **/","/*! Hammer.JS - v2.0.7 - 2016-04-22\n * http://hammerjs.github.io/\n *\n * Copyright (c) 2016 Jorik Tangelder;\n * Licensed under the MIT license */\n(function(window, document, exportName, undefined) {\n  'use strict';\n\nvar VENDOR_PREFIXES = ['', 'webkit', 'Moz', 'MS', 'ms', 'o'];\nvar TEST_ELEMENT = document.createElement('div');\n\nvar TYPE_FUNCTION = 'function';\n\nvar round = Math.round;\nvar abs = Math.abs;\nvar now = Date.now;\n\n/**\n * set a timeout with a given scope\n * @param {Function} fn\n * @param {Number} timeout\n * @param {Object} context\n * @returns {number}\n */\nfunction setTimeoutContext(fn, timeout, context) {\n    return setTimeout(bindFn(fn, context), timeout);\n}\n\n/**\n * if the argument is an array, we want to execute the fn on each entry\n * if it aint an array we don't want to do a thing.\n * this is used by all the methods that accept a single and array argument.\n * @param {*|Array} arg\n * @param {String} fn\n * @param {Object} [context]\n * @returns {Boolean}\n */\nfunction invokeArrayArg(arg, fn, context) {\n    if (Array.isArray(arg)) {\n        each(arg, context[fn], context);\n        return true;\n    }\n    return false;\n}\n\n/**\n * walk objects and arrays\n * @param {Object} obj\n * @param {Function} iterator\n * @param {Object} context\n */\nfunction each(obj, iterator, context) {\n    var i;\n\n    if (!obj) {\n        return;\n    }\n\n    if (obj.forEach) {\n        obj.forEach(iterator, context);\n    } else if (obj.length !== undefined) {\n        i = 0;\n        while (i < obj.length) {\n            iterator.call(context, obj[i], i, obj);\n            i++;\n        }\n    } else {\n        for (i in obj) {\n            obj.hasOwnProperty(i) && iterator.call(context, obj[i], i, obj);\n        }\n    }\n}\n\n/**\n * wrap a method with a deprecation warning and stack trace\n * @param {Function} method\n * @param {String} name\n * @param {String} message\n * @returns {Function} A new function wrapping the supplied method.\n */\nfunction deprecate(method, name, message) {\n    var deprecationMessage = 'DEPRECATED METHOD: ' + name + '\\n' + message + ' AT \\n';\n    return function() {\n        var e = new Error('get-stack-trace');\n        var stack = e && e.stack ? e.stack.replace(/^[^\\(]+?[\\n$]/gm, '')\n            .replace(/^\\s+at\\s+/gm, '')\n            .replace(/^Object.<anonymous>\\s*\\(/gm, '{anonymous}()@') : 'Unknown Stack Trace';\n\n        var log = window.console && (window.console.warn || window.console.log);\n        if (log) {\n            log.call(window.console, deprecationMessage, stack);\n        }\n        return method.apply(this, arguments);\n    };\n}\n\n/**\n * extend object.\n * means that properties in dest will be overwritten by the ones in src.\n * @param {Object} target\n * @param {...Object} objects_to_assign\n * @returns {Object} target\n */\nvar assign;\nif (typeof Object.assign !== 'function') {\n    assign = function assign(target) {\n        if (target === undefined || target === null) {\n            throw new TypeError('Cannot convert undefined or null to object');\n        }\n\n        var output = Object(target);\n        for (var index = 1; index < arguments.length; index++) {\n            var source = arguments[index];\n            if (source !== undefined && source !== null) {\n                for (var nextKey in source) {\n                    if (source.hasOwnProperty(nextKey)) {\n                        output[nextKey] = source[nextKey];\n                    }\n                }\n            }\n        }\n        return output;\n    };\n} else {\n    assign = Object.assign;\n}\n\n/**\n * extend object.\n * means that properties in dest will be overwritten by the ones in src.\n * @param {Object} dest\n * @param {Object} src\n * @param {Boolean} [merge=false]\n * @returns {Object} dest\n */\nvar extend = deprecate(function extend(dest, src, merge) {\n    var keys = Object.keys(src);\n    var i = 0;\n    while (i < keys.length) {\n        if (!merge || (merge && dest[keys[i]] === undefined)) {\n            dest[keys[i]] = src[keys[i]];\n        }\n        i++;\n    }\n    return dest;\n}, 'extend', 'Use `assign`.');\n\n/**\n * merge the values from src in the dest.\n * means that properties that exist in dest will not be overwritten by src\n * @param {Object} dest\n * @param {Object} src\n * @returns {Object} dest\n */\nvar merge = deprecate(function merge(dest, src) {\n    return extend(dest, src, true);\n}, 'merge', 'Use `assign`.');\n\n/**\n * simple class inheritance\n * @param {Function} child\n * @param {Function} base\n * @param {Object} [properties]\n */\nfunction inherit(child, base, properties) {\n    var baseP = base.prototype,\n        childP;\n\n    childP = child.prototype = Object.create(baseP);\n    childP.constructor = child;\n    childP._super = baseP;\n\n    if (properties) {\n        assign(childP, properties);\n    }\n}\n\n/**\n * simple function bind\n * @param {Function} fn\n * @param {Object} context\n * @returns {Function}\n */\nfunction bindFn(fn, context) {\n    return function boundFn() {\n        return fn.apply(context, arguments);\n    };\n}\n\n/**\n * let a boolean value also be a function that must return a boolean\n * this first item in args will be used as the context\n * @param {Boolean|Function} val\n * @param {Array} [args]\n * @returns {Boolean}\n */\nfunction boolOrFn(val, args) {\n    if (typeof val == TYPE_FUNCTION) {\n        return val.apply(args ? args[0] || undefined : undefined, args);\n    }\n    return val;\n}\n\n/**\n * use the val2 when val1 is undefined\n * @param {*} val1\n * @param {*} val2\n * @returns {*}\n */\nfunction ifUndefined(val1, val2) {\n    return (val1 === undefined) ? val2 : val1;\n}\n\n/**\n * addEventListener with multiple events at once\n * @param {EventTarget} target\n * @param {String} types\n * @param {Function} handler\n */\nfunction addEventListeners(target, types, handler) {\n    each(splitStr(types), function(type) {\n        target.addEventListener(type, handler, false);\n    });\n}\n\n/**\n * removeEventListener with multiple events at once\n * @param {EventTarget} target\n * @param {String} types\n * @param {Function} handler\n */\nfunction removeEventListeners(target, types, handler) {\n    each(splitStr(types), function(type) {\n        target.removeEventListener(type, handler, false);\n    });\n}\n\n/**\n * find if a node is in the given parent\n * @method hasParent\n * @param {HTMLElement} node\n * @param {HTMLElement} parent\n * @return {Boolean} found\n */\nfunction hasParent(node, parent) {\n    while (node) {\n        if (node == parent) {\n            return true;\n        }\n        node = node.parentNode;\n    }\n    return false;\n}\n\n/**\n * small indexOf wrapper\n * @param {String} str\n * @param {String} find\n * @returns {Boolean} found\n */\nfunction inStr(str, find) {\n    return str.indexOf(find) > -1;\n}\n\n/**\n * split string on whitespace\n * @param {String} str\n * @returns {Array} words\n */\nfunction splitStr(str) {\n    return str.trim().split(/\\s+/g);\n}\n\n/**\n * find if a array contains the object using indexOf or a simple polyFill\n * @param {Array} src\n * @param {String} find\n * @param {String} [findByKey]\n * @return {Boolean|Number} false when not found, or the index\n */\nfunction inArray(src, find, findByKey) {\n    if (src.indexOf && !findByKey) {\n        return src.indexOf(find);\n    } else {\n        var i = 0;\n        while (i < src.length) {\n            if ((findByKey && src[i][findByKey] == find) || (!findByKey && src[i] === find)) {\n                return i;\n            }\n            i++;\n        }\n        return -1;\n    }\n}\n\n/**\n * convert array-like objects to real arrays\n * @param {Object} obj\n * @returns {Array}\n */\nfunction toArray(obj) {\n    return Array.prototype.slice.call(obj, 0);\n}\n\n/**\n * unique array with objects based on a key (like 'id') or just by the array's value\n * @param {Array} src [{id:1},{id:2},{id:1}]\n * @param {String} [key]\n * @param {Boolean} [sort=False]\n * @returns {Array} [{id:1},{id:2}]\n */\nfunction uniqueArray(src, key, sort) {\n    var results = [];\n    var values = [];\n    var i = 0;\n\n    while (i < src.length) {\n        var val = key ? src[i][key] : src[i];\n        if (inArray(values, val) < 0) {\n            results.push(src[i]);\n        }\n        values[i] = val;\n        i++;\n    }\n\n    if (sort) {\n        if (!key) {\n            results = results.sort();\n        } else {\n            results = results.sort(function sortUniqueArray(a, b) {\n                return a[key] > b[key];\n            });\n        }\n    }\n\n    return results;\n}\n\n/**\n * get the prefixed property\n * @param {Object} obj\n * @param {String} property\n * @returns {String|Undefined} prefixed\n */\nfunction prefixed(obj, property) {\n    var prefix, prop;\n    var camelProp = property[0].toUpperCase() + property.slice(1);\n\n    var i = 0;\n    while (i < VENDOR_PREFIXES.length) {\n        prefix = VENDOR_PREFIXES[i];\n        prop = (prefix) ? prefix + camelProp : property;\n\n        if (prop in obj) {\n            return prop;\n        }\n        i++;\n    }\n    return undefined;\n}\n\n/**\n * get a unique id\n * @returns {number} uniqueId\n */\nvar _uniqueId = 1;\nfunction uniqueId() {\n    return _uniqueId++;\n}\n\n/**\n * get the window object of an element\n * @param {HTMLElement} element\n * @returns {DocumentView|Window}\n */\nfunction getWindowForElement(element) {\n    var doc = element.ownerDocument || element;\n    return (doc.defaultView || doc.parentWindow || window);\n}\n\nvar MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;\n\nvar SUPPORT_TOUCH = ('ontouchstart' in window);\nvar SUPPORT_POINTER_EVENTS = prefixed(window, 'PointerEvent') !== undefined;\nvar SUPPORT_ONLY_TOUCH = SUPPORT_TOUCH && MOBILE_REGEX.test(navigator.userAgent);\n\nvar INPUT_TYPE_TOUCH = 'touch';\nvar INPUT_TYPE_PEN = 'pen';\nvar INPUT_TYPE_MOUSE = 'mouse';\nvar INPUT_TYPE_KINECT = 'kinect';\n\nvar COMPUTE_INTERVAL = 25;\n\nvar INPUT_START = 1;\nvar INPUT_MOVE = 2;\nvar INPUT_END = 4;\nvar INPUT_CANCEL = 8;\n\nvar DIRECTION_NONE = 1;\nvar DIRECTION_LEFT = 2;\nvar DIRECTION_RIGHT = 4;\nvar DIRECTION_UP = 8;\nvar DIRECTION_DOWN = 16;\n\nvar DIRECTION_HORIZONTAL = DIRECTION_LEFT | DIRECTION_RIGHT;\nvar DIRECTION_VERTICAL = DIRECTION_UP | DIRECTION_DOWN;\nvar DIRECTION_ALL = DIRECTION_HORIZONTAL | DIRECTION_VERTICAL;\n\nvar PROPS_XY = ['x', 'y'];\nvar PROPS_CLIENT_XY = ['clientX', 'clientY'];\n\n/**\n * create new input type manager\n * @param {Manager} manager\n * @param {Function} callback\n * @returns {Input}\n * @constructor\n */\nfunction Input(manager, callback) {\n    var self = this;\n    this.manager = manager;\n    this.callback = callback;\n    this.element = manager.element;\n    this.target = manager.options.inputTarget;\n\n    // smaller wrapper around the handler, for the scope and the enabled state of the manager,\n    // so when disabled the input events are completely bypassed.\n    this.domHandler = function(ev) {\n        if (boolOrFn(manager.options.enable, [manager])) {\n            self.handler(ev);\n        }\n    };\n\n    this.init();\n\n}\n\nInput.prototype = {\n    /**\n     * should handle the inputEvent data and trigger the callback\n     * @virtual\n     */\n    handler: function() { },\n\n    /**\n     * bind the events\n     */\n    init: function() {\n        this.evEl && addEventListeners(this.element, this.evEl, this.domHandler);\n        this.evTarget && addEventListeners(this.target, this.evTarget, this.domHandler);\n        this.evWin && addEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\n    },\n\n    /**\n     * unbind the events\n     */\n    destroy: function() {\n        this.evEl && removeEventListeners(this.element, this.evEl, this.domHandler);\n        this.evTarget && removeEventListeners(this.target, this.evTarget, this.domHandler);\n        this.evWin && removeEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\n    }\n};\n\n/**\n * create new input type manager\n * called by the Manager constructor\n * @param {Hammer} manager\n * @returns {Input}\n */\nfunction createInputInstance(manager) {\n    var Type;\n    var inputClass = manager.options.inputClass;\n\n    if (inputClass) {\n        Type = inputClass;\n    } else if (SUPPORT_POINTER_EVENTS) {\n        Type = PointerEventInput;\n    } else if (SUPPORT_ONLY_TOUCH) {\n        Type = TouchInput;\n    } else if (!SUPPORT_TOUCH) {\n        Type = MouseInput;\n    } else {\n        Type = TouchMouseInput;\n    }\n    return new (Type)(manager, inputHandler);\n}\n\n/**\n * handle input events\n * @param {Manager} manager\n * @param {String} eventType\n * @param {Object} input\n */\nfunction inputHandler(manager, eventType, input) {\n    var pointersLen = input.pointers.length;\n    var changedPointersLen = input.changedPointers.length;\n    var isFirst = (eventType & INPUT_START && (pointersLen - changedPointersLen === 0));\n    var isFinal = (eventType & (INPUT_END | INPUT_CANCEL) && (pointersLen - changedPointersLen === 0));\n\n    input.isFirst = !!isFirst;\n    input.isFinal = !!isFinal;\n\n    if (isFirst) {\n        manager.session = {};\n    }\n\n    // source event is the normalized value of the domEvents\n    // like 'touchstart, mouseup, pointerdown'\n    input.eventType = eventType;\n\n    // compute scale, rotation etc\n    computeInputData(manager, input);\n\n    // emit secret event\n    manager.emit('hammer.input', input);\n\n    manager.recognize(input);\n    manager.session.prevInput = input;\n}\n\n/**\n * extend the data with some usable properties like scale, rotate, velocity etc\n * @param {Object} manager\n * @param {Object} input\n */\nfunction computeInputData(manager, input) {\n    var session = manager.session;\n    var pointers = input.pointers;\n    var pointersLength = pointers.length;\n\n    // store the first input to calculate the distance and direction\n    if (!session.firstInput) {\n        session.firstInput = simpleCloneInputData(input);\n    }\n\n    // to compute scale and rotation we need to store the multiple touches\n    if (pointersLength > 1 && !session.firstMultiple) {\n        session.firstMultiple = simpleCloneInputData(input);\n    } else if (pointersLength === 1) {\n        session.firstMultiple = false;\n    }\n\n    var firstInput = session.firstInput;\n    var firstMultiple = session.firstMultiple;\n    var offsetCenter = firstMultiple ? firstMultiple.center : firstInput.center;\n\n    var center = input.center = getCenter(pointers);\n    input.timeStamp = now();\n    input.deltaTime = input.timeStamp - firstInput.timeStamp;\n\n    input.angle = getAngle(offsetCenter, center);\n    input.distance = getDistance(offsetCenter, center);\n\n    computeDeltaXY(session, input);\n    input.offsetDirection = getDirection(input.deltaX, input.deltaY);\n\n    var overallVelocity = getVelocity(input.deltaTime, input.deltaX, input.deltaY);\n    input.overallVelocityX = overallVelocity.x;\n    input.overallVelocityY = overallVelocity.y;\n    input.overallVelocity = (abs(overallVelocity.x) > abs(overallVelocity.y)) ? overallVelocity.x : overallVelocity.y;\n\n    input.scale = firstMultiple ? getScale(firstMultiple.pointers, pointers) : 1;\n    input.rotation = firstMultiple ? getRotation(firstMultiple.pointers, pointers) : 0;\n\n    input.maxPointers = !session.prevInput ? input.pointers.length : ((input.pointers.length >\n        session.prevInput.maxPointers) ? input.pointers.length : session.prevInput.maxPointers);\n\n    computeIntervalInputData(session, input);\n\n    // find the correct target\n    var target = manager.element;\n    if (hasParent(input.srcEvent.target, target)) {\n        target = input.srcEvent.target;\n    }\n    input.target = target;\n}\n\nfunction computeDeltaXY(session, input) {\n    var center = input.center;\n    var offset = session.offsetDelta || {};\n    var prevDelta = session.prevDelta || {};\n    var prevInput = session.prevInput || {};\n\n    if (input.eventType === INPUT_START || prevInput.eventType === INPUT_END) {\n        prevDelta = session.prevDelta = {\n            x: prevInput.deltaX || 0,\n            y: prevInput.deltaY || 0\n        };\n\n        offset = session.offsetDelta = {\n            x: center.x,\n            y: center.y\n        };\n    }\n\n    input.deltaX = prevDelta.x + (center.x - offset.x);\n    input.deltaY = prevDelta.y + (center.y - offset.y);\n}\n\n/**\n * velocity is calculated every x ms\n * @param {Object} session\n * @param {Object} input\n */\nfunction computeIntervalInputData(session, input) {\n    var last = session.lastInterval || input,\n        deltaTime = input.timeStamp - last.timeStamp,\n        velocity, velocityX, velocityY, direction;\n\n    if (input.eventType != INPUT_CANCEL && (deltaTime > COMPUTE_INTERVAL || last.velocity === undefined)) {\n        var deltaX = input.deltaX - last.deltaX;\n        var deltaY = input.deltaY - last.deltaY;\n\n        var v = getVelocity(deltaTime, deltaX, deltaY);\n        velocityX = v.x;\n        velocityY = v.y;\n        velocity = (abs(v.x) > abs(v.y)) ? v.x : v.y;\n        direction = getDirection(deltaX, deltaY);\n\n        session.lastInterval = input;\n    } else {\n        // use latest velocity info if it doesn't overtake a minimum period\n        velocity = last.velocity;\n        velocityX = last.velocityX;\n        velocityY = last.velocityY;\n        direction = last.direction;\n    }\n\n    input.velocity = velocity;\n    input.velocityX = velocityX;\n    input.velocityY = velocityY;\n    input.direction = direction;\n}\n\n/**\n * create a simple clone from the input used for storage of firstInput and firstMultiple\n * @param {Object} input\n * @returns {Object} clonedInputData\n */\nfunction simpleCloneInputData(input) {\n    // make a simple copy of the pointers because we will get a reference if we don't\n    // we only need clientXY for the calculations\n    var pointers = [];\n    var i = 0;\n    while (i < input.pointers.length) {\n        pointers[i] = {\n            clientX: round(input.pointers[i].clientX),\n            clientY: round(input.pointers[i].clientY)\n        };\n        i++;\n    }\n\n    return {\n        timeStamp: now(),\n        pointers: pointers,\n        center: getCenter(pointers),\n        deltaX: input.deltaX,\n        deltaY: input.deltaY\n    };\n}\n\n/**\n * get the center of all the pointers\n * @param {Array} pointers\n * @return {Object} center contains `x` and `y` properties\n */\nfunction getCenter(pointers) {\n    var pointersLength = pointers.length;\n\n    // no need to loop when only one touch\n    if (pointersLength === 1) {\n        return {\n            x: round(pointers[0].clientX),\n            y: round(pointers[0].clientY)\n        };\n    }\n\n    var x = 0, y = 0, i = 0;\n    while (i < pointersLength) {\n        x += pointers[i].clientX;\n        y += pointers[i].clientY;\n        i++;\n    }\n\n    return {\n        x: round(x / pointersLength),\n        y: round(y / pointersLength)\n    };\n}\n\n/**\n * calculate the velocity between two points. unit is in px per ms.\n * @param {Number} deltaTime\n * @param {Number} x\n * @param {Number} y\n * @return {Object} velocity `x` and `y`\n */\nfunction getVelocity(deltaTime, x, y) {\n    return {\n        x: x / deltaTime || 0,\n        y: y / deltaTime || 0\n    };\n}\n\n/**\n * get the direction between two points\n * @param {Number} x\n * @param {Number} y\n * @return {Number} direction\n */\nfunction getDirection(x, y) {\n    if (x === y) {\n        return DIRECTION_NONE;\n    }\n\n    if (abs(x) >= abs(y)) {\n        return x < 0 ? DIRECTION_LEFT : DIRECTION_RIGHT;\n    }\n    return y < 0 ? DIRECTION_UP : DIRECTION_DOWN;\n}\n\n/**\n * calculate the absolute distance between two points\n * @param {Object} p1 {x, y}\n * @param {Object} p2 {x, y}\n * @param {Array} [props] containing x and y keys\n * @return {Number} distance\n */\nfunction getDistance(p1, p2, props) {\n    if (!props) {\n        props = PROPS_XY;\n    }\n    var x = p2[props[0]] - p1[props[0]],\n        y = p2[props[1]] - p1[props[1]];\n\n    return Math.sqrt((x * x) + (y * y));\n}\n\n/**\n * calculate the angle between two coordinates\n * @param {Object} p1\n * @param {Object} p2\n * @param {Array} [props] containing x and y keys\n * @return {Number} angle\n */\nfunction getAngle(p1, p2, props) {\n    if (!props) {\n        props = PROPS_XY;\n    }\n    var x = p2[props[0]] - p1[props[0]],\n        y = p2[props[1]] - p1[props[1]];\n    return Math.atan2(y, x) * 180 / Math.PI;\n}\n\n/**\n * calculate the rotation degrees between two pointersets\n * @param {Array} start array of pointers\n * @param {Array} end array of pointers\n * @return {Number} rotation\n */\nfunction getRotation(start, end) {\n    return getAngle(end[1], end[0], PROPS_CLIENT_XY) + getAngle(start[1], start[0], PROPS_CLIENT_XY);\n}\n\n/**\n * calculate the scale factor between two pointersets\n * no scale is 1, and goes down to 0 when pinched together, and bigger when pinched out\n * @param {Array} start array of pointers\n * @param {Array} end array of pointers\n * @return {Number} scale\n */\nfunction getScale(start, end) {\n    return getDistance(end[0], end[1], PROPS_CLIENT_XY) / getDistance(start[0], start[1], PROPS_CLIENT_XY);\n}\n\nvar MOUSE_INPUT_MAP = {\n    mousedown: INPUT_START,\n    mousemove: INPUT_MOVE,\n    mouseup: INPUT_END\n};\n\nvar MOUSE_ELEMENT_EVENTS = 'mousedown';\nvar MOUSE_WINDOW_EVENTS = 'mousemove mouseup';\n\n/**\n * Mouse events input\n * @constructor\n * @extends Input\n */\nfunction MouseInput() {\n    this.evEl = MOUSE_ELEMENT_EVENTS;\n    this.evWin = MOUSE_WINDOW_EVENTS;\n\n    this.pressed = false; // mousedown state\n\n    Input.apply(this, arguments);\n}\n\ninherit(MouseInput, Input, {\n    /**\n     * handle mouse events\n     * @param {Object} ev\n     */\n    handler: function MEhandler(ev) {\n        var eventType = MOUSE_INPUT_MAP[ev.type];\n\n        // on start we want to have the left mouse button down\n        if (eventType & INPUT_START && ev.button === 0) {\n            this.pressed = true;\n        }\n\n        if (eventType & INPUT_MOVE && ev.which !== 1) {\n            eventType = INPUT_END;\n        }\n\n        // mouse must be down\n        if (!this.pressed) {\n            return;\n        }\n\n        if (eventType & INPUT_END) {\n            this.pressed = false;\n        }\n\n        this.callback(this.manager, eventType, {\n            pointers: [ev],\n            changedPointers: [ev],\n            pointerType: INPUT_TYPE_MOUSE,\n            srcEvent: ev\n        });\n    }\n});\n\nvar POINTER_INPUT_MAP = {\n    pointerdown: INPUT_START,\n    pointermove: INPUT_MOVE,\n    pointerup: INPUT_END,\n    pointercancel: INPUT_CANCEL,\n    pointerout: INPUT_CANCEL\n};\n\n// in IE10 the pointer types is defined as an enum\nvar IE10_POINTER_TYPE_ENUM = {\n    2: INPUT_TYPE_TOUCH,\n    3: INPUT_TYPE_PEN,\n    4: INPUT_TYPE_MOUSE,\n    5: INPUT_TYPE_KINECT // see https://twitter.com/jacobrossi/status/480596438489890816\n};\n\nvar POINTER_ELEMENT_EVENTS = 'pointerdown';\nvar POINTER_WINDOW_EVENTS = 'pointermove pointerup pointercancel';\n\n// IE10 has prefixed support, and case-sensitive\nif (window.MSPointerEvent && !window.PointerEvent) {\n    POINTER_ELEMENT_EVENTS = 'MSPointerDown';\n    POINTER_WINDOW_EVENTS = 'MSPointerMove MSPointerUp MSPointerCancel';\n}\n\n/**\n * Pointer events input\n * @constructor\n * @extends Input\n */\nfunction PointerEventInput() {\n    this.evEl = POINTER_ELEMENT_EVENTS;\n    this.evWin = POINTER_WINDOW_EVENTS;\n\n    Input.apply(this, arguments);\n\n    this.store = (this.manager.session.pointerEvents = []);\n}\n\ninherit(PointerEventInput, Input, {\n    /**\n     * handle mouse events\n     * @param {Object} ev\n     */\n    handler: function PEhandler(ev) {\n        var store = this.store;\n        var removePointer = false;\n\n        var eventTypeNormalized = ev.type.toLowerCase().replace('ms', '');\n        var eventType = POINTER_INPUT_MAP[eventTypeNormalized];\n        var pointerType = IE10_POINTER_TYPE_ENUM[ev.pointerType] || ev.pointerType;\n\n        var isTouch = (pointerType == INPUT_TYPE_TOUCH);\n\n        // get index of the event in the store\n        var storeIndex = inArray(store, ev.pointerId, 'pointerId');\n\n        // start and mouse must be down\n        if (eventType & INPUT_START && (ev.button === 0 || isTouch)) {\n            if (storeIndex < 0) {\n                store.push(ev);\n                storeIndex = store.length - 1;\n            }\n        } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\n            removePointer = true;\n        }\n\n        // it not found, so the pointer hasn't been down (so it's probably a hover)\n        if (storeIndex < 0) {\n            return;\n        }\n\n        // update the event in the store\n        store[storeIndex] = ev;\n\n        this.callback(this.manager, eventType, {\n            pointers: store,\n            changedPointers: [ev],\n            pointerType: pointerType,\n            srcEvent: ev\n        });\n\n        if (removePointer) {\n            // remove from the store\n            store.splice(storeIndex, 1);\n        }\n    }\n});\n\nvar SINGLE_TOUCH_INPUT_MAP = {\n    touchstart: INPUT_START,\n    touchmove: INPUT_MOVE,\n    touchend: INPUT_END,\n    touchcancel: INPUT_CANCEL\n};\n\nvar SINGLE_TOUCH_TARGET_EVENTS = 'touchstart';\nvar SINGLE_TOUCH_WINDOW_EVENTS = 'touchstart touchmove touchend touchcancel';\n\n/**\n * Touch events input\n * @constructor\n * @extends Input\n */\nfunction SingleTouchInput() {\n    this.evTarget = SINGLE_TOUCH_TARGET_EVENTS;\n    this.evWin = SINGLE_TOUCH_WINDOW_EVENTS;\n    this.started = false;\n\n    Input.apply(this, arguments);\n}\n\ninherit(SingleTouchInput, Input, {\n    handler: function TEhandler(ev) {\n        var type = SINGLE_TOUCH_INPUT_MAP[ev.type];\n\n        // should we handle the touch events?\n        if (type === INPUT_START) {\n            this.started = true;\n        }\n\n        if (!this.started) {\n            return;\n        }\n\n        var touches = normalizeSingleTouches.call(this, ev, type);\n\n        // when done, reset the started state\n        if (type & (INPUT_END | INPUT_CANCEL) && touches[0].length - touches[1].length === 0) {\n            this.started = false;\n        }\n\n        this.callback(this.manager, type, {\n            pointers: touches[0],\n            changedPointers: touches[1],\n            pointerType: INPUT_TYPE_TOUCH,\n            srcEvent: ev\n        });\n    }\n});\n\n/**\n * @this {TouchInput}\n * @param {Object} ev\n * @param {Number} type flag\n * @returns {undefined|Array} [all, changed]\n */\nfunction normalizeSingleTouches(ev, type) {\n    var all = toArray(ev.touches);\n    var changed = toArray(ev.changedTouches);\n\n    if (type & (INPUT_END | INPUT_CANCEL)) {\n        all = uniqueArray(all.concat(changed), 'identifier', true);\n    }\n\n    return [all, changed];\n}\n\nvar TOUCH_INPUT_MAP = {\n    touchstart: INPUT_START,\n    touchmove: INPUT_MOVE,\n    touchend: INPUT_END,\n    touchcancel: INPUT_CANCEL\n};\n\nvar TOUCH_TARGET_EVENTS = 'touchstart touchmove touchend touchcancel';\n\n/**\n * Multi-user touch events input\n * @constructor\n * @extends Input\n */\nfunction TouchInput() {\n    this.evTarget = TOUCH_TARGET_EVENTS;\n    this.targetIds = {};\n\n    Input.apply(this, arguments);\n}\n\ninherit(TouchInput, Input, {\n    handler: function MTEhandler(ev) {\n        var type = TOUCH_INPUT_MAP[ev.type];\n        var touches = getTouches.call(this, ev, type);\n        if (!touches) {\n            return;\n        }\n\n        this.callback(this.manager, type, {\n            pointers: touches[0],\n            changedPointers: touches[1],\n            pointerType: INPUT_TYPE_TOUCH,\n            srcEvent: ev\n        });\n    }\n});\n\n/**\n * @this {TouchInput}\n * @param {Object} ev\n * @param {Number} type flag\n * @returns {undefined|Array} [all, changed]\n */\nfunction getTouches(ev, type) {\n    var allTouches = toArray(ev.touches);\n    var targetIds = this.targetIds;\n\n    // when there is only one touch, the process can be simplified\n    if (type & (INPUT_START | INPUT_MOVE) && allTouches.length === 1) {\n        targetIds[allTouches[0].identifier] = true;\n        return [allTouches, allTouches];\n    }\n\n    var i,\n        targetTouches,\n        changedTouches = toArray(ev.changedTouches),\n        changedTargetTouches = [],\n        target = this.target;\n\n    // get target touches from touches\n    targetTouches = allTouches.filter(function(touch) {\n        return hasParent(touch.target, target);\n    });\n\n    // collect touches\n    if (type === INPUT_START) {\n        i = 0;\n        while (i < targetTouches.length) {\n            targetIds[targetTouches[i].identifier] = true;\n            i++;\n        }\n    }\n\n    // filter changed touches to only contain touches that exist in the collected target ids\n    i = 0;\n    while (i < changedTouches.length) {\n        if (targetIds[changedTouches[i].identifier]) {\n            changedTargetTouches.push(changedTouches[i]);\n        }\n\n        // cleanup removed touches\n        if (type & (INPUT_END | INPUT_CANCEL)) {\n            delete targetIds[changedTouches[i].identifier];\n        }\n        i++;\n    }\n\n    if (!changedTargetTouches.length) {\n        return;\n    }\n\n    return [\n        // merge targetTouches with changedTargetTouches so it contains ALL touches, including 'end' and 'cancel'\n        uniqueArray(targetTouches.concat(changedTargetTouches), 'identifier', true),\n        changedTargetTouches\n    ];\n}\n\n/**\n * Combined touch and mouse input\n *\n * Touch has a higher priority then mouse, and while touching no mouse events are allowed.\n * This because touch devices also emit mouse events while doing a touch.\n *\n * @constructor\n * @extends Input\n */\n\nvar DEDUP_TIMEOUT = 2500;\nvar DEDUP_DISTANCE = 25;\n\nfunction TouchMouseInput() {\n    Input.apply(this, arguments);\n\n    var handler = bindFn(this.handler, this);\n    this.touch = new TouchInput(this.manager, handler);\n    this.mouse = new MouseInput(this.manager, handler);\n\n    this.primaryTouch = null;\n    this.lastTouches = [];\n}\n\ninherit(TouchMouseInput, Input, {\n    /**\n     * handle mouse and touch events\n     * @param {Hammer} manager\n     * @param {String} inputEvent\n     * @param {Object} inputData\n     */\n    handler: function TMEhandler(manager, inputEvent, inputData) {\n        var isTouch = (inputData.pointerType == INPUT_TYPE_TOUCH),\n            isMouse = (inputData.pointerType == INPUT_TYPE_MOUSE);\n\n        if (isMouse && inputData.sourceCapabilities && inputData.sourceCapabilities.firesTouchEvents) {\n            return;\n        }\n\n        // when we're in a touch event, record touches to  de-dupe synthetic mouse event\n        if (isTouch) {\n            recordTouches.call(this, inputEvent, inputData);\n        } else if (isMouse && isSyntheticEvent.call(this, inputData)) {\n            return;\n        }\n\n        this.callback(manager, inputEvent, inputData);\n    },\n\n    /**\n     * remove the event listeners\n     */\n    destroy: function destroy() {\n        this.touch.destroy();\n        this.mouse.destroy();\n    }\n});\n\nfunction recordTouches(eventType, eventData) {\n    if (eventType & INPUT_START) {\n        this.primaryTouch = eventData.changedPointers[0].identifier;\n        setLastTouch.call(this, eventData);\n    } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\n        setLastTouch.call(this, eventData);\n    }\n}\n\nfunction setLastTouch(eventData) {\n    var touch = eventData.changedPointers[0];\n\n    if (touch.identifier === this.primaryTouch) {\n        var lastTouch = {x: touch.clientX, y: touch.clientY};\n        this.lastTouches.push(lastTouch);\n        var lts = this.lastTouches;\n        var removeLastTouch = function() {\n            var i = lts.indexOf(lastTouch);\n            if (i > -1) {\n                lts.splice(i, 1);\n            }\n        };\n        setTimeout(removeLastTouch, DEDUP_TIMEOUT);\n    }\n}\n\nfunction isSyntheticEvent(eventData) {\n    var x = eventData.srcEvent.clientX, y = eventData.srcEvent.clientY;\n    for (var i = 0; i < this.lastTouches.length; i++) {\n        var t = this.lastTouches[i];\n        var dx = Math.abs(x - t.x), dy = Math.abs(y - t.y);\n        if (dx <= DEDUP_DISTANCE && dy <= DEDUP_DISTANCE) {\n            return true;\n        }\n    }\n    return false;\n}\n\nvar PREFIXED_TOUCH_ACTION = prefixed(TEST_ELEMENT.style, 'touchAction');\nvar NATIVE_TOUCH_ACTION = PREFIXED_TOUCH_ACTION !== undefined;\n\n// magical touchAction value\nvar TOUCH_ACTION_COMPUTE = 'compute';\nvar TOUCH_ACTION_AUTO = 'auto';\nvar TOUCH_ACTION_MANIPULATION = 'manipulation'; // not implemented\nvar TOUCH_ACTION_NONE = 'none';\nvar TOUCH_ACTION_PAN_X = 'pan-x';\nvar TOUCH_ACTION_PAN_Y = 'pan-y';\nvar TOUCH_ACTION_MAP = getTouchActionProps();\n\n/**\n * Touch Action\n * sets the touchAction property or uses the js alternative\n * @param {Manager} manager\n * @param {String} value\n * @constructor\n */\nfunction TouchAction(manager, value) {\n    this.manager = manager;\n    this.set(value);\n}\n\nTouchAction.prototype = {\n    /**\n     * set the touchAction value on the element or enable the polyfill\n     * @param {String} value\n     */\n    set: function(value) {\n        // find out the touch-action by the event handlers\n        if (value == TOUCH_ACTION_COMPUTE) {\n            value = this.compute();\n        }\n\n        if (NATIVE_TOUCH_ACTION && this.manager.element.style && TOUCH_ACTION_MAP[value]) {\n            this.manager.element.style[PREFIXED_TOUCH_ACTION] = value;\n        }\n        this.actions = value.toLowerCase().trim();\n    },\n\n    /**\n     * just re-set the touchAction value\n     */\n    update: function() {\n        this.set(this.manager.options.touchAction);\n    },\n\n    /**\n     * compute the value for the touchAction property based on the recognizer's settings\n     * @returns {String} value\n     */\n    compute: function() {\n        var actions = [];\n        each(this.manager.recognizers, function(recognizer) {\n            if (boolOrFn(recognizer.options.enable, [recognizer])) {\n                actions = actions.concat(recognizer.getTouchAction());\n            }\n        });\n        return cleanTouchActions(actions.join(' '));\n    },\n\n    /**\n     * this method is called on each input cycle and provides the preventing of the browser behavior\n     * @param {Object} input\n     */\n    preventDefaults: function(input) {\n        var srcEvent = input.srcEvent;\n        var direction = input.offsetDirection;\n\n        // if the touch action did prevented once this session\n        if (this.manager.session.prevented) {\n            srcEvent.preventDefault();\n            return;\n        }\n\n        var actions = this.actions;\n        var hasNone = inStr(actions, TOUCH_ACTION_NONE) && !TOUCH_ACTION_MAP[TOUCH_ACTION_NONE];\n        var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y];\n        var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];\n\n        if (hasNone) {\n            //do not prevent defaults if this is a tap gesture\n\n            var isTapPointer = input.pointers.length === 1;\n            var isTapMovement = input.distance < 2;\n            var isTapTouchTime = input.deltaTime < 250;\n\n            if (isTapPointer && isTapMovement && isTapTouchTime) {\n                return;\n            }\n        }\n\n        if (hasPanX && hasPanY) {\n            // `pan-x pan-y` means browser handles all scrolling/panning, do not prevent\n            return;\n        }\n\n        if (hasNone ||\n            (hasPanY && direction & DIRECTION_HORIZONTAL) ||\n            (hasPanX && direction & DIRECTION_VERTICAL)) {\n            return this.preventSrc(srcEvent);\n        }\n    },\n\n    /**\n     * call preventDefault to prevent the browser's default behavior (scrolling in most cases)\n     * @param {Object} srcEvent\n     */\n    preventSrc: function(srcEvent) {\n        this.manager.session.prevented = true;\n        srcEvent.preventDefault();\n    }\n};\n\n/**\n * when the touchActions are collected they are not a valid value, so we need to clean things up. *\n * @param {String} actions\n * @returns {*}\n */\nfunction cleanTouchActions(actions) {\n    // none\n    if (inStr(actions, TOUCH_ACTION_NONE)) {\n        return TOUCH_ACTION_NONE;\n    }\n\n    var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X);\n    var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y);\n\n    // if both pan-x and pan-y are set (different recognizers\n    // for different directions, e.g. horizontal pan but vertical swipe?)\n    // we need none (as otherwise with pan-x pan-y combined none of these\n    // recognizers will work, since the browser would handle all panning\n    if (hasPanX && hasPanY) {\n        return TOUCH_ACTION_NONE;\n    }\n\n    // pan-x OR pan-y\n    if (hasPanX || hasPanY) {\n        return hasPanX ? TOUCH_ACTION_PAN_X : TOUCH_ACTION_PAN_Y;\n    }\n\n    // manipulation\n    if (inStr(actions, TOUCH_ACTION_MANIPULATION)) {\n        return TOUCH_ACTION_MANIPULATION;\n    }\n\n    return TOUCH_ACTION_AUTO;\n}\n\nfunction getTouchActionProps() {\n    if (!NATIVE_TOUCH_ACTION) {\n        return false;\n    }\n    var touchMap = {};\n    var cssSupports = window.CSS && window.CSS.supports;\n    ['auto', 'manipulation', 'pan-y', 'pan-x', 'pan-x pan-y', 'none'].forEach(function(val) {\n\n        // If css.supports is not supported but there is native touch-action assume it supports\n        // all values. This is the case for IE 10 and 11.\n        touchMap[val] = cssSupports ? window.CSS.supports('touch-action', val) : true;\n    });\n    return touchMap;\n}\n\n/**\n * Recognizer flow explained; *\n * All recognizers have the initial state of POSSIBLE when a input session starts.\n * The definition of a input session is from the first input until the last input, with all it's movement in it. *\n * Example session for mouse-input: mousedown -> mousemove -> mouseup\n *\n * On each recognizing cycle (see Manager.recognize) the .recognize() method is executed\n * which determines with state it should be.\n *\n * If the recognizer has the state FAILED, CANCELLED or RECOGNIZED (equals ENDED), it is reset to\n * POSSIBLE to give it another change on the next cycle.\n *\n *               Possible\n *                  |\n *            +-----+---------------+\n *            |                     |\n *      +-----+-----+               |\n *      |           |               |\n *   Failed      Cancelled          |\n *                          +-------+------+\n *                          |              |\n *                      Recognized       Began\n *                                         |\n *                                      Changed\n *                                         |\n *                                  Ended/Recognized\n */\nvar STATE_POSSIBLE = 1;\nvar STATE_BEGAN = 2;\nvar STATE_CHANGED = 4;\nvar STATE_ENDED = 8;\nvar STATE_RECOGNIZED = STATE_ENDED;\nvar STATE_CANCELLED = 16;\nvar STATE_FAILED = 32;\n\n/**\n * Recognizer\n * Every recognizer needs to extend from this class.\n * @constructor\n * @param {Object} options\n */\nfunction Recognizer(options) {\n    this.options = assign({}, this.defaults, options || {});\n\n    this.id = uniqueId();\n\n    this.manager = null;\n\n    // default is enable true\n    this.options.enable = ifUndefined(this.options.enable, true);\n\n    this.state = STATE_POSSIBLE;\n\n    this.simultaneous = {};\n    this.requireFail = [];\n}\n\nRecognizer.prototype = {\n    /**\n     * @virtual\n     * @type {Object}\n     */\n    defaults: {},\n\n    /**\n     * set options\n     * @param {Object} options\n     * @return {Recognizer}\n     */\n    set: function(options) {\n        assign(this.options, options);\n\n        // also update the touchAction, in case something changed about the directions/enabled state\n        this.manager && this.manager.touchAction.update();\n        return this;\n    },\n\n    /**\n     * recognize simultaneous with an other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    recognizeWith: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'recognizeWith', this)) {\n            return this;\n        }\n\n        var simultaneous = this.simultaneous;\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        if (!simultaneous[otherRecognizer.id]) {\n            simultaneous[otherRecognizer.id] = otherRecognizer;\n            otherRecognizer.recognizeWith(this);\n        }\n        return this;\n    },\n\n    /**\n     * drop the simultaneous link. it doesnt remove the link on the other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    dropRecognizeWith: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'dropRecognizeWith', this)) {\n            return this;\n        }\n\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        delete this.simultaneous[otherRecognizer.id];\n        return this;\n    },\n\n    /**\n     * recognizer can only run when an other is failing\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    requireFailure: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'requireFailure', this)) {\n            return this;\n        }\n\n        var requireFail = this.requireFail;\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        if (inArray(requireFail, otherRecognizer) === -1) {\n            requireFail.push(otherRecognizer);\n            otherRecognizer.requireFailure(this);\n        }\n        return this;\n    },\n\n    /**\n     * drop the requireFailure link. it does not remove the link on the other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    dropRequireFailure: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'dropRequireFailure', this)) {\n            return this;\n        }\n\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        var index = inArray(this.requireFail, otherRecognizer);\n        if (index > -1) {\n            this.requireFail.splice(index, 1);\n        }\n        return this;\n    },\n\n    /**\n     * has require failures boolean\n     * @returns {boolean}\n     */\n    hasRequireFailures: function() {\n        return this.requireFail.length > 0;\n    },\n\n    /**\n     * if the recognizer can recognize simultaneous with an other recognizer\n     * @param {Recognizer} otherRecognizer\n     * @returns {Boolean}\n     */\n    canRecognizeWith: function(otherRecognizer) {\n        return !!this.simultaneous[otherRecognizer.id];\n    },\n\n    /**\n     * You should use `tryEmit` instead of `emit` directly to check\n     * that all the needed recognizers has failed before emitting.\n     * @param {Object} input\n     */\n    emit: function(input) {\n        var self = this;\n        var state = this.state;\n\n        function emit(event) {\n            self.manager.emit(event, input);\n        }\n\n        // 'panstart' and 'panmove'\n        if (state < STATE_ENDED) {\n            emit(self.options.event + stateStr(state));\n        }\n\n        emit(self.options.event); // simple 'eventName' events\n\n        if (input.additionalEvent) { // additional event(panleft, panright, pinchin, pinchout...)\n            emit(input.additionalEvent);\n        }\n\n        // panend and pancancel\n        if (state >= STATE_ENDED) {\n            emit(self.options.event + stateStr(state));\n        }\n    },\n\n    /**\n     * Check that all the require failure recognizers has failed,\n     * if true, it emits a gesture event,\n     * otherwise, setup the state to FAILED.\n     * @param {Object} input\n     */\n    tryEmit: function(input) {\n        if (this.canEmit()) {\n            return this.emit(input);\n        }\n        // it's failing anyway\n        this.state = STATE_FAILED;\n    },\n\n    /**\n     * can we emit?\n     * @returns {boolean}\n     */\n    canEmit: function() {\n        var i = 0;\n        while (i < this.requireFail.length) {\n            if (!(this.requireFail[i].state & (STATE_FAILED | STATE_POSSIBLE))) {\n                return false;\n            }\n            i++;\n        }\n        return true;\n    },\n\n    /**\n     * update the recognizer\n     * @param {Object} inputData\n     */\n    recognize: function(inputData) {\n        // make a new copy of the inputData\n        // so we can change the inputData without messing up the other recognizers\n        var inputDataClone = assign({}, inputData);\n\n        // is is enabled and allow recognizing?\n        if (!boolOrFn(this.options.enable, [this, inputDataClone])) {\n            this.reset();\n            this.state = STATE_FAILED;\n            return;\n        }\n\n        // reset when we've reached the end\n        if (this.state & (STATE_RECOGNIZED | STATE_CANCELLED | STATE_FAILED)) {\n            this.state = STATE_POSSIBLE;\n        }\n\n        this.state = this.process(inputDataClone);\n\n        // the recognizer has recognized a gesture\n        // so trigger an event\n        if (this.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED | STATE_CANCELLED)) {\n            this.tryEmit(inputDataClone);\n        }\n    },\n\n    /**\n     * return the state of the recognizer\n     * the actual recognizing happens in this method\n     * @virtual\n     * @param {Object} inputData\n     * @returns {Const} STATE\n     */\n    process: function(inputData) { }, // jshint ignore:line\n\n    /**\n     * return the preferred touch-action\n     * @virtual\n     * @returns {Array}\n     */\n    getTouchAction: function() { },\n\n    /**\n     * called when the gesture isn't allowed to recognize\n     * like when another is being recognized or it is disabled\n     * @virtual\n     */\n    reset: function() { }\n};\n\n/**\n * get a usable string, used as event postfix\n * @param {Const} state\n * @returns {String} state\n */\nfunction stateStr(state) {\n    if (state & STATE_CANCELLED) {\n        return 'cancel';\n    } else if (state & STATE_ENDED) {\n        return 'end';\n    } else if (state & STATE_CHANGED) {\n        return 'move';\n    } else if (state & STATE_BEGAN) {\n        return 'start';\n    }\n    return '';\n}\n\n/**\n * direction cons to string\n * @param {Const} direction\n * @returns {String}\n */\nfunction directionStr(direction) {\n    if (direction == DIRECTION_DOWN) {\n        return 'down';\n    } else if (direction == DIRECTION_UP) {\n        return 'up';\n    } else if (direction == DIRECTION_LEFT) {\n        return 'left';\n    } else if (direction == DIRECTION_RIGHT) {\n        return 'right';\n    }\n    return '';\n}\n\n/**\n * get a recognizer by name if it is bound to a manager\n * @param {Recognizer|String} otherRecognizer\n * @param {Recognizer} recognizer\n * @returns {Recognizer}\n */\nfunction getRecognizerByNameIfManager(otherRecognizer, recognizer) {\n    var manager = recognizer.manager;\n    if (manager) {\n        return manager.get(otherRecognizer);\n    }\n    return otherRecognizer;\n}\n\n/**\n * This recognizer is just used as a base for the simple attribute recognizers.\n * @constructor\n * @extends Recognizer\n */\nfunction AttrRecognizer() {\n    Recognizer.apply(this, arguments);\n}\n\ninherit(AttrRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof AttrRecognizer\n     */\n    defaults: {\n        /**\n         * @type {Number}\n         * @default 1\n         */\n        pointers: 1\n    },\n\n    /**\n     * Used to check if it the recognizer receives valid input, like input.distance > 10.\n     * @memberof AttrRecognizer\n     * @param {Object} input\n     * @returns {Boolean} recognized\n     */\n    attrTest: function(input) {\n        var optionPointers = this.options.pointers;\n        return optionPointers === 0 || input.pointers.length === optionPointers;\n    },\n\n    /**\n     * Process the input and return the state for the recognizer\n     * @memberof AttrRecognizer\n     * @param {Object} input\n     * @returns {*} State\n     */\n    process: function(input) {\n        var state = this.state;\n        var eventType = input.eventType;\n\n        var isRecognized = state & (STATE_BEGAN | STATE_CHANGED);\n        var isValid = this.attrTest(input);\n\n        // on cancel input and we've recognized before, return STATE_CANCELLED\n        if (isRecognized && (eventType & INPUT_CANCEL || !isValid)) {\n            return state | STATE_CANCELLED;\n        } else if (isRecognized || isValid) {\n            if (eventType & INPUT_END) {\n                return state | STATE_ENDED;\n            } else if (!(state & STATE_BEGAN)) {\n                return STATE_BEGAN;\n            }\n            return state | STATE_CHANGED;\n        }\n        return STATE_FAILED;\n    }\n});\n\n/**\n * Pan\n * Recognized when the pointer is down and moved in the allowed direction.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction PanRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n\n    this.pX = null;\n    this.pY = null;\n}\n\ninherit(PanRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof PanRecognizer\n     */\n    defaults: {\n        event: 'pan',\n        threshold: 10,\n        pointers: 1,\n        direction: DIRECTION_ALL\n    },\n\n    getTouchAction: function() {\n        var direction = this.options.direction;\n        var actions = [];\n        if (direction & DIRECTION_HORIZONTAL) {\n            actions.push(TOUCH_ACTION_PAN_Y);\n        }\n        if (direction & DIRECTION_VERTICAL) {\n            actions.push(TOUCH_ACTION_PAN_X);\n        }\n        return actions;\n    },\n\n    directionTest: function(input) {\n        var options = this.options;\n        var hasMoved = true;\n        var distance = input.distance;\n        var direction = input.direction;\n        var x = input.deltaX;\n        var y = input.deltaY;\n\n        // lock to axis?\n        if (!(direction & options.direction)) {\n            if (options.direction & DIRECTION_HORIZONTAL) {\n                direction = (x === 0) ? DIRECTION_NONE : (x < 0) ? DIRECTION_LEFT : DIRECTION_RIGHT;\n                hasMoved = x != this.pX;\n                distance = Math.abs(input.deltaX);\n            } else {\n                direction = (y === 0) ? DIRECTION_NONE : (y < 0) ? DIRECTION_UP : DIRECTION_DOWN;\n                hasMoved = y != this.pY;\n                distance = Math.abs(input.deltaY);\n            }\n        }\n        input.direction = direction;\n        return hasMoved && distance > options.threshold && direction & options.direction;\n    },\n\n    attrTest: function(input) {\n        return AttrRecognizer.prototype.attrTest.call(this, input) &&\n            (this.state & STATE_BEGAN || (!(this.state & STATE_BEGAN) && this.directionTest(input)));\n    },\n\n    emit: function(input) {\n\n        this.pX = input.deltaX;\n        this.pY = input.deltaY;\n\n        var direction = directionStr(input.direction);\n\n        if (direction) {\n            input.additionalEvent = this.options.event + direction;\n        }\n        this._super.emit.call(this, input);\n    }\n});\n\n/**\n * Pinch\n * Recognized when two or more pointers are moving toward (zoom-in) or away from each other (zoom-out).\n * @constructor\n * @extends AttrRecognizer\n */\nfunction PinchRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(PinchRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof PinchRecognizer\n     */\n    defaults: {\n        event: 'pinch',\n        threshold: 0,\n        pointers: 2\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_NONE];\n    },\n\n    attrTest: function(input) {\n        return this._super.attrTest.call(this, input) &&\n            (Math.abs(input.scale - 1) > this.options.threshold || this.state & STATE_BEGAN);\n    },\n\n    emit: function(input) {\n        if (input.scale !== 1) {\n            var inOut = input.scale < 1 ? 'in' : 'out';\n            input.additionalEvent = this.options.event + inOut;\n        }\n        this._super.emit.call(this, input);\n    }\n});\n\n/**\n * Press\n * Recognized when the pointer is down for x ms without any movement.\n * @constructor\n * @extends Recognizer\n */\nfunction PressRecognizer() {\n    Recognizer.apply(this, arguments);\n\n    this._timer = null;\n    this._input = null;\n}\n\ninherit(PressRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof PressRecognizer\n     */\n    defaults: {\n        event: 'press',\n        pointers: 1,\n        time: 251, // minimal time of the pointer to be pressed\n        threshold: 9 // a minimal movement is ok, but keep it low\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_AUTO];\n    },\n\n    process: function(input) {\n        var options = this.options;\n        var validPointers = input.pointers.length === options.pointers;\n        var validMovement = input.distance < options.threshold;\n        var validTime = input.deltaTime > options.time;\n\n        this._input = input;\n\n        // we only allow little movement\n        // and we've reached an end event, so a tap is possible\n        if (!validMovement || !validPointers || (input.eventType & (INPUT_END | INPUT_CANCEL) && !validTime)) {\n            this.reset();\n        } else if (input.eventType & INPUT_START) {\n            this.reset();\n            this._timer = setTimeoutContext(function() {\n                this.state = STATE_RECOGNIZED;\n                this.tryEmit();\n            }, options.time, this);\n        } else if (input.eventType & INPUT_END) {\n            return STATE_RECOGNIZED;\n        }\n        return STATE_FAILED;\n    },\n\n    reset: function() {\n        clearTimeout(this._timer);\n    },\n\n    emit: function(input) {\n        if (this.state !== STATE_RECOGNIZED) {\n            return;\n        }\n\n        if (input && (input.eventType & INPUT_END)) {\n            this.manager.emit(this.options.event + 'up', input);\n        } else {\n            this._input.timeStamp = now();\n            this.manager.emit(this.options.event, this._input);\n        }\n    }\n});\n\n/**\n * Rotate\n * Recognized when two or more pointer are moving in a circular motion.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction RotateRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(RotateRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof RotateRecognizer\n     */\n    defaults: {\n        event: 'rotate',\n        threshold: 0,\n        pointers: 2\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_NONE];\n    },\n\n    attrTest: function(input) {\n        return this._super.attrTest.call(this, input) &&\n            (Math.abs(input.rotation) > this.options.threshold || this.state & STATE_BEGAN);\n    }\n});\n\n/**\n * Swipe\n * Recognized when the pointer is moving fast (velocity), with enough distance in the allowed direction.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction SwipeRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(SwipeRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof SwipeRecognizer\n     */\n    defaults: {\n        event: 'swipe',\n        threshold: 10,\n        velocity: 0.3,\n        direction: DIRECTION_HORIZONTAL | DIRECTION_VERTICAL,\n        pointers: 1\n    },\n\n    getTouchAction: function() {\n        return PanRecognizer.prototype.getTouchAction.call(this);\n    },\n\n    attrTest: function(input) {\n        var direction = this.options.direction;\n        var velocity;\n\n        if (direction & (DIRECTION_HORIZONTAL | DIRECTION_VERTICAL)) {\n            velocity = input.overallVelocity;\n        } else if (direction & DIRECTION_HORIZONTAL) {\n            velocity = input.overallVelocityX;\n        } else if (direction & DIRECTION_VERTICAL) {\n            velocity = input.overallVelocityY;\n        }\n\n        return this._super.attrTest.call(this, input) &&\n            direction & input.offsetDirection &&\n            input.distance > this.options.threshold &&\n            input.maxPointers == this.options.pointers &&\n            abs(velocity) > this.options.velocity && input.eventType & INPUT_END;\n    },\n\n    emit: function(input) {\n        var direction = directionStr(input.offsetDirection);\n        if (direction) {\n            this.manager.emit(this.options.event + direction, input);\n        }\n\n        this.manager.emit(this.options.event, input);\n    }\n});\n\n/**\n * A tap is ecognized when the pointer is doing a small tap/click. Multiple taps are recognized if they occur\n * between the given interval and position. The delay option can be used to recognize multi-taps without firing\n * a single tap.\n *\n * The eventData from the emitted event contains the property `tapCount`, which contains the amount of\n * multi-taps being recognized.\n * @constructor\n * @extends Recognizer\n */\nfunction TapRecognizer() {\n    Recognizer.apply(this, arguments);\n\n    // previous time and center,\n    // used for tap counting\n    this.pTime = false;\n    this.pCenter = false;\n\n    this._timer = null;\n    this._input = null;\n    this.count = 0;\n}\n\ninherit(TapRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof PinchRecognizer\n     */\n    defaults: {\n        event: 'tap',\n        pointers: 1,\n        taps: 1,\n        interval: 300, // max time between the multi-tap taps\n        time: 250, // max time of the pointer to be down (like finger on the screen)\n        threshold: 9, // a minimal movement is ok, but keep it low\n        posThreshold: 10 // a multi-tap can be a bit off the initial position\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_MANIPULATION];\n    },\n\n    process: function(input) {\n        var options = this.options;\n\n        var validPointers = input.pointers.length === options.pointers;\n        var validMovement = input.distance < options.threshold;\n        var validTouchTime = input.deltaTime < options.time;\n\n        this.reset();\n\n        if ((input.eventType & INPUT_START) && (this.count === 0)) {\n            return this.failTimeout();\n        }\n\n        // we only allow little movement\n        // and we've reached an end event, so a tap is possible\n        if (validMovement && validTouchTime && validPointers) {\n            if (input.eventType != INPUT_END) {\n                return this.failTimeout();\n            }\n\n            var validInterval = this.pTime ? (input.timeStamp - this.pTime < options.interval) : true;\n            var validMultiTap = !this.pCenter || getDistance(this.pCenter, input.center) < options.posThreshold;\n\n            this.pTime = input.timeStamp;\n            this.pCenter = input.center;\n\n            if (!validMultiTap || !validInterval) {\n                this.count = 1;\n            } else {\n                this.count += 1;\n            }\n\n            this._input = input;\n\n            // if tap count matches we have recognized it,\n            // else it has began recognizing...\n            var tapCount = this.count % options.taps;\n            if (tapCount === 0) {\n                // no failing requirements, immediately trigger the tap event\n                // or wait as long as the multitap interval to trigger\n                if (!this.hasRequireFailures()) {\n                    return STATE_RECOGNIZED;\n                } else {\n                    this._timer = setTimeoutContext(function() {\n                        this.state = STATE_RECOGNIZED;\n                        this.tryEmit();\n                    }, options.interval, this);\n                    return STATE_BEGAN;\n                }\n            }\n        }\n        return STATE_FAILED;\n    },\n\n    failTimeout: function() {\n        this._timer = setTimeoutContext(function() {\n            this.state = STATE_FAILED;\n        }, this.options.interval, this);\n        return STATE_FAILED;\n    },\n\n    reset: function() {\n        clearTimeout(this._timer);\n    },\n\n    emit: function() {\n        if (this.state == STATE_RECOGNIZED) {\n            this._input.tapCount = this.count;\n            this.manager.emit(this.options.event, this._input);\n        }\n    }\n});\n\n/**\n * Simple way to create a manager with a default set of recognizers.\n * @param {HTMLElement} element\n * @param {Object} [options]\n * @constructor\n */\nfunction Hammer(element, options) {\n    options = options || {};\n    options.recognizers = ifUndefined(options.recognizers, Hammer.defaults.preset);\n    return new Manager(element, options);\n}\n\n/**\n * @const {string}\n */\nHammer.VERSION = '2.0.7';\n\n/**\n * default settings\n * @namespace\n */\nHammer.defaults = {\n    /**\n     * set if DOM events are being triggered.\n     * But this is slower and unused by simple implementations, so disabled by default.\n     * @type {Boolean}\n     * @default false\n     */\n    domEvents: false,\n\n    /**\n     * The value for the touchAction property/fallback.\n     * When set to `compute` it will magically set the correct value based on the added recognizers.\n     * @type {String}\n     * @default compute\n     */\n    touchAction: TOUCH_ACTION_COMPUTE,\n\n    /**\n     * @type {Boolean}\n     * @default true\n     */\n    enable: true,\n\n    /**\n     * EXPERIMENTAL FEATURE -- can be removed/changed\n     * Change the parent input target element.\n     * If Null, then it is being set the to main element.\n     * @type {Null|EventTarget}\n     * @default null\n     */\n    inputTarget: null,\n\n    /**\n     * force an input class\n     * @type {Null|Function}\n     * @default null\n     */\n    inputClass: null,\n\n    /**\n     * Default recognizer setup when calling `Hammer()`\n     * When creating a new Manager these will be skipped.\n     * @type {Array}\n     */\n    preset: [\n        // RecognizerClass, options, [recognizeWith, ...], [requireFailure, ...]\n        [RotateRecognizer, {enable: false}],\n        [PinchRecognizer, {enable: false}, ['rotate']],\n        [SwipeRecognizer, {direction: DIRECTION_HORIZONTAL}],\n        [PanRecognizer, {direction: DIRECTION_HORIZONTAL}, ['swipe']],\n        [TapRecognizer],\n        [TapRecognizer, {event: 'doubletap', taps: 2}, ['tap']],\n        [PressRecognizer]\n    ],\n\n    /**\n     * Some CSS properties can be used to improve the working of Hammer.\n     * Add them to this method and they will be set when creating a new Manager.\n     * @namespace\n     */\n    cssProps: {\n        /**\n         * Disables text selection to improve the dragging gesture. Mainly for desktop browsers.\n         * @type {String}\n         * @default 'none'\n         */\n        userSelect: 'none',\n\n        /**\n         * Disable the Windows Phone grippers when pressing an element.\n         * @type {String}\n         * @default 'none'\n         */\n        touchSelect: 'none',\n\n        /**\n         * Disables the default callout shown when you touch and hold a touch target.\n         * On iOS, when you touch and hold a touch target such as a link, Safari displays\n         * a callout containing information about the link. This property allows you to disable that callout.\n         * @type {String}\n         * @default 'none'\n         */\n        touchCallout: 'none',\n\n        /**\n         * Specifies whether zooming is enabled. Used by IE10>\n         * @type {String}\n         * @default 'none'\n         */\n        contentZooming: 'none',\n\n        /**\n         * Specifies that an entire element should be draggable instead of its contents. Mainly for desktop browsers.\n         * @type {String}\n         * @default 'none'\n         */\n        userDrag: 'none',\n\n        /**\n         * Overrides the highlight color shown when the user taps a link or a JavaScript\n         * clickable element in iOS. This property obeys the alpha value, if specified.\n         * @type {String}\n         * @default 'rgba(0,0,0,0)'\n         */\n        tapHighlightColor: 'rgba(0,0,0,0)'\n    }\n};\n\nvar STOP = 1;\nvar FORCED_STOP = 2;\n\n/**\n * Manager\n * @param {HTMLElement} element\n * @param {Object} [options]\n * @constructor\n */\nfunction Manager(element, options) {\n    this.options = assign({}, Hammer.defaults, options || {});\n\n    this.options.inputTarget = this.options.inputTarget || element;\n\n    this.handlers = {};\n    this.session = {};\n    this.recognizers = [];\n    this.oldCssProps = {};\n\n    this.element = element;\n    this.input = createInputInstance(this);\n    this.touchAction = new TouchAction(this, this.options.touchAction);\n\n    toggleCssProps(this, true);\n\n    each(this.options.recognizers, function(item) {\n        var recognizer = this.add(new (item[0])(item[1]));\n        item[2] && recognizer.recognizeWith(item[2]);\n        item[3] && recognizer.requireFailure(item[3]);\n    }, this);\n}\n\nManager.prototype = {\n    /**\n     * set options\n     * @param {Object} options\n     * @returns {Manager}\n     */\n    set: function(options) {\n        assign(this.options, options);\n\n        // Options that need a little more setup\n        if (options.touchAction) {\n            this.touchAction.update();\n        }\n        if (options.inputTarget) {\n            // Clean up existing event listeners and reinitialize\n            this.input.destroy();\n            this.input.target = options.inputTarget;\n            this.input.init();\n        }\n        return this;\n    },\n\n    /**\n     * stop recognizing for this session.\n     * This session will be discarded, when a new [input]start event is fired.\n     * When forced, the recognizer cycle is stopped immediately.\n     * @param {Boolean} [force]\n     */\n    stop: function(force) {\n        this.session.stopped = force ? FORCED_STOP : STOP;\n    },\n\n    /**\n     * run the recognizers!\n     * called by the inputHandler function on every movement of the pointers (touches)\n     * it walks through all the recognizers and tries to detect the gesture that is being made\n     * @param {Object} inputData\n     */\n    recognize: function(inputData) {\n        var session = this.session;\n        if (session.stopped) {\n            return;\n        }\n\n        // run the touch-action polyfill\n        this.touchAction.preventDefaults(inputData);\n\n        var recognizer;\n        var recognizers = this.recognizers;\n\n        // this holds the recognizer that is being recognized.\n        // so the recognizer's state needs to be BEGAN, CHANGED, ENDED or RECOGNIZED\n        // if no recognizer is detecting a thing, it is set to `null`\n        var curRecognizer = session.curRecognizer;\n\n        // reset when the last recognizer is recognized\n        // or when we're in a new session\n        if (!curRecognizer || (curRecognizer && curRecognizer.state & STATE_RECOGNIZED)) {\n            curRecognizer = session.curRecognizer = null;\n        }\n\n        var i = 0;\n        while (i < recognizers.length) {\n            recognizer = recognizers[i];\n\n            // find out if we are allowed try to recognize the input for this one.\n            // 1.   allow if the session is NOT forced stopped (see the .stop() method)\n            // 2.   allow if we still haven't recognized a gesture in this session, or the this recognizer is the one\n            //      that is being recognized.\n            // 3.   allow if the recognizer is allowed to run simultaneous with the current recognized recognizer.\n            //      this can be setup with the `recognizeWith()` method on the recognizer.\n            if (session.stopped !== FORCED_STOP && ( // 1\n                    !curRecognizer || recognizer == curRecognizer || // 2\n                    recognizer.canRecognizeWith(curRecognizer))) { // 3\n                recognizer.recognize(inputData);\n            } else {\n                recognizer.reset();\n            }\n\n            // if the recognizer has been recognizing the input as a valid gesture, we want to store this one as the\n            // current active recognizer. but only if we don't already have an active recognizer\n            if (!curRecognizer && recognizer.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED)) {\n                curRecognizer = session.curRecognizer = recognizer;\n            }\n            i++;\n        }\n    },\n\n    /**\n     * get a recognizer by its event name.\n     * @param {Recognizer|String} recognizer\n     * @returns {Recognizer|Null}\n     */\n    get: function(recognizer) {\n        if (recognizer instanceof Recognizer) {\n            return recognizer;\n        }\n\n        var recognizers = this.recognizers;\n        for (var i = 0; i < recognizers.length; i++) {\n            if (recognizers[i].options.event == recognizer) {\n                return recognizers[i];\n            }\n        }\n        return null;\n    },\n\n    /**\n     * add a recognizer to the manager\n     * existing recognizers with the same event name will be removed\n     * @param {Recognizer} recognizer\n     * @returns {Recognizer|Manager}\n     */\n    add: function(recognizer) {\n        if (invokeArrayArg(recognizer, 'add', this)) {\n            return this;\n        }\n\n        // remove existing\n        var existing = this.get(recognizer.options.event);\n        if (existing) {\n            this.remove(existing);\n        }\n\n        this.recognizers.push(recognizer);\n        recognizer.manager = this;\n\n        this.touchAction.update();\n        return recognizer;\n    },\n\n    /**\n     * remove a recognizer by name or instance\n     * @param {Recognizer|String} recognizer\n     * @returns {Manager}\n     */\n    remove: function(recognizer) {\n        if (invokeArrayArg(recognizer, 'remove', this)) {\n            return this;\n        }\n\n        recognizer = this.get(recognizer);\n\n        // let's make sure this recognizer exists\n        if (recognizer) {\n            var recognizers = this.recognizers;\n            var index = inArray(recognizers, recognizer);\n\n            if (index !== -1) {\n                recognizers.splice(index, 1);\n                this.touchAction.update();\n            }\n        }\n\n        return this;\n    },\n\n    /**\n     * bind event\n     * @param {String} events\n     * @param {Function} handler\n     * @returns {EventEmitter} this\n     */\n    on: function(events, handler) {\n        if (events === undefined) {\n            return;\n        }\n        if (handler === undefined) {\n            return;\n        }\n\n        var handlers = this.handlers;\n        each(splitStr(events), function(event) {\n            handlers[event] = handlers[event] || [];\n            handlers[event].push(handler);\n        });\n        return this;\n    },\n\n    /**\n     * unbind event, leave emit blank to remove all handlers\n     * @param {String} events\n     * @param {Function} [handler]\n     * @returns {EventEmitter} this\n     */\n    off: function(events, handler) {\n        if (events === undefined) {\n            return;\n        }\n\n        var handlers = this.handlers;\n        each(splitStr(events), function(event) {\n            if (!handler) {\n                delete handlers[event];\n            } else {\n                handlers[event] && handlers[event].splice(inArray(handlers[event], handler), 1);\n            }\n        });\n        return this;\n    },\n\n    /**\n     * emit event to the listeners\n     * @param {String} event\n     * @param {Object} data\n     */\n    emit: function(event, data) {\n        // we also want to trigger dom events\n        if (this.options.domEvents) {\n            triggerDomEvent(event, data);\n        }\n\n        // no handlers, so skip it all\n        var handlers = this.handlers[event] && this.handlers[event].slice();\n        if (!handlers || !handlers.length) {\n            return;\n        }\n\n        data.type = event;\n        data.preventDefault = function() {\n            data.srcEvent.preventDefault();\n        };\n\n        var i = 0;\n        while (i < handlers.length) {\n            handlers[i](data);\n            i++;\n        }\n    },\n\n    /**\n     * destroy the manager and unbinds all events\n     * it doesn't unbind dom events, that is the user own responsibility\n     */\n    destroy: function() {\n        this.element && toggleCssProps(this, false);\n\n        this.handlers = {};\n        this.session = {};\n        this.input.destroy();\n        this.element = null;\n    }\n};\n\n/**\n * add/remove the css properties as defined in manager.options.cssProps\n * @param {Manager} manager\n * @param {Boolean} add\n */\nfunction toggleCssProps(manager, add) {\n    var element = manager.element;\n    if (!element.style) {\n        return;\n    }\n    var prop;\n    each(manager.options.cssProps, function(value, name) {\n        prop = prefixed(element.style, name);\n        if (add) {\n            manager.oldCssProps[prop] = element.style[prop];\n            element.style[prop] = value;\n        } else {\n            element.style[prop] = manager.oldCssProps[prop] || '';\n        }\n    });\n    if (!add) {\n        manager.oldCssProps = {};\n    }\n}\n\n/**\n * trigger dom event\n * @param {String} event\n * @param {Object} data\n */\nfunction triggerDomEvent(event, data) {\n    var gestureEvent = document.createEvent('Event');\n    gestureEvent.initEvent(event, true, true);\n    gestureEvent.gesture = data;\n    data.target.dispatchEvent(gestureEvent);\n}\n\nassign(Hammer, {\n    INPUT_START: INPUT_START,\n    INPUT_MOVE: INPUT_MOVE,\n    INPUT_END: INPUT_END,\n    INPUT_CANCEL: INPUT_CANCEL,\n\n    STATE_POSSIBLE: STATE_POSSIBLE,\n    STATE_BEGAN: STATE_BEGAN,\n    STATE_CHANGED: STATE_CHANGED,\n    STATE_ENDED: STATE_ENDED,\n    STATE_RECOGNIZED: STATE_RECOGNIZED,\n    STATE_CANCELLED: STATE_CANCELLED,\n    STATE_FAILED: STATE_FAILED,\n\n    DIRECTION_NONE: DIRECTION_NONE,\n    DIRECTION_LEFT: DIRECTION_LEFT,\n    DIRECTION_RIGHT: DIRECTION_RIGHT,\n    DIRECTION_UP: DIRECTION_UP,\n    DIRECTION_DOWN: DIRECTION_DOWN,\n    DIRECTION_HORIZONTAL: DIRECTION_HORIZONTAL,\n    DIRECTION_VERTICAL: DIRECTION_VERTICAL,\n    DIRECTION_ALL: DIRECTION_ALL,\n\n    Manager: Manager,\n    Input: Input,\n    TouchAction: TouchAction,\n\n    TouchInput: TouchInput,\n    MouseInput: MouseInput,\n    PointerEventInput: PointerEventInput,\n    TouchMouseInput: TouchMouseInput,\n    SingleTouchInput: SingleTouchInput,\n\n    Recognizer: Recognizer,\n    AttrRecognizer: AttrRecognizer,\n    Tap: TapRecognizer,\n    Pan: PanRecognizer,\n    Swipe: SwipeRecognizer,\n    Pinch: PinchRecognizer,\n    Rotate: RotateRecognizer,\n    Press: PressRecognizer,\n\n    on: addEventListeners,\n    off: removeEventListeners,\n    each: each,\n    merge: merge,\n    extend: extend,\n    assign: assign,\n    inherit: inherit,\n    bindFn: bindFn,\n    prefixed: prefixed\n});\n\n// this prevents errors when Hammer is loaded in the presence of an AMD\n//  style loader but by script tag, not by the loader.\nvar freeGlobal = (typeof window !== 'undefined' ? window : (typeof self !== 'undefined' ? self : {})); // jshint ignore:line\nfreeGlobal.Hammer = Hammer;\n\nif (typeof define === 'function' && define.amd) {\n    define(function() {\n        return Hammer;\n    });\n} else if (typeof module != 'undefined' && module.exports) {\n    module.exports = Hammer;\n} else {\n    window[exportName] = Hammer;\n}\n\n})(window, document, 'Hammer');\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/hammerjs/hammer.js\n **/","define( [ \"Utility\", \"gator\" ], function( ut, Gator ) {\n\n\t// Every button should have an :after pseudo-element tooltip prebuilt in CSS.\n\t( function() {\n\t\tlet inspectingTooltips = false;\n\t\tlet waitingPeriod;\n\t\tlet allowanceInterval;\n\t\tlet elementStack = [];\n\n\t\tGator( document.body ).on( \"mouseover\", \".panel__button\", function( e ) {\n\n\t\t\t// Technically unnecessary but DOM call seems to suppress glitching.\n\t\t\tif ( this.classList.contains( \"panel__button--show-tooltip\" ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet button = this;\n\n\t\t\t// Once tooltips are shown, allow the user to scan quickly between tooltips\n\t\t\t// without delay\n\t\t\tlet delay = 1000;\n\t\t\tif ( inspectingTooltips ) {\n\t\t\t\tdelay = 0;\n\t\t\t}\n\n\t\t\t// Throttle multiple mouseover events.\n\t\t\tclearTimeout( waitingPeriod );\n\n\t\t\t// Still inspecting, don't set false yet\n\t\t\tclearTimeout( allowanceInterval );\n\n\t\t\twaitingPeriod = setTimeout( function() { addTooltip( button ); }, delay );\n\t\t\tbutton.addEventListener( \"mouseleave\", abortTooltip );\n\t\t} );\n\n\t\tlet addTooltip = function( buttonElem ) {\n\t\t\tinspectingTooltips = true;\n\t\t\twaitingPeriod = null;\n\n\t\t\t// Tooltips need to float above any adjacent panels, so\n\t\t\t// move the current panel to the stop of the stack.\n\t\t\tvar parentPanel = ut.getClosest( buttonElem, \".panel\" );\n\t\t\tshufflePanelStack( parentPanel );\n\n\t\t\tbuttonElem.classList.add( \"panel__button--show-tooltip\" );\n\t\t};\n\n\t\tlet abortTooltip = function() {\n\n\t\t\t// In case the mouse darts in and out, before the tooltip is ever shown.\n\t\t\tclearTimeout( waitingPeriod );\n\t\t\tthis.classList.remove( \"panel__button--show-tooltip\" );\n\t\t\tthis.removeEventListener( \"mouseleave\", abortTooltip );\n\t\t\tallowanceInterval =\tsetTimeout( function() { inspectingTooltips = false; }, 200 );\n\t\t};\n\n\t\t//\n\t\t// Panel Stacking on click\n\t\t//\n\t\t// Grouped with Tooltips because tooltip show sometimes needs to lift hovered button's\n\t\t// panel in the stacking order.\n\t\tlet getLayerNumber = function( elem ) {\n\t\t\tfor ( let i = 0; i < elementStack.length; i += 1 ) {\n\t\t\t\tif ( elem === elementStack[ i ] ) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tlet applyZindexClasses = function() {\n\t\t\tlet elem;\n\t\t\tlet len = elementStack.length;\n\t\t\tif ( !len ) { return; }\n\n\t\t\tfor ( var i = 0; i < len; i += 1 ) {\n\t\t\t\telem = elementStack[ i ];\n\n\t\t\t\tif ( elem ) { // Some mobile-only buttons float free & don't live in a panel.\n\n\t\t\t\t\t// Remove all the old class names.\n\t\t\t\t\tfor ( var j = 0; j < len; j += 1 ) {\n\t\t\t\t\t\telem.classList.remove( \"z-index\" + ( j + 1 ) );\n\t\t\t\t\t}\n\n\t\t\t\t\t// And apply the new.\n\t\t\t\t\telem.classList.add( \"z-index\" + ( i + 1 ) );\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tlet shufflePanelStack = function( panelToGoOnTop ) {\n\n\t\t\t// If click is on the topmost layer get out.\n\t\t\tif ( panelToGoOnTop === elementStack[ elementStack.length - 1 ] ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar currentLayerNumber = getLayerNumber( panelToGoOnTop );\n\n\t\t\tif ( typeof currentLayerNumber === \"number\" ) {\n\n\t\t\t\t// Remove from current position.\n\t\t\t\telementStack.splice( currentLayerNumber, 1 );\n\t\t\t}\n\n\t\t\t// Always apply classes to any panel that has been clicked\n\t\t\telementStack.push( panelToGoOnTop );\n\t\t\tapplyZindexClasses();\n\t\t};\n\n\t\tGator( document.body ).on( \"mousedown\", \".panel\", function() {\n\t\t\tshufflePanelStack( this );\n\t\t} );\n\t}() );\n\n} );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/app/js/es6/modules/tooltips-and-stacking.js\n **/","/**\n * Copyright 2014 Craig Campbell\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * GATOR.JS\n * Simple Event Delegation\n *\n * @version 1.2.4\n *\n * Compatible with IE 9+, FF 3.6+, Safari 5+, Chrome\n *\n * Include legacy.js for compatibility with older browsers\n *\n *             .-._   _ _ _ _ _ _ _ _\n *  .-''-.__.-'00  '-' ' ' ' ' ' ' ' '-.\n * '.___ '    .   .--_'-' '-' '-' _'-' '._\n *  V: V 'vv-'   '_   '.       .'  _..' '.'.\n *    '=.____.=_.--'   :_.__.__:_   '.   : :\n *            (((____.-'        '-.  /   : :\n *                              (((-'\\ .' /\n *                            _____..'  .'\n *                           '-._____.-'\n */\n(function() {\n    var _matcher,\n        _level = 0,\n        _id = 0,\n        _handlers = {},\n        _gatorInstances = {};\n\n    function _addEvent(gator, type, callback) {\n\n        // blur and focus do not bubble up but if you use event capturing\n        // then you will get them\n        var useCapture = type == 'blur' || type == 'focus';\n        gator.element.addEventListener(type, callback, useCapture);\n    }\n\n    function _cancel(e) {\n        e.preventDefault();\n        e.stopPropagation();\n    }\n\n    /**\n     * returns function to use for determining if an element\n     * matches a query selector\n     *\n     * @returns {Function}\n     */\n    function _getMatcher(element) {\n        if (_matcher) {\n            return _matcher;\n        }\n\n        if (element.matches) {\n            _matcher = element.matches;\n            return _matcher;\n        }\n\n        if (element.webkitMatchesSelector) {\n            _matcher = element.webkitMatchesSelector;\n            return _matcher;\n        }\n\n        if (element.mozMatchesSelector) {\n            _matcher = element.mozMatchesSelector;\n            return _matcher;\n        }\n\n        if (element.msMatchesSelector) {\n            _matcher = element.msMatchesSelector;\n            return _matcher;\n        }\n\n        if (element.oMatchesSelector) {\n            _matcher = element.oMatchesSelector;\n            return _matcher;\n        }\n\n        // if it doesn't match a native browser method\n        // fall back to the gator function\n        _matcher = Gator.matchesSelector;\n        return _matcher;\n    }\n\n    /**\n     * determines if the specified element matches a given selector\n     *\n     * @param {Node} element - the element to compare against the selector\n     * @param {string} selector\n     * @param {Node} boundElement - the element the listener was attached to\n     * @returns {void|Node}\n     */\n    function _matchesSelector(element, selector, boundElement) {\n\n        // no selector means this event was bound directly to this element\n        if (selector == '_root') {\n            return boundElement;\n        }\n\n        // if we have moved up to the element you bound the event to\n        // then we have come too far\n        if (element === boundElement) {\n            return;\n        }\n\n        // if this is a match then we are done!\n        if (_getMatcher(element).call(element, selector)) {\n            return element;\n        }\n\n        // if this element did not match but has a parent we should try\n        // going up the tree to see if any of the parent elements match\n        // for example if you are looking for a click on an <a> tag but there\n        // is a <span> inside of the a tag that it is the target,\n        // it should still work\n        if (element.parentNode) {\n            _level++;\n            return _matchesSelector(element.parentNode, selector, boundElement);\n        }\n    }\n\n    function _addHandler(gator, event, selector, callback) {\n        if (!_handlers[gator.id]) {\n            _handlers[gator.id] = {};\n        }\n\n        if (!_handlers[gator.id][event]) {\n            _handlers[gator.id][event] = {};\n        }\n\n        if (!_handlers[gator.id][event][selector]) {\n            _handlers[gator.id][event][selector] = [];\n        }\n\n        _handlers[gator.id][event][selector].push(callback);\n    }\n\n    function _removeHandler(gator, event, selector, callback) {\n\n        // if there are no events tied to this element at all\n        // then don't do anything\n        if (!_handlers[gator.id]) {\n            return;\n        }\n\n        // if there is no event type specified then remove all events\n        // example: Gator(element).off()\n        if (!event) {\n            for (var type in _handlers[gator.id]) {\n                if (_handlers[gator.id].hasOwnProperty(type)) {\n                    _handlers[gator.id][type] = {};\n                }\n            }\n            return;\n        }\n\n        // if no callback or selector is specified remove all events of this type\n        // example: Gator(element).off('click')\n        if (!callback && !selector) {\n            _handlers[gator.id][event] = {};\n            return;\n        }\n\n        // if a selector is specified but no callback remove all events\n        // for this selector\n        // example: Gator(element).off('click', '.sub-element')\n        if (!callback) {\n            delete _handlers[gator.id][event][selector];\n            return;\n        }\n\n        // if we have specified an event type, selector, and callback then we\n        // need to make sure there are callbacks tied to this selector to\n        // begin with.  if there aren't then we can stop here\n        if (!_handlers[gator.id][event][selector]) {\n            return;\n        }\n\n        // if there are then loop through all the callbacks and if we find\n        // one that matches remove it from the array\n        for (var i = 0; i < _handlers[gator.id][event][selector].length; i++) {\n            if (_handlers[gator.id][event][selector][i] === callback) {\n                _handlers[gator.id][event][selector].splice(i, 1);\n                break;\n            }\n        }\n    }\n\n    function _handleEvent(id, e, type) {\n        if (!_handlers[id][type]) {\n            return;\n        }\n\n        var target = e.target || e.srcElement,\n            selector,\n            match,\n            matches = {},\n            i = 0,\n            j = 0;\n\n        // find all events that match\n        _level = 0;\n        for (selector in _handlers[id][type]) {\n            if (_handlers[id][type].hasOwnProperty(selector)) {\n                match = _matchesSelector(target, selector, _gatorInstances[id].element);\n\n                if (match && Gator.matchesEvent(type, _gatorInstances[id].element, match, selector == '_root', e)) {\n                    _level++;\n                    _handlers[id][type][selector].match = match;\n                    matches[_level] = _handlers[id][type][selector];\n                }\n            }\n        }\n\n        // stopPropagation() fails to set cancelBubble to true in Webkit\n        // @see http://code.google.com/p/chromium/issues/detail?id=162270\n        e.stopPropagation = function() {\n            e.cancelBubble = true;\n        };\n\n        for (i = 0; i <= _level; i++) {\n            if (matches[i]) {\n                for (j = 0; j < matches[i].length; j++) {\n                    if (matches[i][j].call(matches[i].match, e) === false) {\n                        Gator.cancel(e);\n                        return;\n                    }\n\n                    if (e.cancelBubble) {\n                        return;\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * binds the specified events to the element\n     *\n     * @param {string|Array} events\n     * @param {string} selector\n     * @param {Function} callback\n     * @param {boolean=} remove\n     * @returns {Object}\n     */\n    function _bind(events, selector, callback, remove) {\n\n        // fail silently if you pass null or undefined as an alement\n        // in the Gator constructor\n        if (!this.element) {\n            return;\n        }\n\n        if (!(events instanceof Array)) {\n            events = [events];\n        }\n\n        if (!callback && typeof(selector) == 'function') {\n            callback = selector;\n            selector = '_root';\n        }\n\n        var id = this.id,\n            i;\n\n        function _getGlobalCallback(type) {\n            return function(e) {\n                _handleEvent(id, e, type);\n            };\n        }\n\n        for (i = 0; i < events.length; i++) {\n            if (remove) {\n                _removeHandler(this, events[i], selector, callback);\n                continue;\n            }\n\n            if (!_handlers[id] || !_handlers[id][events[i]]) {\n                Gator.addEvent(this, events[i], _getGlobalCallback(events[i]));\n            }\n\n            _addHandler(this, events[i], selector, callback);\n        }\n\n        return this;\n    }\n\n    /**\n     * Gator object constructor\n     *\n     * @param {Node} element\n     */\n    function Gator(element, id) {\n\n        // called as function\n        if (!(this instanceof Gator)) {\n            // only keep one Gator instance per node to make sure that\n            // we don't create a ton of new objects if you want to delegate\n            // multiple events from the same node\n            //\n            // for example: Gator(document).on(...\n            for (var key in _gatorInstances) {\n                if (_gatorInstances[key].element === element) {\n                    return _gatorInstances[key];\n                }\n            }\n\n            _id++;\n            _gatorInstances[_id] = new Gator(element, _id);\n\n            return _gatorInstances[_id];\n        }\n\n        this.element = element;\n        this.id = id;\n    }\n\n    /**\n     * adds an event\n     *\n     * @param {string|Array} events\n     * @param {string} selector\n     * @param {Function} callback\n     * @returns {Object}\n     */\n    Gator.prototype.on = function(events, selector, callback) {\n        return _bind.call(this, events, selector, callback);\n    };\n\n    /**\n     * removes an event\n     *\n     * @param {string|Array} events\n     * @param {string} selector\n     * @param {Function} callback\n     * @returns {Object}\n     */\n    Gator.prototype.off = function(events, selector, callback) {\n        return _bind.call(this, events, selector, callback, true);\n    };\n\n    Gator.matchesSelector = function() {};\n    Gator.cancel = _cancel;\n    Gator.addEvent = _addEvent;\n    Gator.matchesEvent = function() {\n        return true;\n    };\n\n    if (typeof module !== 'undefined' && module.exports) {\n        module.exports = Gator;\n    }\n\n    window.Gator = Gator;\n}) ();\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/gator/gator.js\n **/"],"sourceRoot":""}